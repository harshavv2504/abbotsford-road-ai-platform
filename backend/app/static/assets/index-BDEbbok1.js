var zm=Object.defineProperty;var Cf=U=>{throw TypeError(U)};var qm=(U,j,B)=>j in U?zm(U,j,{enumerable:!0,configurable:!0,writable:!0,value:B}):U[j]=B;var Bt=(U,j,B)=>qm(U,typeof j!="symbol"?j+"":j,B),_f=(U,j,B)=>j.has(U)||Cf("Cannot "+B);var rt=(U,j,B)=>(_f(U,j,"read from private field"),B?B.call(U):j.get(U)),Pt=(U,j,B)=>j.has(U)?Cf("Cannot add the same private member more than once"):j instanceof WeakSet?j.add(U):j.set(U,B),Lt=(U,j,B,q)=>(_f(U,j,"write to private field"),q?q.call(U,B):j.set(U,B),B);(function(){const j=document.createElement("link").relList;if(j&&j.supports&&j.supports("modulepreload"))return;for(const V of document.querySelectorAll('link[rel="modulepreload"]'))q(V);new MutationObserver(V=>{for(const H of V)if(H.type==="childList")for(const $ of H.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&q($)}).observe(document,{childList:!0,subtree:!0});function B(V){const H={};return V.integrity&&(H.integrity=V.integrity),V.referrerPolicy&&(H.referrerPolicy=V.referrerPolicy),V.crossOrigin==="use-credentials"?H.credentials="include":V.crossOrigin==="anonymous"?H.credentials="omit":H.credentials="same-origin",H}function q(V){if(V.ep)return;V.ep=!0;const H=B(V);fetch(V.href,H)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(U){return U&&U.__esModule&&Object.prototype.hasOwnProperty.call(U,"default")?U.default:U}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var U=Symbol.for("react.transitional.element"),j=Symbol.for("react.fragment");function B(q,V,H){var $=null;if(H!==void 0&&($=""+H),V.key!==void 0&&($=""+V.key),"key"in V){H={};for(var K in V)K!=="key"&&(H[K]=V[K])}else H=V;return V=H.ref,{$$typeof:U,type:q,key:$,ref:V!==void 0?V:null,props:H}}return reactJsxRuntime_production.Fragment=j,reactJsxRuntime_production.jsx=B,reactJsxRuntime_production.jsxs=B,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(U){function j(Se,we){var $e=Se.length;Se.push(we);e:for(;0<$e;){var Ye=$e-1>>>1,pe=Se[Ye];if(0<V(pe,we))Se[Ye]=we,Se[$e]=pe,$e=Ye;else break e}}function B(Se){return Se.length===0?null:Se[0]}function q(Se){if(Se.length===0)return null;var we=Se[0],$e=Se.pop();if($e!==we){Se[0]=$e;e:for(var Ye=0,pe=Se.length,ve=pe>>>1;Ye<ve;){var Oe=2*(Ye+1)-1,fe=Se[Oe],Qe=Oe+1,tt=Se[Qe];if(0>V(fe,$e))Qe<pe&&0>V(tt,fe)?(Se[Ye]=tt,Se[Qe]=$e,Ye=Qe):(Se[Ye]=fe,Se[Oe]=$e,Ye=Oe);else if(Qe<pe&&0>V(tt,$e))Se[Ye]=tt,Se[Qe]=$e,Ye=Qe;else break e}}return we}function V(Se,we){var $e=Se.sortIndex-we.sortIndex;return $e!==0?$e:Se.id-we.id}if(U.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var H=performance;U.unstable_now=function(){return H.now()}}else{var $=Date,K=$.now();U.unstable_now=function(){return $.now()-K}}var X=[],Q=[],W=1,Z=null,te=3,ie=!1,ae=!1,oe=!1,de=!1,le=typeof setTimeout=="function"?setTimeout:null,ue=typeof clearTimeout=="function"?clearTimeout:null,he=typeof setImmediate<"u"?setImmediate:null;function me(Se){for(var we=B(Q);we!==null;){if(we.callback===null)q(Q);else if(we.startTime<=Se)q(Q),we.sortIndex=we.expirationTime,j(X,we);else break;we=B(Q)}}function be(Se){if(oe=!1,me(Se),!ae)if(B(X)!==null)ae=!0,ge||(ge=!0,Ie());else{var we=B(Q);we!==null&&Ve(be,we.startTime-Se)}}var ge=!1,Ee=-1,Fe=5,Ue=-1;function ze(){return de?!0:!(U.unstable_now()-Ue<Fe)}function xe(){if(de=!1,ge){var Se=U.unstable_now();Ue=Se;var we=!0;try{e:{ae=!1,oe&&(oe=!1,ue(Ee),Ee=-1),ie=!0;var $e=te;try{t:{for(me(Se),Z=B(X);Z!==null&&!(Z.expirationTime>Se&&ze());){var Ye=Z.callback;if(typeof Ye=="function"){Z.callback=null,te=Z.priorityLevel;var pe=Ye(Z.expirationTime<=Se);if(Se=U.unstable_now(),typeof pe=="function"){Z.callback=pe,me(Se),we=!0;break t}Z===B(X)&&q(X),me(Se)}else q(X);Z=B(X)}if(Z!==null)we=!0;else{var ve=B(Q);ve!==null&&Ve(be,ve.startTime-Se),we=!1}}break e}finally{Z=null,te=$e,ie=!1}we=void 0}}finally{we?Ie():ge=!1}}}var Ie;if(typeof he=="function")Ie=function(){he(xe)};else if(typeof MessageChannel<"u"){var Ge=new MessageChannel,De=Ge.port2;Ge.port1.onmessage=xe,Ie=function(){De.postMessage(null)}}else Ie=function(){le(xe,0)};function Ve(Se,we){Ee=le(function(){Se(U.unstable_now())},we)}U.unstable_IdlePriority=5,U.unstable_ImmediatePriority=1,U.unstable_LowPriority=4,U.unstable_NormalPriority=3,U.unstable_Profiling=null,U.unstable_UserBlockingPriority=2,U.unstable_cancelCallback=function(Se){Se.callback=null},U.unstable_forceFrameRate=function(Se){0>Se||125<Se?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fe=0<Se?Math.floor(1e3/Se):5},U.unstable_getCurrentPriorityLevel=function(){return te},U.unstable_next=function(Se){switch(te){case 1:case 2:case 3:var we=3;break;default:we=te}var $e=te;te=we;try{return Se()}finally{te=$e}},U.unstable_requestPaint=function(){de=!0},U.unstable_runWithPriority=function(Se,we){switch(Se){case 1:case 2:case 3:case 4:case 5:break;default:Se=3}var $e=te;te=Se;try{return we()}finally{te=$e}},U.unstable_scheduleCallback=function(Se,we,$e){var Ye=U.unstable_now();switch(typeof $e=="object"&&$e!==null?($e=$e.delay,$e=typeof $e=="number"&&0<$e?Ye+$e:Ye):$e=Ye,Se){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=$e+pe,Se={id:W++,callback:we,priorityLevel:Se,startTime:$e,expirationTime:pe,sortIndex:-1},$e>Ye?(Se.sortIndex=$e,j(Q,Se),B(X)===null&&Se===B(Q)&&(oe?(ue(Ee),Ee=-1):oe=!0,Ve(be,$e-Ye))):(Se.sortIndex=pe,j(X,Se),ae||ie||(ae=!0,ge||(ge=!0,Ie()))),Se},U.unstable_shouldYield=ze,U.unstable_wrapCallback=function(Se){var we=te;return function(){var $e=te;te=we;try{return Se.apply(this,arguments)}finally{te=$e}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var U=Symbol.for("react.transitional.element"),j=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),V=Symbol.for("react.profiler"),H=Symbol.for("react.consumer"),$=Symbol.for("react.context"),K=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),Q=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),Z=Symbol.for("react.activity"),te=Symbol.iterator;function ie(ve){return ve===null||typeof ve!="object"?null:(ve=te&&ve[te]||ve["@@iterator"],typeof ve=="function"?ve:null)}var ae={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},oe=Object.assign,de={};function le(ve,Oe,fe){this.props=ve,this.context=Oe,this.refs=de,this.updater=fe||ae}le.prototype.isReactComponent={},le.prototype.setState=function(ve,Oe){if(typeof ve!="object"&&typeof ve!="function"&&ve!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ve,Oe,"setState")},le.prototype.forceUpdate=function(ve){this.updater.enqueueForceUpdate(this,ve,"forceUpdate")};function ue(){}ue.prototype=le.prototype;function he(ve,Oe,fe){this.props=ve,this.context=Oe,this.refs=de,this.updater=fe||ae}var me=he.prototype=new ue;me.constructor=he,oe(me,le.prototype),me.isPureReactComponent=!0;var be=Array.isArray;function ge(){}var Ee={H:null,A:null,T:null,S:null},Fe=Object.prototype.hasOwnProperty;function Ue(ve,Oe,fe){var Qe=fe.ref;return{$$typeof:U,type:ve,key:Oe,ref:Qe!==void 0?Qe:null,props:fe}}function ze(ve,Oe){return Ue(ve.type,Oe,ve.props)}function xe(ve){return typeof ve=="object"&&ve!==null&&ve.$$typeof===U}function Ie(ve){var Oe={"=":"=0",":":"=2"};return"$"+ve.replace(/[=:]/g,function(fe){return Oe[fe]})}var Ge=/\/+/g;function De(ve,Oe){return typeof ve=="object"&&ve!==null&&ve.key!=null?Ie(""+ve.key):Oe.toString(36)}function Ve(ve){switch(ve.status){case"fulfilled":return ve.value;case"rejected":throw ve.reason;default:switch(typeof ve.status=="string"?ve.then(ge,ge):(ve.status="pending",ve.then(function(Oe){ve.status==="pending"&&(ve.status="fulfilled",ve.value=Oe)},function(Oe){ve.status==="pending"&&(ve.status="rejected",ve.reason=Oe)})),ve.status){case"fulfilled":return ve.value;case"rejected":throw ve.reason}}throw ve}function Se(ve,Oe,fe,Qe,tt){var He=typeof ve;(He==="undefined"||He==="boolean")&&(ve=null);var at=!1;if(ve===null)at=!0;else switch(He){case"bigint":case"string":case"number":at=!0;break;case"object":switch(ve.$$typeof){case U:case j:at=!0;break;case W:return at=ve._init,Se(at(ve._payload),Oe,fe,Qe,tt)}}if(at)return tt=tt(ve),at=Qe===""?"."+De(ve,0):Qe,be(tt)?(fe="",at!=null&&(fe=at.replace(Ge,"$&/")+"/"),Se(tt,Oe,fe,"",function(on){return on})):tt!=null&&(xe(tt)&&(tt=ze(tt,fe+(tt.key==null||ve&&ve.key===tt.key?"":(""+tt.key).replace(Ge,"$&/")+"/")+at)),Oe.push(tt)),1;at=0;var xt=Qe===""?".":Qe+":";if(be(ve))for(var gt=0;gt<ve.length;gt++)Qe=ve[gt],He=xt+De(Qe,gt),at+=Se(Qe,Oe,fe,He,tt);else if(gt=ie(ve),typeof gt=="function")for(ve=gt.call(ve),gt=0;!(Qe=ve.next()).done;)Qe=Qe.value,He=xt+De(Qe,gt++),at+=Se(Qe,Oe,fe,He,tt);else if(He==="object"){if(typeof ve.then=="function")return Se(Ve(ve),Oe,fe,Qe,tt);throw Oe=String(ve),Error("Objects are not valid as a React child (found: "+(Oe==="[object Object]"?"object with keys {"+Object.keys(ve).join(", ")+"}":Oe)+"). If you meant to render a collection of children, use an array instead.")}return at}function we(ve,Oe,fe){if(ve==null)return ve;var Qe=[],tt=0;return Se(ve,Qe,"","",function(He){return Oe.call(fe,He,tt++)}),Qe}function $e(ve){if(ve._status===-1){var Oe=ve._result;Oe=Oe(),Oe.then(function(fe){(ve._status===0||ve._status===-1)&&(ve._status=1,ve._result=fe)},function(fe){(ve._status===0||ve._status===-1)&&(ve._status=2,ve._result=fe)}),ve._status===-1&&(ve._status=0,ve._result=Oe)}if(ve._status===1)return ve._result.default;throw ve._result}var Ye=typeof reportError=="function"?reportError:function(ve){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Oe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ve=="object"&&ve!==null&&typeof ve.message=="string"?String(ve.message):String(ve),error:ve});if(!window.dispatchEvent(Oe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ve);return}console.error(ve)},pe={map:we,forEach:function(ve,Oe,fe){we(ve,function(){Oe.apply(this,arguments)},fe)},count:function(ve){var Oe=0;return we(ve,function(){Oe++}),Oe},toArray:function(ve){return we(ve,function(Oe){return Oe})||[]},only:function(ve){if(!xe(ve))throw Error("React.Children.only expected to receive a single React element child.");return ve}};return react_production.Activity=Z,react_production.Children=pe,react_production.Component=le,react_production.Fragment=B,react_production.Profiler=V,react_production.PureComponent=he,react_production.StrictMode=q,react_production.Suspense=X,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ee,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(ve){return Ee.H.useMemoCache(ve)}},react_production.cache=function(ve){return function(){return ve.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(ve,Oe,fe){if(ve==null)throw Error("The argument must be a React element, but you passed "+ve+".");var Qe=oe({},ve.props),tt=ve.key;if(Oe!=null)for(He in Oe.key!==void 0&&(tt=""+Oe.key),Oe)!Fe.call(Oe,He)||He==="key"||He==="__self"||He==="__source"||He==="ref"&&Oe.ref===void 0||(Qe[He]=Oe[He]);var He=arguments.length-2;if(He===1)Qe.children=fe;else if(1<He){for(var at=Array(He),xt=0;xt<He;xt++)at[xt]=arguments[xt+2];Qe.children=at}return Ue(ve.type,tt,Qe)},react_production.createContext=function(ve){return ve={$$typeof:$,_currentValue:ve,_currentValue2:ve,_threadCount:0,Provider:null,Consumer:null},ve.Provider=ve,ve.Consumer={$$typeof:H,_context:ve},ve},react_production.createElement=function(ve,Oe,fe){var Qe,tt={},He=null;if(Oe!=null)for(Qe in Oe.key!==void 0&&(He=""+Oe.key),Oe)Fe.call(Oe,Qe)&&Qe!=="key"&&Qe!=="__self"&&Qe!=="__source"&&(tt[Qe]=Oe[Qe]);var at=arguments.length-2;if(at===1)tt.children=fe;else if(1<at){for(var xt=Array(at),gt=0;gt<at;gt++)xt[gt]=arguments[gt+2];tt.children=xt}if(ve&&ve.defaultProps)for(Qe in at=ve.defaultProps,at)tt[Qe]===void 0&&(tt[Qe]=at[Qe]);return Ue(ve,He,tt)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(ve){return{$$typeof:K,render:ve}},react_production.isValidElement=xe,react_production.lazy=function(ve){return{$$typeof:W,_payload:{_status:-1,_result:ve},_init:$e}},react_production.memo=function(ve,Oe){return{$$typeof:Q,type:ve,compare:Oe===void 0?null:Oe}},react_production.startTransition=function(ve){var Oe=Ee.T,fe={};Ee.T=fe;try{var Qe=ve(),tt=Ee.S;tt!==null&&tt(fe,Qe),typeof Qe=="object"&&Qe!==null&&typeof Qe.then=="function"&&Qe.then(ge,Ye)}catch(He){Ye(He)}finally{Oe!==null&&fe.types!==null&&(Oe.types=fe.types),Ee.T=Oe}},react_production.unstable_useCacheRefresh=function(){return Ee.H.useCacheRefresh()},react_production.use=function(ve){return Ee.H.use(ve)},react_production.useActionState=function(ve,Oe,fe){return Ee.H.useActionState(ve,Oe,fe)},react_production.useCallback=function(ve,Oe){return Ee.H.useCallback(ve,Oe)},react_production.useContext=function(ve){return Ee.H.useContext(ve)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(ve,Oe){return Ee.H.useDeferredValue(ve,Oe)},react_production.useEffect=function(ve,Oe){return Ee.H.useEffect(ve,Oe)},react_production.useEffectEvent=function(ve){return Ee.H.useEffectEvent(ve)},react_production.useId=function(){return Ee.H.useId()},react_production.useImperativeHandle=function(ve,Oe,fe){return Ee.H.useImperativeHandle(ve,Oe,fe)},react_production.useInsertionEffect=function(ve,Oe){return Ee.H.useInsertionEffect(ve,Oe)},react_production.useLayoutEffect=function(ve,Oe){return Ee.H.useLayoutEffect(ve,Oe)},react_production.useMemo=function(ve,Oe){return Ee.H.useMemo(ve,Oe)},react_production.useOptimistic=function(ve,Oe){return Ee.H.useOptimistic(ve,Oe)},react_production.useReducer=function(ve,Oe,fe){return Ee.H.useReducer(ve,Oe,fe)},react_production.useRef=function(ve){return Ee.H.useRef(ve)},react_production.useState=function(ve){return Ee.H.useState(ve)},react_production.useSyncExternalStore=function(ve,Oe,fe){return Ee.H.useSyncExternalStore(ve,Oe,fe)},react_production.useTransition=function(){return Ee.H.useTransition()},react_production.version="19.2.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var U=requireReact();function j(X){var Q="https://react.dev/errors/"+X;if(1<arguments.length){Q+="?args[]="+encodeURIComponent(arguments[1]);for(var W=2;W<arguments.length;W++)Q+="&args[]="+encodeURIComponent(arguments[W])}return"Minified React error #"+X+"; visit "+Q+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function B(){}var q={d:{f:B,r:function(){throw Error(j(522))},D:B,C:B,L:B,m:B,X:B,S:B,M:B},p:0,findDOMNode:null},V=Symbol.for("react.portal");function H(X,Q,W){var Z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:Z==null?null:""+Z,children:X,containerInfo:Q,implementation:W}}var $=U.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function K(X,Q){if(X==="font")return"";if(typeof Q=="string")return Q==="use-credentials"?Q:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=q,reactDom_production.createPortal=function(X,Q){var W=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Q||Q.nodeType!==1&&Q.nodeType!==9&&Q.nodeType!==11)throw Error(j(299));return H(X,Q,null,W)},reactDom_production.flushSync=function(X){var Q=$.T,W=q.p;try{if($.T=null,q.p=2,X)return X()}finally{$.T=Q,q.p=W,q.d.f()}},reactDom_production.preconnect=function(X,Q){typeof X=="string"&&(Q?(Q=Q.crossOrigin,Q=typeof Q=="string"?Q==="use-credentials"?Q:"":void 0):Q=null,q.d.C(X,Q))},reactDom_production.prefetchDNS=function(X){typeof X=="string"&&q.d.D(X)},reactDom_production.preinit=function(X,Q){if(typeof X=="string"&&Q&&typeof Q.as=="string"){var W=Q.as,Z=K(W,Q.crossOrigin),te=typeof Q.integrity=="string"?Q.integrity:void 0,ie=typeof Q.fetchPriority=="string"?Q.fetchPriority:void 0;W==="style"?q.d.S(X,typeof Q.precedence=="string"?Q.precedence:void 0,{crossOrigin:Z,integrity:te,fetchPriority:ie}):W==="script"&&q.d.X(X,{crossOrigin:Z,integrity:te,fetchPriority:ie,nonce:typeof Q.nonce=="string"?Q.nonce:void 0})}},reactDom_production.preinitModule=function(X,Q){if(typeof X=="string")if(typeof Q=="object"&&Q!==null){if(Q.as==null||Q.as==="script"){var W=K(Q.as,Q.crossOrigin);q.d.M(X,{crossOrigin:W,integrity:typeof Q.integrity=="string"?Q.integrity:void 0,nonce:typeof Q.nonce=="string"?Q.nonce:void 0})}}else Q==null&&q.d.M(X)},reactDom_production.preload=function(X,Q){if(typeof X=="string"&&typeof Q=="object"&&Q!==null&&typeof Q.as=="string"){var W=Q.as,Z=K(W,Q.crossOrigin);q.d.L(X,W,{crossOrigin:Z,integrity:typeof Q.integrity=="string"?Q.integrity:void 0,nonce:typeof Q.nonce=="string"?Q.nonce:void 0,type:typeof Q.type=="string"?Q.type:void 0,fetchPriority:typeof Q.fetchPriority=="string"?Q.fetchPriority:void 0,referrerPolicy:typeof Q.referrerPolicy=="string"?Q.referrerPolicy:void 0,imageSrcSet:typeof Q.imageSrcSet=="string"?Q.imageSrcSet:void 0,imageSizes:typeof Q.imageSizes=="string"?Q.imageSizes:void 0,media:typeof Q.media=="string"?Q.media:void 0})}},reactDom_production.preloadModule=function(X,Q){if(typeof X=="string")if(Q){var W=K(Q.as,Q.crossOrigin);q.d.m(X,{as:typeof Q.as=="string"&&Q.as!=="script"?Q.as:void 0,crossOrigin:W,integrity:typeof Q.integrity=="string"?Q.integrity:void 0})}else q.d.m(X)},reactDom_production.requestFormReset=function(X){q.d.r(X)},reactDom_production.unstable_batchedUpdates=function(X,Q){return X(Q)},reactDom_production.useFormState=function(X,Q,W){return $.H.useFormState(X,Q,W)},reactDom_production.useFormStatus=function(){return $.H.useHostTransitionStatus()},reactDom_production.version="19.2.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function U(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(U)}catch(j){console.error(j)}}return U(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var U=requireScheduler(),j=requireReact(),B=requireReactDom();function q(z){var F="https://react.dev/errors/"+z;if(1<arguments.length){F+="?args[]="+encodeURIComponent(arguments[1]);for(var G=2;G<arguments.length;G++)F+="&args[]="+encodeURIComponent(arguments[G])}return"Minified React error #"+z+"; visit "+F+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function V(z){return!(!z||z.nodeType!==1&&z.nodeType!==9&&z.nodeType!==11)}function H(z){var F=z,G=z;if(z.alternate)for(;F.return;)F=F.return;else{z=F;do F=z,(F.flags&4098)!==0&&(G=F.return),z=F.return;while(z)}return F.tag===3?G:null}function $(z){if(z.tag===13){var F=z.memoizedState;if(F===null&&(z=z.alternate,z!==null&&(F=z.memoizedState)),F!==null)return F.dehydrated}return null}function K(z){if(z.tag===31){var F=z.memoizedState;if(F===null&&(z=z.alternate,z!==null&&(F=z.memoizedState)),F!==null)return F.dehydrated}return null}function X(z){if(H(z)!==z)throw Error(q(188))}function Q(z){var F=z.alternate;if(!F){if(F=H(z),F===null)throw Error(q(188));return F!==z?null:z}for(var G=z,Y=F;;){var ee=G.return;if(ee===null)break;var ne=ee.alternate;if(ne===null){if(Y=ee.return,Y!==null){G=Y;continue}break}if(ee.child===ne.child){for(ne=ee.child;ne;){if(ne===G)return X(ee),z;if(ne===Y)return X(ee),F;ne=ne.sibling}throw Error(q(188))}if(G.return!==Y.return)G=ee,Y=ne;else{for(var se=!1,ce=ee.child;ce;){if(ce===G){se=!0,G=ee,Y=ne;break}if(ce===Y){se=!0,Y=ee,G=ne;break}ce=ce.sibling}if(!se){for(ce=ne.child;ce;){if(ce===G){se=!0,G=ne,Y=ee;break}if(ce===Y){se=!0,Y=ne,G=ee;break}ce=ce.sibling}if(!se)throw Error(q(189))}}if(G.alternate!==Y)throw Error(q(190))}if(G.tag!==3)throw Error(q(188));return G.stateNode.current===G?z:F}function W(z){var F=z.tag;if(F===5||F===26||F===27||F===6)return z;for(z=z.child;z!==null;){if(F=W(z),F!==null)return F;z=z.sibling}return null}var Z=Object.assign,te=Symbol.for("react.element"),ie=Symbol.for("react.transitional.element"),ae=Symbol.for("react.portal"),oe=Symbol.for("react.fragment"),de=Symbol.for("react.strict_mode"),le=Symbol.for("react.profiler"),ue=Symbol.for("react.consumer"),he=Symbol.for("react.context"),me=Symbol.for("react.forward_ref"),be=Symbol.for("react.suspense"),ge=Symbol.for("react.suspense_list"),Ee=Symbol.for("react.memo"),Fe=Symbol.for("react.lazy"),Ue=Symbol.for("react.activity"),ze=Symbol.for("react.memo_cache_sentinel"),xe=Symbol.iterator;function Ie(z){return z===null||typeof z!="object"?null:(z=xe&&z[xe]||z["@@iterator"],typeof z=="function"?z:null)}var Ge=Symbol.for("react.client.reference");function De(z){if(z==null)return null;if(typeof z=="function")return z.$$typeof===Ge?null:z.displayName||z.name||null;if(typeof z=="string")return z;switch(z){case oe:return"Fragment";case le:return"Profiler";case de:return"StrictMode";case be:return"Suspense";case ge:return"SuspenseList";case Ue:return"Activity"}if(typeof z=="object")switch(z.$$typeof){case ae:return"Portal";case he:return z.displayName||"Context";case ue:return(z._context.displayName||"Context")+".Consumer";case me:var F=z.render;return z=z.displayName,z||(z=F.displayName||F.name||"",z=z!==""?"ForwardRef("+z+")":"ForwardRef"),z;case Ee:return F=z.displayName||null,F!==null?F:De(z.type)||"Memo";case Fe:F=z._payload,z=z._init;try{return De(z(F))}catch{}}return null}var Ve=Array.isArray,Se=j.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,we=B.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$e={pending:!1,data:null,method:null,action:null},Ye=[],pe=-1;function ve(z){return{current:z}}function Oe(z){0>pe||(z.current=Ye[pe],Ye[pe]=null,pe--)}function fe(z,F){pe++,Ye[pe]=z.current,z.current=F}var Qe=ve(null),tt=ve(null),He=ve(null),at=ve(null);function xt(z,F){switch(fe(He,F),fe(tt,z),fe(Qe,null),F.nodeType){case 9:case 11:z=(z=F.documentElement)&&(z=z.namespaceURI)?Kh(z):0;break;default:if(z=F.tagName,F=F.namespaceURI)F=Kh(F),z=Qh(F,z);else switch(z){case"svg":z=1;break;case"math":z=2;break;default:z=0}}Oe(Qe),fe(Qe,z)}function gt(){Oe(Qe),Oe(tt),Oe(He)}function on(z){z.memoizedState!==null&&fe(at,z);var F=Qe.current,G=Qh(F,z.type);F!==G&&(fe(tt,z),fe(Qe,G))}function tn(z){tt.current===z&&(Oe(Qe),Oe(tt)),at.current===z&&(Oe(at),Ia._currentValue=$e)}var ji,ar;function Nn(z){if(ji===void 0)try{throw Error()}catch(G){var F=G.stack.trim().match(/\n( *(at )?)/);ji=F&&F[1]||"",ar=-1<G.stack.indexOf(`
    at`)?" (<anonymous>)":-1<G.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ji+z+ar}var ui=!1;function Un(z,F){if(!z||ui)return"";ui=!0;var G=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var Y={DetermineComponentFrameRoot:function(){try{if(F){var qe=function(){throw Error()};if(Object.defineProperty(qe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(qe,[])}catch(Ae){var Re=Ae}Reflect.construct(z,[],qe)}else{try{qe.call()}catch(Ae){Re=Ae}z.call(qe.prototype)}}else{try{throw Error()}catch(Ae){Re=Ae}(qe=z())&&typeof qe.catch=="function"&&qe.catch(function(){})}}catch(Ae){if(Ae&&Re&&typeof Ae.stack=="string")return[Ae.stack,Re.stack]}return[null,null]}};Y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var ee=Object.getOwnPropertyDescriptor(Y.DetermineComponentFrameRoot,"name");ee&&ee.configurable&&Object.defineProperty(Y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var ne=Y.DetermineComponentFrameRoot(),se=ne[0],ce=ne[1];if(se&&ce){var ye=se.split(`
`),_e=ce.split(`
`);for(ee=Y=0;Y<ye.length&&!ye[Y].includes("DetermineComponentFrameRoot");)Y++;for(;ee<_e.length&&!_e[ee].includes("DetermineComponentFrameRoot");)ee++;if(Y===ye.length||ee===_e.length)for(Y=ye.length-1,ee=_e.length-1;1<=Y&&0<=ee&&ye[Y]!==_e[ee];)ee--;for(;1<=Y&&0<=ee;Y--,ee--)if(ye[Y]!==_e[ee]){if(Y!==1||ee!==1)do if(Y--,ee--,0>ee||ye[Y]!==_e[ee]){var Me=`
`+ye[Y].replace(" at new "," at ");return z.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",z.displayName)),Me}while(1<=Y&&0<=ee);break}}}finally{ui=!1,Error.prepareStackTrace=G}return(G=z?z.displayName||z.name:"")?Nn(G):""}function nn(z,F){switch(z.tag){case 26:case 27:case 5:return Nn(z.type);case 16:return Nn("Lazy");case 13:return z.child!==F&&F!==null?Nn("Suspense Fallback"):Nn("Suspense");case 19:return Nn("SuspenseList");case 0:case 15:return Un(z.type,!1);case 11:return Un(z.type.render,!1);case 1:return Un(z.type,!0);case 31:return Nn("Activity");default:return""}}function Ui(z){try{var F="",G=null;do F+=nn(z,G),G=z,z=z.return;while(z);return F}catch(Y){return`
Error generating stack: `+Y.message+`
`+Y.stack}}var $t=Object.prototype.hasOwnProperty,di=U.unstable_scheduleCallback,Bi=U.unstable_cancelCallback,Qr=U.unstable_shouldYield,sr=U.unstable_requestPaint,Yt=U.unstable_now,rn=U.unstable_getCurrentPriorityLevel,je=U.unstable_ImmediatePriority,Ke=U.unstable_UserBlockingPriority,it=U.unstable_NormalPriority,st=U.unstable_LowPriority,vt=U.unstable_IdlePriority,an=U.log,Mn=U.unstable_setDisableYieldValue,mt=null,Pe=null;function Le(z){if(typeof an=="function"&&Mn(z),Pe&&typeof Pe.setStrictMode=="function")try{Pe.setStrictMode(mt,z)}catch{}}var Ne=Math.clz32?Math.clz32:ot,Xe=Math.log,Je=Math.LN2;function ot(z){return z>>>=0,z===0?32:31-(Xe(z)/Je|0)|0}var kt=256,It=262144,zt=4194304;function Tn(z){var F=z&42;if(F!==0)return F;switch(z&-z){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return z&261888;case 262144:case 524288:case 1048576:case 2097152:return z&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return z&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return z}}function Yr(z,F,G){var Y=z.pendingLanes;if(Y===0)return 0;var ee=0,ne=z.suspendedLanes,se=z.pingedLanes;z=z.warmLanes;var ce=Y&134217727;return ce!==0?(Y=ce&~ne,Y!==0?ee=Tn(Y):(se&=ce,se!==0?ee=Tn(se):G||(G=ce&~z,G!==0&&(ee=Tn(G))))):(ce=Y&~ne,ce!==0?ee=Tn(ce):se!==0?ee=Tn(se):G||(G=Y&~z,G!==0&&(ee=Tn(G)))),ee===0?0:F!==0&&F!==ee&&(F&ne)===0&&(ne=ee&-ee,G=F&-F,ne>=G||ne===32&&(G&4194048)!==0)?F:ee}function Hn(z,F){return(z.pendingLanes&~(z.suspendedLanes&~z.pingedLanes)&F)===0}function wf(z,F){switch(z){case 1:case 2:case 4:case 8:case 64:return F+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return F+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Rc(){var z=zt;return zt<<=1,(zt&62914560)===0&&(zt=4194304),z}function go(z){for(var F=[],G=0;31>G;G++)F.push(z);return F}function Jr(z,F){z.pendingLanes|=F,F!==268435456&&(z.suspendedLanes=0,z.pingedLanes=0,z.warmLanes=0)}function Rf(z,F,G,Y,ee,ne){var se=z.pendingLanes;z.pendingLanes=G,z.suspendedLanes=0,z.pingedLanes=0,z.warmLanes=0,z.expiredLanes&=G,z.entangledLanes&=G,z.errorRecoveryDisabledLanes&=G,z.shellSuspendCounter=0;var ce=z.entanglements,ye=z.expirationTimes,_e=z.hiddenUpdates;for(G=se&~G;0<G;){var Me=31-Ne(G),qe=1<<Me;ce[Me]=0,ye[Me]=-1;var Re=_e[Me];if(Re!==null)for(_e[Me]=null,Me=0;Me<Re.length;Me++){var Ae=Re[Me];Ae!==null&&(Ae.lane&=-536870913)}G&=~qe}Y!==0&&Ac(z,Y,0),ne!==0&&ee===0&&z.tag!==0&&(z.suspendedLanes|=ne&~(se&~F))}function Ac(z,F,G){z.pendingLanes|=F,z.suspendedLanes&=~F;var Y=31-Ne(F);z.entangledLanes|=F,z.entanglements[Y]=z.entanglements[Y]|1073741824|G&261930}function Oc(z,F){var G=z.entangledLanes|=F;for(z=z.entanglements;G;){var Y=31-Ne(G),ee=1<<Y;ee&F|z[Y]&F&&(z[Y]|=F),G&=~ee}}function Dc(z,F){var G=F&-F;return G=(G&42)!==0?1:vo(G),(G&(z.suspendedLanes|F))!==0?0:G}function vo(z){switch(z){case 2:z=1;break;case 8:z=4;break;case 32:z=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:z=128;break;case 268435456:z=134217728;break;default:z=0}return z}function yo(z){return z&=-z,2<z?8<z?(z&134217727)!==0?32:268435456:8:2}function Pc(){var z=we.p;return z!==0?z:(z=window.event,z===void 0?32:yf(z.type))}function Nc(z,F){var G=we.p;try{return we.p=z,F()}finally{we.p=G}}var hi=Math.random().toString(36).slice(2),Jt="__reactFiber$"+hi,ln="__reactProps$"+hi,or="__reactContainer$"+hi,bo="__reactEvents$"+hi,Af="__reactListeners$"+hi,Of="__reactHandles$"+hi,Mc="__reactResources$"+hi,Xr="__reactMarker$"+hi;function So(z){delete z[Jt],delete z[ln],delete z[bo],delete z[Af],delete z[Of]}function lr(z){var F=z[Jt];if(F)return F;for(var G=z.parentNode;G;){if(F=G[or]||G[Jt]){if(G=F.alternate,F.child!==null||G!==null&&G.child!==null)for(z=tf(z);z!==null;){if(G=z[Jt])return G;z=tf(z)}return F}z=G,G=z.parentNode}return null}function cr(z){if(z=z[Jt]||z[or]){var F=z.tag;if(F===5||F===6||F===13||F===31||F===26||F===27||F===3)return z}return null}function Wr(z){var F=z.tag;if(F===5||F===26||F===27||F===6)return z.stateNode;throw Error(q(33))}function ur(z){var F=z[Mc];return F||(F=z[Mc]={hoistableStyles:new Map,hoistableScripts:new Map}),F}function Kt(z){z[Xr]=!0}var Lc=new Set,Ic={};function zi(z,F){dr(z,F),dr(z+"Capture",F)}function dr(z,F){for(Ic[z]=F,z=0;z<F.length;z++)Lc.add(F[z])}var Df=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jc={},Uc={};function Pf(z){return $t.call(Uc,z)?!0:$t.call(jc,z)?!1:Df.test(z)?Uc[z]=!0:(jc[z]=!0,!1)}function ns(z,F,G){if(Pf(F))if(G===null)z.removeAttribute(F);else{switch(typeof G){case"undefined":case"function":case"symbol":z.removeAttribute(F);return;case"boolean":var Y=F.toLowerCase().slice(0,5);if(Y!=="data-"&&Y!=="aria-"){z.removeAttribute(F);return}}z.setAttribute(F,""+G)}}function is(z,F,G){if(G===null)z.removeAttribute(F);else{switch(typeof G){case"undefined":case"function":case"symbol":case"boolean":z.removeAttribute(F);return}z.setAttribute(F,""+G)}}function $n(z,F,G,Y){if(Y===null)z.removeAttribute(G);else{switch(typeof Y){case"undefined":case"function":case"symbol":case"boolean":z.removeAttribute(G);return}z.setAttributeNS(F,G,""+Y)}}function En(z){switch(typeof z){case"bigint":case"boolean":case"number":case"string":case"undefined":return z;case"object":return z;default:return""}}function Bc(z){var F=z.type;return(z=z.nodeName)&&z.toLowerCase()==="input"&&(F==="checkbox"||F==="radio")}function Nf(z,F,G){var Y=Object.getOwnPropertyDescriptor(z.constructor.prototype,F);if(!z.hasOwnProperty(F)&&typeof Y<"u"&&typeof Y.get=="function"&&typeof Y.set=="function"){var ee=Y.get,ne=Y.set;return Object.defineProperty(z,F,{configurable:!0,get:function(){return ee.call(this)},set:function(se){G=""+se,ne.call(this,se)}}),Object.defineProperty(z,F,{enumerable:Y.enumerable}),{getValue:function(){return G},setValue:function(se){G=""+se},stopTracking:function(){z._valueTracker=null,delete z[F]}}}}function ko(z){if(!z._valueTracker){var F=Bc(z)?"checked":"value";z._valueTracker=Nf(z,F,""+z[F])}}function zc(z){if(!z)return!1;var F=z._valueTracker;if(!F)return!0;var G=F.getValue(),Y="";return z&&(Y=Bc(z)?z.checked?"true":"false":z.value),z=Y,z!==G?(F.setValue(z),!0):!1}function rs(z){if(z=z||(typeof document<"u"?document:void 0),typeof z>"u")return null;try{return z.activeElement||z.body}catch{return z.body}}var Mf=/[\n"\\]/g;function xn(z){return z.replace(Mf,function(F){return"\\"+F.charCodeAt(0).toString(16)+" "})}function To(z,F,G,Y,ee,ne,se,ce){z.name="",se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"?z.type=se:z.removeAttribute("type"),F!=null?se==="number"?(F===0&&z.value===""||z.value!=F)&&(z.value=""+En(F)):z.value!==""+En(F)&&(z.value=""+En(F)):se!=="submit"&&se!=="reset"||z.removeAttribute("value"),F!=null?Eo(z,se,En(F)):G!=null?Eo(z,se,En(G)):Y!=null&&z.removeAttribute("value"),ee==null&&ne!=null&&(z.defaultChecked=!!ne),ee!=null&&(z.checked=ee&&typeof ee!="function"&&typeof ee!="symbol"),ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?z.name=""+En(ce):z.removeAttribute("name")}function qc(z,F,G,Y,ee,ne,se,ce){if(ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(z.type=ne),F!=null||G!=null){if(!(ne!=="submit"&&ne!=="reset"||F!=null)){ko(z);return}G=G!=null?""+En(G):"",F=F!=null?""+En(F):G,ce||F===z.value||(z.value=F),z.defaultValue=F}Y=Y??ee,Y=typeof Y!="function"&&typeof Y!="symbol"&&!!Y,z.checked=ce?z.checked:!!Y,z.defaultChecked=!!Y,se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"&&(z.name=se),ko(z)}function Eo(z,F,G){F==="number"&&rs(z.ownerDocument)===z||z.defaultValue===""+G||(z.defaultValue=""+G)}function hr(z,F,G,Y){if(z=z.options,F){F={};for(var ee=0;ee<G.length;ee++)F["$"+G[ee]]=!0;for(G=0;G<z.length;G++)ee=F.hasOwnProperty("$"+z[G].value),z[G].selected!==ee&&(z[G].selected=ee),ee&&Y&&(z[G].defaultSelected=!0)}else{for(G=""+En(G),F=null,ee=0;ee<z.length;ee++){if(z[ee].value===G){z[ee].selected=!0,Y&&(z[ee].defaultSelected=!0);return}F!==null||z[ee].disabled||(F=z[ee])}F!==null&&(F.selected=!0)}}function Fc(z,F,G){if(F!=null&&(F=""+En(F),F!==z.value&&(z.value=F),G==null)){z.defaultValue!==F&&(z.defaultValue=F);return}z.defaultValue=G!=null?""+En(G):""}function Vc(z,F,G,Y){if(F==null){if(Y!=null){if(G!=null)throw Error(q(92));if(Ve(Y)){if(1<Y.length)throw Error(q(93));Y=Y[0]}G=Y}G==null&&(G=""),F=G}G=En(F),z.defaultValue=G,Y=z.textContent,Y===G&&Y!==""&&Y!==null&&(z.value=Y),ko(z)}function fr(z,F){if(F){var G=z.firstChild;if(G&&G===z.lastChild&&G.nodeType===3){G.nodeValue=F;return}}z.textContent=F}var Lf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Hc(z,F,G){var Y=F.indexOf("--")===0;G==null||typeof G=="boolean"||G===""?Y?z.setProperty(F,""):F==="float"?z.cssFloat="":z[F]="":Y?z.setProperty(F,G):typeof G!="number"||G===0||Lf.has(F)?F==="float"?z.cssFloat=G:z[F]=(""+G).trim():z[F]=G+"px"}function $c(z,F,G){if(F!=null&&typeof F!="object")throw Error(q(62));if(z=z.style,G!=null){for(var Y in G)!G.hasOwnProperty(Y)||F!=null&&F.hasOwnProperty(Y)||(Y.indexOf("--")===0?z.setProperty(Y,""):Y==="float"?z.cssFloat="":z[Y]="");for(var ee in F)Y=F[ee],F.hasOwnProperty(ee)&&G[ee]!==Y&&Hc(z,ee,Y)}else for(var ne in F)F.hasOwnProperty(ne)&&Hc(z,ne,F[ne])}function xo(z){if(z.indexOf("-")===-1)return!1;switch(z){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var If=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function as(z){return jf.test(""+z)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":z}function Gn(){}var Co=null;function _o(z){return z=z.target||z.srcElement||window,z.correspondingUseElement&&(z=z.correspondingUseElement),z.nodeType===3?z.parentNode:z}var pr=null,mr=null;function Gc(z){var F=cr(z);if(F&&(z=F.stateNode)){var G=z[ln]||null;e:switch(z=F.stateNode,F.type){case"input":if(To(z,G.value,G.defaultValue,G.defaultValue,G.checked,G.defaultChecked,G.type,G.name),F=G.name,G.type==="radio"&&F!=null){for(G=z;G.parentNode;)G=G.parentNode;for(G=G.querySelectorAll('input[name="'+xn(""+F)+'"][type="radio"]'),F=0;F<G.length;F++){var Y=G[F];if(Y!==z&&Y.form===z.form){var ee=Y[ln]||null;if(!ee)throw Error(q(90));To(Y,ee.value,ee.defaultValue,ee.defaultValue,ee.checked,ee.defaultChecked,ee.type,ee.name)}}for(F=0;F<G.length;F++)Y=G[F],Y.form===z.form&&zc(Y)}break e;case"textarea":Fc(z,G.value,G.defaultValue);break e;case"select":F=G.value,F!=null&&hr(z,!!G.multiple,F,!1)}}}var wo=!1;function Kc(z,F,G){if(wo)return z(F,G);wo=!0;try{var Y=z(F);return Y}finally{if(wo=!1,(pr!==null||mr!==null)&&(Gs(),pr&&(F=pr,z=mr,mr=pr=null,Gc(F),z)))for(F=0;F<z.length;F++)Gc(z[F])}}function Zr(z,F){var G=z.stateNode;if(G===null)return null;var Y=G[ln]||null;if(Y===null)return null;G=Y[F];e:switch(F){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(Y=!Y.disabled)||(z=z.type,Y=!(z==="button"||z==="input"||z==="select"||z==="textarea")),z=!Y;break e;default:z=!1}if(z)return null;if(G&&typeof G!="function")throw Error(q(231,F,typeof G));return G}var Kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ro=!1;if(Kn)try{var ea={};Object.defineProperty(ea,"passive",{get:function(){Ro=!0}}),window.addEventListener("test",ea,ea),window.removeEventListener("test",ea,ea)}catch{Ro=!1}var fi=null,Ao=null,ss=null;function Qc(){if(ss)return ss;var z,F=Ao,G=F.length,Y,ee="value"in fi?fi.value:fi.textContent,ne=ee.length;for(z=0;z<G&&F[z]===ee[z];z++);var se=G-z;for(Y=1;Y<=se&&F[G-Y]===ee[ne-Y];Y++);return ss=ee.slice(z,1<Y?1-Y:void 0)}function os(z){var F=z.keyCode;return"charCode"in z?(z=z.charCode,z===0&&F===13&&(z=13)):z=F,z===10&&(z=13),32<=z||z===13?z:0}function ls(){return!0}function Yc(){return!1}function cn(z){function F(G,Y,ee,ne,se){this._reactName=G,this._targetInst=ee,this.type=Y,this.nativeEvent=ne,this.target=se,this.currentTarget=null;for(var ce in z)z.hasOwnProperty(ce)&&(G=z[ce],this[ce]=G?G(ne):ne[ce]);return this.isDefaultPrevented=(ne.defaultPrevented!=null?ne.defaultPrevented:ne.returnValue===!1)?ls:Yc,this.isPropagationStopped=Yc,this}return Z(F.prototype,{preventDefault:function(){this.defaultPrevented=!0;var G=this.nativeEvent;G&&(G.preventDefault?G.preventDefault():typeof G.returnValue!="unknown"&&(G.returnValue=!1),this.isDefaultPrevented=ls)},stopPropagation:function(){var G=this.nativeEvent;G&&(G.stopPropagation?G.stopPropagation():typeof G.cancelBubble!="unknown"&&(G.cancelBubble=!0),this.isPropagationStopped=ls)},persist:function(){},isPersistent:ls}),F}var qi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(z){return z.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cs=cn(qi),ta=Z({},qi,{view:0,detail:0}),Uf=cn(ta),Oo,Do,na,us=Z({},ta,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:No,button:0,buttons:0,relatedTarget:function(z){return z.relatedTarget===void 0?z.fromElement===z.srcElement?z.toElement:z.fromElement:z.relatedTarget},movementX:function(z){return"movementX"in z?z.movementX:(z!==na&&(na&&z.type==="mousemove"?(Oo=z.screenX-na.screenX,Do=z.screenY-na.screenY):Do=Oo=0,na=z),Oo)},movementY:function(z){return"movementY"in z?z.movementY:Do}}),Jc=cn(us),Bf=Z({},us,{dataTransfer:0}),zf=cn(Bf),qf=Z({},ta,{relatedTarget:0}),Po=cn(qf),Ff=Z({},qi,{animationName:0,elapsedTime:0,pseudoElement:0}),Vf=cn(Ff),Hf=Z({},qi,{clipboardData:function(z){return"clipboardData"in z?z.clipboardData:window.clipboardData}}),$f=cn(Hf),Gf=Z({},qi,{data:0}),Xc=cn(Gf),Kf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jf(z){var F=this.nativeEvent;return F.getModifierState?F.getModifierState(z):(z=Yf[z])?!!F[z]:!1}function No(){return Jf}var Xf=Z({},ta,{key:function(z){if(z.key){var F=Kf[z.key]||z.key;if(F!=="Unidentified")return F}return z.type==="keypress"?(z=os(z),z===13?"Enter":String.fromCharCode(z)):z.type==="keydown"||z.type==="keyup"?Qf[z.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:No,charCode:function(z){return z.type==="keypress"?os(z):0},keyCode:function(z){return z.type==="keydown"||z.type==="keyup"?z.keyCode:0},which:function(z){return z.type==="keypress"?os(z):z.type==="keydown"||z.type==="keyup"?z.keyCode:0}}),Wf=cn(Xf),Zf=Z({},us,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wc=cn(Zf),ep=Z({},ta,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:No}),tp=cn(ep),np=Z({},qi,{propertyName:0,elapsedTime:0,pseudoElement:0}),ip=cn(np),rp=Z({},us,{deltaX:function(z){return"deltaX"in z?z.deltaX:"wheelDeltaX"in z?-z.wheelDeltaX:0},deltaY:function(z){return"deltaY"in z?z.deltaY:"wheelDeltaY"in z?-z.wheelDeltaY:"wheelDelta"in z?-z.wheelDelta:0},deltaZ:0,deltaMode:0}),ap=cn(rp),sp=Z({},qi,{newState:0,oldState:0}),op=cn(sp),lp=[9,13,27,32],Mo=Kn&&"CompositionEvent"in window,ia=null;Kn&&"documentMode"in document&&(ia=document.documentMode);var cp=Kn&&"TextEvent"in window&&!ia,Zc=Kn&&(!Mo||ia&&8<ia&&11>=ia),eu=" ",tu=!1;function nu(z,F){switch(z){case"keyup":return lp.indexOf(F.keyCode)!==-1;case"keydown":return F.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iu(z){return z=z.detail,typeof z=="object"&&"data"in z?z.data:null}var gr=!1;function up(z,F){switch(z){case"compositionend":return iu(F);case"keypress":return F.which!==32?null:(tu=!0,eu);case"textInput":return z=F.data,z===eu&&tu?null:z;default:return null}}function dp(z,F){if(gr)return z==="compositionend"||!Mo&&nu(z,F)?(z=Qc(),ss=Ao=fi=null,gr=!1,z):null;switch(z){case"paste":return null;case"keypress":if(!(F.ctrlKey||F.altKey||F.metaKey)||F.ctrlKey&&F.altKey){if(F.char&&1<F.char.length)return F.char;if(F.which)return String.fromCharCode(F.which)}return null;case"compositionend":return Zc&&F.locale!=="ko"?null:F.data;default:return null}}var hp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ru(z){var F=z&&z.nodeName&&z.nodeName.toLowerCase();return F==="input"?!!hp[z.type]:F==="textarea"}function au(z,F,G,Y){pr?mr?mr.push(Y):mr=[Y]:pr=Y,F=Zs(F,"onChange"),0<F.length&&(G=new cs("onChange","change",null,G,Y),z.push({event:G,listeners:F}))}var ra=null,aa=null;function fp(z){qh(z,0)}function ds(z){var F=Wr(z);if(zc(F))return z}function su(z,F){if(z==="change")return F}var ou=!1;if(Kn){var Lo;if(Kn){var Io="oninput"in document;if(!Io){var lu=document.createElement("div");lu.setAttribute("oninput","return;"),Io=typeof lu.oninput=="function"}Lo=Io}else Lo=!1;ou=Lo&&(!document.documentMode||9<document.documentMode)}function cu(){ra&&(ra.detachEvent("onpropertychange",uu),aa=ra=null)}function uu(z){if(z.propertyName==="value"&&ds(aa)){var F=[];au(F,aa,z,_o(z)),Kc(fp,F)}}function pp(z,F,G){z==="focusin"?(cu(),ra=F,aa=G,ra.attachEvent("onpropertychange",uu)):z==="focusout"&&cu()}function mp(z){if(z==="selectionchange"||z==="keyup"||z==="keydown")return ds(aa)}function gp(z,F){if(z==="click")return ds(F)}function vp(z,F){if(z==="input"||z==="change")return ds(F)}function yp(z,F){return z===F&&(z!==0||1/z===1/F)||z!==z&&F!==F}var mn=typeof Object.is=="function"?Object.is:yp;function sa(z,F){if(mn(z,F))return!0;if(typeof z!="object"||z===null||typeof F!="object"||F===null)return!1;var G=Object.keys(z),Y=Object.keys(F);if(G.length!==Y.length)return!1;for(Y=0;Y<G.length;Y++){var ee=G[Y];if(!$t.call(F,ee)||!mn(z[ee],F[ee]))return!1}return!0}function du(z){for(;z&&z.firstChild;)z=z.firstChild;return z}function hu(z,F){var G=du(z);z=0;for(var Y;G;){if(G.nodeType===3){if(Y=z+G.textContent.length,z<=F&&Y>=F)return{node:G,offset:F-z};z=Y}e:{for(;G;){if(G.nextSibling){G=G.nextSibling;break e}G=G.parentNode}G=void 0}G=du(G)}}function fu(z,F){return z&&F?z===F?!0:z&&z.nodeType===3?!1:F&&F.nodeType===3?fu(z,F.parentNode):"contains"in z?z.contains(F):z.compareDocumentPosition?!!(z.compareDocumentPosition(F)&16):!1:!1}function pu(z){z=z!=null&&z.ownerDocument!=null&&z.ownerDocument.defaultView!=null?z.ownerDocument.defaultView:window;for(var F=rs(z.document);F instanceof z.HTMLIFrameElement;){try{var G=typeof F.contentWindow.location.href=="string"}catch{G=!1}if(G)z=F.contentWindow;else break;F=rs(z.document)}return F}function jo(z){var F=z&&z.nodeName&&z.nodeName.toLowerCase();return F&&(F==="input"&&(z.type==="text"||z.type==="search"||z.type==="tel"||z.type==="url"||z.type==="password")||F==="textarea"||z.contentEditable==="true")}var bp=Kn&&"documentMode"in document&&11>=document.documentMode,vr=null,Uo=null,oa=null,Bo=!1;function mu(z,F,G){var Y=G.window===G?G.document:G.nodeType===9?G:G.ownerDocument;Bo||vr==null||vr!==rs(Y)||(Y=vr,"selectionStart"in Y&&jo(Y)?Y={start:Y.selectionStart,end:Y.selectionEnd}:(Y=(Y.ownerDocument&&Y.ownerDocument.defaultView||window).getSelection(),Y={anchorNode:Y.anchorNode,anchorOffset:Y.anchorOffset,focusNode:Y.focusNode,focusOffset:Y.focusOffset}),oa&&sa(oa,Y)||(oa=Y,Y=Zs(Uo,"onSelect"),0<Y.length&&(F=new cs("onSelect","select",null,F,G),z.push({event:F,listeners:Y}),F.target=vr)))}function Fi(z,F){var G={};return G[z.toLowerCase()]=F.toLowerCase(),G["Webkit"+z]="webkit"+F,G["Moz"+z]="moz"+F,G}var yr={animationend:Fi("Animation","AnimationEnd"),animationiteration:Fi("Animation","AnimationIteration"),animationstart:Fi("Animation","AnimationStart"),transitionrun:Fi("Transition","TransitionRun"),transitionstart:Fi("Transition","TransitionStart"),transitioncancel:Fi("Transition","TransitionCancel"),transitionend:Fi("Transition","TransitionEnd")},zo={},gu={};Kn&&(gu=document.createElement("div").style,"AnimationEvent"in window||(delete yr.animationend.animation,delete yr.animationiteration.animation,delete yr.animationstart.animation),"TransitionEvent"in window||delete yr.transitionend.transition);function Vi(z){if(zo[z])return zo[z];if(!yr[z])return z;var F=yr[z],G;for(G in F)if(F.hasOwnProperty(G)&&G in gu)return zo[z]=F[G];return z}var vu=Vi("animationend"),yu=Vi("animationiteration"),bu=Vi("animationstart"),Sp=Vi("transitionrun"),kp=Vi("transitionstart"),Tp=Vi("transitioncancel"),Su=Vi("transitionend"),ku=new Map,qo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");qo.push("scrollEnd");function Ln(z,F){ku.set(z,F),zi(F,[z])}var hs=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},Cn=[],br=0,Fo=0;function fs(){for(var z=br,F=Fo=br=0;F<z;){var G=Cn[F];Cn[F++]=null;var Y=Cn[F];Cn[F++]=null;var ee=Cn[F];Cn[F++]=null;var ne=Cn[F];if(Cn[F++]=null,Y!==null&&ee!==null){var se=Y.pending;se===null?ee.next=ee:(ee.next=se.next,se.next=ee),Y.pending=ee}ne!==0&&Tu(G,ee,ne)}}function ps(z,F,G,Y){Cn[br++]=z,Cn[br++]=F,Cn[br++]=G,Cn[br++]=Y,Fo|=Y,z.lanes|=Y,z=z.alternate,z!==null&&(z.lanes|=Y)}function Vo(z,F,G,Y){return ps(z,F,G,Y),ms(z)}function Hi(z,F){return ps(z,null,null,F),ms(z)}function Tu(z,F,G){z.lanes|=G;var Y=z.alternate;Y!==null&&(Y.lanes|=G);for(var ee=!1,ne=z.return;ne!==null;)ne.childLanes|=G,Y=ne.alternate,Y!==null&&(Y.childLanes|=G),ne.tag===22&&(z=ne.stateNode,z===null||z._visibility&1||(ee=!0)),z=ne,ne=ne.return;return z.tag===3?(ne=z.stateNode,ee&&F!==null&&(ee=31-Ne(G),z=ne.hiddenUpdates,Y=z[ee],Y===null?z[ee]=[F]:Y.push(F),F.lane=G|536870912),ne):null}function ms(z){if(50<Aa)throw Aa=0,Wl=null,Error(q(185));for(var F=z.return;F!==null;)z=F,F=z.return;return z.tag===3?z.stateNode:null}var Sr={};function Ep(z,F,G,Y){this.tag=z,this.key=G,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=F,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gn(z,F,G,Y){return new Ep(z,F,G,Y)}function Ho(z){return z=z.prototype,!(!z||!z.isReactComponent)}function Qn(z,F){var G=z.alternate;return G===null?(G=gn(z.tag,F,z.key,z.mode),G.elementType=z.elementType,G.type=z.type,G.stateNode=z.stateNode,G.alternate=z,z.alternate=G):(G.pendingProps=F,G.type=z.type,G.flags=0,G.subtreeFlags=0,G.deletions=null),G.flags=z.flags&65011712,G.childLanes=z.childLanes,G.lanes=z.lanes,G.child=z.child,G.memoizedProps=z.memoizedProps,G.memoizedState=z.memoizedState,G.updateQueue=z.updateQueue,F=z.dependencies,G.dependencies=F===null?null:{lanes:F.lanes,firstContext:F.firstContext},G.sibling=z.sibling,G.index=z.index,G.ref=z.ref,G.refCleanup=z.refCleanup,G}function Eu(z,F){z.flags&=65011714;var G=z.alternate;return G===null?(z.childLanes=0,z.lanes=F,z.child=null,z.subtreeFlags=0,z.memoizedProps=null,z.memoizedState=null,z.updateQueue=null,z.dependencies=null,z.stateNode=null):(z.childLanes=G.childLanes,z.lanes=G.lanes,z.child=G.child,z.subtreeFlags=0,z.deletions=null,z.memoizedProps=G.memoizedProps,z.memoizedState=G.memoizedState,z.updateQueue=G.updateQueue,z.type=G.type,F=G.dependencies,z.dependencies=F===null?null:{lanes:F.lanes,firstContext:F.firstContext}),z}function gs(z,F,G,Y,ee,ne){var se=0;if(Y=z,typeof z=="function")Ho(z)&&(se=1);else if(typeof z=="string")se=Rm(z,G,Qe.current)?26:z==="html"||z==="head"||z==="body"?27:5;else e:switch(z){case Ue:return z=gn(31,G,F,ee),z.elementType=Ue,z.lanes=ne,z;case oe:return $i(G.children,ee,ne,F);case de:se=8,ee|=24;break;case le:return z=gn(12,G,F,ee|2),z.elementType=le,z.lanes=ne,z;case be:return z=gn(13,G,F,ee),z.elementType=be,z.lanes=ne,z;case ge:return z=gn(19,G,F,ee),z.elementType=ge,z.lanes=ne,z;default:if(typeof z=="object"&&z!==null)switch(z.$$typeof){case he:se=10;break e;case ue:se=9;break e;case me:se=11;break e;case Ee:se=14;break e;case Fe:se=16,Y=null;break e}se=29,G=Error(q(130,z===null?"null":typeof z,"")),Y=null}return F=gn(se,G,F,ee),F.elementType=z,F.type=Y,F.lanes=ne,F}function $i(z,F,G,Y){return z=gn(7,z,Y,F),z.lanes=G,z}function $o(z,F,G){return z=gn(6,z,null,F),z.lanes=G,z}function xu(z){var F=gn(18,null,null,0);return F.stateNode=z,F}function Go(z,F,G){return F=gn(4,z.children!==null?z.children:[],z.key,F),F.lanes=G,F.stateNode={containerInfo:z.containerInfo,pendingChildren:null,implementation:z.implementation},F}var Cu=new WeakMap;function _n(z,F){if(typeof z=="object"&&z!==null){var G=Cu.get(z);return G!==void 0?G:(F={value:z,source:F,stack:Ui(F)},Cu.set(z,F),F)}return{value:z,source:F,stack:Ui(F)}}var kr=[],Tr=0,vs=null,la=0,wn=[],Rn=0,pi=null,Bn=1,zn="";function Yn(z,F){kr[Tr++]=la,kr[Tr++]=vs,vs=z,la=F}function _u(z,F,G){wn[Rn++]=Bn,wn[Rn++]=zn,wn[Rn++]=pi,pi=z;var Y=Bn;z=zn;var ee=32-Ne(Y)-1;Y&=~(1<<ee),G+=1;var ne=32-Ne(F)+ee;if(30<ne){var se=ee-ee%5;ne=(Y&(1<<se)-1).toString(32),Y>>=se,ee-=se,Bn=1<<32-Ne(F)+ee|G<<ee|Y,zn=ne+z}else Bn=1<<ne|G<<ee|Y,zn=z}function Ko(z){z.return!==null&&(Yn(z,1),_u(z,1,0))}function Qo(z){for(;z===vs;)vs=kr[--Tr],kr[Tr]=null,la=kr[--Tr],kr[Tr]=null;for(;z===pi;)pi=wn[--Rn],wn[Rn]=null,zn=wn[--Rn],wn[Rn]=null,Bn=wn[--Rn],wn[Rn]=null}function wu(z,F){wn[Rn++]=Bn,wn[Rn++]=zn,wn[Rn++]=pi,Bn=F.id,zn=F.overflow,pi=z}var Xt=null,At=null,pt=!1,mi=null,An=!1,Yo=Error(q(519));function gi(z){var F=Error(q(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ca(_n(F,z)),Yo}function Ru(z){var F=z.stateNode,G=z.type,Y=z.memoizedProps;switch(F[Jt]=z,F[ln]=Y,G){case"dialog":dt("cancel",F),dt("close",F);break;case"iframe":case"object":case"embed":dt("load",F);break;case"video":case"audio":for(G=0;G<Da.length;G++)dt(Da[G],F);break;case"source":dt("error",F);break;case"img":case"image":case"link":dt("error",F),dt("load",F);break;case"details":dt("toggle",F);break;case"input":dt("invalid",F),qc(F,Y.value,Y.defaultValue,Y.checked,Y.defaultChecked,Y.type,Y.name,!0);break;case"select":dt("invalid",F);break;case"textarea":dt("invalid",F),Vc(F,Y.value,Y.defaultValue,Y.children)}G=Y.children,typeof G!="string"&&typeof G!="number"&&typeof G!="bigint"||F.textContent===""+G||Y.suppressHydrationWarning===!0||$h(F.textContent,G)?(Y.popover!=null&&(dt("beforetoggle",F),dt("toggle",F)),Y.onScroll!=null&&dt("scroll",F),Y.onScrollEnd!=null&&dt("scrollend",F),Y.onClick!=null&&(F.onclick=Gn),F=!0):F=!1,F||gi(z,!0)}function Au(z){for(Xt=z.return;Xt;)switch(Xt.tag){case 5:case 31:case 13:An=!1;return;case 27:case 3:An=!0;return;default:Xt=Xt.return}}function Er(z){if(z!==Xt)return!1;if(!pt)return Au(z),pt=!0,!1;var F=z.tag,G;if((G=F!==3&&F!==27)&&((G=F===5)&&(G=z.type,G=!(G!=="form"&&G!=="button")||fc(z.type,z.memoizedProps)),G=!G),G&&At&&gi(z),Au(z),F===13){if(z=z.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(q(317));At=ef(z)}else if(F===31){if(z=z.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(q(317));At=ef(z)}else F===27?(F=At,Oi(z.type)?(z=yc,yc=null,At=z):At=F):At=Xt?Dn(z.stateNode.nextSibling):null;return!0}function Gi(){At=Xt=null,pt=!1}function Jo(){var z=mi;return z!==null&&(fn===null?fn=z:fn.push.apply(fn,z),mi=null),z}function ca(z){mi===null?mi=[z]:mi.push(z)}var Xo=ve(null),Ki=null,Jn=null;function vi(z,F,G){fe(Xo,F._currentValue),F._currentValue=G}function Xn(z){z._currentValue=Xo.current,Oe(Xo)}function Wo(z,F,G){for(;z!==null;){var Y=z.alternate;if((z.childLanes&F)!==F?(z.childLanes|=F,Y!==null&&(Y.childLanes|=F)):Y!==null&&(Y.childLanes&F)!==F&&(Y.childLanes|=F),z===G)break;z=z.return}}function Zo(z,F,G,Y){var ee=z.child;for(ee!==null&&(ee.return=z);ee!==null;){var ne=ee.dependencies;if(ne!==null){var se=ee.child;ne=ne.firstContext;e:for(;ne!==null;){var ce=ne;ne=ee;for(var ye=0;ye<F.length;ye++)if(ce.context===F[ye]){ne.lanes|=G,ce=ne.alternate,ce!==null&&(ce.lanes|=G),Wo(ne.return,G,z),Y||(se=null);break e}ne=ce.next}}else if(ee.tag===18){if(se=ee.return,se===null)throw Error(q(341));se.lanes|=G,ne=se.alternate,ne!==null&&(ne.lanes|=G),Wo(se,G,z),se=null}else se=ee.child;if(se!==null)se.return=ee;else for(se=ee;se!==null;){if(se===z){se=null;break}if(ee=se.sibling,ee!==null){ee.return=se.return,se=ee;break}se=se.return}ee=se}}function xr(z,F,G,Y){z=null;for(var ee=F,ne=!1;ee!==null;){if(!ne){if((ee.flags&524288)!==0)ne=!0;else if((ee.flags&262144)!==0)break}if(ee.tag===10){var se=ee.alternate;if(se===null)throw Error(q(387));if(se=se.memoizedProps,se!==null){var ce=ee.type;mn(ee.pendingProps.value,se.value)||(z!==null?z.push(ce):z=[ce])}}else if(ee===at.current){if(se=ee.alternate,se===null)throw Error(q(387));se.memoizedState.memoizedState!==ee.memoizedState.memoizedState&&(z!==null?z.push(Ia):z=[Ia])}ee=ee.return}z!==null&&Zo(F,z,G,Y),F.flags|=262144}function ys(z){for(z=z.firstContext;z!==null;){if(!mn(z.context._currentValue,z.memoizedValue))return!0;z=z.next}return!1}function Qi(z){Ki=z,Jn=null,z=z.dependencies,z!==null&&(z.firstContext=null)}function Wt(z){return Ou(Ki,z)}function bs(z,F){return Ki===null&&Qi(z),Ou(z,F)}function Ou(z,F){var G=F._currentValue;if(F={context:F,memoizedValue:G,next:null},Jn===null){if(z===null)throw Error(q(308));Jn=F,z.dependencies={lanes:0,firstContext:F},z.flags|=524288}else Jn=Jn.next=F;return G}var xp=typeof AbortController<"u"?AbortController:function(){var z=[],F=this.signal={aborted:!1,addEventListener:function(G,Y){z.push(Y)}};this.abort=function(){F.aborted=!0,z.forEach(function(G){return G()})}},Cp=U.unstable_scheduleCallback,_p=U.unstable_NormalPriority,qt={$$typeof:he,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function el(){return{controller:new xp,data:new Map,refCount:0}}function ua(z){z.refCount--,z.refCount===0&&Cp(_p,function(){z.controller.abort()})}var da=null,tl=0,Cr=0,_r=null;function wp(z,F){if(da===null){var G=da=[];tl=0,Cr=rc(),_r={status:"pending",value:void 0,then:function(Y){G.push(Y)}}}return tl++,F.then(Du,Du),F}function Du(){if(--tl===0&&da!==null){_r!==null&&(_r.status="fulfilled");var z=da;da=null,Cr=0,_r=null;for(var F=0;F<z.length;F++)(0,z[F])()}}function Rp(z,F){var G=[],Y={status:"pending",value:null,reason:null,then:function(ee){G.push(ee)}};return z.then(function(){Y.status="fulfilled",Y.value=F;for(var ee=0;ee<G.length;ee++)(0,G[ee])(F)},function(ee){for(Y.status="rejected",Y.reason=ee,ee=0;ee<G.length;ee++)(0,G[ee])(void 0)}),Y}var Pu=Se.S;Se.S=function(z,F){mh=Yt(),typeof F=="object"&&F!==null&&typeof F.then=="function"&&wp(z,F),Pu!==null&&Pu(z,F)};var Yi=ve(null);function nl(){var z=Yi.current;return z!==null?z:Rt.pooledCache}function Ss(z,F){F===null?fe(Yi,Yi.current):fe(Yi,F.pool)}function Nu(){var z=nl();return z===null?null:{parent:qt._currentValue,pool:z}}var wr=Error(q(460)),il=Error(q(474)),ks=Error(q(542)),Ts={then:function(){}};function Mu(z){return z=z.status,z==="fulfilled"||z==="rejected"}function Lu(z,F,G){switch(G=z[G],G===void 0?z.push(F):G!==F&&(F.then(Gn,Gn),F=G),F.status){case"fulfilled":return F.value;case"rejected":throw z=F.reason,ju(z),z;default:if(typeof F.status=="string")F.then(Gn,Gn);else{if(z=Rt,z!==null&&100<z.shellSuspendCounter)throw Error(q(482));z=F,z.status="pending",z.then(function(Y){if(F.status==="pending"){var ee=F;ee.status="fulfilled",ee.value=Y}},function(Y){if(F.status==="pending"){var ee=F;ee.status="rejected",ee.reason=Y}})}switch(F.status){case"fulfilled":return F.value;case"rejected":throw z=F.reason,ju(z),z}throw Xi=F,wr}}function Ji(z){try{var F=z._init;return F(z._payload)}catch(G){throw G!==null&&typeof G=="object"&&typeof G.then=="function"?(Xi=G,wr):G}}var Xi=null;function Iu(){if(Xi===null)throw Error(q(459));var z=Xi;return Xi=null,z}function ju(z){if(z===wr||z===ks)throw Error(q(483))}var Rr=null,ha=0;function Es(z){var F=ha;return ha+=1,Rr===null&&(Rr=[]),Lu(Rr,z,F)}function fa(z,F){F=F.props.ref,z.ref=F!==void 0?F:null}function xs(z,F){throw F.$$typeof===te?Error(q(525)):(z=Object.prototype.toString.call(F),Error(q(31,z==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":z)))}function Uu(z){function F(Te,ke){if(z){var Ce=Te.deletions;Ce===null?(Te.deletions=[ke],Te.flags|=16):Ce.push(ke)}}function G(Te,ke){if(!z)return null;for(;ke!==null;)F(Te,ke),ke=ke.sibling;return null}function Y(Te){for(var ke=new Map;Te!==null;)Te.key!==null?ke.set(Te.key,Te):ke.set(Te.index,Te),Te=Te.sibling;return ke}function ee(Te,ke){return Te=Qn(Te,ke),Te.index=0,Te.sibling=null,Te}function ne(Te,ke,Ce){return Te.index=Ce,z?(Ce=Te.alternate,Ce!==null?(Ce=Ce.index,Ce<ke?(Te.flags|=67108866,ke):Ce):(Te.flags|=67108866,ke)):(Te.flags|=1048576,ke)}function se(Te){return z&&Te.alternate===null&&(Te.flags|=67108866),Te}function ce(Te,ke,Ce,Be){return ke===null||ke.tag!==6?(ke=$o(Ce,Te.mode,Be),ke.return=Te,ke):(ke=ee(ke,Ce),ke.return=Te,ke)}function ye(Te,ke,Ce,Be){var et=Ce.type;return et===oe?Me(Te,ke,Ce.props.children,Be,Ce.key):ke!==null&&(ke.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===Fe&&Ji(et)===ke.type)?(ke=ee(ke,Ce.props),fa(ke,Ce),ke.return=Te,ke):(ke=gs(Ce.type,Ce.key,Ce.props,null,Te.mode,Be),fa(ke,Ce),ke.return=Te,ke)}function _e(Te,ke,Ce,Be){return ke===null||ke.tag!==4||ke.stateNode.containerInfo!==Ce.containerInfo||ke.stateNode.implementation!==Ce.implementation?(ke=Go(Ce,Te.mode,Be),ke.return=Te,ke):(ke=ee(ke,Ce.children||[]),ke.return=Te,ke)}function Me(Te,ke,Ce,Be,et){return ke===null||ke.tag!==7?(ke=$i(Ce,Te.mode,Be,et),ke.return=Te,ke):(ke=ee(ke,Ce),ke.return=Te,ke)}function qe(Te,ke,Ce){if(typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint")return ke=$o(""+ke,Te.mode,Ce),ke.return=Te,ke;if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case ie:return Ce=gs(ke.type,ke.key,ke.props,null,Te.mode,Ce),fa(Ce,ke),Ce.return=Te,Ce;case ae:return ke=Go(ke,Te.mode,Ce),ke.return=Te,ke;case Fe:return ke=Ji(ke),qe(Te,ke,Ce)}if(Ve(ke)||Ie(ke))return ke=$i(ke,Te.mode,Ce,null),ke.return=Te,ke;if(typeof ke.then=="function")return qe(Te,Es(ke),Ce);if(ke.$$typeof===he)return qe(Te,bs(Te,ke),Ce);xs(Te,ke)}return null}function Re(Te,ke,Ce,Be){var et=ke!==null?ke.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return et!==null?null:ce(Te,ke,""+Ce,Be);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case ie:return Ce.key===et?ye(Te,ke,Ce,Be):null;case ae:return Ce.key===et?_e(Te,ke,Ce,Be):null;case Fe:return Ce=Ji(Ce),Re(Te,ke,Ce,Be)}if(Ve(Ce)||Ie(Ce))return et!==null?null:Me(Te,ke,Ce,Be,null);if(typeof Ce.then=="function")return Re(Te,ke,Es(Ce),Be);if(Ce.$$typeof===he)return Re(Te,ke,bs(Te,Ce),Be);xs(Te,Ce)}return null}function Ae(Te,ke,Ce,Be,et){if(typeof Be=="string"&&Be!==""||typeof Be=="number"||typeof Be=="bigint")return Te=Te.get(Ce)||null,ce(ke,Te,""+Be,et);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case ie:return Te=Te.get(Be.key===null?Ce:Be.key)||null,ye(ke,Te,Be,et);case ae:return Te=Te.get(Be.key===null?Ce:Be.key)||null,_e(ke,Te,Be,et);case Fe:return Be=Ji(Be),Ae(Te,ke,Ce,Be,et)}if(Ve(Be)||Ie(Be))return Te=Te.get(Ce)||null,Me(ke,Te,Be,et,null);if(typeof Be.then=="function")return Ae(Te,ke,Ce,Es(Be),et);if(Be.$$typeof===he)return Ae(Te,ke,Ce,bs(ke,Be),et);xs(ke,Be)}return null}function We(Te,ke,Ce,Be){for(var et=null,yt=null,Ze=ke,ct=ke=0,ft=null;Ze!==null&&ct<Ce.length;ct++){Ze.index>ct?(ft=Ze,Ze=null):ft=Ze.sibling;var bt=Re(Te,Ze,Ce[ct],Be);if(bt===null){Ze===null&&(Ze=ft);break}z&&Ze&&bt.alternate===null&&F(Te,Ze),ke=ne(bt,ke,ct),yt===null?et=bt:yt.sibling=bt,yt=bt,Ze=ft}if(ct===Ce.length)return G(Te,Ze),pt&&Yn(Te,ct),et;if(Ze===null){for(;ct<Ce.length;ct++)Ze=qe(Te,Ce[ct],Be),Ze!==null&&(ke=ne(Ze,ke,ct),yt===null?et=Ze:yt.sibling=Ze,yt=Ze);return pt&&Yn(Te,ct),et}for(Ze=Y(Ze);ct<Ce.length;ct++)ft=Ae(Ze,Te,ct,Ce[ct],Be),ft!==null&&(z&&ft.alternate!==null&&Ze.delete(ft.key===null?ct:ft.key),ke=ne(ft,ke,ct),yt===null?et=ft:yt.sibling=ft,yt=ft);return z&&Ze.forEach(function(Li){return F(Te,Li)}),pt&&Yn(Te,ct),et}function nt(Te,ke,Ce,Be){if(Ce==null)throw Error(q(151));for(var et=null,yt=null,Ze=ke,ct=ke=0,ft=null,bt=Ce.next();Ze!==null&&!bt.done;ct++,bt=Ce.next()){Ze.index>ct?(ft=Ze,Ze=null):ft=Ze.sibling;var Li=Re(Te,Ze,bt.value,Be);if(Li===null){Ze===null&&(Ze=ft);break}z&&Ze&&Li.alternate===null&&F(Te,Ze),ke=ne(Li,ke,ct),yt===null?et=Li:yt.sibling=Li,yt=Li,Ze=ft}if(bt.done)return G(Te,Ze),pt&&Yn(Te,ct),et;if(Ze===null){for(;!bt.done;ct++,bt=Ce.next())bt=qe(Te,bt.value,Be),bt!==null&&(ke=ne(bt,ke,ct),yt===null?et=bt:yt.sibling=bt,yt=bt);return pt&&Yn(Te,ct),et}for(Ze=Y(Ze);!bt.done;ct++,bt=Ce.next())bt=Ae(Ze,Te,ct,bt.value,Be),bt!==null&&(z&&bt.alternate!==null&&Ze.delete(bt.key===null?ct:bt.key),ke=ne(bt,ke,ct),yt===null?et=bt:yt.sibling=bt,yt=bt);return z&&Ze.forEach(function(Bm){return F(Te,Bm)}),pt&&Yn(Te,ct),et}function wt(Te,ke,Ce,Be){if(typeof Ce=="object"&&Ce!==null&&Ce.type===oe&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case ie:e:{for(var et=Ce.key;ke!==null;){if(ke.key===et){if(et=Ce.type,et===oe){if(ke.tag===7){G(Te,ke.sibling),Be=ee(ke,Ce.props.children),Be.return=Te,Te=Be;break e}}else if(ke.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===Fe&&Ji(et)===ke.type){G(Te,ke.sibling),Be=ee(ke,Ce.props),fa(Be,Ce),Be.return=Te,Te=Be;break e}G(Te,ke);break}else F(Te,ke);ke=ke.sibling}Ce.type===oe?(Be=$i(Ce.props.children,Te.mode,Be,Ce.key),Be.return=Te,Te=Be):(Be=gs(Ce.type,Ce.key,Ce.props,null,Te.mode,Be),fa(Be,Ce),Be.return=Te,Te=Be)}return se(Te);case ae:e:{for(et=Ce.key;ke!==null;){if(ke.key===et)if(ke.tag===4&&ke.stateNode.containerInfo===Ce.containerInfo&&ke.stateNode.implementation===Ce.implementation){G(Te,ke.sibling),Be=ee(ke,Ce.children||[]),Be.return=Te,Te=Be;break e}else{G(Te,ke);break}else F(Te,ke);ke=ke.sibling}Be=Go(Ce,Te.mode,Be),Be.return=Te,Te=Be}return se(Te);case Fe:return Ce=Ji(Ce),wt(Te,ke,Ce,Be)}if(Ve(Ce))return We(Te,ke,Ce,Be);if(Ie(Ce)){if(et=Ie(Ce),typeof et!="function")throw Error(q(150));return Ce=et.call(Ce),nt(Te,ke,Ce,Be)}if(typeof Ce.then=="function")return wt(Te,ke,Es(Ce),Be);if(Ce.$$typeof===he)return wt(Te,ke,bs(Te,Ce),Be);xs(Te,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint"?(Ce=""+Ce,ke!==null&&ke.tag===6?(G(Te,ke.sibling),Be=ee(ke,Ce),Be.return=Te,Te=Be):(G(Te,ke),Be=$o(Ce,Te.mode,Be),Be.return=Te,Te=Be),se(Te)):G(Te,ke)}return function(Te,ke,Ce,Be){try{ha=0;var et=wt(Te,ke,Ce,Be);return Rr=null,et}catch(Ze){if(Ze===wr||Ze===ks)throw Ze;var yt=gn(29,Ze,null,Te.mode);return yt.lanes=Be,yt.return=Te,yt}finally{}}}var Wi=Uu(!0),Bu=Uu(!1),yi=!1;function rl(z){z.updateQueue={baseState:z.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function al(z,F){z=z.updateQueue,F.updateQueue===z&&(F.updateQueue={baseState:z.baseState,firstBaseUpdate:z.firstBaseUpdate,lastBaseUpdate:z.lastBaseUpdate,shared:z.shared,callbacks:null})}function bi(z){return{lane:z,tag:0,payload:null,callback:null,next:null}}function Si(z,F,G){var Y=z.updateQueue;if(Y===null)return null;if(Y=Y.shared,(St&2)!==0){var ee=Y.pending;return ee===null?F.next=F:(F.next=ee.next,ee.next=F),Y.pending=F,F=ms(z),Tu(z,null,G),F}return ps(z,Y,F,G),ms(z)}function pa(z,F,G){if(F=F.updateQueue,F!==null&&(F=F.shared,(G&4194048)!==0)){var Y=F.lanes;Y&=z.pendingLanes,G|=Y,F.lanes=G,Oc(z,G)}}function sl(z,F){var G=z.updateQueue,Y=z.alternate;if(Y!==null&&(Y=Y.updateQueue,G===Y)){var ee=null,ne=null;if(G=G.firstBaseUpdate,G!==null){do{var se={lane:G.lane,tag:G.tag,payload:G.payload,callback:null,next:null};ne===null?ee=ne=se:ne=ne.next=se,G=G.next}while(G!==null);ne===null?ee=ne=F:ne=ne.next=F}else ee=ne=F;G={baseState:Y.baseState,firstBaseUpdate:ee,lastBaseUpdate:ne,shared:Y.shared,callbacks:Y.callbacks},z.updateQueue=G;return}z=G.lastBaseUpdate,z===null?G.firstBaseUpdate=F:z.next=F,G.lastBaseUpdate=F}var ol=!1;function ma(){if(ol){var z=_r;if(z!==null)throw z}}function ga(z,F,G,Y){ol=!1;var ee=z.updateQueue;yi=!1;var ne=ee.firstBaseUpdate,se=ee.lastBaseUpdate,ce=ee.shared.pending;if(ce!==null){ee.shared.pending=null;var ye=ce,_e=ye.next;ye.next=null,se===null?ne=_e:se.next=_e,se=ye;var Me=z.alternate;Me!==null&&(Me=Me.updateQueue,ce=Me.lastBaseUpdate,ce!==se&&(ce===null?Me.firstBaseUpdate=_e:ce.next=_e,Me.lastBaseUpdate=ye))}if(ne!==null){var qe=ee.baseState;se=0,Me=_e=ye=null,ce=ne;do{var Re=ce.lane&-536870913,Ae=Re!==ce.lane;if(Ae?(ht&Re)===Re:(Y&Re)===Re){Re!==0&&Re===Cr&&(ol=!0),Me!==null&&(Me=Me.next={lane:0,tag:ce.tag,payload:ce.payload,callback:null,next:null});e:{var We=z,nt=ce;Re=F;var wt=G;switch(nt.tag){case 1:if(We=nt.payload,typeof We=="function"){qe=We.call(wt,qe,Re);break e}qe=We;break e;case 3:We.flags=We.flags&-65537|128;case 0:if(We=nt.payload,Re=typeof We=="function"?We.call(wt,qe,Re):We,Re==null)break e;qe=Z({},qe,Re);break e;case 2:yi=!0}}Re=ce.callback,Re!==null&&(z.flags|=64,Ae&&(z.flags|=8192),Ae=ee.callbacks,Ae===null?ee.callbacks=[Re]:Ae.push(Re))}else Ae={lane:Re,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null},Me===null?(_e=Me=Ae,ye=qe):Me=Me.next=Ae,se|=Re;if(ce=ce.next,ce===null){if(ce=ee.shared.pending,ce===null)break;Ae=ce,ce=Ae.next,Ae.next=null,ee.lastBaseUpdate=Ae,ee.shared.pending=null}}while(!0);Me===null&&(ye=qe),ee.baseState=ye,ee.firstBaseUpdate=_e,ee.lastBaseUpdate=Me,ne===null&&(ee.shared.lanes=0),Ci|=se,z.lanes=se,z.memoizedState=qe}}function zu(z,F){if(typeof z!="function")throw Error(q(191,z));z.call(F)}function qu(z,F){var G=z.callbacks;if(G!==null)for(z.callbacks=null,z=0;z<G.length;z++)zu(G[z],F)}var Ar=ve(null),Cs=ve(0);function Fu(z,F){z=si,fe(Cs,z),fe(Ar,F),si=z|F.baseLanes}function ll(){fe(Cs,si),fe(Ar,Ar.current)}function cl(){si=Cs.current,Oe(Ar),Oe(Cs)}var vn=ve(null),On=null;function ki(z){var F=z.alternate;fe(jt,jt.current&1),fe(vn,z),On===null&&(F===null||Ar.current!==null||F.memoizedState!==null)&&(On=z)}function ul(z){fe(jt,jt.current),fe(vn,z),On===null&&(On=z)}function Vu(z){z.tag===22?(fe(jt,jt.current),fe(vn,z),On===null&&(On=z)):Ti()}function Ti(){fe(jt,jt.current),fe(vn,vn.current)}function yn(z){Oe(vn),On===z&&(On=null),Oe(jt)}var jt=ve(0);function _s(z){for(var F=z;F!==null;){if(F.tag===13){var G=F.memoizedState;if(G!==null&&(G=G.dehydrated,G===null||gc(G)||vc(G)))return F}else if(F.tag===19&&(F.memoizedProps.revealOrder==="forwards"||F.memoizedProps.revealOrder==="backwards"||F.memoizedProps.revealOrder==="unstable_legacy-backwards"||F.memoizedProps.revealOrder==="together")){if((F.flags&128)!==0)return F}else if(F.child!==null){F.child.return=F,F=F.child;continue}if(F===z)break;for(;F.sibling===null;){if(F.return===null||F.return===z)return null;F=F.return}F.sibling.return=F.return,F=F.sibling}return null}var Wn=0,lt=null,Ct=null,Ft=null,ws=!1,Or=!1,Zi=!1,Rs=0,va=0,Dr=null,Ap=0;function Nt(){throw Error(q(321))}function dl(z,F){if(F===null)return!1;for(var G=0;G<F.length&&G<z.length;G++)if(!mn(z[G],F[G]))return!1;return!0}function hl(z,F,G,Y,ee,ne){return Wn=ne,lt=F,F.memoizedState=null,F.updateQueue=null,F.lanes=0,Se.H=z===null||z.memoizedState===null?_d:wl,Zi=!1,ne=G(Y,ee),Zi=!1,Or&&(ne=$u(F,G,Y,ee)),Hu(z),ne}function Hu(z){Se.H=Sa;var F=Ct!==null&&Ct.next!==null;if(Wn=0,Ft=Ct=lt=null,ws=!1,va=0,Dr=null,F)throw Error(q(300));z===null||Vt||(z=z.dependencies,z!==null&&ys(z)&&(Vt=!0))}function $u(z,F,G,Y){lt=z;var ee=0;do{if(Or&&(Dr=null),va=0,Or=!1,25<=ee)throw Error(q(301));if(ee+=1,Ft=Ct=null,z.updateQueue!=null){var ne=z.updateQueue;ne.lastEffect=null,ne.events=null,ne.stores=null,ne.memoCache!=null&&(ne.memoCache.index=0)}Se.H=wd,ne=F(G,Y)}while(Or);return ne}function Op(){var z=Se.H,F=z.useState()[0];return F=typeof F.then=="function"?ya(F):F,z=z.useState()[0],(Ct!==null?Ct.memoizedState:null)!==z&&(lt.flags|=1024),F}function fl(){var z=Rs!==0;return Rs=0,z}function pl(z,F,G){F.updateQueue=z.updateQueue,F.flags&=-2053,z.lanes&=~G}function ml(z){if(ws){for(z=z.memoizedState;z!==null;){var F=z.queue;F!==null&&(F.pending=null),z=z.next}ws=!1}Wn=0,Ft=Ct=lt=null,Or=!1,va=Rs=0,Dr=null}function sn(){var z={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?lt.memoizedState=Ft=z:Ft=Ft.next=z,Ft}function Ut(){if(Ct===null){var z=lt.alternate;z=z!==null?z.memoizedState:null}else z=Ct.next;var F=Ft===null?lt.memoizedState:Ft.next;if(F!==null)Ft=F,Ct=z;else{if(z===null)throw lt.alternate===null?Error(q(467)):Error(q(310));Ct=z,z={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},Ft===null?lt.memoizedState=Ft=z:Ft=Ft.next=z}return Ft}function As(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ya(z){var F=va;return va+=1,Dr===null&&(Dr=[]),z=Lu(Dr,z,F),F=lt,(Ft===null?F.memoizedState:Ft.next)===null&&(F=F.alternate,Se.H=F===null||F.memoizedState===null?_d:wl),z}function Os(z){if(z!==null&&typeof z=="object"){if(typeof z.then=="function")return ya(z);if(z.$$typeof===he)return Wt(z)}throw Error(q(438,String(z)))}function gl(z){var F=null,G=lt.updateQueue;if(G!==null&&(F=G.memoCache),F==null){var Y=lt.alternate;Y!==null&&(Y=Y.updateQueue,Y!==null&&(Y=Y.memoCache,Y!=null&&(F={data:Y.data.map(function(ee){return ee.slice()}),index:0})))}if(F==null&&(F={data:[],index:0}),G===null&&(G=As(),lt.updateQueue=G),G.memoCache=F,G=F.data[F.index],G===void 0)for(G=F.data[F.index]=Array(z),Y=0;Y<z;Y++)G[Y]=ze;return F.index++,G}function Zn(z,F){return typeof F=="function"?F(z):F}function Ds(z){var F=Ut();return vl(F,Ct,z)}function vl(z,F,G){var Y=z.queue;if(Y===null)throw Error(q(311));Y.lastRenderedReducer=G;var ee=z.baseQueue,ne=Y.pending;if(ne!==null){if(ee!==null){var se=ee.next;ee.next=ne.next,ne.next=se}F.baseQueue=ee=ne,Y.pending=null}if(ne=z.baseState,ee===null)z.memoizedState=ne;else{F=ee.next;var ce=se=null,ye=null,_e=F,Me=!1;do{var qe=_e.lane&-536870913;if(qe!==_e.lane?(ht&qe)===qe:(Wn&qe)===qe){var Re=_e.revertLane;if(Re===0)ye!==null&&(ye=ye.next={lane:0,revertLane:0,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),qe===Cr&&(Me=!0);else if((Wn&Re)===Re){_e=_e.next,Re===Cr&&(Me=!0);continue}else qe={lane:0,revertLane:_e.revertLane,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ye===null?(ce=ye=qe,se=ne):ye=ye.next=qe,lt.lanes|=Re,Ci|=Re;qe=_e.action,Zi&&G(ne,qe),ne=_e.hasEagerState?_e.eagerState:G(ne,qe)}else Re={lane:qe,revertLane:_e.revertLane,gesture:_e.gesture,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ye===null?(ce=ye=Re,se=ne):ye=ye.next=Re,lt.lanes|=qe,Ci|=qe;_e=_e.next}while(_e!==null&&_e!==F);if(ye===null?se=ne:ye.next=ce,!mn(ne,z.memoizedState)&&(Vt=!0,Me&&(G=_r,G!==null)))throw G;z.memoizedState=ne,z.baseState=se,z.baseQueue=ye,Y.lastRenderedState=ne}return ee===null&&(Y.lanes=0),[z.memoizedState,Y.dispatch]}function yl(z){var F=Ut(),G=F.queue;if(G===null)throw Error(q(311));G.lastRenderedReducer=z;var Y=G.dispatch,ee=G.pending,ne=F.memoizedState;if(ee!==null){G.pending=null;var se=ee=ee.next;do ne=z(ne,se.action),se=se.next;while(se!==ee);mn(ne,F.memoizedState)||(Vt=!0),F.memoizedState=ne,F.baseQueue===null&&(F.baseState=ne),G.lastRenderedState=ne}return[ne,Y]}function Gu(z,F,G){var Y=lt,ee=Ut(),ne=pt;if(ne){if(G===void 0)throw Error(q(407));G=G()}else G=F();var se=!mn((Ct||ee).memoizedState,G);if(se&&(ee.memoizedState=G,Vt=!0),ee=ee.queue,kl(Yu.bind(null,Y,ee,z),[z]),ee.getSnapshot!==F||se||Ft!==null&&Ft.memoizedState.tag&1){if(Y.flags|=2048,Pr(9,{destroy:void 0},Qu.bind(null,Y,ee,G,F),null),Rt===null)throw Error(q(349));ne||(Wn&127)!==0||Ku(Y,F,G)}return G}function Ku(z,F,G){z.flags|=16384,z={getSnapshot:F,value:G},F=lt.updateQueue,F===null?(F=As(),lt.updateQueue=F,F.stores=[z]):(G=F.stores,G===null?F.stores=[z]:G.push(z))}function Qu(z,F,G,Y){F.value=G,F.getSnapshot=Y,Ju(F)&&Xu(z)}function Yu(z,F,G){return G(function(){Ju(F)&&Xu(z)})}function Ju(z){var F=z.getSnapshot;z=z.value;try{var G=F();return!mn(z,G)}catch{return!0}}function Xu(z){var F=Hi(z,2);F!==null&&pn(F,z,2)}function bl(z){var F=sn();if(typeof z=="function"){var G=z;if(z=G(),Zi){Le(!0);try{G()}finally{Le(!1)}}}return F.memoizedState=F.baseState=z,F.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zn,lastRenderedState:z},F}function Wu(z,F,G,Y){return z.baseState=G,vl(z,Ct,typeof Y=="function"?Y:Zn)}function Dp(z,F,G,Y,ee){if(Ms(z))throw Error(q(485));if(z=F.action,z!==null){var ne={payload:ee,action:z,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(se){ne.listeners.push(se)}};Se.T!==null?G(!0):ne.isTransition=!1,Y(ne),G=F.pending,G===null?(ne.next=F.pending=ne,Zu(F,ne)):(ne.next=G.next,F.pending=G.next=ne)}}function Zu(z,F){var G=F.action,Y=F.payload,ee=z.state;if(F.isTransition){var ne=Se.T,se={};Se.T=se;try{var ce=G(ee,Y),ye=Se.S;ye!==null&&ye(se,ce),ed(z,F,ce)}catch(_e){Sl(z,F,_e)}finally{ne!==null&&se.types!==null&&(ne.types=se.types),Se.T=ne}}else try{ne=G(ee,Y),ed(z,F,ne)}catch(_e){Sl(z,F,_e)}}function ed(z,F,G){G!==null&&typeof G=="object"&&typeof G.then=="function"?G.then(function(Y){td(z,F,Y)},function(Y){return Sl(z,F,Y)}):td(z,F,G)}function td(z,F,G){F.status="fulfilled",F.value=G,nd(F),z.state=G,F=z.pending,F!==null&&(G=F.next,G===F?z.pending=null:(G=G.next,F.next=G,Zu(z,G)))}function Sl(z,F,G){var Y=z.pending;if(z.pending=null,Y!==null){Y=Y.next;do F.status="rejected",F.reason=G,nd(F),F=F.next;while(F!==Y)}z.action=null}function nd(z){z=z.listeners;for(var F=0;F<z.length;F++)(0,z[F])()}function id(z,F){return F}function rd(z,F){if(pt){var G=Rt.formState;if(G!==null){e:{var Y=lt;if(pt){if(At){t:{for(var ee=At,ne=An;ee.nodeType!==8;){if(!ne){ee=null;break t}if(ee=Dn(ee.nextSibling),ee===null){ee=null;break t}}ne=ee.data,ee=ne==="F!"||ne==="F"?ee:null}if(ee){At=Dn(ee.nextSibling),Y=ee.data==="F!";break e}}gi(Y)}Y=!1}Y&&(F=G[0])}}return G=sn(),G.memoizedState=G.baseState=F,Y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:id,lastRenderedState:F},G.queue=Y,G=Ed.bind(null,lt,Y),Y.dispatch=G,Y=bl(!1),ne=_l.bind(null,lt,!1,Y.queue),Y=sn(),ee={state:F,dispatch:null,action:z,pending:null},Y.queue=ee,G=Dp.bind(null,lt,ee,ne,G),ee.dispatch=G,Y.memoizedState=z,[F,G,!1]}function ad(z){var F=Ut();return sd(F,Ct,z)}function sd(z,F,G){if(F=vl(z,F,id)[0],z=Ds(Zn)[0],typeof F=="object"&&F!==null&&typeof F.then=="function")try{var Y=ya(F)}catch(se){throw se===wr?ks:se}else Y=F;F=Ut();var ee=F.queue,ne=ee.dispatch;return G!==F.memoizedState&&(lt.flags|=2048,Pr(9,{destroy:void 0},Pp.bind(null,ee,G),null)),[Y,ne,z]}function Pp(z,F){z.action=F}function od(z){var F=Ut(),G=Ct;if(G!==null)return sd(F,G,z);Ut(),F=F.memoizedState,G=Ut();var Y=G.queue.dispatch;return G.memoizedState=z,[F,Y,!1]}function Pr(z,F,G,Y){return z={tag:z,create:G,deps:Y,inst:F,next:null},F=lt.updateQueue,F===null&&(F=As(),lt.updateQueue=F),G=F.lastEffect,G===null?F.lastEffect=z.next=z:(Y=G.next,G.next=z,z.next=Y,F.lastEffect=z),z}function ld(){return Ut().memoizedState}function Ps(z,F,G,Y){var ee=sn();lt.flags|=z,ee.memoizedState=Pr(1|F,{destroy:void 0},G,Y===void 0?null:Y)}function Ns(z,F,G,Y){var ee=Ut();Y=Y===void 0?null:Y;var ne=ee.memoizedState.inst;Ct!==null&&Y!==null&&dl(Y,Ct.memoizedState.deps)?ee.memoizedState=Pr(F,ne,G,Y):(lt.flags|=z,ee.memoizedState=Pr(1|F,ne,G,Y))}function cd(z,F){Ps(8390656,8,z,F)}function kl(z,F){Ns(2048,8,z,F)}function Np(z){lt.flags|=4;var F=lt.updateQueue;if(F===null)F=As(),lt.updateQueue=F,F.events=[z];else{var G=F.events;G===null?F.events=[z]:G.push(z)}}function ud(z){var F=Ut().memoizedState;return Np({ref:F,nextImpl:z}),function(){if((St&2)!==0)throw Error(q(440));return F.impl.apply(void 0,arguments)}}function dd(z,F){return Ns(4,2,z,F)}function hd(z,F){return Ns(4,4,z,F)}function fd(z,F){if(typeof F=="function"){z=z();var G=F(z);return function(){typeof G=="function"?G():F(null)}}if(F!=null)return z=z(),F.current=z,function(){F.current=null}}function pd(z,F,G){G=G!=null?G.concat([z]):null,Ns(4,4,fd.bind(null,F,z),G)}function Tl(){}function md(z,F){var G=Ut();F=F===void 0?null:F;var Y=G.memoizedState;return F!==null&&dl(F,Y[1])?Y[0]:(G.memoizedState=[z,F],z)}function gd(z,F){var G=Ut();F=F===void 0?null:F;var Y=G.memoizedState;if(F!==null&&dl(F,Y[1]))return Y[0];if(Y=z(),Zi){Le(!0);try{z()}finally{Le(!1)}}return G.memoizedState=[Y,F],Y}function El(z,F,G){return G===void 0||(Wn&1073741824)!==0&&(ht&261930)===0?z.memoizedState=F:(z.memoizedState=G,z=vh(),lt.lanes|=z,Ci|=z,G)}function vd(z,F,G,Y){return mn(G,F)?G:Ar.current!==null?(z=El(z,G,Y),mn(z,F)||(Vt=!0),z):(Wn&42)===0||(Wn&1073741824)!==0&&(ht&261930)===0?(Vt=!0,z.memoizedState=G):(z=vh(),lt.lanes|=z,Ci|=z,F)}function yd(z,F,G,Y,ee){var ne=we.p;we.p=ne!==0&&8>ne?ne:8;var se=Se.T,ce={};Se.T=ce,_l(z,!1,F,G);try{var ye=ee(),_e=Se.S;if(_e!==null&&_e(ce,ye),ye!==null&&typeof ye=="object"&&typeof ye.then=="function"){var Me=Rp(ye,Y);ba(z,F,Me,kn(z))}else ba(z,F,Y,kn(z))}catch(qe){ba(z,F,{then:function(){},status:"rejected",reason:qe},kn())}finally{we.p=ne,se!==null&&ce.types!==null&&(se.types=ce.types),Se.T=se}}function Mp(){}function xl(z,F,G,Y){if(z.tag!==5)throw Error(q(476));var ee=bd(z).queue;yd(z,ee,F,$e,G===null?Mp:function(){return Sd(z),G(Y)})}function bd(z){var F=z.memoizedState;if(F!==null)return F;F={memoizedState:$e,baseState:$e,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zn,lastRenderedState:$e},next:null};var G={};return F.next={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zn,lastRenderedState:G},next:null},z.memoizedState=F,z=z.alternate,z!==null&&(z.memoizedState=F),F}function Sd(z){var F=bd(z);F.next===null&&(F=z.alternate.memoizedState),ba(z,F.next.queue,{},kn())}function Cl(){return Wt(Ia)}function kd(){return Ut().memoizedState}function Td(){return Ut().memoizedState}function Lp(z){for(var F=z.return;F!==null;){switch(F.tag){case 24:case 3:var G=kn();z=bi(G);var Y=Si(F,z,G);Y!==null&&(pn(Y,F,G),pa(Y,F,G)),F={cache:el()},z.payload=F;return}F=F.return}}function Ip(z,F,G){var Y=kn();G={lane:Y,revertLane:0,gesture:null,action:G,hasEagerState:!1,eagerState:null,next:null},Ms(z)?xd(F,G):(G=Vo(z,F,G,Y),G!==null&&(pn(G,z,Y),Cd(G,F,Y)))}function Ed(z,F,G){var Y=kn();ba(z,F,G,Y)}function ba(z,F,G,Y){var ee={lane:Y,revertLane:0,gesture:null,action:G,hasEagerState:!1,eagerState:null,next:null};if(Ms(z))xd(F,ee);else{var ne=z.alternate;if(z.lanes===0&&(ne===null||ne.lanes===0)&&(ne=F.lastRenderedReducer,ne!==null))try{var se=F.lastRenderedState,ce=ne(se,G);if(ee.hasEagerState=!0,ee.eagerState=ce,mn(ce,se))return ps(z,F,ee,0),Rt===null&&fs(),!1}catch{}finally{}if(G=Vo(z,F,ee,Y),G!==null)return pn(G,z,Y),Cd(G,F,Y),!0}return!1}function _l(z,F,G,Y){if(Y={lane:2,revertLane:rc(),gesture:null,action:Y,hasEagerState:!1,eagerState:null,next:null},Ms(z)){if(F)throw Error(q(479))}else F=Vo(z,G,Y,2),F!==null&&pn(F,z,2)}function Ms(z){var F=z.alternate;return z===lt||F!==null&&F===lt}function xd(z,F){Or=ws=!0;var G=z.pending;G===null?F.next=F:(F.next=G.next,G.next=F),z.pending=F}function Cd(z,F,G){if((G&4194048)!==0){var Y=F.lanes;Y&=z.pendingLanes,G|=Y,F.lanes=G,Oc(z,G)}}var Sa={readContext:Wt,use:Os,useCallback:Nt,useContext:Nt,useEffect:Nt,useImperativeHandle:Nt,useLayoutEffect:Nt,useInsertionEffect:Nt,useMemo:Nt,useReducer:Nt,useRef:Nt,useState:Nt,useDebugValue:Nt,useDeferredValue:Nt,useTransition:Nt,useSyncExternalStore:Nt,useId:Nt,useHostTransitionStatus:Nt,useFormState:Nt,useActionState:Nt,useOptimistic:Nt,useMemoCache:Nt,useCacheRefresh:Nt};Sa.useEffectEvent=Nt;var _d={readContext:Wt,use:Os,useCallback:function(z,F){return sn().memoizedState=[z,F===void 0?null:F],z},useContext:Wt,useEffect:cd,useImperativeHandle:function(z,F,G){G=G!=null?G.concat([z]):null,Ps(4194308,4,fd.bind(null,F,z),G)},useLayoutEffect:function(z,F){return Ps(4194308,4,z,F)},useInsertionEffect:function(z,F){Ps(4,2,z,F)},useMemo:function(z,F){var G=sn();F=F===void 0?null:F;var Y=z();if(Zi){Le(!0);try{z()}finally{Le(!1)}}return G.memoizedState=[Y,F],Y},useReducer:function(z,F,G){var Y=sn();if(G!==void 0){var ee=G(F);if(Zi){Le(!0);try{G(F)}finally{Le(!1)}}}else ee=F;return Y.memoizedState=Y.baseState=ee,z={pending:null,lanes:0,dispatch:null,lastRenderedReducer:z,lastRenderedState:ee},Y.queue=z,z=z.dispatch=Ip.bind(null,lt,z),[Y.memoizedState,z]},useRef:function(z){var F=sn();return z={current:z},F.memoizedState=z},useState:function(z){z=bl(z);var F=z.queue,G=Ed.bind(null,lt,F);return F.dispatch=G,[z.memoizedState,G]},useDebugValue:Tl,useDeferredValue:function(z,F){var G=sn();return El(G,z,F)},useTransition:function(){var z=bl(!1);return z=yd.bind(null,lt,z.queue,!0,!1),sn().memoizedState=z,[!1,z]},useSyncExternalStore:function(z,F,G){var Y=lt,ee=sn();if(pt){if(G===void 0)throw Error(q(407));G=G()}else{if(G=F(),Rt===null)throw Error(q(349));(ht&127)!==0||Ku(Y,F,G)}ee.memoizedState=G;var ne={value:G,getSnapshot:F};return ee.queue=ne,cd(Yu.bind(null,Y,ne,z),[z]),Y.flags|=2048,Pr(9,{destroy:void 0},Qu.bind(null,Y,ne,G,F),null),G},useId:function(){var z=sn(),F=Rt.identifierPrefix;if(pt){var G=zn,Y=Bn;G=(Y&~(1<<32-Ne(Y)-1)).toString(32)+G,F="_"+F+"R_"+G,G=Rs++,0<G&&(F+="H"+G.toString(32)),F+="_"}else G=Ap++,F="_"+F+"r_"+G.toString(32)+"_";return z.memoizedState=F},useHostTransitionStatus:Cl,useFormState:rd,useActionState:rd,useOptimistic:function(z){var F=sn();F.memoizedState=F.baseState=z;var G={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return F.queue=G,F=_l.bind(null,lt,!0,G),G.dispatch=F,[z,F]},useMemoCache:gl,useCacheRefresh:function(){return sn().memoizedState=Lp.bind(null,lt)},useEffectEvent:function(z){var F=sn(),G={impl:z};return F.memoizedState=G,function(){if((St&2)!==0)throw Error(q(440));return G.impl.apply(void 0,arguments)}}},wl={readContext:Wt,use:Os,useCallback:md,useContext:Wt,useEffect:kl,useImperativeHandle:pd,useInsertionEffect:dd,useLayoutEffect:hd,useMemo:gd,useReducer:Ds,useRef:ld,useState:function(){return Ds(Zn)},useDebugValue:Tl,useDeferredValue:function(z,F){var G=Ut();return vd(G,Ct.memoizedState,z,F)},useTransition:function(){var z=Ds(Zn)[0],F=Ut().memoizedState;return[typeof z=="boolean"?z:ya(z),F]},useSyncExternalStore:Gu,useId:kd,useHostTransitionStatus:Cl,useFormState:ad,useActionState:ad,useOptimistic:function(z,F){var G=Ut();return Wu(G,Ct,z,F)},useMemoCache:gl,useCacheRefresh:Td};wl.useEffectEvent=ud;var wd={readContext:Wt,use:Os,useCallback:md,useContext:Wt,useEffect:kl,useImperativeHandle:pd,useInsertionEffect:dd,useLayoutEffect:hd,useMemo:gd,useReducer:yl,useRef:ld,useState:function(){return yl(Zn)},useDebugValue:Tl,useDeferredValue:function(z,F){var G=Ut();return Ct===null?El(G,z,F):vd(G,Ct.memoizedState,z,F)},useTransition:function(){var z=yl(Zn)[0],F=Ut().memoizedState;return[typeof z=="boolean"?z:ya(z),F]},useSyncExternalStore:Gu,useId:kd,useHostTransitionStatus:Cl,useFormState:od,useActionState:od,useOptimistic:function(z,F){var G=Ut();return Ct!==null?Wu(G,Ct,z,F):(G.baseState=z,[z,G.queue.dispatch])},useMemoCache:gl,useCacheRefresh:Td};wd.useEffectEvent=ud;function Rl(z,F,G,Y){F=z.memoizedState,G=G(Y,F),G=G==null?F:Z({},F,G),z.memoizedState=G,z.lanes===0&&(z.updateQueue.baseState=G)}var Al={enqueueSetState:function(z,F,G){z=z._reactInternals;var Y=kn(),ee=bi(Y);ee.payload=F,G!=null&&(ee.callback=G),F=Si(z,ee,Y),F!==null&&(pn(F,z,Y),pa(F,z,Y))},enqueueReplaceState:function(z,F,G){z=z._reactInternals;var Y=kn(),ee=bi(Y);ee.tag=1,ee.payload=F,G!=null&&(ee.callback=G),F=Si(z,ee,Y),F!==null&&(pn(F,z,Y),pa(F,z,Y))},enqueueForceUpdate:function(z,F){z=z._reactInternals;var G=kn(),Y=bi(G);Y.tag=2,F!=null&&(Y.callback=F),F=Si(z,Y,G),F!==null&&(pn(F,z,G),pa(F,z,G))}};function Rd(z,F,G,Y,ee,ne,se){return z=z.stateNode,typeof z.shouldComponentUpdate=="function"?z.shouldComponentUpdate(Y,ne,se):F.prototype&&F.prototype.isPureReactComponent?!sa(G,Y)||!sa(ee,ne):!0}function Ad(z,F,G,Y){z=F.state,typeof F.componentWillReceiveProps=="function"&&F.componentWillReceiveProps(G,Y),typeof F.UNSAFE_componentWillReceiveProps=="function"&&F.UNSAFE_componentWillReceiveProps(G,Y),F.state!==z&&Al.enqueueReplaceState(F,F.state,null)}function er(z,F){var G=F;if("ref"in F){G={};for(var Y in F)Y!=="ref"&&(G[Y]=F[Y])}if(z=z.defaultProps){G===F&&(G=Z({},G));for(var ee in z)G[ee]===void 0&&(G[ee]=z[ee])}return G}function Od(z){hs(z)}function Dd(z){console.error(z)}function Pd(z){hs(z)}function Ls(z,F){try{var G=z.onUncaughtError;G(F.value,{componentStack:F.stack})}catch(Y){setTimeout(function(){throw Y})}}function Nd(z,F,G){try{var Y=z.onCaughtError;Y(G.value,{componentStack:G.stack,errorBoundary:F.tag===1?F.stateNode:null})}catch(ee){setTimeout(function(){throw ee})}}function Ol(z,F,G){return G=bi(G),G.tag=3,G.payload={element:null},G.callback=function(){Ls(z,F)},G}function Md(z){return z=bi(z),z.tag=3,z}function Ld(z,F,G,Y){var ee=G.type.getDerivedStateFromError;if(typeof ee=="function"){var ne=Y.value;z.payload=function(){return ee(ne)},z.callback=function(){Nd(F,G,Y)}}var se=G.stateNode;se!==null&&typeof se.componentDidCatch=="function"&&(z.callback=function(){Nd(F,G,Y),typeof ee!="function"&&(_i===null?_i=new Set([this]):_i.add(this));var ce=Y.stack;this.componentDidCatch(Y.value,{componentStack:ce!==null?ce:""})})}function jp(z,F,G,Y,ee){if(G.flags|=32768,Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){if(F=G.alternate,F!==null&&xr(F,G,ee,!0),G=vn.current,G!==null){switch(G.tag){case 31:case 13:return On===null?Ks():G.alternate===null&&Mt===0&&(Mt=3),G.flags&=-257,G.flags|=65536,G.lanes=ee,Y===Ts?G.flags|=16384:(F=G.updateQueue,F===null?G.updateQueue=new Set([Y]):F.add(Y),tc(z,Y,ee)),!1;case 22:return G.flags|=65536,Y===Ts?G.flags|=16384:(F=G.updateQueue,F===null?(F={transitions:null,markerInstances:null,retryQueue:new Set([Y])},G.updateQueue=F):(G=F.retryQueue,G===null?F.retryQueue=new Set([Y]):G.add(Y)),tc(z,Y,ee)),!1}throw Error(q(435,G.tag))}return tc(z,Y,ee),Ks(),!1}if(pt)return F=vn.current,F!==null?((F.flags&65536)===0&&(F.flags|=256),F.flags|=65536,F.lanes=ee,Y!==Yo&&(z=Error(q(422),{cause:Y}),ca(_n(z,G)))):(Y!==Yo&&(F=Error(q(423),{cause:Y}),ca(_n(F,G))),z=z.current.alternate,z.flags|=65536,ee&=-ee,z.lanes|=ee,Y=_n(Y,G),ee=Ol(z.stateNode,Y,ee),sl(z,ee),Mt!==4&&(Mt=2)),!1;var ne=Error(q(520),{cause:Y});if(ne=_n(ne,G),Ra===null?Ra=[ne]:Ra.push(ne),Mt!==4&&(Mt=2),F===null)return!0;Y=_n(Y,G),G=F;do{switch(G.tag){case 3:return G.flags|=65536,z=ee&-ee,G.lanes|=z,z=Ol(G.stateNode,Y,z),sl(G,z),!1;case 1:if(F=G.type,ne=G.stateNode,(G.flags&128)===0&&(typeof F.getDerivedStateFromError=="function"||ne!==null&&typeof ne.componentDidCatch=="function"&&(_i===null||!_i.has(ne))))return G.flags|=65536,ee&=-ee,G.lanes|=ee,ee=Md(ee),Ld(ee,z,G,Y),sl(G,ee),!1}G=G.return}while(G!==null);return!1}var Dl=Error(q(461)),Vt=!1;function Zt(z,F,G,Y){F.child=z===null?Bu(F,null,G,Y):Wi(F,z.child,G,Y)}function Id(z,F,G,Y,ee){G=G.render;var ne=F.ref;if("ref"in Y){var se={};for(var ce in Y)ce!=="ref"&&(se[ce]=Y[ce])}else se=Y;return Qi(F),Y=hl(z,F,G,se,ne,ee),ce=fl(),z!==null&&!Vt?(pl(z,F,ee),ei(z,F,ee)):(pt&&ce&&Ko(F),F.flags|=1,Zt(z,F,Y,ee),F.child)}function jd(z,F,G,Y,ee){if(z===null){var ne=G.type;return typeof ne=="function"&&!Ho(ne)&&ne.defaultProps===void 0&&G.compare===null?(F.tag=15,F.type=ne,Ud(z,F,ne,Y,ee)):(z=gs(G.type,null,Y,F,F.mode,ee),z.ref=F.ref,z.return=F,F.child=z)}if(ne=z.child,!Bl(z,ee)){var se=ne.memoizedProps;if(G=G.compare,G=G!==null?G:sa,G(se,Y)&&z.ref===F.ref)return ei(z,F,ee)}return F.flags|=1,z=Qn(ne,Y),z.ref=F.ref,z.return=F,F.child=z}function Ud(z,F,G,Y,ee){if(z!==null){var ne=z.memoizedProps;if(sa(ne,Y)&&z.ref===F.ref)if(Vt=!1,F.pendingProps=Y=ne,Bl(z,ee))(z.flags&131072)!==0&&(Vt=!0);else return F.lanes=z.lanes,ei(z,F,ee)}return Pl(z,F,G,Y,ee)}function Bd(z,F,G,Y){var ee=Y.children,ne=z!==null?z.memoizedState:null;if(z===null&&F.stateNode===null&&(F.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),Y.mode==="hidden"){if((F.flags&128)!==0){if(ne=ne!==null?ne.baseLanes|G:G,z!==null){for(Y=F.child=z.child,ee=0;Y!==null;)ee=ee|Y.lanes|Y.childLanes,Y=Y.sibling;Y=ee&~ne}else Y=0,F.child=null;return zd(z,F,ne,G,Y)}if((G&536870912)!==0)F.memoizedState={baseLanes:0,cachePool:null},z!==null&&Ss(F,ne!==null?ne.cachePool:null),ne!==null?Fu(F,ne):ll(),Vu(F);else return Y=F.lanes=536870912,zd(z,F,ne!==null?ne.baseLanes|G:G,G,Y)}else ne!==null?(Ss(F,ne.cachePool),Fu(F,ne),Ti(),F.memoizedState=null):(z!==null&&Ss(F,null),ll(),Ti());return Zt(z,F,ee,G),F.child}function ka(z,F){return z!==null&&z.tag===22||F.stateNode!==null||(F.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),F.sibling}function zd(z,F,G,Y,ee){var ne=nl();return ne=ne===null?null:{parent:qt._currentValue,pool:ne},F.memoizedState={baseLanes:G,cachePool:ne},z!==null&&Ss(F,null),ll(),Vu(F),z!==null&&xr(z,F,Y,!0),F.childLanes=ee,null}function Is(z,F){return F=Us({mode:F.mode,children:F.children},z.mode),F.ref=z.ref,z.child=F,F.return=z,F}function qd(z,F,G){return Wi(F,z.child,null,G),z=Is(F,F.pendingProps),z.flags|=2,yn(F),F.memoizedState=null,z}function Up(z,F,G){var Y=F.pendingProps,ee=(F.flags&128)!==0;if(F.flags&=-129,z===null){if(pt){if(Y.mode==="hidden")return z=Is(F,Y),F.lanes=536870912,ka(null,z);if(ul(F),(z=At)?(z=Zh(z,An),z=z!==null&&z.data==="&"?z:null,z!==null&&(F.memoizedState={dehydrated:z,treeContext:pi!==null?{id:Bn,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},G=xu(z),G.return=F,F.child=G,Xt=F,At=null)):z=null,z===null)throw gi(F);return F.lanes=536870912,null}return Is(F,Y)}var ne=z.memoizedState;if(ne!==null){var se=ne.dehydrated;if(ul(F),ee)if(F.flags&256)F.flags&=-257,F=qd(z,F,G);else if(F.memoizedState!==null)F.child=z.child,F.flags|=128,F=null;else throw Error(q(558));else if(Vt||xr(z,F,G,!1),ee=(G&z.childLanes)!==0,Vt||ee){if(Y=Rt,Y!==null&&(se=Dc(Y,G),se!==0&&se!==ne.retryLane))throw ne.retryLane=se,Hi(z,se),pn(Y,z,se),Dl;Ks(),F=qd(z,F,G)}else z=ne.treeContext,At=Dn(se.nextSibling),Xt=F,pt=!0,mi=null,An=!1,z!==null&&wu(F,z),F=Is(F,Y),F.flags|=4096;return F}return z=Qn(z.child,{mode:Y.mode,children:Y.children}),z.ref=F.ref,F.child=z,z.return=F,z}function js(z,F){var G=F.ref;if(G===null)z!==null&&z.ref!==null&&(F.flags|=4194816);else{if(typeof G!="function"&&typeof G!="object")throw Error(q(284));(z===null||z.ref!==G)&&(F.flags|=4194816)}}function Pl(z,F,G,Y,ee){return Qi(F),G=hl(z,F,G,Y,void 0,ee),Y=fl(),z!==null&&!Vt?(pl(z,F,ee),ei(z,F,ee)):(pt&&Y&&Ko(F),F.flags|=1,Zt(z,F,G,ee),F.child)}function Fd(z,F,G,Y,ee,ne){return Qi(F),F.updateQueue=null,G=$u(F,Y,G,ee),Hu(z),Y=fl(),z!==null&&!Vt?(pl(z,F,ne),ei(z,F,ne)):(pt&&Y&&Ko(F),F.flags|=1,Zt(z,F,G,ne),F.child)}function Vd(z,F,G,Y,ee){if(Qi(F),F.stateNode===null){var ne=Sr,se=G.contextType;typeof se=="object"&&se!==null&&(ne=Wt(se)),ne=new G(Y,ne),F.memoizedState=ne.state!==null&&ne.state!==void 0?ne.state:null,ne.updater=Al,F.stateNode=ne,ne._reactInternals=F,ne=F.stateNode,ne.props=Y,ne.state=F.memoizedState,ne.refs={},rl(F),se=G.contextType,ne.context=typeof se=="object"&&se!==null?Wt(se):Sr,ne.state=F.memoizedState,se=G.getDerivedStateFromProps,typeof se=="function"&&(Rl(F,G,se,Y),ne.state=F.memoizedState),typeof G.getDerivedStateFromProps=="function"||typeof ne.getSnapshotBeforeUpdate=="function"||typeof ne.UNSAFE_componentWillMount!="function"&&typeof ne.componentWillMount!="function"||(se=ne.state,typeof ne.componentWillMount=="function"&&ne.componentWillMount(),typeof ne.UNSAFE_componentWillMount=="function"&&ne.UNSAFE_componentWillMount(),se!==ne.state&&Al.enqueueReplaceState(ne,ne.state,null),ga(F,Y,ne,ee),ma(),ne.state=F.memoizedState),typeof ne.componentDidMount=="function"&&(F.flags|=4194308),Y=!0}else if(z===null){ne=F.stateNode;var ce=F.memoizedProps,ye=er(G,ce);ne.props=ye;var _e=ne.context,Me=G.contextType;se=Sr,typeof Me=="object"&&Me!==null&&(se=Wt(Me));var qe=G.getDerivedStateFromProps;Me=typeof qe=="function"||typeof ne.getSnapshotBeforeUpdate=="function",ce=F.pendingProps!==ce,Me||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(ce||_e!==se)&&Ad(F,ne,Y,se),yi=!1;var Re=F.memoizedState;ne.state=Re,ga(F,Y,ne,ee),ma(),_e=F.memoizedState,ce||Re!==_e||yi?(typeof qe=="function"&&(Rl(F,G,qe,Y),_e=F.memoizedState),(ye=yi||Rd(F,G,ye,Y,Re,_e,se))?(Me||typeof ne.UNSAFE_componentWillMount!="function"&&typeof ne.componentWillMount!="function"||(typeof ne.componentWillMount=="function"&&ne.componentWillMount(),typeof ne.UNSAFE_componentWillMount=="function"&&ne.UNSAFE_componentWillMount()),typeof ne.componentDidMount=="function"&&(F.flags|=4194308)):(typeof ne.componentDidMount=="function"&&(F.flags|=4194308),F.memoizedProps=Y,F.memoizedState=_e),ne.props=Y,ne.state=_e,ne.context=se,Y=ye):(typeof ne.componentDidMount=="function"&&(F.flags|=4194308),Y=!1)}else{ne=F.stateNode,al(z,F),se=F.memoizedProps,Me=er(G,se),ne.props=Me,qe=F.pendingProps,Re=ne.context,_e=G.contextType,ye=Sr,typeof _e=="object"&&_e!==null&&(ye=Wt(_e)),ce=G.getDerivedStateFromProps,(_e=typeof ce=="function"||typeof ne.getSnapshotBeforeUpdate=="function")||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(se!==qe||Re!==ye)&&Ad(F,ne,Y,ye),yi=!1,Re=F.memoizedState,ne.state=Re,ga(F,Y,ne,ee),ma();var Ae=F.memoizedState;se!==qe||Re!==Ae||yi||z!==null&&z.dependencies!==null&&ys(z.dependencies)?(typeof ce=="function"&&(Rl(F,G,ce,Y),Ae=F.memoizedState),(Me=yi||Rd(F,G,Me,Y,Re,Ae,ye)||z!==null&&z.dependencies!==null&&ys(z.dependencies))?(_e||typeof ne.UNSAFE_componentWillUpdate!="function"&&typeof ne.componentWillUpdate!="function"||(typeof ne.componentWillUpdate=="function"&&ne.componentWillUpdate(Y,Ae,ye),typeof ne.UNSAFE_componentWillUpdate=="function"&&ne.UNSAFE_componentWillUpdate(Y,Ae,ye)),typeof ne.componentDidUpdate=="function"&&(F.flags|=4),typeof ne.getSnapshotBeforeUpdate=="function"&&(F.flags|=1024)):(typeof ne.componentDidUpdate!="function"||se===z.memoizedProps&&Re===z.memoizedState||(F.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||se===z.memoizedProps&&Re===z.memoizedState||(F.flags|=1024),F.memoizedProps=Y,F.memoizedState=Ae),ne.props=Y,ne.state=Ae,ne.context=ye,Y=Me):(typeof ne.componentDidUpdate!="function"||se===z.memoizedProps&&Re===z.memoizedState||(F.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||se===z.memoizedProps&&Re===z.memoizedState||(F.flags|=1024),Y=!1)}return ne=Y,js(z,F),Y=(F.flags&128)!==0,ne||Y?(ne=F.stateNode,G=Y&&typeof G.getDerivedStateFromError!="function"?null:ne.render(),F.flags|=1,z!==null&&Y?(F.child=Wi(F,z.child,null,ee),F.child=Wi(F,null,G,ee)):Zt(z,F,G,ee),F.memoizedState=ne.state,z=F.child):z=ei(z,F,ee),z}function Hd(z,F,G,Y){return Gi(),F.flags|=256,Zt(z,F,G,Y),F.child}var Nl={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ml(z){return{baseLanes:z,cachePool:Nu()}}function Ll(z,F,G){return z=z!==null?z.childLanes&~G:0,F&&(z|=Sn),z}function $d(z,F,G){var Y=F.pendingProps,ee=!1,ne=(F.flags&128)!==0,se;if((se=ne)||(se=z!==null&&z.memoizedState===null?!1:(jt.current&2)!==0),se&&(ee=!0,F.flags&=-129),se=(F.flags&32)!==0,F.flags&=-33,z===null){if(pt){if(ee?ki(F):Ti(),(z=At)?(z=Zh(z,An),z=z!==null&&z.data!=="&"?z:null,z!==null&&(F.memoizedState={dehydrated:z,treeContext:pi!==null?{id:Bn,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},G=xu(z),G.return=F,F.child=G,Xt=F,At=null)):z=null,z===null)throw gi(F);return vc(z)?F.lanes=32:F.lanes=536870912,null}var ce=Y.children;return Y=Y.fallback,ee?(Ti(),ee=F.mode,ce=Us({mode:"hidden",children:ce},ee),Y=$i(Y,ee,G,null),ce.return=F,Y.return=F,ce.sibling=Y,F.child=ce,Y=F.child,Y.memoizedState=Ml(G),Y.childLanes=Ll(z,se,G),F.memoizedState=Nl,ka(null,Y)):(ki(F),Il(F,ce))}var ye=z.memoizedState;if(ye!==null&&(ce=ye.dehydrated,ce!==null)){if(ne)F.flags&256?(ki(F),F.flags&=-257,F=jl(z,F,G)):F.memoizedState!==null?(Ti(),F.child=z.child,F.flags|=128,F=null):(Ti(),ce=Y.fallback,ee=F.mode,Y=Us({mode:"visible",children:Y.children},ee),ce=$i(ce,ee,G,null),ce.flags|=2,Y.return=F,ce.return=F,Y.sibling=ce,F.child=Y,Wi(F,z.child,null,G),Y=F.child,Y.memoizedState=Ml(G),Y.childLanes=Ll(z,se,G),F.memoizedState=Nl,F=ka(null,Y));else if(ki(F),vc(ce)){if(se=ce.nextSibling&&ce.nextSibling.dataset,se)var _e=se.dgst;se=_e,Y=Error(q(419)),Y.stack="",Y.digest=se,ca({value:Y,source:null,stack:null}),F=jl(z,F,G)}else if(Vt||xr(z,F,G,!1),se=(G&z.childLanes)!==0,Vt||se){if(se=Rt,se!==null&&(Y=Dc(se,G),Y!==0&&Y!==ye.retryLane))throw ye.retryLane=Y,Hi(z,Y),pn(se,z,Y),Dl;gc(ce)||Ks(),F=jl(z,F,G)}else gc(ce)?(F.flags|=192,F.child=z.child,F=null):(z=ye.treeContext,At=Dn(ce.nextSibling),Xt=F,pt=!0,mi=null,An=!1,z!==null&&wu(F,z),F=Il(F,Y.children),F.flags|=4096);return F}return ee?(Ti(),ce=Y.fallback,ee=F.mode,ye=z.child,_e=ye.sibling,Y=Qn(ye,{mode:"hidden",children:Y.children}),Y.subtreeFlags=ye.subtreeFlags&65011712,_e!==null?ce=Qn(_e,ce):(ce=$i(ce,ee,G,null),ce.flags|=2),ce.return=F,Y.return=F,Y.sibling=ce,F.child=Y,ka(null,Y),Y=F.child,ce=z.child.memoizedState,ce===null?ce=Ml(G):(ee=ce.cachePool,ee!==null?(ye=qt._currentValue,ee=ee.parent!==ye?{parent:ye,pool:ye}:ee):ee=Nu(),ce={baseLanes:ce.baseLanes|G,cachePool:ee}),Y.memoizedState=ce,Y.childLanes=Ll(z,se,G),F.memoizedState=Nl,ka(z.child,Y)):(ki(F),G=z.child,z=G.sibling,G=Qn(G,{mode:"visible",children:Y.children}),G.return=F,G.sibling=null,z!==null&&(se=F.deletions,se===null?(F.deletions=[z],F.flags|=16):se.push(z)),F.child=G,F.memoizedState=null,G)}function Il(z,F){return F=Us({mode:"visible",children:F},z.mode),F.return=z,z.child=F}function Us(z,F){return z=gn(22,z,null,F),z.lanes=0,z}function jl(z,F,G){return Wi(F,z.child,null,G),z=Il(F,F.pendingProps.children),z.flags|=2,F.memoizedState=null,z}function Gd(z,F,G){z.lanes|=F;var Y=z.alternate;Y!==null&&(Y.lanes|=F),Wo(z.return,F,G)}function Ul(z,F,G,Y,ee,ne){var se=z.memoizedState;se===null?z.memoizedState={isBackwards:F,rendering:null,renderingStartTime:0,last:Y,tail:G,tailMode:ee,treeForkCount:ne}:(se.isBackwards=F,se.rendering=null,se.renderingStartTime=0,se.last=Y,se.tail=G,se.tailMode=ee,se.treeForkCount=ne)}function Kd(z,F,G){var Y=F.pendingProps,ee=Y.revealOrder,ne=Y.tail;Y=Y.children;var se=jt.current,ce=(se&2)!==0;if(ce?(se=se&1|2,F.flags|=128):se&=1,fe(jt,se),Zt(z,F,Y,G),Y=pt?la:0,!ce&&z!==null&&(z.flags&128)!==0)e:for(z=F.child;z!==null;){if(z.tag===13)z.memoizedState!==null&&Gd(z,G,F);else if(z.tag===19)Gd(z,G,F);else if(z.child!==null){z.child.return=z,z=z.child;continue}if(z===F)break e;for(;z.sibling===null;){if(z.return===null||z.return===F)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}switch(ee){case"forwards":for(G=F.child,ee=null;G!==null;)z=G.alternate,z!==null&&_s(z)===null&&(ee=G),G=G.sibling;G=ee,G===null?(ee=F.child,F.child=null):(ee=G.sibling,G.sibling=null),Ul(F,!1,ee,G,ne,Y);break;case"backwards":case"unstable_legacy-backwards":for(G=null,ee=F.child,F.child=null;ee!==null;){if(z=ee.alternate,z!==null&&_s(z)===null){F.child=ee;break}z=ee.sibling,ee.sibling=G,G=ee,ee=z}Ul(F,!0,G,null,ne,Y);break;case"together":Ul(F,!1,null,null,void 0,Y);break;default:F.memoizedState=null}return F.child}function ei(z,F,G){if(z!==null&&(F.dependencies=z.dependencies),Ci|=F.lanes,(G&F.childLanes)===0)if(z!==null){if(xr(z,F,G,!1),(G&F.childLanes)===0)return null}else return null;if(z!==null&&F.child!==z.child)throw Error(q(153));if(F.child!==null){for(z=F.child,G=Qn(z,z.pendingProps),F.child=G,G.return=F;z.sibling!==null;)z=z.sibling,G=G.sibling=Qn(z,z.pendingProps),G.return=F;G.sibling=null}return F.child}function Bl(z,F){return(z.lanes&F)!==0?!0:(z=z.dependencies,!!(z!==null&&ys(z)))}function Bp(z,F,G){switch(F.tag){case 3:xt(F,F.stateNode.containerInfo),vi(F,qt,z.memoizedState.cache),Gi();break;case 27:case 5:on(F);break;case 4:xt(F,F.stateNode.containerInfo);break;case 10:vi(F,F.type,F.memoizedProps.value);break;case 31:if(F.memoizedState!==null)return F.flags|=128,ul(F),null;break;case 13:var Y=F.memoizedState;if(Y!==null)return Y.dehydrated!==null?(ki(F),F.flags|=128,null):(G&F.child.childLanes)!==0?$d(z,F,G):(ki(F),z=ei(z,F,G),z!==null?z.sibling:null);ki(F);break;case 19:var ee=(z.flags&128)!==0;if(Y=(G&F.childLanes)!==0,Y||(xr(z,F,G,!1),Y=(G&F.childLanes)!==0),ee){if(Y)return Kd(z,F,G);F.flags|=128}if(ee=F.memoizedState,ee!==null&&(ee.rendering=null,ee.tail=null,ee.lastEffect=null),fe(jt,jt.current),Y)break;return null;case 22:return F.lanes=0,Bd(z,F,G,F.pendingProps);case 24:vi(F,qt,z.memoizedState.cache)}return ei(z,F,G)}function Qd(z,F,G){if(z!==null)if(z.memoizedProps!==F.pendingProps)Vt=!0;else{if(!Bl(z,G)&&(F.flags&128)===0)return Vt=!1,Bp(z,F,G);Vt=(z.flags&131072)!==0}else Vt=!1,pt&&(F.flags&1048576)!==0&&_u(F,la,F.index);switch(F.lanes=0,F.tag){case 16:e:{var Y=F.pendingProps;if(z=Ji(F.elementType),F.type=z,typeof z=="function")Ho(z)?(Y=er(z,Y),F.tag=1,F=Vd(null,F,z,Y,G)):(F.tag=0,F=Pl(null,F,z,Y,G));else{if(z!=null){var ee=z.$$typeof;if(ee===me){F.tag=11,F=Id(null,F,z,Y,G);break e}else if(ee===Ee){F.tag=14,F=jd(null,F,z,Y,G);break e}}throw F=De(z)||z,Error(q(306,F,""))}}return F;case 0:return Pl(z,F,F.type,F.pendingProps,G);case 1:return Y=F.type,ee=er(Y,F.pendingProps),Vd(z,F,Y,ee,G);case 3:e:{if(xt(F,F.stateNode.containerInfo),z===null)throw Error(q(387));Y=F.pendingProps;var ne=F.memoizedState;ee=ne.element,al(z,F),ga(F,Y,null,G);var se=F.memoizedState;if(Y=se.cache,vi(F,qt,Y),Y!==ne.cache&&Zo(F,[qt],G,!0),ma(),Y=se.element,ne.isDehydrated)if(ne={element:Y,isDehydrated:!1,cache:se.cache},F.updateQueue.baseState=ne,F.memoizedState=ne,F.flags&256){F=Hd(z,F,Y,G);break e}else if(Y!==ee){ee=_n(Error(q(424)),F),ca(ee),F=Hd(z,F,Y,G);break e}else{switch(z=F.stateNode.containerInfo,z.nodeType){case 9:z=z.body;break;default:z=z.nodeName==="HTML"?z.ownerDocument.body:z}for(At=Dn(z.firstChild),Xt=F,pt=!0,mi=null,An=!0,G=Bu(F,null,Y,G),F.child=G;G;)G.flags=G.flags&-3|4096,G=G.sibling}else{if(Gi(),Y===ee){F=ei(z,F,G);break e}Zt(z,F,Y,G)}F=F.child}return F;case 26:return js(z,F),z===null?(G=sf(F.type,null,F.pendingProps,null))?F.memoizedState=G:pt||(G=F.type,z=F.pendingProps,Y=eo(He.current).createElement(G),Y[Jt]=F,Y[ln]=z,en(Y,G,z),Kt(Y),F.stateNode=Y):F.memoizedState=sf(F.type,z.memoizedProps,F.pendingProps,z.memoizedState),null;case 27:return on(F),z===null&&pt&&(Y=F.stateNode=nf(F.type,F.pendingProps,He.current),Xt=F,An=!0,ee=At,Oi(F.type)?(yc=ee,At=Dn(Y.firstChild)):At=ee),Zt(z,F,F.pendingProps.children,G),js(z,F),z===null&&(F.flags|=4194304),F.child;case 5:return z===null&&pt&&((ee=Y=At)&&(Y=mm(Y,F.type,F.pendingProps,An),Y!==null?(F.stateNode=Y,Xt=F,At=Dn(Y.firstChild),An=!1,ee=!0):ee=!1),ee||gi(F)),on(F),ee=F.type,ne=F.pendingProps,se=z!==null?z.memoizedProps:null,Y=ne.children,fc(ee,ne)?Y=null:se!==null&&fc(ee,se)&&(F.flags|=32),F.memoizedState!==null&&(ee=hl(z,F,Op,null,null,G),Ia._currentValue=ee),js(z,F),Zt(z,F,Y,G),F.child;case 6:return z===null&&pt&&((z=G=At)&&(G=gm(G,F.pendingProps,An),G!==null?(F.stateNode=G,Xt=F,At=null,z=!0):z=!1),z||gi(F)),null;case 13:return $d(z,F,G);case 4:return xt(F,F.stateNode.containerInfo),Y=F.pendingProps,z===null?F.child=Wi(F,null,Y,G):Zt(z,F,Y,G),F.child;case 11:return Id(z,F,F.type,F.pendingProps,G);case 7:return Zt(z,F,F.pendingProps,G),F.child;case 8:return Zt(z,F,F.pendingProps.children,G),F.child;case 12:return Zt(z,F,F.pendingProps.children,G),F.child;case 10:return Y=F.pendingProps,vi(F,F.type,Y.value),Zt(z,F,Y.children,G),F.child;case 9:return ee=F.type._context,Y=F.pendingProps.children,Qi(F),ee=Wt(ee),Y=Y(ee),F.flags|=1,Zt(z,F,Y,G),F.child;case 14:return jd(z,F,F.type,F.pendingProps,G);case 15:return Ud(z,F,F.type,F.pendingProps,G);case 19:return Kd(z,F,G);case 31:return Up(z,F,G);case 22:return Bd(z,F,G,F.pendingProps);case 24:return Qi(F),Y=Wt(qt),z===null?(ee=nl(),ee===null&&(ee=Rt,ne=el(),ee.pooledCache=ne,ne.refCount++,ne!==null&&(ee.pooledCacheLanes|=G),ee=ne),F.memoizedState={parent:Y,cache:ee},rl(F),vi(F,qt,ee)):((z.lanes&G)!==0&&(al(z,F),ga(F,null,null,G),ma()),ee=z.memoizedState,ne=F.memoizedState,ee.parent!==Y?(ee={parent:Y,cache:Y},F.memoizedState=ee,F.lanes===0&&(F.memoizedState=F.updateQueue.baseState=ee),vi(F,qt,Y)):(Y=ne.cache,vi(F,qt,Y),Y!==ee.cache&&Zo(F,[qt],G,!0))),Zt(z,F,F.pendingProps.children,G),F.child;case 29:throw F.pendingProps}throw Error(q(156,F.tag))}function ti(z){z.flags|=4}function zl(z,F,G,Y,ee){if((F=(z.mode&32)!==0)&&(F=!1),F){if(z.flags|=16777216,(ee&335544128)===ee)if(z.stateNode.complete)z.flags|=8192;else if(kh())z.flags|=8192;else throw Xi=Ts,il}else z.flags&=-16777217}function Yd(z,F){if(F.type!=="stylesheet"||(F.state.loading&4)!==0)z.flags&=-16777217;else if(z.flags|=16777216,!df(F))if(kh())z.flags|=8192;else throw Xi=Ts,il}function Bs(z,F){F!==null&&(z.flags|=4),z.flags&16384&&(F=z.tag!==22?Rc():536870912,z.lanes|=F,Ir|=F)}function Ta(z,F){if(!pt)switch(z.tailMode){case"hidden":F=z.tail;for(var G=null;F!==null;)F.alternate!==null&&(G=F),F=F.sibling;G===null?z.tail=null:G.sibling=null;break;case"collapsed":G=z.tail;for(var Y=null;G!==null;)G.alternate!==null&&(Y=G),G=G.sibling;Y===null?F||z.tail===null?z.tail=null:z.tail.sibling=null:Y.sibling=null}}function Ot(z){var F=z.alternate!==null&&z.alternate.child===z.child,G=0,Y=0;if(F)for(var ee=z.child;ee!==null;)G|=ee.lanes|ee.childLanes,Y|=ee.subtreeFlags&65011712,Y|=ee.flags&65011712,ee.return=z,ee=ee.sibling;else for(ee=z.child;ee!==null;)G|=ee.lanes|ee.childLanes,Y|=ee.subtreeFlags,Y|=ee.flags,ee.return=z,ee=ee.sibling;return z.subtreeFlags|=Y,z.childLanes=G,F}function zp(z,F,G){var Y=F.pendingProps;switch(Qo(F),F.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ot(F),null;case 1:return Ot(F),null;case 3:return G=F.stateNode,Y=null,z!==null&&(Y=z.memoizedState.cache),F.memoizedState.cache!==Y&&(F.flags|=2048),Xn(qt),gt(),G.pendingContext&&(G.context=G.pendingContext,G.pendingContext=null),(z===null||z.child===null)&&(Er(F)?ti(F):z===null||z.memoizedState.isDehydrated&&(F.flags&256)===0||(F.flags|=1024,Jo())),Ot(F),null;case 26:var ee=F.type,ne=F.memoizedState;return z===null?(ti(F),ne!==null?(Ot(F),Yd(F,ne)):(Ot(F),zl(F,ee,null,Y,G))):ne?ne!==z.memoizedState?(ti(F),Ot(F),Yd(F,ne)):(Ot(F),F.flags&=-16777217):(z=z.memoizedProps,z!==Y&&ti(F),Ot(F),zl(F,ee,z,Y,G)),null;case 27:if(tn(F),G=He.current,ee=F.type,z!==null&&F.stateNode!=null)z.memoizedProps!==Y&&ti(F);else{if(!Y){if(F.stateNode===null)throw Error(q(166));return Ot(F),null}z=Qe.current,Er(F)?Ru(F):(z=nf(ee,Y,G),F.stateNode=z,ti(F))}return Ot(F),null;case 5:if(tn(F),ee=F.type,z!==null&&F.stateNode!=null)z.memoizedProps!==Y&&ti(F);else{if(!Y){if(F.stateNode===null)throw Error(q(166));return Ot(F),null}if(ne=Qe.current,Er(F))Ru(F);else{var se=eo(He.current);switch(ne){case 1:ne=se.createElementNS("http://www.w3.org/2000/svg",ee);break;case 2:ne=se.createElementNS("http://www.w3.org/1998/Math/MathML",ee);break;default:switch(ee){case"svg":ne=se.createElementNS("http://www.w3.org/2000/svg",ee);break;case"math":ne=se.createElementNS("http://www.w3.org/1998/Math/MathML",ee);break;case"script":ne=se.createElement("div"),ne.innerHTML="<script><\/script>",ne=ne.removeChild(ne.firstChild);break;case"select":ne=typeof Y.is=="string"?se.createElement("select",{is:Y.is}):se.createElement("select"),Y.multiple?ne.multiple=!0:Y.size&&(ne.size=Y.size);break;default:ne=typeof Y.is=="string"?se.createElement(ee,{is:Y.is}):se.createElement(ee)}}ne[Jt]=F,ne[ln]=Y;e:for(se=F.child;se!==null;){if(se.tag===5||se.tag===6)ne.appendChild(se.stateNode);else if(se.tag!==4&&se.tag!==27&&se.child!==null){se.child.return=se,se=se.child;continue}if(se===F)break e;for(;se.sibling===null;){if(se.return===null||se.return===F)break e;se=se.return}se.sibling.return=se.return,se=se.sibling}F.stateNode=ne;e:switch(en(ne,ee,Y),ee){case"button":case"input":case"select":case"textarea":Y=!!Y.autoFocus;break e;case"img":Y=!0;break e;default:Y=!1}Y&&ti(F)}}return Ot(F),zl(F,F.type,z===null?null:z.memoizedProps,F.pendingProps,G),null;case 6:if(z&&F.stateNode!=null)z.memoizedProps!==Y&&ti(F);else{if(typeof Y!="string"&&F.stateNode===null)throw Error(q(166));if(z=He.current,Er(F)){if(z=F.stateNode,G=F.memoizedProps,Y=null,ee=Xt,ee!==null)switch(ee.tag){case 27:case 5:Y=ee.memoizedProps}z[Jt]=F,z=!!(z.nodeValue===G||Y!==null&&Y.suppressHydrationWarning===!0||$h(z.nodeValue,G)),z||gi(F,!0)}else z=eo(z).createTextNode(Y),z[Jt]=F,F.stateNode=z}return Ot(F),null;case 31:if(G=F.memoizedState,z===null||z.memoizedState!==null){if(Y=Er(F),G!==null){if(z===null){if(!Y)throw Error(q(318));if(z=F.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(q(557));z[Jt]=F}else Gi(),(F.flags&128)===0&&(F.memoizedState=null),F.flags|=4;Ot(F),z=!1}else G=Jo(),z!==null&&z.memoizedState!==null&&(z.memoizedState.hydrationErrors=G),z=!0;if(!z)return F.flags&256?(yn(F),F):(yn(F),null);if((F.flags&128)!==0)throw Error(q(558))}return Ot(F),null;case 13:if(Y=F.memoizedState,z===null||z.memoizedState!==null&&z.memoizedState.dehydrated!==null){if(ee=Er(F),Y!==null&&Y.dehydrated!==null){if(z===null){if(!ee)throw Error(q(318));if(ee=F.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(q(317));ee[Jt]=F}else Gi(),(F.flags&128)===0&&(F.memoizedState=null),F.flags|=4;Ot(F),ee=!1}else ee=Jo(),z!==null&&z.memoizedState!==null&&(z.memoizedState.hydrationErrors=ee),ee=!0;if(!ee)return F.flags&256?(yn(F),F):(yn(F),null)}return yn(F),(F.flags&128)!==0?(F.lanes=G,F):(G=Y!==null,z=z!==null&&z.memoizedState!==null,G&&(Y=F.child,ee=null,Y.alternate!==null&&Y.alternate.memoizedState!==null&&Y.alternate.memoizedState.cachePool!==null&&(ee=Y.alternate.memoizedState.cachePool.pool),ne=null,Y.memoizedState!==null&&Y.memoizedState.cachePool!==null&&(ne=Y.memoizedState.cachePool.pool),ne!==ee&&(Y.flags|=2048)),G!==z&&G&&(F.child.flags|=8192),Bs(F,F.updateQueue),Ot(F),null);case 4:return gt(),z===null&&lc(F.stateNode.containerInfo),Ot(F),null;case 10:return Xn(F.type),Ot(F),null;case 19:if(Oe(jt),Y=F.memoizedState,Y===null)return Ot(F),null;if(ee=(F.flags&128)!==0,ne=Y.rendering,ne===null)if(ee)Ta(Y,!1);else{if(Mt!==0||z!==null&&(z.flags&128)!==0)for(z=F.child;z!==null;){if(ne=_s(z),ne!==null){for(F.flags|=128,Ta(Y,!1),z=ne.updateQueue,F.updateQueue=z,Bs(F,z),F.subtreeFlags=0,z=G,G=F.child;G!==null;)Eu(G,z),G=G.sibling;return fe(jt,jt.current&1|2),pt&&Yn(F,Y.treeForkCount),F.child}z=z.sibling}Y.tail!==null&&Yt()>Hs&&(F.flags|=128,ee=!0,Ta(Y,!1),F.lanes=4194304)}else{if(!ee)if(z=_s(ne),z!==null){if(F.flags|=128,ee=!0,z=z.updateQueue,F.updateQueue=z,Bs(F,z),Ta(Y,!0),Y.tail===null&&Y.tailMode==="hidden"&&!ne.alternate&&!pt)return Ot(F),null}else 2*Yt()-Y.renderingStartTime>Hs&&G!==536870912&&(F.flags|=128,ee=!0,Ta(Y,!1),F.lanes=4194304);Y.isBackwards?(ne.sibling=F.child,F.child=ne):(z=Y.last,z!==null?z.sibling=ne:F.child=ne,Y.last=ne)}return Y.tail!==null?(z=Y.tail,Y.rendering=z,Y.tail=z.sibling,Y.renderingStartTime=Yt(),z.sibling=null,G=jt.current,fe(jt,ee?G&1|2:G&1),pt&&Yn(F,Y.treeForkCount),z):(Ot(F),null);case 22:case 23:return yn(F),cl(),Y=F.memoizedState!==null,z!==null?z.memoizedState!==null!==Y&&(F.flags|=8192):Y&&(F.flags|=8192),Y?(G&536870912)!==0&&(F.flags&128)===0&&(Ot(F),F.subtreeFlags&6&&(F.flags|=8192)):Ot(F),G=F.updateQueue,G!==null&&Bs(F,G.retryQueue),G=null,z!==null&&z.memoizedState!==null&&z.memoizedState.cachePool!==null&&(G=z.memoizedState.cachePool.pool),Y=null,F.memoizedState!==null&&F.memoizedState.cachePool!==null&&(Y=F.memoizedState.cachePool.pool),Y!==G&&(F.flags|=2048),z!==null&&Oe(Yi),null;case 24:return G=null,z!==null&&(G=z.memoizedState.cache),F.memoizedState.cache!==G&&(F.flags|=2048),Xn(qt),Ot(F),null;case 25:return null;case 30:return null}throw Error(q(156,F.tag))}function qp(z,F){switch(Qo(F),F.tag){case 1:return z=F.flags,z&65536?(F.flags=z&-65537|128,F):null;case 3:return Xn(qt),gt(),z=F.flags,(z&65536)!==0&&(z&128)===0?(F.flags=z&-65537|128,F):null;case 26:case 27:case 5:return tn(F),null;case 31:if(F.memoizedState!==null){if(yn(F),F.alternate===null)throw Error(q(340));Gi()}return z=F.flags,z&65536?(F.flags=z&-65537|128,F):null;case 13:if(yn(F),z=F.memoizedState,z!==null&&z.dehydrated!==null){if(F.alternate===null)throw Error(q(340));Gi()}return z=F.flags,z&65536?(F.flags=z&-65537|128,F):null;case 19:return Oe(jt),null;case 4:return gt(),null;case 10:return Xn(F.type),null;case 22:case 23:return yn(F),cl(),z!==null&&Oe(Yi),z=F.flags,z&65536?(F.flags=z&-65537|128,F):null;case 24:return Xn(qt),null;case 25:return null;default:return null}}function Jd(z,F){switch(Qo(F),F.tag){case 3:Xn(qt),gt();break;case 26:case 27:case 5:tn(F);break;case 4:gt();break;case 31:F.memoizedState!==null&&yn(F);break;case 13:yn(F);break;case 19:Oe(jt);break;case 10:Xn(F.type);break;case 22:case 23:yn(F),cl(),z!==null&&Oe(Yi);break;case 24:Xn(qt)}}function Ea(z,F){try{var G=F.updateQueue,Y=G!==null?G.lastEffect:null;if(Y!==null){var ee=Y.next;G=ee;do{if((G.tag&z)===z){Y=void 0;var ne=G.create,se=G.inst;Y=ne(),se.destroy=Y}G=G.next}while(G!==ee)}}catch(ce){Et(F,F.return,ce)}}function Ei(z,F,G){try{var Y=F.updateQueue,ee=Y!==null?Y.lastEffect:null;if(ee!==null){var ne=ee.next;Y=ne;do{if((Y.tag&z)===z){var se=Y.inst,ce=se.destroy;if(ce!==void 0){se.destroy=void 0,ee=F;var ye=G,_e=ce;try{_e()}catch(Me){Et(ee,ye,Me)}}}Y=Y.next}while(Y!==ne)}}catch(Me){Et(F,F.return,Me)}}function Xd(z){var F=z.updateQueue;if(F!==null){var G=z.stateNode;try{qu(F,G)}catch(Y){Et(z,z.return,Y)}}}function Wd(z,F,G){G.props=er(z.type,z.memoizedProps),G.state=z.memoizedState;try{G.componentWillUnmount()}catch(Y){Et(z,F,Y)}}function xa(z,F){try{var G=z.ref;if(G!==null){switch(z.tag){case 26:case 27:case 5:var Y=z.stateNode;break;case 30:Y=z.stateNode;break;default:Y=z.stateNode}typeof G=="function"?z.refCleanup=G(Y):G.current=Y}}catch(ee){Et(z,F,ee)}}function qn(z,F){var G=z.ref,Y=z.refCleanup;if(G!==null)if(typeof Y=="function")try{Y()}catch(ee){Et(z,F,ee)}finally{z.refCleanup=null,z=z.alternate,z!=null&&(z.refCleanup=null)}else if(typeof G=="function")try{G(null)}catch(ee){Et(z,F,ee)}else G.current=null}function Zd(z){var F=z.type,G=z.memoizedProps,Y=z.stateNode;try{e:switch(F){case"button":case"input":case"select":case"textarea":G.autoFocus&&Y.focus();break e;case"img":G.src?Y.src=G.src:G.srcSet&&(Y.srcset=G.srcSet)}}catch(ee){Et(z,z.return,ee)}}function ql(z,F,G){try{var Y=z.stateNode;cm(Y,z.type,G,F),Y[ln]=F}catch(ee){Et(z,z.return,ee)}}function eh(z){return z.tag===5||z.tag===3||z.tag===26||z.tag===27&&Oi(z.type)||z.tag===4}function Fl(z){e:for(;;){for(;z.sibling===null;){if(z.return===null||eh(z.return))return null;z=z.return}for(z.sibling.return=z.return,z=z.sibling;z.tag!==5&&z.tag!==6&&z.tag!==18;){if(z.tag===27&&Oi(z.type)||z.flags&2||z.child===null||z.tag===4)continue e;z.child.return=z,z=z.child}if(!(z.flags&2))return z.stateNode}}function Vl(z,F,G){var Y=z.tag;if(Y===5||Y===6)z=z.stateNode,F?(G.nodeType===9?G.body:G.nodeName==="HTML"?G.ownerDocument.body:G).insertBefore(z,F):(F=G.nodeType===9?G.body:G.nodeName==="HTML"?G.ownerDocument.body:G,F.appendChild(z),G=G._reactRootContainer,G!=null||F.onclick!==null||(F.onclick=Gn));else if(Y!==4&&(Y===27&&Oi(z.type)&&(G=z.stateNode,F=null),z=z.child,z!==null))for(Vl(z,F,G),z=z.sibling;z!==null;)Vl(z,F,G),z=z.sibling}function zs(z,F,G){var Y=z.tag;if(Y===5||Y===6)z=z.stateNode,F?G.insertBefore(z,F):G.appendChild(z);else if(Y!==4&&(Y===27&&Oi(z.type)&&(G=z.stateNode),z=z.child,z!==null))for(zs(z,F,G),z=z.sibling;z!==null;)zs(z,F,G),z=z.sibling}function th(z){var F=z.stateNode,G=z.memoizedProps;try{for(var Y=z.type,ee=F.attributes;ee.length;)F.removeAttributeNode(ee[0]);en(F,Y,G),F[Jt]=z,F[ln]=G}catch(ne){Et(z,z.return,ne)}}var ni=!1,Ht=!1,Hl=!1,nh=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function Fp(z,F){if(z=z.containerInfo,dc=oo,z=pu(z),jo(z)){if("selectionStart"in z)var G={start:z.selectionStart,end:z.selectionEnd};else e:{G=(G=z.ownerDocument)&&G.defaultView||window;var Y=G.getSelection&&G.getSelection();if(Y&&Y.rangeCount!==0){G=Y.anchorNode;var ee=Y.anchorOffset,ne=Y.focusNode;Y=Y.focusOffset;try{G.nodeType,ne.nodeType}catch{G=null;break e}var se=0,ce=-1,ye=-1,_e=0,Me=0,qe=z,Re=null;t:for(;;){for(var Ae;qe!==G||ee!==0&&qe.nodeType!==3||(ce=se+ee),qe!==ne||Y!==0&&qe.nodeType!==3||(ye=se+Y),qe.nodeType===3&&(se+=qe.nodeValue.length),(Ae=qe.firstChild)!==null;)Re=qe,qe=Ae;for(;;){if(qe===z)break t;if(Re===G&&++_e===ee&&(ce=se),Re===ne&&++Me===Y&&(ye=se),(Ae=qe.nextSibling)!==null)break;qe=Re,Re=qe.parentNode}qe=Ae}G=ce===-1||ye===-1?null:{start:ce,end:ye}}else G=null}G=G||{start:0,end:0}}else G=null;for(hc={focusedElem:z,selectionRange:G},oo=!1,Qt=F;Qt!==null;)if(F=Qt,z=F.child,(F.subtreeFlags&1028)!==0&&z!==null)z.return=F,Qt=z;else for(;Qt!==null;){switch(F=Qt,ne=F.alternate,z=F.flags,F.tag){case 0:if((z&4)!==0&&(z=F.updateQueue,z=z!==null?z.events:null,z!==null))for(G=0;G<z.length;G++)ee=z[G],ee.ref.impl=ee.nextImpl;break;case 11:case 15:break;case 1:if((z&1024)!==0&&ne!==null){z=void 0,G=F,ee=ne.memoizedProps,ne=ne.memoizedState,Y=G.stateNode;try{var We=er(G.type,ee);z=Y.getSnapshotBeforeUpdate(We,ne),Y.__reactInternalSnapshotBeforeUpdate=z}catch(nt){Et(G,G.return,nt)}}break;case 3:if((z&1024)!==0){if(z=F.stateNode.containerInfo,G=z.nodeType,G===9)mc(z);else if(G===1)switch(z.nodeName){case"HEAD":case"HTML":case"BODY":mc(z);break;default:z.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((z&1024)!==0)throw Error(q(163))}if(z=F.sibling,z!==null){z.return=F.return,Qt=z;break}Qt=F.return}}function ih(z,F,G){var Y=G.flags;switch(G.tag){case 0:case 11:case 15:ri(z,G),Y&4&&Ea(5,G);break;case 1:if(ri(z,G),Y&4)if(z=G.stateNode,F===null)try{z.componentDidMount()}catch(se){Et(G,G.return,se)}else{var ee=er(G.type,F.memoizedProps);F=F.memoizedState;try{z.componentDidUpdate(ee,F,z.__reactInternalSnapshotBeforeUpdate)}catch(se){Et(G,G.return,se)}}Y&64&&Xd(G),Y&512&&xa(G,G.return);break;case 3:if(ri(z,G),Y&64&&(z=G.updateQueue,z!==null)){if(F=null,G.child!==null)switch(G.child.tag){case 27:case 5:F=G.child.stateNode;break;case 1:F=G.child.stateNode}try{qu(z,F)}catch(se){Et(G,G.return,se)}}break;case 27:F===null&&Y&4&&th(G);case 26:case 5:ri(z,G),F===null&&Y&4&&Zd(G),Y&512&&xa(G,G.return);break;case 12:ri(z,G);break;case 31:ri(z,G),Y&4&&sh(z,G);break;case 13:ri(z,G),Y&4&&oh(z,G),Y&64&&(z=G.memoizedState,z!==null&&(z=z.dehydrated,z!==null&&(G=Xp.bind(null,G),vm(z,G))));break;case 22:if(Y=G.memoizedState!==null||ni,!Y){F=F!==null&&F.memoizedState!==null||Ht,ee=ni;var ne=Ht;ni=Y,(Ht=F)&&!ne?ai(z,G,(G.subtreeFlags&8772)!==0):ri(z,G),ni=ee,Ht=ne}break;case 30:break;default:ri(z,G)}}function rh(z){var F=z.alternate;F!==null&&(z.alternate=null,rh(F)),z.child=null,z.deletions=null,z.sibling=null,z.tag===5&&(F=z.stateNode,F!==null&&So(F)),z.stateNode=null,z.return=null,z.dependencies=null,z.memoizedProps=null,z.memoizedState=null,z.pendingProps=null,z.stateNode=null,z.updateQueue=null}var Dt=null,un=!1;function ii(z,F,G){for(G=G.child;G!==null;)ah(z,F,G),G=G.sibling}function ah(z,F,G){if(Pe&&typeof Pe.onCommitFiberUnmount=="function")try{Pe.onCommitFiberUnmount(mt,G)}catch{}switch(G.tag){case 26:Ht||qn(G,F),ii(z,F,G),G.memoizedState?G.memoizedState.count--:G.stateNode&&(G=G.stateNode,G.parentNode.removeChild(G));break;case 27:Ht||qn(G,F);var Y=Dt,ee=un;Oi(G.type)&&(Dt=G.stateNode,un=!1),ii(z,F,G),Na(G.stateNode),Dt=Y,un=ee;break;case 5:Ht||qn(G,F);case 6:if(Y=Dt,ee=un,Dt=null,ii(z,F,G),Dt=Y,un=ee,Dt!==null)if(un)try{(Dt.nodeType===9?Dt.body:Dt.nodeName==="HTML"?Dt.ownerDocument.body:Dt).removeChild(G.stateNode)}catch(ne){Et(G,F,ne)}else try{Dt.removeChild(G.stateNode)}catch(ne){Et(G,F,ne)}break;case 18:Dt!==null&&(un?(z=Dt,Xh(z.nodeType===9?z.body:z.nodeName==="HTML"?z.ownerDocument.body:z,G.stateNode),Hr(z)):Xh(Dt,G.stateNode));break;case 4:Y=Dt,ee=un,Dt=G.stateNode.containerInfo,un=!0,ii(z,F,G),Dt=Y,un=ee;break;case 0:case 11:case 14:case 15:Ei(2,G,F),Ht||Ei(4,G,F),ii(z,F,G);break;case 1:Ht||(qn(G,F),Y=G.stateNode,typeof Y.componentWillUnmount=="function"&&Wd(G,F,Y)),ii(z,F,G);break;case 21:ii(z,F,G);break;case 22:Ht=(Y=Ht)||G.memoizedState!==null,ii(z,F,G),Ht=Y;break;default:ii(z,F,G)}}function sh(z,F){if(F.memoizedState===null&&(z=F.alternate,z!==null&&(z=z.memoizedState,z!==null))){z=z.dehydrated;try{Hr(z)}catch(G){Et(F,F.return,G)}}}function oh(z,F){if(F.memoizedState===null&&(z=F.alternate,z!==null&&(z=z.memoizedState,z!==null&&(z=z.dehydrated,z!==null))))try{Hr(z)}catch(G){Et(F,F.return,G)}}function Vp(z){switch(z.tag){case 31:case 13:case 19:var F=z.stateNode;return F===null&&(F=z.stateNode=new nh),F;case 22:return z=z.stateNode,F=z._retryCache,F===null&&(F=z._retryCache=new nh),F;default:throw Error(q(435,z.tag))}}function qs(z,F){var G=Vp(z);F.forEach(function(Y){if(!G.has(Y)){G.add(Y);var ee=Wp.bind(null,z,Y);Y.then(ee,ee)}})}function dn(z,F){var G=F.deletions;if(G!==null)for(var Y=0;Y<G.length;Y++){var ee=G[Y],ne=z,se=F,ce=se;e:for(;ce!==null;){switch(ce.tag){case 27:if(Oi(ce.type)){Dt=ce.stateNode,un=!1;break e}break;case 5:Dt=ce.stateNode,un=!1;break e;case 3:case 4:Dt=ce.stateNode.containerInfo,un=!0;break e}ce=ce.return}if(Dt===null)throw Error(q(160));ah(ne,se,ee),Dt=null,un=!1,ne=ee.alternate,ne!==null&&(ne.return=null),ee.return=null}if(F.subtreeFlags&13886)for(F=F.child;F!==null;)lh(F,z),F=F.sibling}var In=null;function lh(z,F){var G=z.alternate,Y=z.flags;switch(z.tag){case 0:case 11:case 14:case 15:dn(F,z),hn(z),Y&4&&(Ei(3,z,z.return),Ea(3,z),Ei(5,z,z.return));break;case 1:dn(F,z),hn(z),Y&512&&(Ht||G===null||qn(G,G.return)),Y&64&&ni&&(z=z.updateQueue,z!==null&&(Y=z.callbacks,Y!==null&&(G=z.shared.hiddenCallbacks,z.shared.hiddenCallbacks=G===null?Y:G.concat(Y))));break;case 26:var ee=In;if(dn(F,z),hn(z),Y&512&&(Ht||G===null||qn(G,G.return)),Y&4){var ne=G!==null?G.memoizedState:null;if(Y=z.memoizedState,G===null)if(Y===null)if(z.stateNode===null){e:{Y=z.type,G=z.memoizedProps,ee=ee.ownerDocument||ee;t:switch(Y){case"title":ne=ee.getElementsByTagName("title")[0],(!ne||ne[Xr]||ne[Jt]||ne.namespaceURI==="http://www.w3.org/2000/svg"||ne.hasAttribute("itemprop"))&&(ne=ee.createElement(Y),ee.head.insertBefore(ne,ee.querySelector("head > title"))),en(ne,Y,G),ne[Jt]=z,Kt(ne),Y=ne;break e;case"link":var se=cf("link","href",ee).get(Y+(G.href||""));if(se){for(var ce=0;ce<se.length;ce++)if(ne=se[ce],ne.getAttribute("href")===(G.href==null||G.href===""?null:G.href)&&ne.getAttribute("rel")===(G.rel==null?null:G.rel)&&ne.getAttribute("title")===(G.title==null?null:G.title)&&ne.getAttribute("crossorigin")===(G.crossOrigin==null?null:G.crossOrigin)){se.splice(ce,1);break t}}ne=ee.createElement(Y),en(ne,Y,G),ee.head.appendChild(ne);break;case"meta":if(se=cf("meta","content",ee).get(Y+(G.content||""))){for(ce=0;ce<se.length;ce++)if(ne=se[ce],ne.getAttribute("content")===(G.content==null?null:""+G.content)&&ne.getAttribute("name")===(G.name==null?null:G.name)&&ne.getAttribute("property")===(G.property==null?null:G.property)&&ne.getAttribute("http-equiv")===(G.httpEquiv==null?null:G.httpEquiv)&&ne.getAttribute("charset")===(G.charSet==null?null:G.charSet)){se.splice(ce,1);break t}}ne=ee.createElement(Y),en(ne,Y,G),ee.head.appendChild(ne);break;default:throw Error(q(468,Y))}ne[Jt]=z,Kt(ne),Y=ne}z.stateNode=Y}else uf(ee,z.type,z.stateNode);else z.stateNode=lf(ee,Y,z.memoizedProps);else ne!==Y?(ne===null?G.stateNode!==null&&(G=G.stateNode,G.parentNode.removeChild(G)):ne.count--,Y===null?uf(ee,z.type,z.stateNode):lf(ee,Y,z.memoizedProps)):Y===null&&z.stateNode!==null&&ql(z,z.memoizedProps,G.memoizedProps)}break;case 27:dn(F,z),hn(z),Y&512&&(Ht||G===null||qn(G,G.return)),G!==null&&Y&4&&ql(z,z.memoizedProps,G.memoizedProps);break;case 5:if(dn(F,z),hn(z),Y&512&&(Ht||G===null||qn(G,G.return)),z.flags&32){ee=z.stateNode;try{fr(ee,"")}catch(We){Et(z,z.return,We)}}Y&4&&z.stateNode!=null&&(ee=z.memoizedProps,ql(z,ee,G!==null?G.memoizedProps:ee)),Y&1024&&(Hl=!0);break;case 6:if(dn(F,z),hn(z),Y&4){if(z.stateNode===null)throw Error(q(162));Y=z.memoizedProps,G=z.stateNode;try{G.nodeValue=Y}catch(We){Et(z,z.return,We)}}break;case 3:if(io=null,ee=In,In=to(F.containerInfo),dn(F,z),In=ee,hn(z),Y&4&&G!==null&&G.memoizedState.isDehydrated)try{Hr(F.containerInfo)}catch(We){Et(z,z.return,We)}Hl&&(Hl=!1,ch(z));break;case 4:Y=In,In=to(z.stateNode.containerInfo),dn(F,z),hn(z),In=Y;break;case 12:dn(F,z),hn(z);break;case 31:dn(F,z),hn(z),Y&4&&(Y=z.updateQueue,Y!==null&&(z.updateQueue=null,qs(z,Y)));break;case 13:dn(F,z),hn(z),z.child.flags&8192&&z.memoizedState!==null!=(G!==null&&G.memoizedState!==null)&&(Vs=Yt()),Y&4&&(Y=z.updateQueue,Y!==null&&(z.updateQueue=null,qs(z,Y)));break;case 22:ee=z.memoizedState!==null;var ye=G!==null&&G.memoizedState!==null,_e=ni,Me=Ht;if(ni=_e||ee,Ht=Me||ye,dn(F,z),Ht=Me,ni=_e,hn(z),Y&8192)e:for(F=z.stateNode,F._visibility=ee?F._visibility&-2:F._visibility|1,ee&&(G===null||ye||ni||Ht||tr(z)),G=null,F=z;;){if(F.tag===5||F.tag===26){if(G===null){ye=G=F;try{if(ne=ye.stateNode,ee)se=ne.style,typeof se.setProperty=="function"?se.setProperty("display","none","important"):se.display="none";else{ce=ye.stateNode;var qe=ye.memoizedProps.style,Re=qe!=null&&qe.hasOwnProperty("display")?qe.display:null;ce.style.display=Re==null||typeof Re=="boolean"?"":(""+Re).trim()}}catch(We){Et(ye,ye.return,We)}}}else if(F.tag===6){if(G===null){ye=F;try{ye.stateNode.nodeValue=ee?"":ye.memoizedProps}catch(We){Et(ye,ye.return,We)}}}else if(F.tag===18){if(G===null){ye=F;try{var Ae=ye.stateNode;ee?Wh(Ae,!0):Wh(ye.stateNode,!1)}catch(We){Et(ye,ye.return,We)}}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===z)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===z)break e;for(;F.sibling===null;){if(F.return===null||F.return===z)break e;G===F&&(G=null),F=F.return}G===F&&(G=null),F.sibling.return=F.return,F=F.sibling}Y&4&&(Y=z.updateQueue,Y!==null&&(G=Y.retryQueue,G!==null&&(Y.retryQueue=null,qs(z,G))));break;case 19:dn(F,z),hn(z),Y&4&&(Y=z.updateQueue,Y!==null&&(z.updateQueue=null,qs(z,Y)));break;case 30:break;case 21:break;default:dn(F,z),hn(z)}}function hn(z){var F=z.flags;if(F&2){try{for(var G,Y=z.return;Y!==null;){if(eh(Y)){G=Y;break}Y=Y.return}if(G==null)throw Error(q(160));switch(G.tag){case 27:var ee=G.stateNode,ne=Fl(z);zs(z,ne,ee);break;case 5:var se=G.stateNode;G.flags&32&&(fr(se,""),G.flags&=-33);var ce=Fl(z);zs(z,ce,se);break;case 3:case 4:var ye=G.stateNode.containerInfo,_e=Fl(z);Vl(z,_e,ye);break;default:throw Error(q(161))}}catch(Me){Et(z,z.return,Me)}z.flags&=-3}F&4096&&(z.flags&=-4097)}function ch(z){if(z.subtreeFlags&1024)for(z=z.child;z!==null;){var F=z;ch(F),F.tag===5&&F.flags&1024&&F.stateNode.reset(),z=z.sibling}}function ri(z,F){if(F.subtreeFlags&8772)for(F=F.child;F!==null;)ih(z,F.alternate,F),F=F.sibling}function tr(z){for(z=z.child;z!==null;){var F=z;switch(F.tag){case 0:case 11:case 14:case 15:Ei(4,F,F.return),tr(F);break;case 1:qn(F,F.return);var G=F.stateNode;typeof G.componentWillUnmount=="function"&&Wd(F,F.return,G),tr(F);break;case 27:Na(F.stateNode);case 26:case 5:qn(F,F.return),tr(F);break;case 22:F.memoizedState===null&&tr(F);break;case 30:tr(F);break;default:tr(F)}z=z.sibling}}function ai(z,F,G){for(G=G&&(F.subtreeFlags&8772)!==0,F=F.child;F!==null;){var Y=F.alternate,ee=z,ne=F,se=ne.flags;switch(ne.tag){case 0:case 11:case 15:ai(ee,ne,G),Ea(4,ne);break;case 1:if(ai(ee,ne,G),Y=ne,ee=Y.stateNode,typeof ee.componentDidMount=="function")try{ee.componentDidMount()}catch(_e){Et(Y,Y.return,_e)}if(Y=ne,ee=Y.updateQueue,ee!==null){var ce=Y.stateNode;try{var ye=ee.shared.hiddenCallbacks;if(ye!==null)for(ee.shared.hiddenCallbacks=null,ee=0;ee<ye.length;ee++)zu(ye[ee],ce)}catch(_e){Et(Y,Y.return,_e)}}G&&se&64&&Xd(ne),xa(ne,ne.return);break;case 27:th(ne);case 26:case 5:ai(ee,ne,G),G&&Y===null&&se&4&&Zd(ne),xa(ne,ne.return);break;case 12:ai(ee,ne,G);break;case 31:ai(ee,ne,G),G&&se&4&&sh(ee,ne);break;case 13:ai(ee,ne,G),G&&se&4&&oh(ee,ne);break;case 22:ne.memoizedState===null&&ai(ee,ne,G),xa(ne,ne.return);break;case 30:break;default:ai(ee,ne,G)}F=F.sibling}}function $l(z,F){var G=null;z!==null&&z.memoizedState!==null&&z.memoizedState.cachePool!==null&&(G=z.memoizedState.cachePool.pool),z=null,F.memoizedState!==null&&F.memoizedState.cachePool!==null&&(z=F.memoizedState.cachePool.pool),z!==G&&(z!=null&&z.refCount++,G!=null&&ua(G))}function Gl(z,F){z=null,F.alternate!==null&&(z=F.alternate.memoizedState.cache),F=F.memoizedState.cache,F!==z&&(F.refCount++,z!=null&&ua(z))}function jn(z,F,G,Y){if(F.subtreeFlags&10256)for(F=F.child;F!==null;)uh(z,F,G,Y),F=F.sibling}function uh(z,F,G,Y){var ee=F.flags;switch(F.tag){case 0:case 11:case 15:jn(z,F,G,Y),ee&2048&&Ea(9,F);break;case 1:jn(z,F,G,Y);break;case 3:jn(z,F,G,Y),ee&2048&&(z=null,F.alternate!==null&&(z=F.alternate.memoizedState.cache),F=F.memoizedState.cache,F!==z&&(F.refCount++,z!=null&&ua(z)));break;case 12:if(ee&2048){jn(z,F,G,Y),z=F.stateNode;try{var ne=F.memoizedProps,se=ne.id,ce=ne.onPostCommit;typeof ce=="function"&&ce(se,F.alternate===null?"mount":"update",z.passiveEffectDuration,-0)}catch(ye){Et(F,F.return,ye)}}else jn(z,F,G,Y);break;case 31:jn(z,F,G,Y);break;case 13:jn(z,F,G,Y);break;case 23:break;case 22:ne=F.stateNode,se=F.alternate,F.memoizedState!==null?ne._visibility&2?jn(z,F,G,Y):Ca(z,F):ne._visibility&2?jn(z,F,G,Y):(ne._visibility|=2,Nr(z,F,G,Y,(F.subtreeFlags&10256)!==0||!1)),ee&2048&&$l(se,F);break;case 24:jn(z,F,G,Y),ee&2048&&Gl(F.alternate,F);break;default:jn(z,F,G,Y)}}function Nr(z,F,G,Y,ee){for(ee=ee&&((F.subtreeFlags&10256)!==0||!1),F=F.child;F!==null;){var ne=z,se=F,ce=G,ye=Y,_e=se.flags;switch(se.tag){case 0:case 11:case 15:Nr(ne,se,ce,ye,ee),Ea(8,se);break;case 23:break;case 22:var Me=se.stateNode;se.memoizedState!==null?Me._visibility&2?Nr(ne,se,ce,ye,ee):Ca(ne,se):(Me._visibility|=2,Nr(ne,se,ce,ye,ee)),ee&&_e&2048&&$l(se.alternate,se);break;case 24:Nr(ne,se,ce,ye,ee),ee&&_e&2048&&Gl(se.alternate,se);break;default:Nr(ne,se,ce,ye,ee)}F=F.sibling}}function Ca(z,F){if(F.subtreeFlags&10256)for(F=F.child;F!==null;){var G=z,Y=F,ee=Y.flags;switch(Y.tag){case 22:Ca(G,Y),ee&2048&&$l(Y.alternate,Y);break;case 24:Ca(G,Y),ee&2048&&Gl(Y.alternate,Y);break;default:Ca(G,Y)}F=F.sibling}}var _a=8192;function Mr(z,F,G){if(z.subtreeFlags&_a)for(z=z.child;z!==null;)dh(z,F,G),z=z.sibling}function dh(z,F,G){switch(z.tag){case 26:Mr(z,F,G),z.flags&_a&&z.memoizedState!==null&&Am(G,In,z.memoizedState,z.memoizedProps);break;case 5:Mr(z,F,G);break;case 3:case 4:var Y=In;In=to(z.stateNode.containerInfo),Mr(z,F,G),In=Y;break;case 22:z.memoizedState===null&&(Y=z.alternate,Y!==null&&Y.memoizedState!==null?(Y=_a,_a=16777216,Mr(z,F,G),_a=Y):Mr(z,F,G));break;default:Mr(z,F,G)}}function hh(z){var F=z.alternate;if(F!==null&&(z=F.child,z!==null)){F.child=null;do F=z.sibling,z.sibling=null,z=F;while(z!==null)}}function wa(z){var F=z.deletions;if((z.flags&16)!==0){if(F!==null)for(var G=0;G<F.length;G++){var Y=F[G];Qt=Y,ph(Y,z)}hh(z)}if(z.subtreeFlags&10256)for(z=z.child;z!==null;)fh(z),z=z.sibling}function fh(z){switch(z.tag){case 0:case 11:case 15:wa(z),z.flags&2048&&Ei(9,z,z.return);break;case 3:wa(z);break;case 12:wa(z);break;case 22:var F=z.stateNode;z.memoizedState!==null&&F._visibility&2&&(z.return===null||z.return.tag!==13)?(F._visibility&=-3,Fs(z)):wa(z);break;default:wa(z)}}function Fs(z){var F=z.deletions;if((z.flags&16)!==0){if(F!==null)for(var G=0;G<F.length;G++){var Y=F[G];Qt=Y,ph(Y,z)}hh(z)}for(z=z.child;z!==null;){switch(F=z,F.tag){case 0:case 11:case 15:Ei(8,F,F.return),Fs(F);break;case 22:G=F.stateNode,G._visibility&2&&(G._visibility&=-3,Fs(F));break;default:Fs(F)}z=z.sibling}}function ph(z,F){for(;Qt!==null;){var G=Qt;switch(G.tag){case 0:case 11:case 15:Ei(8,G,F);break;case 23:case 22:if(G.memoizedState!==null&&G.memoizedState.cachePool!==null){var Y=G.memoizedState.cachePool.pool;Y!=null&&Y.refCount++}break;case 24:ua(G.memoizedState.cache)}if(Y=G.child,Y!==null)Y.return=G,Qt=Y;else e:for(G=z;Qt!==null;){Y=Qt;var ee=Y.sibling,ne=Y.return;if(rh(Y),Y===G){Qt=null;break e}if(ee!==null){ee.return=ne,Qt=ee;break e}Qt=ne}}}var Hp={getCacheForType:function(z){var F=Wt(qt),G=F.data.get(z);return G===void 0&&(G=z(),F.data.set(z,G)),G},cacheSignal:function(){return Wt(qt).controller.signal}},$p=typeof WeakMap=="function"?WeakMap:Map,St=0,Rt=null,ut=null,ht=0,Tt=0,bn=null,xi=!1,Lr=!1,Kl=!1,si=0,Mt=0,Ci=0,nr=0,Ql=0,Sn=0,Ir=0,Ra=null,fn=null,Yl=!1,Vs=0,mh=0,Hs=1/0,$s=null,_i=null,Gt=0,wi=null,jr=null,oi=0,Jl=0,Xl=null,gh=null,Aa=0,Wl=null;function kn(){return(St&2)!==0&&ht!==0?ht&-ht:Se.T!==null?rc():Pc()}function vh(){if(Sn===0)if((ht&536870912)===0||pt){var z=It;It<<=1,(It&3932160)===0&&(It=262144),Sn=z}else Sn=536870912;return z=vn.current,z!==null&&(z.flags|=32),Sn}function pn(z,F,G){(z===Rt&&(Tt===2||Tt===9)||z.cancelPendingCommit!==null)&&(Ur(z,0),Ri(z,ht,Sn,!1)),Jr(z,G),((St&2)===0||z!==Rt)&&(z===Rt&&((St&2)===0&&(nr|=G),Mt===4&&Ri(z,ht,Sn,!1)),Fn(z))}function yh(z,F,G){if((St&6)!==0)throw Error(q(327));var Y=!G&&(F&127)===0&&(F&z.expiredLanes)===0||Hn(z,F),ee=Y?Qp(z,F):ec(z,F,!0),ne=Y;do{if(ee===0){Lr&&!Y&&Ri(z,F,0,!1);break}else{if(G=z.current.alternate,ne&&!Gp(G)){ee=ec(z,F,!1),ne=!1;continue}if(ee===2){if(ne=F,z.errorRecoveryDisabledLanes&ne)var se=0;else se=z.pendingLanes&-536870913,se=se!==0?se:se&536870912?536870912:0;if(se!==0){F=se;e:{var ce=z;ee=Ra;var ye=ce.current.memoizedState.isDehydrated;if(ye&&(Ur(ce,se).flags|=256),se=ec(ce,se,!1),se!==2){if(Kl&&!ye){ce.errorRecoveryDisabledLanes|=ne,nr|=ne,ee=4;break e}ne=fn,fn=ee,ne!==null&&(fn===null?fn=ne:fn.push.apply(fn,ne))}ee=se}if(ne=!1,ee!==2)continue}}if(ee===1){Ur(z,0),Ri(z,F,0,!0);break}e:{switch(Y=z,ne=ee,ne){case 0:case 1:throw Error(q(345));case 4:if((F&4194048)!==F)break;case 6:Ri(Y,F,Sn,!xi);break e;case 2:fn=null;break;case 3:case 5:break;default:throw Error(q(329))}if((F&62914560)===F&&(ee=Vs+300-Yt(),10<ee)){if(Ri(Y,F,Sn,!xi),Yr(Y,0,!0)!==0)break e;oi=F,Y.timeoutHandle=Yh(bh.bind(null,Y,G,fn,$s,Yl,F,Sn,nr,Ir,xi,ne,"Throttled",-0,0),ee);break e}bh(Y,G,fn,$s,Yl,F,Sn,nr,Ir,xi,ne,null,-0,0)}}break}while(!0);Fn(z)}function bh(z,F,G,Y,ee,ne,se,ce,ye,_e,Me,qe,Re,Ae){if(z.timeoutHandle=-1,qe=F.subtreeFlags,qe&8192||(qe&16785408)===16785408){qe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Gn},dh(F,ne,qe);var We=(ne&62914560)===ne?Vs-Yt():(ne&4194048)===ne?mh-Yt():0;if(We=Om(qe,We),We!==null){oi=ne,z.cancelPendingCommit=We(wh.bind(null,z,F,ne,G,Y,ee,se,ce,ye,Me,qe,null,Re,Ae)),Ri(z,ne,se,!_e);return}}wh(z,F,ne,G,Y,ee,se,ce,ye)}function Gp(z){for(var F=z;;){var G=F.tag;if((G===0||G===11||G===15)&&F.flags&16384&&(G=F.updateQueue,G!==null&&(G=G.stores,G!==null)))for(var Y=0;Y<G.length;Y++){var ee=G[Y],ne=ee.getSnapshot;ee=ee.value;try{if(!mn(ne(),ee))return!1}catch{return!1}}if(G=F.child,F.subtreeFlags&16384&&G!==null)G.return=F,F=G;else{if(F===z)break;for(;F.sibling===null;){if(F.return===null||F.return===z)return!0;F=F.return}F.sibling.return=F.return,F=F.sibling}}return!0}function Ri(z,F,G,Y){F&=~Ql,F&=~nr,z.suspendedLanes|=F,z.pingedLanes&=~F,Y&&(z.warmLanes|=F),Y=z.expirationTimes;for(var ee=F;0<ee;){var ne=31-Ne(ee),se=1<<ne;Y[ne]=-1,ee&=~se}G!==0&&Ac(z,G,F)}function Gs(){return(St&6)===0?(Oa(0),!1):!0}function Zl(){if(ut!==null){if(Tt===0)var z=ut.return;else z=ut,Jn=Ki=null,ml(z),Rr=null,ha=0,z=ut;for(;z!==null;)Jd(z.alternate,z),z=z.return;ut=null}}function Ur(z,F){var G=z.timeoutHandle;G!==-1&&(z.timeoutHandle=-1,hm(G)),G=z.cancelPendingCommit,G!==null&&(z.cancelPendingCommit=null,G()),oi=0,Zl(),Rt=z,ut=G=Qn(z.current,null),ht=F,Tt=0,bn=null,xi=!1,Lr=Hn(z,F),Kl=!1,Ir=Sn=Ql=nr=Ci=Mt=0,fn=Ra=null,Yl=!1,(F&8)!==0&&(F|=F&32);var Y=z.entangledLanes;if(Y!==0)for(z=z.entanglements,Y&=F;0<Y;){var ee=31-Ne(Y),ne=1<<ee;F|=z[ee],Y&=~ne}return si=F,fs(),G}function Sh(z,F){lt=null,Se.H=Sa,F===wr||F===ks?(F=Iu(),Tt=3):F===il?(F=Iu(),Tt=4):Tt=F===Dl?8:F!==null&&typeof F=="object"&&typeof F.then=="function"?6:1,bn=F,ut===null&&(Mt=1,Ls(z,_n(F,z.current)))}function kh(){var z=vn.current;return z===null?!0:(ht&4194048)===ht?On===null:(ht&62914560)===ht||(ht&536870912)!==0?z===On:!1}function Th(){var z=Se.H;return Se.H=Sa,z===null?Sa:z}function Eh(){var z=Se.A;return Se.A=Hp,z}function Ks(){Mt=4,xi||(ht&4194048)!==ht&&vn.current!==null||(Lr=!0),(Ci&134217727)===0&&(nr&134217727)===0||Rt===null||Ri(Rt,ht,Sn,!1)}function ec(z,F,G){var Y=St;St|=2;var ee=Th(),ne=Eh();(Rt!==z||ht!==F)&&($s=null,Ur(z,F)),F=!1;var se=Mt;e:do try{if(Tt!==0&&ut!==null){var ce=ut,ye=bn;switch(Tt){case 8:Zl(),se=6;break e;case 3:case 2:case 9:case 6:vn.current===null&&(F=!0);var _e=Tt;if(Tt=0,bn=null,Br(z,ce,ye,_e),G&&Lr){se=0;break e}break;default:_e=Tt,Tt=0,bn=null,Br(z,ce,ye,_e)}}Kp(),se=Mt;break}catch(Me){Sh(z,Me)}while(!0);return F&&z.shellSuspendCounter++,Jn=Ki=null,St=Y,Se.H=ee,Se.A=ne,ut===null&&(Rt=null,ht=0,fs()),se}function Kp(){for(;ut!==null;)xh(ut)}function Qp(z,F){var G=St;St|=2;var Y=Th(),ee=Eh();Rt!==z||ht!==F?($s=null,Hs=Yt()+500,Ur(z,F)):Lr=Hn(z,F);e:do try{if(Tt!==0&&ut!==null){F=ut;var ne=bn;t:switch(Tt){case 1:Tt=0,bn=null,Br(z,F,ne,1);break;case 2:case 9:if(Mu(ne)){Tt=0,bn=null,Ch(F);break}F=function(){Tt!==2&&Tt!==9||Rt!==z||(Tt=7),Fn(z)},ne.then(F,F);break e;case 3:Tt=7;break e;case 4:Tt=5;break e;case 7:Mu(ne)?(Tt=0,bn=null,Ch(F)):(Tt=0,bn=null,Br(z,F,ne,7));break;case 5:var se=null;switch(ut.tag){case 26:se=ut.memoizedState;case 5:case 27:var ce=ut;if(se?df(se):ce.stateNode.complete){Tt=0,bn=null;var ye=ce.sibling;if(ye!==null)ut=ye;else{var _e=ce.return;_e!==null?(ut=_e,Qs(_e)):ut=null}break t}}Tt=0,bn=null,Br(z,F,ne,5);break;case 6:Tt=0,bn=null,Br(z,F,ne,6);break;case 8:Zl(),Mt=6;break e;default:throw Error(q(462))}}Yp();break}catch(Me){Sh(z,Me)}while(!0);return Jn=Ki=null,Se.H=Y,Se.A=ee,St=G,ut!==null?0:(Rt=null,ht=0,fs(),Mt)}function Yp(){for(;ut!==null&&!Qr();)xh(ut)}function xh(z){var F=Qd(z.alternate,z,si);z.memoizedProps=z.pendingProps,F===null?Qs(z):ut=F}function Ch(z){var F=z,G=F.alternate;switch(F.tag){case 15:case 0:F=Fd(G,F,F.pendingProps,F.type,void 0,ht);break;case 11:F=Fd(G,F,F.pendingProps,F.type.render,F.ref,ht);break;case 5:ml(F);default:Jd(G,F),F=ut=Eu(F,si),F=Qd(G,F,si)}z.memoizedProps=z.pendingProps,F===null?Qs(z):ut=F}function Br(z,F,G,Y){Jn=Ki=null,ml(F),Rr=null,ha=0;var ee=F.return;try{if(jp(z,ee,F,G,ht)){Mt=1,Ls(z,_n(G,z.current)),ut=null;return}}catch(ne){if(ee!==null)throw ut=ee,ne;Mt=1,Ls(z,_n(G,z.current)),ut=null;return}F.flags&32768?(pt||Y===1?z=!0:Lr||(ht&536870912)!==0?z=!1:(xi=z=!0,(Y===2||Y===9||Y===3||Y===6)&&(Y=vn.current,Y!==null&&Y.tag===13&&(Y.flags|=16384))),_h(F,z)):Qs(F)}function Qs(z){var F=z;do{if((F.flags&32768)!==0){_h(F,xi);return}z=F.return;var G=zp(F.alternate,F,si);if(G!==null){ut=G;return}if(F=F.sibling,F!==null){ut=F;return}ut=F=z}while(F!==null);Mt===0&&(Mt=5)}function _h(z,F){do{var G=qp(z.alternate,z);if(G!==null){G.flags&=32767,ut=G;return}if(G=z.return,G!==null&&(G.flags|=32768,G.subtreeFlags=0,G.deletions=null),!F&&(z=z.sibling,z!==null)){ut=z;return}ut=z=G}while(z!==null);Mt=6,ut=null}function wh(z,F,G,Y,ee,ne,se,ce,ye){z.cancelPendingCommit=null;do Ys();while(Gt!==0);if((St&6)!==0)throw Error(q(327));if(F!==null){if(F===z.current)throw Error(q(177));if(ne=F.lanes|F.childLanes,ne|=Fo,Rf(z,G,ne,se,ce,ye),z===Rt&&(ut=Rt=null,ht=0),jr=F,wi=z,oi=G,Jl=ne,Xl=ee,gh=Y,(F.subtreeFlags&10256)!==0||(F.flags&10256)!==0?(z.callbackNode=null,z.callbackPriority=0,Zp(it,function(){return Ph(),null})):(z.callbackNode=null,z.callbackPriority=0),Y=(F.flags&13878)!==0,(F.subtreeFlags&13878)!==0||Y){Y=Se.T,Se.T=null,ee=we.p,we.p=2,se=St,St|=4;try{Fp(z,F,G)}finally{St=se,we.p=ee,Se.T=Y}}Gt=1,Rh(),Ah(),Oh()}}function Rh(){if(Gt===1){Gt=0;var z=wi,F=jr,G=(F.flags&13878)!==0;if((F.subtreeFlags&13878)!==0||G){G=Se.T,Se.T=null;var Y=we.p;we.p=2;var ee=St;St|=4;try{lh(F,z);var ne=hc,se=pu(z.containerInfo),ce=ne.focusedElem,ye=ne.selectionRange;if(se!==ce&&ce&&ce.ownerDocument&&fu(ce.ownerDocument.documentElement,ce)){if(ye!==null&&jo(ce)){var _e=ye.start,Me=ye.end;if(Me===void 0&&(Me=_e),"selectionStart"in ce)ce.selectionStart=_e,ce.selectionEnd=Math.min(Me,ce.value.length);else{var qe=ce.ownerDocument||document,Re=qe&&qe.defaultView||window;if(Re.getSelection){var Ae=Re.getSelection(),We=ce.textContent.length,nt=Math.min(ye.start,We),wt=ye.end===void 0?nt:Math.min(ye.end,We);!Ae.extend&&nt>wt&&(se=wt,wt=nt,nt=se);var Te=hu(ce,nt),ke=hu(ce,wt);if(Te&&ke&&(Ae.rangeCount!==1||Ae.anchorNode!==Te.node||Ae.anchorOffset!==Te.offset||Ae.focusNode!==ke.node||Ae.focusOffset!==ke.offset)){var Ce=qe.createRange();Ce.setStart(Te.node,Te.offset),Ae.removeAllRanges(),nt>wt?(Ae.addRange(Ce),Ae.extend(ke.node,ke.offset)):(Ce.setEnd(ke.node,ke.offset),Ae.addRange(Ce))}}}}for(qe=[],Ae=ce;Ae=Ae.parentNode;)Ae.nodeType===1&&qe.push({element:Ae,left:Ae.scrollLeft,top:Ae.scrollTop});for(typeof ce.focus=="function"&&ce.focus(),ce=0;ce<qe.length;ce++){var Be=qe[ce];Be.element.scrollLeft=Be.left,Be.element.scrollTop=Be.top}}oo=!!dc,hc=dc=null}finally{St=ee,we.p=Y,Se.T=G}}z.current=F,Gt=2}}function Ah(){if(Gt===2){Gt=0;var z=wi,F=jr,G=(F.flags&8772)!==0;if((F.subtreeFlags&8772)!==0||G){G=Se.T,Se.T=null;var Y=we.p;we.p=2;var ee=St;St|=4;try{ih(z,F.alternate,F)}finally{St=ee,we.p=Y,Se.T=G}}Gt=3}}function Oh(){if(Gt===4||Gt===3){Gt=0,sr();var z=wi,F=jr,G=oi,Y=gh;(F.subtreeFlags&10256)!==0||(F.flags&10256)!==0?Gt=5:(Gt=0,jr=wi=null,Dh(z,z.pendingLanes));var ee=z.pendingLanes;if(ee===0&&(_i=null),yo(G),F=F.stateNode,Pe&&typeof Pe.onCommitFiberRoot=="function")try{Pe.onCommitFiberRoot(mt,F,void 0,(F.current.flags&128)===128)}catch{}if(Y!==null){F=Se.T,ee=we.p,we.p=2,Se.T=null;try{for(var ne=z.onRecoverableError,se=0;se<Y.length;se++){var ce=Y[se];ne(ce.value,{componentStack:ce.stack})}}finally{Se.T=F,we.p=ee}}(oi&3)!==0&&Ys(),Fn(z),ee=z.pendingLanes,(G&261930)!==0&&(ee&42)!==0?z===Wl?Aa++:(Aa=0,Wl=z):Aa=0,Oa(0)}}function Dh(z,F){(z.pooledCacheLanes&=F)===0&&(F=z.pooledCache,F!=null&&(z.pooledCache=null,ua(F)))}function Ys(){return Rh(),Ah(),Oh(),Ph()}function Ph(){if(Gt!==5)return!1;var z=wi,F=Jl;Jl=0;var G=yo(oi),Y=Se.T,ee=we.p;try{we.p=32>G?32:G,Se.T=null,G=Xl,Xl=null;var ne=wi,se=oi;if(Gt=0,jr=wi=null,oi=0,(St&6)!==0)throw Error(q(331));var ce=St;if(St|=4,fh(ne.current),uh(ne,ne.current,se,G),St=ce,Oa(0,!1),Pe&&typeof Pe.onPostCommitFiberRoot=="function")try{Pe.onPostCommitFiberRoot(mt,ne)}catch{}return!0}finally{we.p=ee,Se.T=Y,Dh(z,F)}}function Nh(z,F,G){F=_n(G,F),F=Ol(z.stateNode,F,2),z=Si(z,F,2),z!==null&&(Jr(z,2),Fn(z))}function Et(z,F,G){if(z.tag===3)Nh(z,z,G);else for(;F!==null;){if(F.tag===3){Nh(F,z,G);break}else if(F.tag===1){var Y=F.stateNode;if(typeof F.type.getDerivedStateFromError=="function"||typeof Y.componentDidCatch=="function"&&(_i===null||!_i.has(Y))){z=_n(G,z),G=Md(2),Y=Si(F,G,2),Y!==null&&(Ld(G,Y,F,z),Jr(Y,2),Fn(Y));break}}F=F.return}}function tc(z,F,G){var Y=z.pingCache;if(Y===null){Y=z.pingCache=new $p;var ee=new Set;Y.set(F,ee)}else ee=Y.get(F),ee===void 0&&(ee=new Set,Y.set(F,ee));ee.has(G)||(Kl=!0,ee.add(G),z=Jp.bind(null,z,F,G),F.then(z,z))}function Jp(z,F,G){var Y=z.pingCache;Y!==null&&Y.delete(F),z.pingedLanes|=z.suspendedLanes&G,z.warmLanes&=~G,Rt===z&&(ht&G)===G&&(Mt===4||Mt===3&&(ht&62914560)===ht&&300>Yt()-Vs?(St&2)===0&&Ur(z,0):Ql|=G,Ir===ht&&(Ir=0)),Fn(z)}function Mh(z,F){F===0&&(F=Rc()),z=Hi(z,F),z!==null&&(Jr(z,F),Fn(z))}function Xp(z){var F=z.memoizedState,G=0;F!==null&&(G=F.retryLane),Mh(z,G)}function Wp(z,F){var G=0;switch(z.tag){case 31:case 13:var Y=z.stateNode,ee=z.memoizedState;ee!==null&&(G=ee.retryLane);break;case 19:Y=z.stateNode;break;case 22:Y=z.stateNode._retryCache;break;default:throw Error(q(314))}Y!==null&&Y.delete(F),Mh(z,G)}function Zp(z,F){return di(z,F)}var Js=null,zr=null,nc=!1,Xs=!1,ic=!1,Ai=0;function Fn(z){z!==zr&&z.next===null&&(zr===null?Js=zr=z:zr=zr.next=z),Xs=!0,nc||(nc=!0,tm())}function Oa(z,F){if(!ic&&Xs){ic=!0;do for(var G=!1,Y=Js;Y!==null;){if(z!==0){var ee=Y.pendingLanes;if(ee===0)var ne=0;else{var se=Y.suspendedLanes,ce=Y.pingedLanes;ne=(1<<31-Ne(42|z)+1)-1,ne&=ee&~(se&~ce),ne=ne&201326741?ne&201326741|1:ne?ne|2:0}ne!==0&&(G=!0,Uh(Y,ne))}else ne=ht,ne=Yr(Y,Y===Rt?ne:0,Y.cancelPendingCommit!==null||Y.timeoutHandle!==-1),(ne&3)===0||Hn(Y,ne)||(G=!0,Uh(Y,ne));Y=Y.next}while(G);ic=!1}}function em(){Lh()}function Lh(){Xs=nc=!1;var z=0;Ai!==0&&dm()&&(z=Ai);for(var F=Yt(),G=null,Y=Js;Y!==null;){var ee=Y.next,ne=Ih(Y,F);ne===0?(Y.next=null,G===null?Js=ee:G.next=ee,ee===null&&(zr=G)):(G=Y,(z!==0||(ne&3)!==0)&&(Xs=!0)),Y=ee}Gt!==0&&Gt!==5||Oa(z),Ai!==0&&(Ai=0)}function Ih(z,F){for(var G=z.suspendedLanes,Y=z.pingedLanes,ee=z.expirationTimes,ne=z.pendingLanes&-62914561;0<ne;){var se=31-Ne(ne),ce=1<<se,ye=ee[se];ye===-1?((ce&G)===0||(ce&Y)!==0)&&(ee[se]=wf(ce,F)):ye<=F&&(z.expiredLanes|=ce),ne&=~ce}if(F=Rt,G=ht,G=Yr(z,z===F?G:0,z.cancelPendingCommit!==null||z.timeoutHandle!==-1),Y=z.callbackNode,G===0||z===F&&(Tt===2||Tt===9)||z.cancelPendingCommit!==null)return Y!==null&&Y!==null&&Bi(Y),z.callbackNode=null,z.callbackPriority=0;if((G&3)===0||Hn(z,G)){if(F=G&-G,F===z.callbackPriority)return F;switch(Y!==null&&Bi(Y),yo(G)){case 2:case 8:G=Ke;break;case 32:G=it;break;case 268435456:G=vt;break;default:G=it}return Y=jh.bind(null,z),G=di(G,Y),z.callbackPriority=F,z.callbackNode=G,F}return Y!==null&&Y!==null&&Bi(Y),z.callbackPriority=2,z.callbackNode=null,2}function jh(z,F){if(Gt!==0&&Gt!==5)return z.callbackNode=null,z.callbackPriority=0,null;var G=z.callbackNode;if(Ys()&&z.callbackNode!==G)return null;var Y=ht;return Y=Yr(z,z===Rt?Y:0,z.cancelPendingCommit!==null||z.timeoutHandle!==-1),Y===0?null:(yh(z,Y,F),Ih(z,Yt()),z.callbackNode!=null&&z.callbackNode===G?jh.bind(null,z):null)}function Uh(z,F){if(Ys())return null;yh(z,F,!0)}function tm(){fm(function(){(St&6)!==0?di(je,em):Lh()})}function rc(){if(Ai===0){var z=Cr;z===0&&(z=kt,kt<<=1,(kt&261888)===0&&(kt=256)),Ai=z}return Ai}function Bh(z){return z==null||typeof z=="symbol"||typeof z=="boolean"?null:typeof z=="function"?z:as(""+z)}function zh(z,F){var G=F.ownerDocument.createElement("input");return G.name=F.name,G.value=F.value,z.id&&G.setAttribute("form",z.id),F.parentNode.insertBefore(G,F),z=new FormData(z),G.parentNode.removeChild(G),z}function nm(z,F,G,Y,ee){if(F==="submit"&&G&&G.stateNode===ee){var ne=Bh((ee[ln]||null).action),se=Y.submitter;se&&(F=(F=se[ln]||null)?Bh(F.formAction):se.getAttribute("formAction"),F!==null&&(ne=F,se=null));var ce=new cs("action","action",null,Y,ee);z.push({event:ce,listeners:[{instance:null,listener:function(){if(Y.defaultPrevented){if(Ai!==0){var ye=se?zh(ee,se):new FormData(ee);xl(G,{pending:!0,data:ye,method:ee.method,action:ne},null,ye)}}else typeof ne=="function"&&(ce.preventDefault(),ye=se?zh(ee,se):new FormData(ee),xl(G,{pending:!0,data:ye,method:ee.method,action:ne},ne,ye))},currentTarget:ee}]})}}for(var ac=0;ac<qo.length;ac++){var sc=qo[ac],im=sc.toLowerCase(),rm=sc[0].toUpperCase()+sc.slice(1);Ln(im,"on"+rm)}Ln(vu,"onAnimationEnd"),Ln(yu,"onAnimationIteration"),Ln(bu,"onAnimationStart"),Ln("dblclick","onDoubleClick"),Ln("focusin","onFocus"),Ln("focusout","onBlur"),Ln(Sp,"onTransitionRun"),Ln(kp,"onTransitionStart"),Ln(Tp,"onTransitionCancel"),Ln(Su,"onTransitionEnd"),dr("onMouseEnter",["mouseout","mouseover"]),dr("onMouseLeave",["mouseout","mouseover"]),dr("onPointerEnter",["pointerout","pointerover"]),dr("onPointerLeave",["pointerout","pointerover"]),zi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),zi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),zi("onBeforeInput",["compositionend","keypress","textInput","paste"]),zi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),zi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),zi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Da="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),am=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Da));function qh(z,F){F=(F&4)!==0;for(var G=0;G<z.length;G++){var Y=z[G],ee=Y.event;Y=Y.listeners;e:{var ne=void 0;if(F)for(var se=Y.length-1;0<=se;se--){var ce=Y[se],ye=ce.instance,_e=ce.currentTarget;if(ce=ce.listener,ye!==ne&&ee.isPropagationStopped())break e;ne=ce,ee.currentTarget=_e;try{ne(ee)}catch(Me){hs(Me)}ee.currentTarget=null,ne=ye}else for(se=0;se<Y.length;se++){if(ce=Y[se],ye=ce.instance,_e=ce.currentTarget,ce=ce.listener,ye!==ne&&ee.isPropagationStopped())break e;ne=ce,ee.currentTarget=_e;try{ne(ee)}catch(Me){hs(Me)}ee.currentTarget=null,ne=ye}}}}function dt(z,F){var G=F[bo];G===void 0&&(G=F[bo]=new Set);var Y=z+"__bubble";G.has(Y)||(Fh(F,z,2,!1),G.add(Y))}function oc(z,F,G){var Y=0;F&&(Y|=4),Fh(G,z,Y,F)}var Ws="_reactListening"+Math.random().toString(36).slice(2);function lc(z){if(!z[Ws]){z[Ws]=!0,Lc.forEach(function(G){G!=="selectionchange"&&(am.has(G)||oc(G,!1,z),oc(G,!0,z))});var F=z.nodeType===9?z:z.ownerDocument;F===null||F[Ws]||(F[Ws]=!0,oc("selectionchange",!1,F))}}function Fh(z,F,G,Y){switch(yf(F)){case 2:var ee=Nm;break;case 8:ee=Mm;break;default:ee=Ec}G=ee.bind(null,F,G,z),ee=void 0,!Ro||F!=="touchstart"&&F!=="touchmove"&&F!=="wheel"||(ee=!0),Y?ee!==void 0?z.addEventListener(F,G,{capture:!0,passive:ee}):z.addEventListener(F,G,!0):ee!==void 0?z.addEventListener(F,G,{passive:ee}):z.addEventListener(F,G,!1)}function cc(z,F,G,Y,ee){var ne=Y;if((F&1)===0&&(F&2)===0&&Y!==null)e:for(;;){if(Y===null)return;var se=Y.tag;if(se===3||se===4){var ce=Y.stateNode.containerInfo;if(ce===ee)break;if(se===4)for(se=Y.return;se!==null;){var ye=se.tag;if((ye===3||ye===4)&&se.stateNode.containerInfo===ee)return;se=se.return}for(;ce!==null;){if(se=lr(ce),se===null)return;if(ye=se.tag,ye===5||ye===6||ye===26||ye===27){Y=ne=se;continue e}ce=ce.parentNode}}Y=Y.return}Kc(function(){var _e=ne,Me=_o(G),qe=[];e:{var Re=ku.get(z);if(Re!==void 0){var Ae=cs,We=z;switch(z){case"keypress":if(os(G)===0)break e;case"keydown":case"keyup":Ae=Wf;break;case"focusin":We="focus",Ae=Po;break;case"focusout":We="blur",Ae=Po;break;case"beforeblur":case"afterblur":Ae=Po;break;case"click":if(G.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ae=Jc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ae=zf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ae=tp;break;case vu:case yu:case bu:Ae=Vf;break;case Su:Ae=ip;break;case"scroll":case"scrollend":Ae=Uf;break;case"wheel":Ae=ap;break;case"copy":case"cut":case"paste":Ae=$f;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ae=Wc;break;case"toggle":case"beforetoggle":Ae=op}var nt=(F&4)!==0,wt=!nt&&(z==="scroll"||z==="scrollend"),Te=nt?Re!==null?Re+"Capture":null:Re;nt=[];for(var ke=_e,Ce;ke!==null;){var Be=ke;if(Ce=Be.stateNode,Be=Be.tag,Be!==5&&Be!==26&&Be!==27||Ce===null||Te===null||(Be=Zr(ke,Te),Be!=null&&nt.push(Pa(ke,Be,Ce))),wt)break;ke=ke.return}0<nt.length&&(Re=new Ae(Re,We,null,G,Me),qe.push({event:Re,listeners:nt}))}}if((F&7)===0){e:{if(Re=z==="mouseover"||z==="pointerover",Ae=z==="mouseout"||z==="pointerout",Re&&G!==Co&&(We=G.relatedTarget||G.fromElement)&&(lr(We)||We[or]))break e;if((Ae||Re)&&(Re=Me.window===Me?Me:(Re=Me.ownerDocument)?Re.defaultView||Re.parentWindow:window,Ae?(We=G.relatedTarget||G.toElement,Ae=_e,We=We?lr(We):null,We!==null&&(wt=H(We),nt=We.tag,We!==wt||nt!==5&&nt!==27&&nt!==6)&&(We=null)):(Ae=null,We=_e),Ae!==We)){if(nt=Jc,Be="onMouseLeave",Te="onMouseEnter",ke="mouse",(z==="pointerout"||z==="pointerover")&&(nt=Wc,Be="onPointerLeave",Te="onPointerEnter",ke="pointer"),wt=Ae==null?Re:Wr(Ae),Ce=We==null?Re:Wr(We),Re=new nt(Be,ke+"leave",Ae,G,Me),Re.target=wt,Re.relatedTarget=Ce,Be=null,lr(Me)===_e&&(nt=new nt(Te,ke+"enter",We,G,Me),nt.target=Ce,nt.relatedTarget=wt,Be=nt),wt=Be,Ae&&We)t:{for(nt=sm,Te=Ae,ke=We,Ce=0,Be=Te;Be;Be=nt(Be))Ce++;Be=0;for(var et=ke;et;et=nt(et))Be++;for(;0<Ce-Be;)Te=nt(Te),Ce--;for(;0<Be-Ce;)ke=nt(ke),Be--;for(;Ce--;){if(Te===ke||ke!==null&&Te===ke.alternate){nt=Te;break t}Te=nt(Te),ke=nt(ke)}nt=null}else nt=null;Ae!==null&&Vh(qe,Re,Ae,nt,!1),We!==null&&wt!==null&&Vh(qe,wt,We,nt,!0)}}e:{if(Re=_e?Wr(_e):window,Ae=Re.nodeName&&Re.nodeName.toLowerCase(),Ae==="select"||Ae==="input"&&Re.type==="file")var yt=su;else if(ru(Re))if(ou)yt=vp;else{yt=mp;var Ze=pp}else Ae=Re.nodeName,!Ae||Ae.toLowerCase()!=="input"||Re.type!=="checkbox"&&Re.type!=="radio"?_e&&xo(_e.elementType)&&(yt=su):yt=gp;if(yt&&(yt=yt(z,_e))){au(qe,yt,G,Me);break e}Ze&&Ze(z,Re,_e),z==="focusout"&&_e&&Re.type==="number"&&_e.memoizedProps.value!=null&&Eo(Re,"number",Re.value)}switch(Ze=_e?Wr(_e):window,z){case"focusin":(ru(Ze)||Ze.contentEditable==="true")&&(vr=Ze,Uo=_e,oa=null);break;case"focusout":oa=Uo=vr=null;break;case"mousedown":Bo=!0;break;case"contextmenu":case"mouseup":case"dragend":Bo=!1,mu(qe,G,Me);break;case"selectionchange":if(bp)break;case"keydown":case"keyup":mu(qe,G,Me)}var ct;if(Mo)e:{switch(z){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else gr?nu(z,G)&&(ft="onCompositionEnd"):z==="keydown"&&G.keyCode===229&&(ft="onCompositionStart");ft&&(Zc&&G.locale!=="ko"&&(gr||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&gr&&(ct=Qc()):(fi=Me,Ao="value"in fi?fi.value:fi.textContent,gr=!0)),Ze=Zs(_e,ft),0<Ze.length&&(ft=new Xc(ft,z,null,G,Me),qe.push({event:ft,listeners:Ze}),ct?ft.data=ct:(ct=iu(G),ct!==null&&(ft.data=ct)))),(ct=cp?up(z,G):dp(z,G))&&(ft=Zs(_e,"onBeforeInput"),0<ft.length&&(Ze=new Xc("onBeforeInput","beforeinput",null,G,Me),qe.push({event:Ze,listeners:ft}),Ze.data=ct)),nm(qe,z,_e,G,Me)}qh(qe,F)})}function Pa(z,F,G){return{instance:z,listener:F,currentTarget:G}}function Zs(z,F){for(var G=F+"Capture",Y=[];z!==null;){var ee=z,ne=ee.stateNode;if(ee=ee.tag,ee!==5&&ee!==26&&ee!==27||ne===null||(ee=Zr(z,G),ee!=null&&Y.unshift(Pa(z,ee,ne)),ee=Zr(z,F),ee!=null&&Y.push(Pa(z,ee,ne))),z.tag===3)return Y;z=z.return}return[]}function sm(z){if(z===null)return null;do z=z.return;while(z&&z.tag!==5&&z.tag!==27);return z||null}function Vh(z,F,G,Y,ee){for(var ne=F._reactName,se=[];G!==null&&G!==Y;){var ce=G,ye=ce.alternate,_e=ce.stateNode;if(ce=ce.tag,ye!==null&&ye===Y)break;ce!==5&&ce!==26&&ce!==27||_e===null||(ye=_e,ee?(_e=Zr(G,ne),_e!=null&&se.unshift(Pa(G,_e,ye))):ee||(_e=Zr(G,ne),_e!=null&&se.push(Pa(G,_e,ye)))),G=G.return}se.length!==0&&z.push({event:F,listeners:se})}var om=/\r\n?/g,lm=/\u0000|\uFFFD/g;function Hh(z){return(typeof z=="string"?z:""+z).replace(om,`
`).replace(lm,"")}function $h(z,F){return F=Hh(F),Hh(z)===F}function _t(z,F,G,Y,ee,ne){switch(G){case"children":typeof Y=="string"?F==="body"||F==="textarea"&&Y===""||fr(z,Y):(typeof Y=="number"||typeof Y=="bigint")&&F!=="body"&&fr(z,""+Y);break;case"className":is(z,"class",Y);break;case"tabIndex":is(z,"tabindex",Y);break;case"dir":case"role":case"viewBox":case"width":case"height":is(z,G,Y);break;case"style":$c(z,Y,ne);break;case"data":if(F!=="object"){is(z,"data",Y);break}case"src":case"href":if(Y===""&&(F!=="a"||G!=="href")){z.removeAttribute(G);break}if(Y==null||typeof Y=="function"||typeof Y=="symbol"||typeof Y=="boolean"){z.removeAttribute(G);break}Y=as(""+Y),z.setAttribute(G,Y);break;case"action":case"formAction":if(typeof Y=="function"){z.setAttribute(G,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof ne=="function"&&(G==="formAction"?(F!=="input"&&_t(z,F,"name",ee.name,ee,null),_t(z,F,"formEncType",ee.formEncType,ee,null),_t(z,F,"formMethod",ee.formMethod,ee,null),_t(z,F,"formTarget",ee.formTarget,ee,null)):(_t(z,F,"encType",ee.encType,ee,null),_t(z,F,"method",ee.method,ee,null),_t(z,F,"target",ee.target,ee,null)));if(Y==null||typeof Y=="symbol"||typeof Y=="boolean"){z.removeAttribute(G);break}Y=as(""+Y),z.setAttribute(G,Y);break;case"onClick":Y!=null&&(z.onclick=Gn);break;case"onScroll":Y!=null&&dt("scroll",z);break;case"onScrollEnd":Y!=null&&dt("scrollend",z);break;case"dangerouslySetInnerHTML":if(Y!=null){if(typeof Y!="object"||!("__html"in Y))throw Error(q(61));if(G=Y.__html,G!=null){if(ee.children!=null)throw Error(q(60));z.innerHTML=G}}break;case"multiple":z.multiple=Y&&typeof Y!="function"&&typeof Y!="symbol";break;case"muted":z.muted=Y&&typeof Y!="function"&&typeof Y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(Y==null||typeof Y=="function"||typeof Y=="boolean"||typeof Y=="symbol"){z.removeAttribute("xlink:href");break}G=as(""+Y),z.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",G);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":Y!=null&&typeof Y!="function"&&typeof Y!="symbol"?z.setAttribute(G,""+Y):z.removeAttribute(G);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":Y&&typeof Y!="function"&&typeof Y!="symbol"?z.setAttribute(G,""):z.removeAttribute(G);break;case"capture":case"download":Y===!0?z.setAttribute(G,""):Y!==!1&&Y!=null&&typeof Y!="function"&&typeof Y!="symbol"?z.setAttribute(G,Y):z.removeAttribute(G);break;case"cols":case"rows":case"size":case"span":Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&!isNaN(Y)&&1<=Y?z.setAttribute(G,Y):z.removeAttribute(G);break;case"rowSpan":case"start":Y==null||typeof Y=="function"||typeof Y=="symbol"||isNaN(Y)?z.removeAttribute(G):z.setAttribute(G,Y);break;case"popover":dt("beforetoggle",z),dt("toggle",z),ns(z,"popover",Y);break;case"xlinkActuate":$n(z,"http://www.w3.org/1999/xlink","xlink:actuate",Y);break;case"xlinkArcrole":$n(z,"http://www.w3.org/1999/xlink","xlink:arcrole",Y);break;case"xlinkRole":$n(z,"http://www.w3.org/1999/xlink","xlink:role",Y);break;case"xlinkShow":$n(z,"http://www.w3.org/1999/xlink","xlink:show",Y);break;case"xlinkTitle":$n(z,"http://www.w3.org/1999/xlink","xlink:title",Y);break;case"xlinkType":$n(z,"http://www.w3.org/1999/xlink","xlink:type",Y);break;case"xmlBase":$n(z,"http://www.w3.org/XML/1998/namespace","xml:base",Y);break;case"xmlLang":$n(z,"http://www.w3.org/XML/1998/namespace","xml:lang",Y);break;case"xmlSpace":$n(z,"http://www.w3.org/XML/1998/namespace","xml:space",Y);break;case"is":ns(z,"is",Y);break;case"innerText":case"textContent":break;default:(!(2<G.length)||G[0]!=="o"&&G[0]!=="O"||G[1]!=="n"&&G[1]!=="N")&&(G=If.get(G)||G,ns(z,G,Y))}}function uc(z,F,G,Y,ee,ne){switch(G){case"style":$c(z,Y,ne);break;case"dangerouslySetInnerHTML":if(Y!=null){if(typeof Y!="object"||!("__html"in Y))throw Error(q(61));if(G=Y.__html,G!=null){if(ee.children!=null)throw Error(q(60));z.innerHTML=G}}break;case"children":typeof Y=="string"?fr(z,Y):(typeof Y=="number"||typeof Y=="bigint")&&fr(z,""+Y);break;case"onScroll":Y!=null&&dt("scroll",z);break;case"onScrollEnd":Y!=null&&dt("scrollend",z);break;case"onClick":Y!=null&&(z.onclick=Gn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ic.hasOwnProperty(G))e:{if(G[0]==="o"&&G[1]==="n"&&(ee=G.endsWith("Capture"),F=G.slice(2,ee?G.length-7:void 0),ne=z[ln]||null,ne=ne!=null?ne[G]:null,typeof ne=="function"&&z.removeEventListener(F,ne,ee),typeof Y=="function")){typeof ne!="function"&&ne!==null&&(G in z?z[G]=null:z.hasAttribute(G)&&z.removeAttribute(G)),z.addEventListener(F,Y,ee);break e}G in z?z[G]=Y:Y===!0?z.setAttribute(G,""):ns(z,G,Y)}}}function en(z,F,G){switch(F){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",z),dt("load",z);var Y=!1,ee=!1,ne;for(ne in G)if(G.hasOwnProperty(ne)){var se=G[ne];if(se!=null)switch(ne){case"src":Y=!0;break;case"srcSet":ee=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(q(137,F));default:_t(z,F,ne,se,G,null)}}ee&&_t(z,F,"srcSet",G.srcSet,G,null),Y&&_t(z,F,"src",G.src,G,null);return;case"input":dt("invalid",z);var ce=ne=se=ee=null,ye=null,_e=null;for(Y in G)if(G.hasOwnProperty(Y)){var Me=G[Y];if(Me!=null)switch(Y){case"name":ee=Me;break;case"type":se=Me;break;case"checked":ye=Me;break;case"defaultChecked":_e=Me;break;case"value":ne=Me;break;case"defaultValue":ce=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(q(137,F));break;default:_t(z,F,Y,Me,G,null)}}qc(z,ne,ce,ye,_e,se,ee,!1);return;case"select":dt("invalid",z),Y=se=ne=null;for(ee in G)if(G.hasOwnProperty(ee)&&(ce=G[ee],ce!=null))switch(ee){case"value":ne=ce;break;case"defaultValue":se=ce;break;case"multiple":Y=ce;default:_t(z,F,ee,ce,G,null)}F=ne,G=se,z.multiple=!!Y,F!=null?hr(z,!!Y,F,!1):G!=null&&hr(z,!!Y,G,!0);return;case"textarea":dt("invalid",z),ne=ee=Y=null;for(se in G)if(G.hasOwnProperty(se)&&(ce=G[se],ce!=null))switch(se){case"value":Y=ce;break;case"defaultValue":ee=ce;break;case"children":ne=ce;break;case"dangerouslySetInnerHTML":if(ce!=null)throw Error(q(91));break;default:_t(z,F,se,ce,G,null)}Vc(z,Y,ee,ne);return;case"option":for(ye in G)if(G.hasOwnProperty(ye)&&(Y=G[ye],Y!=null))switch(ye){case"selected":z.selected=Y&&typeof Y!="function"&&typeof Y!="symbol";break;default:_t(z,F,ye,Y,G,null)}return;case"dialog":dt("beforetoggle",z),dt("toggle",z),dt("cancel",z),dt("close",z);break;case"iframe":case"object":dt("load",z);break;case"video":case"audio":for(Y=0;Y<Da.length;Y++)dt(Da[Y],z);break;case"image":dt("error",z),dt("load",z);break;case"details":dt("toggle",z);break;case"embed":case"source":case"link":dt("error",z),dt("load",z);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_e in G)if(G.hasOwnProperty(_e)&&(Y=G[_e],Y!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":throw Error(q(137,F));default:_t(z,F,_e,Y,G,null)}return;default:if(xo(F)){for(Me in G)G.hasOwnProperty(Me)&&(Y=G[Me],Y!==void 0&&uc(z,F,Me,Y,G,void 0));return}}for(ce in G)G.hasOwnProperty(ce)&&(Y=G[ce],Y!=null&&_t(z,F,ce,Y,G,null))}function cm(z,F,G,Y){switch(F){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var ee=null,ne=null,se=null,ce=null,ye=null,_e=null,Me=null;for(Ae in G){var qe=G[Ae];if(G.hasOwnProperty(Ae)&&qe!=null)switch(Ae){case"checked":break;case"value":break;case"defaultValue":ye=qe;default:Y.hasOwnProperty(Ae)||_t(z,F,Ae,null,Y,qe)}}for(var Re in Y){var Ae=Y[Re];if(qe=G[Re],Y.hasOwnProperty(Re)&&(Ae!=null||qe!=null))switch(Re){case"type":ne=Ae;break;case"name":ee=Ae;break;case"checked":_e=Ae;break;case"defaultChecked":Me=Ae;break;case"value":se=Ae;break;case"defaultValue":ce=Ae;break;case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(q(137,F));break;default:Ae!==qe&&_t(z,F,Re,Ae,Y,qe)}}To(z,se,ce,ye,_e,Me,ne,ee);return;case"select":Ae=se=ce=Re=null;for(ne in G)if(ye=G[ne],G.hasOwnProperty(ne)&&ye!=null)switch(ne){case"value":break;case"multiple":Ae=ye;default:Y.hasOwnProperty(ne)||_t(z,F,ne,null,Y,ye)}for(ee in Y)if(ne=Y[ee],ye=G[ee],Y.hasOwnProperty(ee)&&(ne!=null||ye!=null))switch(ee){case"value":Re=ne;break;case"defaultValue":ce=ne;break;case"multiple":se=ne;default:ne!==ye&&_t(z,F,ee,ne,Y,ye)}F=ce,G=se,Y=Ae,Re!=null?hr(z,!!G,Re,!1):!!Y!=!!G&&(F!=null?hr(z,!!G,F,!0):hr(z,!!G,G?[]:"",!1));return;case"textarea":Ae=Re=null;for(ce in G)if(ee=G[ce],G.hasOwnProperty(ce)&&ee!=null&&!Y.hasOwnProperty(ce))switch(ce){case"value":break;case"children":break;default:_t(z,F,ce,null,Y,ee)}for(se in Y)if(ee=Y[se],ne=G[se],Y.hasOwnProperty(se)&&(ee!=null||ne!=null))switch(se){case"value":Re=ee;break;case"defaultValue":Ae=ee;break;case"children":break;case"dangerouslySetInnerHTML":if(ee!=null)throw Error(q(91));break;default:ee!==ne&&_t(z,F,se,ee,Y,ne)}Fc(z,Re,Ae);return;case"option":for(var We in G)if(Re=G[We],G.hasOwnProperty(We)&&Re!=null&&!Y.hasOwnProperty(We))switch(We){case"selected":z.selected=!1;break;default:_t(z,F,We,null,Y,Re)}for(ye in Y)if(Re=Y[ye],Ae=G[ye],Y.hasOwnProperty(ye)&&Re!==Ae&&(Re!=null||Ae!=null))switch(ye){case"selected":z.selected=Re&&typeof Re!="function"&&typeof Re!="symbol";break;default:_t(z,F,ye,Re,Y,Ae)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var nt in G)Re=G[nt],G.hasOwnProperty(nt)&&Re!=null&&!Y.hasOwnProperty(nt)&&_t(z,F,nt,null,Y,Re);for(_e in Y)if(Re=Y[_e],Ae=G[_e],Y.hasOwnProperty(_e)&&Re!==Ae&&(Re!=null||Ae!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(q(137,F));break;default:_t(z,F,_e,Re,Y,Ae)}return;default:if(xo(F)){for(var wt in G)Re=G[wt],G.hasOwnProperty(wt)&&Re!==void 0&&!Y.hasOwnProperty(wt)&&uc(z,F,wt,void 0,Y,Re);for(Me in Y)Re=Y[Me],Ae=G[Me],!Y.hasOwnProperty(Me)||Re===Ae||Re===void 0&&Ae===void 0||uc(z,F,Me,Re,Y,Ae);return}}for(var Te in G)Re=G[Te],G.hasOwnProperty(Te)&&Re!=null&&!Y.hasOwnProperty(Te)&&_t(z,F,Te,null,Y,Re);for(qe in Y)Re=Y[qe],Ae=G[qe],!Y.hasOwnProperty(qe)||Re===Ae||Re==null&&Ae==null||_t(z,F,qe,Re,Y,Ae)}function Gh(z){switch(z){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function um(){if(typeof performance.getEntriesByType=="function"){for(var z=0,F=0,G=performance.getEntriesByType("resource"),Y=0;Y<G.length;Y++){var ee=G[Y],ne=ee.transferSize,se=ee.initiatorType,ce=ee.duration;if(ne&&ce&&Gh(se)){for(se=0,ce=ee.responseEnd,Y+=1;Y<G.length;Y++){var ye=G[Y],_e=ye.startTime;if(_e>ce)break;var Me=ye.transferSize,qe=ye.initiatorType;Me&&Gh(qe)&&(ye=ye.responseEnd,se+=Me*(ye<ce?1:(ce-_e)/(ye-_e)))}if(--Y,F+=8*(ne+se)/(ee.duration/1e3),z++,10<z)break}}if(0<z)return F/z/1e6}return navigator.connection&&(z=navigator.connection.downlink,typeof z=="number")?z:5}var dc=null,hc=null;function eo(z){return z.nodeType===9?z:z.ownerDocument}function Kh(z){switch(z){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qh(z,F){if(z===0)switch(F){case"svg":return 1;case"math":return 2;default:return 0}return z===1&&F==="foreignObject"?0:z}function fc(z,F){return z==="textarea"||z==="noscript"||typeof F.children=="string"||typeof F.children=="number"||typeof F.children=="bigint"||typeof F.dangerouslySetInnerHTML=="object"&&F.dangerouslySetInnerHTML!==null&&F.dangerouslySetInnerHTML.__html!=null}var pc=null;function dm(){var z=window.event;return z&&z.type==="popstate"?z===pc?!1:(pc=z,!0):(pc=null,!1)}var Yh=typeof setTimeout=="function"?setTimeout:void 0,hm=typeof clearTimeout=="function"?clearTimeout:void 0,Jh=typeof Promise=="function"?Promise:void 0,fm=typeof queueMicrotask=="function"?queueMicrotask:typeof Jh<"u"?function(z){return Jh.resolve(null).then(z).catch(pm)}:Yh;function pm(z){setTimeout(function(){throw z})}function Oi(z){return z==="head"}function Xh(z,F){var G=F,Y=0;do{var ee=G.nextSibling;if(z.removeChild(G),ee&&ee.nodeType===8)if(G=ee.data,G==="/$"||G==="/&"){if(Y===0){z.removeChild(ee),Hr(F);return}Y--}else if(G==="$"||G==="$?"||G==="$~"||G==="$!"||G==="&")Y++;else if(G==="html")Na(z.ownerDocument.documentElement);else if(G==="head"){G=z.ownerDocument.head,Na(G);for(var ne=G.firstChild;ne;){var se=ne.nextSibling,ce=ne.nodeName;ne[Xr]||ce==="SCRIPT"||ce==="STYLE"||ce==="LINK"&&ne.rel.toLowerCase()==="stylesheet"||G.removeChild(ne),ne=se}}else G==="body"&&Na(z.ownerDocument.body);G=ee}while(G);Hr(F)}function Wh(z,F){var G=z;z=0;do{var Y=G.nextSibling;if(G.nodeType===1?F?(G._stashedDisplay=G.style.display,G.style.display="none"):(G.style.display=G._stashedDisplay||"",G.getAttribute("style")===""&&G.removeAttribute("style")):G.nodeType===3&&(F?(G._stashedText=G.nodeValue,G.nodeValue=""):G.nodeValue=G._stashedText||""),Y&&Y.nodeType===8)if(G=Y.data,G==="/$"){if(z===0)break;z--}else G!=="$"&&G!=="$?"&&G!=="$~"&&G!=="$!"||z++;G=Y}while(G)}function mc(z){var F=z.firstChild;for(F&&F.nodeType===10&&(F=F.nextSibling);F;){var G=F;switch(F=F.nextSibling,G.nodeName){case"HTML":case"HEAD":case"BODY":mc(G),So(G);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(G.rel.toLowerCase()==="stylesheet")continue}z.removeChild(G)}}function mm(z,F,G,Y){for(;z.nodeType===1;){var ee=G;if(z.nodeName.toLowerCase()!==F.toLowerCase()){if(!Y&&(z.nodeName!=="INPUT"||z.type!=="hidden"))break}else if(Y){if(!z[Xr])switch(F){case"meta":if(!z.hasAttribute("itemprop"))break;return z;case"link":if(ne=z.getAttribute("rel"),ne==="stylesheet"&&z.hasAttribute("data-precedence"))break;if(ne!==ee.rel||z.getAttribute("href")!==(ee.href==null||ee.href===""?null:ee.href)||z.getAttribute("crossorigin")!==(ee.crossOrigin==null?null:ee.crossOrigin)||z.getAttribute("title")!==(ee.title==null?null:ee.title))break;return z;case"style":if(z.hasAttribute("data-precedence"))break;return z;case"script":if(ne=z.getAttribute("src"),(ne!==(ee.src==null?null:ee.src)||z.getAttribute("type")!==(ee.type==null?null:ee.type)||z.getAttribute("crossorigin")!==(ee.crossOrigin==null?null:ee.crossOrigin))&&ne&&z.hasAttribute("async")&&!z.hasAttribute("itemprop"))break;return z;default:return z}}else if(F==="input"&&z.type==="hidden"){var ne=ee.name==null?null:""+ee.name;if(ee.type==="hidden"&&z.getAttribute("name")===ne)return z}else return z;if(z=Dn(z.nextSibling),z===null)break}return null}function gm(z,F,G){if(F==="")return null;for(;z.nodeType!==3;)if((z.nodeType!==1||z.nodeName!=="INPUT"||z.type!=="hidden")&&!G||(z=Dn(z.nextSibling),z===null))return null;return z}function Zh(z,F){for(;z.nodeType!==8;)if((z.nodeType!==1||z.nodeName!=="INPUT"||z.type!=="hidden")&&!F||(z=Dn(z.nextSibling),z===null))return null;return z}function gc(z){return z.data==="$?"||z.data==="$~"}function vc(z){return z.data==="$!"||z.data==="$?"&&z.ownerDocument.readyState!=="loading"}function vm(z,F){var G=z.ownerDocument;if(z.data==="$~")z._reactRetry=F;else if(z.data!=="$?"||G.readyState!=="loading")F();else{var Y=function(){F(),G.removeEventListener("DOMContentLoaded",Y)};G.addEventListener("DOMContentLoaded",Y),z._reactRetry=Y}}function Dn(z){for(;z!=null;z=z.nextSibling){var F=z.nodeType;if(F===1||F===3)break;if(F===8){if(F=z.data,F==="$"||F==="$!"||F==="$?"||F==="$~"||F==="&"||F==="F!"||F==="F")break;if(F==="/$"||F==="/&")return null}}return z}var yc=null;function ef(z){z=z.nextSibling;for(var F=0;z;){if(z.nodeType===8){var G=z.data;if(G==="/$"||G==="/&"){if(F===0)return Dn(z.nextSibling);F--}else G!=="$"&&G!=="$!"&&G!=="$?"&&G!=="$~"&&G!=="&"||F++}z=z.nextSibling}return null}function tf(z){z=z.previousSibling;for(var F=0;z;){if(z.nodeType===8){var G=z.data;if(G==="$"||G==="$!"||G==="$?"||G==="$~"||G==="&"){if(F===0)return z;F--}else G!=="/$"&&G!=="/&"||F++}z=z.previousSibling}return null}function nf(z,F,G){switch(F=eo(G),z){case"html":if(z=F.documentElement,!z)throw Error(q(452));return z;case"head":if(z=F.head,!z)throw Error(q(453));return z;case"body":if(z=F.body,!z)throw Error(q(454));return z;default:throw Error(q(451))}}function Na(z){for(var F=z.attributes;F.length;)z.removeAttributeNode(F[0]);So(z)}var Pn=new Map,rf=new Set;function to(z){return typeof z.getRootNode=="function"?z.getRootNode():z.nodeType===9?z:z.ownerDocument}var li=we.d;we.d={f:ym,r:bm,D:Sm,C:km,L:Tm,m:Em,X:Cm,S:xm,M:_m};function ym(){var z=li.f(),F=Gs();return z||F}function bm(z){var F=cr(z);F!==null&&F.tag===5&&F.type==="form"?Sd(F):li.r(z)}var qr=typeof document>"u"?null:document;function af(z,F,G){var Y=qr;if(Y&&typeof F=="string"&&F){var ee=xn(F);ee='link[rel="'+z+'"][href="'+ee+'"]',typeof G=="string"&&(ee+='[crossorigin="'+G+'"]'),rf.has(ee)||(rf.add(ee),z={rel:z,crossOrigin:G,href:F},Y.querySelector(ee)===null&&(F=Y.createElement("link"),en(F,"link",z),Kt(F),Y.head.appendChild(F)))}}function Sm(z){li.D(z),af("dns-prefetch",z,null)}function km(z,F){li.C(z,F),af("preconnect",z,F)}function Tm(z,F,G){li.L(z,F,G);var Y=qr;if(Y&&z&&F){var ee='link[rel="preload"][as="'+xn(F)+'"]';F==="image"&&G&&G.imageSrcSet?(ee+='[imagesrcset="'+xn(G.imageSrcSet)+'"]',typeof G.imageSizes=="string"&&(ee+='[imagesizes="'+xn(G.imageSizes)+'"]')):ee+='[href="'+xn(z)+'"]';var ne=ee;switch(F){case"style":ne=Fr(z);break;case"script":ne=Vr(z)}Pn.has(ne)||(z=Z({rel:"preload",href:F==="image"&&G&&G.imageSrcSet?void 0:z,as:F},G),Pn.set(ne,z),Y.querySelector(ee)!==null||F==="style"&&Y.querySelector(Ma(ne))||F==="script"&&Y.querySelector(La(ne))||(F=Y.createElement("link"),en(F,"link",z),Kt(F),Y.head.appendChild(F)))}}function Em(z,F){li.m(z,F);var G=qr;if(G&&z){var Y=F&&typeof F.as=="string"?F.as:"script",ee='link[rel="modulepreload"][as="'+xn(Y)+'"][href="'+xn(z)+'"]',ne=ee;switch(Y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":ne=Vr(z)}if(!Pn.has(ne)&&(z=Z({rel:"modulepreload",href:z},F),Pn.set(ne,z),G.querySelector(ee)===null)){switch(Y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(G.querySelector(La(ne)))return}Y=G.createElement("link"),en(Y,"link",z),Kt(Y),G.head.appendChild(Y)}}}function xm(z,F,G){li.S(z,F,G);var Y=qr;if(Y&&z){var ee=ur(Y).hoistableStyles,ne=Fr(z);F=F||"default";var se=ee.get(ne);if(!se){var ce={loading:0,preload:null};if(se=Y.querySelector(Ma(ne)))ce.loading=5;else{z=Z({rel:"stylesheet",href:z,"data-precedence":F},G),(G=Pn.get(ne))&&bc(z,G);var ye=se=Y.createElement("link");Kt(ye),en(ye,"link",z),ye._p=new Promise(function(_e,Me){ye.onload=_e,ye.onerror=Me}),ye.addEventListener("load",function(){ce.loading|=1}),ye.addEventListener("error",function(){ce.loading|=2}),ce.loading|=4,no(se,F,Y)}se={type:"stylesheet",instance:se,count:1,state:ce},ee.set(ne,se)}}}function Cm(z,F){li.X(z,F);var G=qr;if(G&&z){var Y=ur(G).hoistableScripts,ee=Vr(z),ne=Y.get(ee);ne||(ne=G.querySelector(La(ee)),ne||(z=Z({src:z,async:!0},F),(F=Pn.get(ee))&&Sc(z,F),ne=G.createElement("script"),Kt(ne),en(ne,"link",z),G.head.appendChild(ne)),ne={type:"script",instance:ne,count:1,state:null},Y.set(ee,ne))}}function _m(z,F){li.M(z,F);var G=qr;if(G&&z){var Y=ur(G).hoistableScripts,ee=Vr(z),ne=Y.get(ee);ne||(ne=G.querySelector(La(ee)),ne||(z=Z({src:z,async:!0,type:"module"},F),(F=Pn.get(ee))&&Sc(z,F),ne=G.createElement("script"),Kt(ne),en(ne,"link",z),G.head.appendChild(ne)),ne={type:"script",instance:ne,count:1,state:null},Y.set(ee,ne))}}function sf(z,F,G,Y){var ee=(ee=He.current)?to(ee):null;if(!ee)throw Error(q(446));switch(z){case"meta":case"title":return null;case"style":return typeof G.precedence=="string"&&typeof G.href=="string"?(F=Fr(G.href),G=ur(ee).hoistableStyles,Y=G.get(F),Y||(Y={type:"style",instance:null,count:0,state:null},G.set(F,Y)),Y):{type:"void",instance:null,count:0,state:null};case"link":if(G.rel==="stylesheet"&&typeof G.href=="string"&&typeof G.precedence=="string"){z=Fr(G.href);var ne=ur(ee).hoistableStyles,se=ne.get(z);if(se||(ee=ee.ownerDocument||ee,se={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},ne.set(z,se),(ne=ee.querySelector(Ma(z)))&&!ne._p&&(se.instance=ne,se.state.loading=5),Pn.has(z)||(G={rel:"preload",as:"style",href:G.href,crossOrigin:G.crossOrigin,integrity:G.integrity,media:G.media,hrefLang:G.hrefLang,referrerPolicy:G.referrerPolicy},Pn.set(z,G),ne||wm(ee,z,G,se.state))),F&&Y===null)throw Error(q(528,""));return se}if(F&&Y!==null)throw Error(q(529,""));return null;case"script":return F=G.async,G=G.src,typeof G=="string"&&F&&typeof F!="function"&&typeof F!="symbol"?(F=Vr(G),G=ur(ee).hoistableScripts,Y=G.get(F),Y||(Y={type:"script",instance:null,count:0,state:null},G.set(F,Y)),Y):{type:"void",instance:null,count:0,state:null};default:throw Error(q(444,z))}}function Fr(z){return'href="'+xn(z)+'"'}function Ma(z){return'link[rel="stylesheet"]['+z+"]"}function of(z){return Z({},z,{"data-precedence":z.precedence,precedence:null})}function wm(z,F,G,Y){z.querySelector('link[rel="preload"][as="style"]['+F+"]")?Y.loading=1:(F=z.createElement("link"),Y.preload=F,F.addEventListener("load",function(){return Y.loading|=1}),F.addEventListener("error",function(){return Y.loading|=2}),en(F,"link",G),Kt(F),z.head.appendChild(F))}function Vr(z){return'[src="'+xn(z)+'"]'}function La(z){return"script[async]"+z}function lf(z,F,G){if(F.count++,F.instance===null)switch(F.type){case"style":var Y=z.querySelector('style[data-href~="'+xn(G.href)+'"]');if(Y)return F.instance=Y,Kt(Y),Y;var ee=Z({},G,{"data-href":G.href,"data-precedence":G.precedence,href:null,precedence:null});return Y=(z.ownerDocument||z).createElement("style"),Kt(Y),en(Y,"style",ee),no(Y,G.precedence,z),F.instance=Y;case"stylesheet":ee=Fr(G.href);var ne=z.querySelector(Ma(ee));if(ne)return F.state.loading|=4,F.instance=ne,Kt(ne),ne;Y=of(G),(ee=Pn.get(ee))&&bc(Y,ee),ne=(z.ownerDocument||z).createElement("link"),Kt(ne);var se=ne;return se._p=new Promise(function(ce,ye){se.onload=ce,se.onerror=ye}),en(ne,"link",Y),F.state.loading|=4,no(ne,G.precedence,z),F.instance=ne;case"script":return ne=Vr(G.src),(ee=z.querySelector(La(ne)))?(F.instance=ee,Kt(ee),ee):(Y=G,(ee=Pn.get(ne))&&(Y=Z({},G),Sc(Y,ee)),z=z.ownerDocument||z,ee=z.createElement("script"),Kt(ee),en(ee,"link",Y),z.head.appendChild(ee),F.instance=ee);case"void":return null;default:throw Error(q(443,F.type))}else F.type==="stylesheet"&&(F.state.loading&4)===0&&(Y=F.instance,F.state.loading|=4,no(Y,G.precedence,z));return F.instance}function no(z,F,G){for(var Y=G.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),ee=Y.length?Y[Y.length-1]:null,ne=ee,se=0;se<Y.length;se++){var ce=Y[se];if(ce.dataset.precedence===F)ne=ce;else if(ne!==ee)break}ne?ne.parentNode.insertBefore(z,ne.nextSibling):(F=G.nodeType===9?G.head:G,F.insertBefore(z,F.firstChild))}function bc(z,F){z.crossOrigin==null&&(z.crossOrigin=F.crossOrigin),z.referrerPolicy==null&&(z.referrerPolicy=F.referrerPolicy),z.title==null&&(z.title=F.title)}function Sc(z,F){z.crossOrigin==null&&(z.crossOrigin=F.crossOrigin),z.referrerPolicy==null&&(z.referrerPolicy=F.referrerPolicy),z.integrity==null&&(z.integrity=F.integrity)}var io=null;function cf(z,F,G){if(io===null){var Y=new Map,ee=io=new Map;ee.set(G,Y)}else ee=io,Y=ee.get(G),Y||(Y=new Map,ee.set(G,Y));if(Y.has(z))return Y;for(Y.set(z,null),G=G.getElementsByTagName(z),ee=0;ee<G.length;ee++){var ne=G[ee];if(!(ne[Xr]||ne[Jt]||z==="link"&&ne.getAttribute("rel")==="stylesheet")&&ne.namespaceURI!=="http://www.w3.org/2000/svg"){var se=ne.getAttribute(F)||"";se=z+se;var ce=Y.get(se);ce?ce.push(ne):Y.set(se,[ne])}}return Y}function uf(z,F,G){z=z.ownerDocument||z,z.head.insertBefore(G,F==="title"?z.querySelector("head > title"):null)}function Rm(z,F,G){if(G===1||F.itemProp!=null)return!1;switch(z){case"meta":case"title":return!0;case"style":if(typeof F.precedence!="string"||typeof F.href!="string"||F.href==="")break;return!0;case"link":if(typeof F.rel!="string"||typeof F.href!="string"||F.href===""||F.onLoad||F.onError)break;switch(F.rel){case"stylesheet":return z=F.disabled,typeof F.precedence=="string"&&z==null;default:return!0}case"script":if(F.async&&typeof F.async!="function"&&typeof F.async!="symbol"&&!F.onLoad&&!F.onError&&F.src&&typeof F.src=="string")return!0}return!1}function df(z){return!(z.type==="stylesheet"&&(z.state.loading&3)===0)}function Am(z,F,G,Y){if(G.type==="stylesheet"&&(typeof Y.media!="string"||matchMedia(Y.media).matches!==!1)&&(G.state.loading&4)===0){if(G.instance===null){var ee=Fr(Y.href),ne=F.querySelector(Ma(ee));if(ne){F=ne._p,F!==null&&typeof F=="object"&&typeof F.then=="function"&&(z.count++,z=ro.bind(z),F.then(z,z)),G.state.loading|=4,G.instance=ne,Kt(ne);return}ne=F.ownerDocument||F,Y=of(Y),(ee=Pn.get(ee))&&bc(Y,ee),ne=ne.createElement("link"),Kt(ne);var se=ne;se._p=new Promise(function(ce,ye){se.onload=ce,se.onerror=ye}),en(ne,"link",Y),G.instance=ne}z.stylesheets===null&&(z.stylesheets=new Map),z.stylesheets.set(G,F),(F=G.state.preload)&&(G.state.loading&3)===0&&(z.count++,G=ro.bind(z),F.addEventListener("load",G),F.addEventListener("error",G))}}var kc=0;function Om(z,F){return z.stylesheets&&z.count===0&&so(z,z.stylesheets),0<z.count||0<z.imgCount?function(G){var Y=setTimeout(function(){if(z.stylesheets&&so(z,z.stylesheets),z.unsuspend){var ne=z.unsuspend;z.unsuspend=null,ne()}},6e4+F);0<z.imgBytes&&kc===0&&(kc=62500*um());var ee=setTimeout(function(){if(z.waitingForImages=!1,z.count===0&&(z.stylesheets&&so(z,z.stylesheets),z.unsuspend)){var ne=z.unsuspend;z.unsuspend=null,ne()}},(z.imgBytes>kc?50:800)+F);return z.unsuspend=G,function(){z.unsuspend=null,clearTimeout(Y),clearTimeout(ee)}}:null}function ro(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)so(this,this.stylesheets);else if(this.unsuspend){var z=this.unsuspend;this.unsuspend=null,z()}}}var ao=null;function so(z,F){z.stylesheets=null,z.unsuspend!==null&&(z.count++,ao=new Map,F.forEach(Dm,z),ao=null,ro.call(z))}function Dm(z,F){if(!(F.state.loading&4)){var G=ao.get(z);if(G)var Y=G.get(null);else{G=new Map,ao.set(z,G);for(var ee=z.querySelectorAll("link[data-precedence],style[data-precedence]"),ne=0;ne<ee.length;ne++){var se=ee[ne];(se.nodeName==="LINK"||se.getAttribute("media")!=="not all")&&(G.set(se.dataset.precedence,se),Y=se)}Y&&G.set(null,Y)}ee=F.instance,se=ee.getAttribute("data-precedence"),ne=G.get(se)||Y,ne===Y&&G.set(null,ee),G.set(se,ee),this.count++,Y=ro.bind(this),ee.addEventListener("load",Y),ee.addEventListener("error",Y),ne?ne.parentNode.insertBefore(ee,ne.nextSibling):(z=z.nodeType===9?z.head:z,z.insertBefore(ee,z.firstChild)),F.state.loading|=4}}var Ia={$$typeof:he,Provider:null,Consumer:null,_currentValue:$e,_currentValue2:$e,_threadCount:0};function Pm(z,F,G,Y,ee,ne,se,ce,ye){this.tag=1,this.containerInfo=z,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=go(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=go(0),this.hiddenUpdates=go(null),this.identifierPrefix=Y,this.onUncaughtError=ee,this.onCaughtError=ne,this.onRecoverableError=se,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ye,this.incompleteTransitions=new Map}function hf(z,F,G,Y,ee,ne,se,ce,ye,_e,Me,qe){return z=new Pm(z,F,G,se,ye,_e,Me,qe,ce),F=1,ne===!0&&(F|=24),ne=gn(3,null,null,F),z.current=ne,ne.stateNode=z,F=el(),F.refCount++,z.pooledCache=F,F.refCount++,ne.memoizedState={element:Y,isDehydrated:G,cache:F},rl(ne),z}function ff(z){return z?(z=Sr,z):Sr}function pf(z,F,G,Y,ee,ne){ee=ff(ee),Y.context===null?Y.context=ee:Y.pendingContext=ee,Y=bi(F),Y.payload={element:G},ne=ne===void 0?null:ne,ne!==null&&(Y.callback=ne),G=Si(z,Y,F),G!==null&&(pn(G,z,F),pa(G,z,F))}function mf(z,F){if(z=z.memoizedState,z!==null&&z.dehydrated!==null){var G=z.retryLane;z.retryLane=G!==0&&G<F?G:F}}function Tc(z,F){mf(z,F),(z=z.alternate)&&mf(z,F)}function gf(z){if(z.tag===13||z.tag===31){var F=Hi(z,67108864);F!==null&&pn(F,z,67108864),Tc(z,67108864)}}function vf(z){if(z.tag===13||z.tag===31){var F=kn();F=vo(F);var G=Hi(z,F);G!==null&&pn(G,z,F),Tc(z,F)}}var oo=!0;function Nm(z,F,G,Y){var ee=Se.T;Se.T=null;var ne=we.p;try{we.p=2,Ec(z,F,G,Y)}finally{we.p=ne,Se.T=ee}}function Mm(z,F,G,Y){var ee=Se.T;Se.T=null;var ne=we.p;try{we.p=8,Ec(z,F,G,Y)}finally{we.p=ne,Se.T=ee}}function Ec(z,F,G,Y){if(oo){var ee=xc(Y);if(ee===null)cc(z,F,Y,lo,G),bf(z,Y);else if(Im(ee,z,F,G,Y))Y.stopPropagation();else if(bf(z,Y),F&4&&-1<Lm.indexOf(z)){for(;ee!==null;){var ne=cr(ee);if(ne!==null)switch(ne.tag){case 3:if(ne=ne.stateNode,ne.current.memoizedState.isDehydrated){var se=Tn(ne.pendingLanes);if(se!==0){var ce=ne;for(ce.pendingLanes|=2,ce.entangledLanes|=2;se;){var ye=1<<31-Ne(se);ce.entanglements[1]|=ye,se&=~ye}Fn(ne),(St&6)===0&&(Hs=Yt()+500,Oa(0))}}break;case 31:case 13:ce=Hi(ne,2),ce!==null&&pn(ce,ne,2),Gs(),Tc(ne,2)}if(ne=xc(Y),ne===null&&cc(z,F,Y,lo,G),ne===ee)break;ee=ne}ee!==null&&Y.stopPropagation()}else cc(z,F,Y,null,G)}}function xc(z){return z=_o(z),Cc(z)}var lo=null;function Cc(z){if(lo=null,z=lr(z),z!==null){var F=H(z);if(F===null)z=null;else{var G=F.tag;if(G===13){if(z=$(F),z!==null)return z;z=null}else if(G===31){if(z=K(F),z!==null)return z;z=null}else if(G===3){if(F.stateNode.current.memoizedState.isDehydrated)return F.tag===3?F.stateNode.containerInfo:null;z=null}else F!==z&&(z=null)}}return lo=z,null}function yf(z){switch(z){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(rn()){case je:return 2;case Ke:return 8;case it:case st:return 32;case vt:return 268435456;default:return 32}default:return 32}}var _c=!1,Di=null,Pi=null,Ni=null,ja=new Map,Ua=new Map,Mi=[],Lm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bf(z,F){switch(z){case"focusin":case"focusout":Di=null;break;case"dragenter":case"dragleave":Pi=null;break;case"mouseover":case"mouseout":Ni=null;break;case"pointerover":case"pointerout":ja.delete(F.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ua.delete(F.pointerId)}}function Ba(z,F,G,Y,ee,ne){return z===null||z.nativeEvent!==ne?(z={blockedOn:F,domEventName:G,eventSystemFlags:Y,nativeEvent:ne,targetContainers:[ee]},F!==null&&(F=cr(F),F!==null&&gf(F)),z):(z.eventSystemFlags|=Y,F=z.targetContainers,ee!==null&&F.indexOf(ee)===-1&&F.push(ee),z)}function Im(z,F,G,Y,ee){switch(F){case"focusin":return Di=Ba(Di,z,F,G,Y,ee),!0;case"dragenter":return Pi=Ba(Pi,z,F,G,Y,ee),!0;case"mouseover":return Ni=Ba(Ni,z,F,G,Y,ee),!0;case"pointerover":var ne=ee.pointerId;return ja.set(ne,Ba(ja.get(ne)||null,z,F,G,Y,ee)),!0;case"gotpointercapture":return ne=ee.pointerId,Ua.set(ne,Ba(Ua.get(ne)||null,z,F,G,Y,ee)),!0}return!1}function Sf(z){var F=lr(z.target);if(F!==null){var G=H(F);if(G!==null){if(F=G.tag,F===13){if(F=$(G),F!==null){z.blockedOn=F,Nc(z.priority,function(){vf(G)});return}}else if(F===31){if(F=K(G),F!==null){z.blockedOn=F,Nc(z.priority,function(){vf(G)});return}}else if(F===3&&G.stateNode.current.memoizedState.isDehydrated){z.blockedOn=G.tag===3?G.stateNode.containerInfo:null;return}}}z.blockedOn=null}function co(z){if(z.blockedOn!==null)return!1;for(var F=z.targetContainers;0<F.length;){var G=xc(z.nativeEvent);if(G===null){G=z.nativeEvent;var Y=new G.constructor(G.type,G);Co=Y,G.target.dispatchEvent(Y),Co=null}else return F=cr(G),F!==null&&gf(F),z.blockedOn=G,!1;F.shift()}return!0}function kf(z,F,G){co(z)&&G.delete(F)}function jm(){_c=!1,Di!==null&&co(Di)&&(Di=null),Pi!==null&&co(Pi)&&(Pi=null),Ni!==null&&co(Ni)&&(Ni=null),ja.forEach(kf),Ua.forEach(kf)}function uo(z,F){z.blockedOn===F&&(z.blockedOn=null,_c||(_c=!0,U.unstable_scheduleCallback(U.unstable_NormalPriority,jm)))}var ho=null;function Tf(z){ho!==z&&(ho=z,U.unstable_scheduleCallback(U.unstable_NormalPriority,function(){ho===z&&(ho=null);for(var F=0;F<z.length;F+=3){var G=z[F],Y=z[F+1],ee=z[F+2];if(typeof Y!="function"){if(Cc(Y||G)===null)continue;break}var ne=cr(G);ne!==null&&(z.splice(F,3),F-=3,xl(ne,{pending:!0,data:ee,method:G.method,action:Y},Y,ee))}}))}function Hr(z){function F(ye){return uo(ye,z)}Di!==null&&uo(Di,z),Pi!==null&&uo(Pi,z),Ni!==null&&uo(Ni,z),ja.forEach(F),Ua.forEach(F);for(var G=0;G<Mi.length;G++){var Y=Mi[G];Y.blockedOn===z&&(Y.blockedOn=null)}for(;0<Mi.length&&(G=Mi[0],G.blockedOn===null);)Sf(G),G.blockedOn===null&&Mi.shift();if(G=(z.ownerDocument||z).$$reactFormReplay,G!=null)for(Y=0;Y<G.length;Y+=3){var ee=G[Y],ne=G[Y+1],se=ee[ln]||null;if(typeof ne=="function")se||Tf(G);else if(se){var ce=null;if(ne&&ne.hasAttribute("formAction")){if(ee=ne,se=ne[ln]||null)ce=se.formAction;else if(Cc(ee)!==null)continue}else ce=se.action;typeof ce=="function"?G[Y+1]=ce:(G.splice(Y,3),Y-=3),Tf(G)}}}function Ef(){function z(ne){ne.canIntercept&&ne.info==="react-transition"&&ne.intercept({handler:function(){return new Promise(function(se){return ee=se})},focusReset:"manual",scroll:"manual"})}function F(){ee!==null&&(ee(),ee=null),Y||setTimeout(G,20)}function G(){if(!Y&&!navigation.transition){var ne=navigation.currentEntry;ne&&ne.url!=null&&navigation.navigate(ne.url,{state:ne.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var Y=!1,ee=null;return navigation.addEventListener("navigate",z),navigation.addEventListener("navigatesuccess",F),navigation.addEventListener("navigateerror",F),setTimeout(G,100),function(){Y=!0,navigation.removeEventListener("navigate",z),navigation.removeEventListener("navigatesuccess",F),navigation.removeEventListener("navigateerror",F),ee!==null&&(ee(),ee=null)}}}function wc(z){this._internalRoot=z}fo.prototype.render=wc.prototype.render=function(z){var F=this._internalRoot;if(F===null)throw Error(q(409));var G=F.current,Y=kn();pf(G,Y,z,F,null,null)},fo.prototype.unmount=wc.prototype.unmount=function(){var z=this._internalRoot;if(z!==null){this._internalRoot=null;var F=z.containerInfo;pf(z.current,2,null,z,null,null),Gs(),F[or]=null}};function fo(z){this._internalRoot=z}fo.prototype.unstable_scheduleHydration=function(z){if(z){var F=Pc();z={blockedOn:null,target:z,priority:F};for(var G=0;G<Mi.length&&F!==0&&F<Mi[G].priority;G++);Mi.splice(G,0,z),G===0&&Sf(z)}};var xf=j.version;if(xf!=="19.2.0")throw Error(q(527,xf,"19.2.0"));we.findDOMNode=function(z){var F=z._reactInternals;if(F===void 0)throw typeof z.render=="function"?Error(q(188)):(z=Object.keys(z).join(","),Error(q(268,z)));return z=Q(F),z=z!==null?W(z):null,z=z===null?null:z.stateNode,z};var Um={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Se,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var po=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!po.isDisabled&&po.supportsFiber)try{mt=po.inject(Um),Pe=po}catch{}}return reactDomClient_production.createRoot=function(z,F){if(!V(z))throw Error(q(299));var G=!1,Y="",ee=Od,ne=Dd,se=Pd;return F!=null&&(F.unstable_strictMode===!0&&(G=!0),F.identifierPrefix!==void 0&&(Y=F.identifierPrefix),F.onUncaughtError!==void 0&&(ee=F.onUncaughtError),F.onCaughtError!==void 0&&(ne=F.onCaughtError),F.onRecoverableError!==void 0&&(se=F.onRecoverableError)),F=hf(z,1,!1,null,null,G,Y,null,ee,ne,se,Ef),z[or]=F.current,lc(z),new wc(F)},reactDomClient_production.hydrateRoot=function(z,F,G){if(!V(z))throw Error(q(299));var Y=!1,ee="",ne=Od,se=Dd,ce=Pd,ye=null;return G!=null&&(G.unstable_strictMode===!0&&(Y=!0),G.identifierPrefix!==void 0&&(ee=G.identifierPrefix),G.onUncaughtError!==void 0&&(ne=G.onUncaughtError),G.onCaughtError!==void 0&&(se=G.onCaughtError),G.onRecoverableError!==void 0&&(ce=G.onRecoverableError),G.formState!==void 0&&(ye=G.formState)),F=hf(z,1,!0,F,G??null,Y,ee,ye,ne,se,ce,Ef),F.context=ff(null),G=F.current,Y=kn(),Y=vo(Y),ee=bi(Y),ee.callback=null,Si(G,ee,Y),G=Y,F.current.lanes=G,Jr(F,G),Fn(F),z[or]=F.current,lc(z),new fo(F)},reactDomClient_production.version="19.2.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function U(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(U)}catch(j){console.error(j)}}return U(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const ReactDOM=getDefaultExportFromCjs$1(clientExports);var reactExports=requireReact();const React=getDefaultExportFromCjs$1(reactExports),PageWrapper=({children:U,isFullScreen:j=!1,bgClass:B})=>{const q=j?"h-screen overflow-hidden font-sans":"flex items-center justify-center h-screen overflow-hidden font-sans p-0 pt-20 pb-24 md:pt-20 md:pb-28 md:px-4";return jsxRuntimeExports.jsx("div",{className:`${B} ${q} transition-all duration-1000 relative`,children:U})},API_BASE_URL="/api",HEYGEN_API_URL="",AUTH_TOKEN_KEY="authToken",USER_KEY="user",login=async(U,j)=>{try{const B=await fetch(`${API_BASE_URL}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:U,password:j})});if(!B.ok){const V=await B.json();return console.error("Login failed:",V.detail),null}const q=await B.json();return localStorage.setItem(AUTH_TOKEN_KEY,q.access_token),localStorage.setItem(USER_KEY,JSON.stringify(q.user)),q.access_token}catch(B){return console.error("Login error:",B),null}},logout=async()=>{try{const U=getToken();U&&await fetch(`${API_BASE_URL}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${U}`}})}catch(U){console.error("Logout error:",U)}finally{localStorage.removeItem(AUTH_TOKEN_KEY),localStorage.removeItem(USER_KEY)}},getToken=()=>localStorage.getItem(AUTH_TOKEN_KEY),isAuthenticated=()=>!!getToken(),getUser$1=()=>{const U=localStorage.getItem(USER_KEY);if(!U)return null;try{return JSON.parse(U)}catch{return null}},MicIcon=({className:U})=>jsxRuntimeExports.jsxs("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"}),jsxRuntimeExports.jsx("path",{d:"M19 10v1a7 7 0 0 1-14 0v-1h2v1a5 5 0 0 0 10 0v-1z"}),jsxRuntimeExports.jsx("path",{d:"M12 19a4 4 0 0 1-4-4h2a2 2 0 0 0 4 0h2a4 4 0 0 1-4 4z"})]}),SendIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})}),StopIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M4.5 7.5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-9a3 3 0 01-3-3v-9z",clipRule:"evenodd"})}),LoadingSpinner=()=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-pulse [animation-delay:-0.3s]"}),jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-pulse [animation-delay:-0.15s]"}),jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-pulse"})]}),ButtonSpinner=()=>jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),CrmIcon=({className:U})=>jsxRuntimeExports.jsxs("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),jsxRuntimeExports.jsx("path",{d:"M19 8v3h-2V8h2m4-4H1v18h22V4zm-2 16H3V6h18v14z"})]}),ChatbotIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"})}),HomeIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),PageLoader=()=>jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-10 w-10 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading CRM Data..."})]}),SearchIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z",clipRule:"evenodd"})}),CloseIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z",clipRule:"evenodd"})}),TrashIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193v-.443A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z",clipRule:"evenodd"})}),ChevronDownIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M5.22 8.22a.75.75 0 011.06 0L10 11.94l3.72-3.72a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.22 9.28a.75.75 0 010-1.06z",clipRule:"evenodd"})}),UserCircleIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-5.5-2.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 12a5.99 5.99 0 00-4.793 2.39A6.483 6.483 0 0010 16.5a6.483 6.483 0 004.793-2.11A5.99 5.99 0 0010 12z",clipRule:"evenodd"})}),PhoneIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M2 3.5A1.5 1.5 0 013.5 2h1.148a1.5 1.5 0 011.465 1.175l.716 3.223a1.5 1.5 0 01-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 006.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 011.767-1.052l3.223.716A1.5 1.5 0 0118 15.352V16.5a1.5 1.5 0 01-1.5 1.5h-1.528a1.5 1.5 0 01-1.488-.938l-1.378-3.445a.75.75 0 00-1.396-.237L8.23 14.509a.75.75 0 01-1.22-.519l-.512-1.91a.75.75 0 00-.936-.57l-1.91.512a.75.75 0 01-.519-1.22l2.15-2.15a.75.75 0 00-.237-1.396L3.438 6.488A1.5 1.5 0 012.5 5.028V3.5z",clipRule:"evenodd"})}),EnvelopeIcon=({className:U})=>jsxRuntimeExports.jsxs("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:[jsxRuntimeExports.jsx("path",{d:"M3 4a2 2 0 00-2 2v1.161l8.441 4.221a1.25 1.25 0 001.118 0L19 7.162V6a2 2 0 00-2-2H3z"}),jsxRuntimeExports.jsx("path",{d:"M19 8.839l-7.77 3.885a2.75 2.75 0 01-2.46 0L1 8.839V14a2 2 0 002 2h14a2 2 0 002-2V8.839z"})]}),HamburgerIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z",clipRule:"evenodd"})}),MapPinIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M10 2a5 5 0 00-5 5c0 3.52 5 9.5 5 9.5s5-5.98 5-9.5a5 5 0 00-5-5zm0 8a3 3 0 110-6 3 3 0 010 6z"})}),SortIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M2.25 3A.75.75 0 013 3.75h14a.75.75 0 000-1.5H3A.75.75 0 002.25 3zm0 5.5A.75.75 0 013 9.25h10a.75.75 0 000-1.5H3a.75.75 0 00-.75.75zM2.25 14A.75.75 0 013 14.75h4a.75.75 0 000-1.5H3a.75.75 0 00-.75.75z",clipRule:"evenodd"})}),CheckIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.052-.143z",clipRule:"evenodd"})}),CalendarIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zM4.5 8.5v6.75c0 .138.112.25.25.25h10.5a.25.25 0 00.25-.25V8.5h-11z",clipRule:"evenodd"})}),ChartBarIcon=({className:U})=>jsxRuntimeExports.jsx("svg",{className:U,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M11.5 16.5a.5.5 0 01-1 0V3.78l-1.72 1.72a.5.5 0 01-.708-.708l2.5-2.5a.5.5 0 01.708 0l2.5 2.5a.5.5 0 01-.708.708L11.5 3.78v12.72zM4.5 3.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v13a.5.5 0 01-.5.5h-2a.5.5 0 01-.5-.5v-13zM15 8.5a.5.5 0 00-.5.5v8a.5.5 0 00.5.5h2a.5.5 0 00.5-.5v-8a.5.5 0 00-.5-.5h-2z"})}),LoginPage=({onLoginSuccess:U})=>{const[j,B]=reactExports.useState(""),[q,V]=reactExports.useState(""),[H,$]=reactExports.useState(""),[K,X]=reactExports.useState(!1),Q=async Z=>{Z.preventDefault(),$(""),X(!0);try{await login(j,q)?U():$("Invalid email or password. Please try again.")}catch{$("An unexpected error occurred. Please try again.")}finally{X(!1)}},W=Z=>te=>{Z(te.target.value),H&&$("")};return jsxRuntimeExports.jsx("div",{className:"w-full max-w-md",children:jsxRuntimeExports.jsxs("div",{className:"relative w-full p-8 bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/20",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl font-bold text-white text-center mb-6",children:"Welcome Back"}),jsxRuntimeExports.jsxs("form",{onSubmit:Q,children:[jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-white/80 mb-1",children:"Email"}),jsxRuntimeExports.jsx("input",{type:"email",id:"email",value:j,onChange:W(B),required:!0,className:"w-full px-3 py-2 bg-white/20 text-white rounded-lg border border-white/30 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"you@example.com"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-white/80 mb-1",children:"Password"}),jsxRuntimeExports.jsx("input",{type:"password",id:"password",value:q,onChange:W(V),required:!0,className:"w-full px-3 py-2 bg-white/20 text-white rounded-lg border border-white/30 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:""})]})]}),H&&jsxRuntimeExports.jsx("p",{className:"mt-4 text-center text-sm text-red-300 bg-red-500/20 p-2 rounded-md",children:H}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:K,className:"w-full mt-6 py-2.5 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-transparent flex items-center justify-center disabled:bg-blue-400 disabled:cursor-wait",children:K?jsxRuntimeExports.jsx(ButtonSpinner,{}):"Login"})]})]})})},HomeCard=({icon:U,title:j,onClick:B,animationDelay:q="0s"})=>jsxRuntimeExports.jsx("div",{className:"p-8 bg-white/10 backdrop-blur-md rounded-2xl shadow-lg border border-white/20 text-white cursor-pointer transition-all duration-300 hover:bg-white/20 hover:scale-105 hover:shadow-xl home-card-enter",onClick:B,style:{animationDelay:q},children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center",children:[U,jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold",children:j})]})}),HomePage=({onNavigateToChatbot:U,onNavigateToCrm:j})=>jsxRuntimeExports.jsx("div",{className:"w-full max-w-4xl mx-auto text-center",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[jsxRuntimeExports.jsx(HomeCard,{icon:jsxRuntimeExports.jsx(CrmIcon,{className:"w-12 h-12 mb-4"}),title:"Dashboard",onClick:j,animationDelay:"0s"}),jsxRuntimeExports.jsx(HomeCard,{icon:jsxRuntimeExports.jsx(ChatbotIcon,{className:"w-12 h-12 mb-4"}),title:"Chatbot",onClick:U,animationDelay:"0.1s"})]})}),SERVICE_BOARD_DATA_KEY="serviceBoardData",getAuthHeaders=()=>{const U=localStorage.getItem("authToken");return{"Content-Type":"application/json",...U&&{Authorization:`Bearer ${U}`}}},getChatbotLeads=async()=>{const U=await fetch(`${API_BASE_URL}/crm/leads`,{headers:getAuthHeaders()});if(!U.ok)throw U.status===403?new Error("403 Forbidden: Admin access required"):new Error(`HTTP error! status: ${U.status}`);return await U.json()},deleteChatbotLead=async U=>{try{const j=await fetch(`${API_BASE_URL}/crm/leads/${U}`,{method:"DELETE",headers:getAuthHeaders()});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);return await getChatbotLeads()}catch(j){throw console.error("Error deleting chatbot lead:",j),j}},getKanbanData=async()=>{const U=await fetch(`${API_BASE_URL}/crm/deals`,{headers:getAuthHeaders()});if(!U.ok)throw U.status===403?new Error("403 Forbidden: Admin access required"):new Error(`HTTP error! status: ${U.status}`);const j=await U.json();return Array.isArray(j)?j:(console.error("Kanban data is not an array:",j),[])},updateDealColumn=async(U,j)=>{try{const B=await fetch(`${API_BASE_URL}/crm/deals/${U}/stage`,{method:"PATCH",headers:getAuthHeaders(),body:JSON.stringify({status:j})});if(!B.ok)throw new Error(`HTTP error! status: ${B.status}`);return await getKanbanData()}catch(B){throw console.error("Error updating deal column:",B),B}},updateDealDetails=async U=>{try{const j=await fetch(`${API_BASE_URL}/crm/deals/${U.id}`,{method:"PUT",headers:getAuthHeaders(),body:JSON.stringify(U)});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);return await getKanbanData()}catch(j){throw console.error("Error updating deal details:",j),j}},deleteDeal=async U=>{try{const j=await fetch(`${API_BASE_URL}/crm/deals/${U}`,{method:"DELETE",headers:getAuthHeaders()});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);return await getKanbanData()}catch(j){throw console.error("Error deleting deal:",j),j}},addDeal=async U=>{try{const j=await fetch(`${API_BASE_URL}/crm/deals`,{method:"POST",headers:getAuthHeaders(),body:JSON.stringify(U)});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);return await getKanbanData()}catch(j){throw console.error("Error adding deal:",j),j}},initialServiceBoardData=[{id:"open",title:"Open",tickets:[{id:"ticket-1",customerName:"Laura Williams",issueSummary:"Cannot log in to my account. Password reset link is not working.",dateOpened:"2024-07-29T14:00:00Z",contactEmail:"laura.w@example.com",contactPhone:"+1-415-555-0101",city:"San Francisco",country:"USA",notes:"User is blocked. Needs immediate assistance with password reset.",comments:""},{id:"ticket-2",customerName:"Michael Brown",issueSummary:"Billing inquiry - I was charged twice for this month's subscription.",dateOpened:"2024-07-29T11:30:00Z",contactEmail:"michael.b@example.com",contactPhone:"+44-20-7946-0958",city:"London",country:"UK",notes:"Check Stripe for duplicate charges. Reference transaction ID #XYZ-123.",comments:"Follow up with a credit note if confirmed."}]},{id:"connected",title:"Connected",tickets:[{id:"ticket-3",customerName:"Sophia Jones",issueSummary:"Feature request for exporting data to CSV format.",dateOpened:"2024-07-28T18:00:00Z",dateConnected:"2024-07-29T09:00:00Z",contactEmail:"sophia.j@example.com",contactPhone:"+61-2-9999-0100",city:"Sydney",country:"Australia",notes:"User wants to export their dashboard data. Emailed them to let them know we have passed the feedback to the product team.",comments:"Good suggestion. Link this ticket to internal feature tracker #PROD-456."}]},{id:"resolved",title:"Resolved",tickets:[{id:"ticket-4",customerName:"Daniel Garcia",issueSummary:"How to integrate the API with my Python application?",dateOpened:"2024-07-27T10:00:00Z",dateConnected:"2024-07-27T10:15:00Z",dateResolved:"2024-07-27T11:00:00Z",contactEmail:"daniel.g@example.com",contactPhone:"+1-212-555-0199",city:"New York",country:"USA",notes:"Sent the user our Python SDK documentation and a code example.",comments:"User confirmed the provided resources resolved their issue."}]}],getServiceBoardDataFromStorage=()=>{var j;try{const B=localStorage.getItem(SERVICE_BOARD_DATA_KEY);if(B){const q=JSON.parse(B);if(Array.isArray(q)&&((j=q[0])!=null&&j.tickets))return q}}catch(B){console.error("Failed to parse Service Board data from localStorage",B)}const U=JSON.parse(JSON.stringify(initialServiceBoardData));return localStorage.setItem(SERVICE_BOARD_DATA_KEY,JSON.stringify(U)),U},getServiceBoardData=()=>new Promise(U=>{setTimeout(()=>{U(getServiceBoardDataFromStorage())},1200)}),updateTicketColumn=(U,j)=>{const B=getServiceBoardDataFromStorage();let q,V;for(const H of B){const $=H.tickets.findIndex(K=>K.id===U);if($!==-1){q=H.tickets[$],V=H.id,H.tickets.splice($,1);break}}if(q&&V!==j){j==="connected"?q.dateConnected=new Date().toISOString():j==="resolved"&&(q.dateConnected||(q.dateConnected=new Date().toISOString()),q.dateResolved=new Date().toISOString());const H=B.find($=>$.id===j);H&&H.tickets.push(q)}return localStorage.setItem(SERVICE_BOARD_DATA_KEY,JSON.stringify(B)),B},updateServiceTicketDetails=U=>new Promise(j=>{setTimeout(()=>{const B=getServiceBoardDataFromStorage();let q=!1;for(const V of B){const H=V.tickets.findIndex($=>$.id===U.id);if(H!==-1){V.tickets[H]={...V.tickets[H],...U},q=!0;break}}q&&localStorage.setItem(SERVICE_BOARD_DATA_KEY,JSON.stringify(B)),j(B)},500)}),CrmNavbar=({activeTab:U,onTabChange:j})=>{const B=q=>`px-4 py-3 font-semibold text-sm transition-colors duration-200 ease-in-out ${U===q?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-800 border-b-2 border-transparent"}`;return jsxRuntimeExports.jsx("nav",{className:"flex-shrink-0 bg-white border-b border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"px-6 md:px-8 flex items-center justify-center space-x-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>j("chatbotData"),className:B("chatbotData"),children:"Chatbot Data"}),jsxRuntimeExports.jsx("button",{onClick:()=>j("manageLeads"),className:B("manageLeads"),children:"Manage Leads"}),jsxRuntimeExports.jsx("button",{onClick:()=>j("inboundService"),className:B("inboundService"),children:"Inbound Service"})]})})};function ok$1(){}function unreachable(){}function stringify$1(U,j){const B={};return(U[U.length-1]===""?[...U,""]:U).join((B.padRight?" ":"")+","+(B.padLeft===!1?"":" ")).trim()}const nameRe=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,nameReJsx=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,emptyOptions$2={};function name(U,j){return(emptyOptions$2.jsx?nameReJsx:nameRe).test(U)}const re=/[ \t\n\f\r]/g;function whitespace(U){return typeof U=="object"?U.type==="text"?empty$1(U.value):!1:empty$1(U)}function empty$1(U){return U.replace(re,"")===""}class Schema{constructor(j,B,q){this.normal=B,this.property=j,q&&(this.space=q)}}Schema.prototype.normal={};Schema.prototype.property={};Schema.prototype.space=void 0;function merge(U,j){const B={},q={};for(const V of U)Object.assign(B,V.property),Object.assign(q,V.normal);return new Schema(B,q,j)}function normalize$1(U){return U.toLowerCase()}class Info{constructor(j,B){this.attribute=B,this.property=j}}Info.prototype.attribute="";Info.prototype.booleanish=!1;Info.prototype.boolean=!1;Info.prototype.commaOrSpaceSeparated=!1;Info.prototype.commaSeparated=!1;Info.prototype.defined=!1;Info.prototype.mustUseProperty=!1;Info.prototype.number=!1;Info.prototype.overloadedBoolean=!1;Info.prototype.property="";Info.prototype.spaceSeparated=!1;Info.prototype.space=void 0;let powers=0;const boolean=increment(),booleanish=increment(),overloadedBoolean=increment(),number=increment(),spaceSeparated=increment(),commaSeparated=increment(),commaOrSpaceSeparated=increment();function increment(){return 2**++powers}const types$1=Object.freeze(Object.defineProperty({__proto__:null,boolean,booleanish,commaOrSpaceSeparated,commaSeparated,number,overloadedBoolean,spaceSeparated},Symbol.toStringTag,{value:"Module"})),checks=Object.keys(types$1);class DefinedInfo extends Info{constructor(j,B,q,V){let H=-1;if(super(j,B),mark(this,"space",V),typeof q=="number")for(;++H<checks.length;){const $=checks[H];mark(this,checks[H],(q&types$1[$])===types$1[$])}}}DefinedInfo.prototype.defined=!0;function mark(U,j,B){B&&(U[j]=B)}function create(U){const j={},B={};for(const[q,V]of Object.entries(U.properties)){const H=new DefinedInfo(q,U.transform(U.attributes||{},q),V,U.space);U.mustUseProperty&&U.mustUseProperty.includes(q)&&(H.mustUseProperty=!0),j[q]=H,B[normalize$1(q)]=q,B[normalize$1(H.attribute)]=q}return new Schema(j,B,U.space)}const aria=create({properties:{ariaActiveDescendant:null,ariaAtomic:booleanish,ariaAutoComplete:null,ariaBusy:booleanish,ariaChecked:booleanish,ariaColCount:number,ariaColIndex:number,ariaColSpan:number,ariaControls:spaceSeparated,ariaCurrent:null,ariaDescribedBy:spaceSeparated,ariaDetails:null,ariaDisabled:booleanish,ariaDropEffect:spaceSeparated,ariaErrorMessage:null,ariaExpanded:booleanish,ariaFlowTo:spaceSeparated,ariaGrabbed:booleanish,ariaHasPopup:null,ariaHidden:booleanish,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:spaceSeparated,ariaLevel:number,ariaLive:null,ariaModal:booleanish,ariaMultiLine:booleanish,ariaMultiSelectable:booleanish,ariaOrientation:null,ariaOwns:spaceSeparated,ariaPlaceholder:null,ariaPosInSet:number,ariaPressed:booleanish,ariaReadOnly:booleanish,ariaRelevant:null,ariaRequired:booleanish,ariaRoleDescription:spaceSeparated,ariaRowCount:number,ariaRowIndex:number,ariaRowSpan:number,ariaSelected:booleanish,ariaSetSize:number,ariaSort:null,ariaValueMax:number,ariaValueMin:number,ariaValueNow:number,ariaValueText:null,role:null},transform(U,j){return j==="role"?j:"aria-"+j.slice(4).toLowerCase()}});function caseSensitiveTransform(U,j){return j in U?U[j]:j}function caseInsensitiveTransform(U,j){return caseSensitiveTransform(U,j.toLowerCase())}const html$2=create({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:commaSeparated,acceptCharset:spaceSeparated,accessKey:spaceSeparated,action:null,allow:null,allowFullScreen:boolean,allowPaymentRequest:boolean,allowUserMedia:boolean,alt:null,as:null,async:boolean,autoCapitalize:null,autoComplete:spaceSeparated,autoFocus:boolean,autoPlay:boolean,blocking:spaceSeparated,capture:null,charSet:null,checked:boolean,cite:null,className:spaceSeparated,cols:number,colSpan:null,content:null,contentEditable:booleanish,controls:boolean,controlsList:spaceSeparated,coords:number|commaSeparated,crossOrigin:null,data:null,dateTime:null,decoding:null,default:boolean,defer:boolean,dir:null,dirName:null,disabled:boolean,download:overloadedBoolean,draggable:booleanish,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:boolean,formTarget:null,headers:spaceSeparated,height:number,hidden:overloadedBoolean,high:number,href:null,hrefLang:null,htmlFor:spaceSeparated,httpEquiv:spaceSeparated,id:null,imageSizes:null,imageSrcSet:null,inert:boolean,inputMode:null,integrity:null,is:null,isMap:boolean,itemId:null,itemProp:spaceSeparated,itemRef:spaceSeparated,itemScope:boolean,itemType:spaceSeparated,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:boolean,low:number,manifest:null,max:null,maxLength:number,media:null,method:null,min:null,minLength:number,multiple:boolean,muted:boolean,name:null,nonce:null,noModule:boolean,noValidate:boolean,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:boolean,optimum:number,pattern:null,ping:spaceSeparated,placeholder:null,playsInline:boolean,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:boolean,referrerPolicy:null,rel:spaceSeparated,required:boolean,reversed:boolean,rows:number,rowSpan:number,sandbox:spaceSeparated,scope:null,scoped:boolean,seamless:boolean,selected:boolean,shadowRootClonable:boolean,shadowRootDelegatesFocus:boolean,shadowRootMode:null,shape:null,size:number,sizes:null,slot:null,span:number,spellCheck:booleanish,src:null,srcDoc:null,srcLang:null,srcSet:null,start:number,step:null,style:null,tabIndex:number,target:null,title:null,translate:null,type:null,typeMustMatch:boolean,useMap:null,value:booleanish,width:number,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:spaceSeparated,axis:null,background:null,bgColor:null,border:number,borderColor:null,bottomMargin:number,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:boolean,declare:boolean,event:null,face:null,frame:null,frameBorder:null,hSpace:number,leftMargin:number,link:null,longDesc:null,lowSrc:null,marginHeight:number,marginWidth:number,noResize:boolean,noHref:boolean,noShade:boolean,noWrap:boolean,object:null,profile:null,prompt:null,rev:null,rightMargin:number,rules:null,scheme:null,scrolling:booleanish,standby:null,summary:null,text:null,topMargin:number,valueType:null,version:null,vAlign:null,vLink:null,vSpace:number,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:boolean,disableRemotePlayback:boolean,prefix:null,property:null,results:number,security:null,unselectable:null},space:"html",transform:caseInsensitiveTransform}),svg$1=create({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:commaOrSpaceSeparated,accentHeight:number,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:number,amplitude:number,arabicForm:null,ascent:number,attributeName:null,attributeType:null,azimuth:number,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:number,by:null,calcMode:null,capHeight:number,className:spaceSeparated,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:number,diffuseConstant:number,direction:null,display:null,dur:null,divisor:number,dominantBaseline:null,download:boolean,dx:null,dy:null,edgeMode:null,editable:null,elevation:number,enableBackground:null,end:null,event:null,exponent:number,externalResourcesRequired:null,fill:null,fillOpacity:number,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:commaSeparated,g2:commaSeparated,glyphName:commaSeparated,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:number,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:number,horizOriginX:number,horizOriginY:number,id:null,ideographic:number,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:number,k:number,k1:number,k2:number,k3:number,k4:number,kernelMatrix:commaOrSpaceSeparated,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:number,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:number,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:number,overlineThickness:number,paintOrder:null,panose1:null,path:null,pathLength:number,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:spaceSeparated,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:number,pointsAtY:number,pointsAtZ:number,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:commaOrSpaceSeparated,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:commaOrSpaceSeparated,rev:commaOrSpaceSeparated,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:commaOrSpaceSeparated,requiredFeatures:commaOrSpaceSeparated,requiredFonts:commaOrSpaceSeparated,requiredFormats:commaOrSpaceSeparated,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:number,specularExponent:number,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:number,strikethroughThickness:number,string:null,stroke:null,strokeDashArray:commaOrSpaceSeparated,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:number,strokeOpacity:number,strokeWidth:null,style:null,surfaceScale:number,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:commaOrSpaceSeparated,tabIndex:number,tableValues:null,target:null,targetX:number,targetY:number,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:commaOrSpaceSeparated,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:number,underlineThickness:number,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:number,values:null,vAlphabetic:number,vMathematical:number,vectorEffect:null,vHanging:number,vIdeographic:number,version:null,vertAdvY:number,vertOriginX:number,vertOriginY:number,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:number,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:caseSensitiveTransform}),xlink=create({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(U,j){return"xlink:"+j.slice(5).toLowerCase()}}),xmlns=create({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:caseInsensitiveTransform}),xml=create({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(U,j){return"xml:"+j.slice(3).toLowerCase()}}),hastToReact={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},cap$1=/[A-Z]/g,dash=/-[a-z]/g,valid=/^data[-\w.:]+$/i;function find(U,j){const B=normalize$1(j);let q=j,V=Info;if(B in U.normal)return U.property[U.normal[B]];if(B.length>4&&B.slice(0,4)==="data"&&valid.test(j)){if(j.charAt(4)==="-"){const H=j.slice(5).replace(dash,camelcase);q="data"+H.charAt(0).toUpperCase()+H.slice(1)}else{const H=j.slice(4);if(!dash.test(H)){let $=H.replace(cap$1,kebab);$.charAt(0)!=="-"&&($="-"+$),j="data"+$}}V=DefinedInfo}return new V(q,j)}function kebab(U){return"-"+U.toLowerCase()}function camelcase(U){return U.charAt(1).toUpperCase()}const html$1=merge([aria,html$2,xlink,xmlns,xml],"html"),svg=merge([aria,svg$1,xlink,xmlns,xml],"svg");function stringify(U){return U.join(" ").trim()}var cjs$1={},inlineStyleParser,hasRequiredInlineStyleParser;function requireInlineStyleParser(){if(hasRequiredInlineStyleParser)return inlineStyleParser;hasRequiredInlineStyleParser=1;var U=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,j=/\n/g,B=/^\s*/,q=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,V=/^:\s*/,H=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,$=/^[;\s]*/,K=/^\s+|\s+$/g,X=`
`,Q="/",W="*",Z="",te="comment",ie="declaration";inlineStyleParser=function(oe,de){if(typeof oe!="string")throw new TypeError("First argument must be a string");if(!oe)return[];de=de||{};var le=1,ue=1;function he(Ge){var De=Ge.match(j);De&&(le+=De.length);var Ve=Ge.lastIndexOf(X);ue=~Ve?Ge.length-Ve:ue+Ge.length}function me(){var Ge={line:le,column:ue};return function(De){return De.position=new be(Ge),Fe(),De}}function be(Ge){this.start=Ge,this.end={line:le,column:ue},this.source=de.source}be.prototype.content=oe;function ge(Ge){var De=new Error(de.source+":"+le+":"+ue+": "+Ge);if(De.reason=Ge,De.filename=de.source,De.line=le,De.column=ue,De.source=oe,!de.silent)throw De}function Ee(Ge){var De=Ge.exec(oe);if(De){var Ve=De[0];return he(Ve),oe=oe.slice(Ve.length),De}}function Fe(){Ee(B)}function Ue(Ge){var De;for(Ge=Ge||[];De=ze();)De!==!1&&Ge.push(De);return Ge}function ze(){var Ge=me();if(!(Q!=oe.charAt(0)||W!=oe.charAt(1))){for(var De=2;Z!=oe.charAt(De)&&(W!=oe.charAt(De)||Q!=oe.charAt(De+1));)++De;if(De+=2,Z===oe.charAt(De-1))return ge("End of comment missing");var Ve=oe.slice(2,De-2);return ue+=2,he(Ve),oe=oe.slice(De),ue+=2,Ge({type:te,comment:Ve})}}function xe(){var Ge=me(),De=Ee(q);if(De){if(ze(),!Ee(V))return ge("property missing ':'");var Ve=Ee(H),Se=Ge({type:ie,property:ae(De[0].replace(U,Z)),value:Ve?ae(Ve[0].replace(U,Z)):Z});return Ee($),Se}}function Ie(){var Ge=[];Ue(Ge);for(var De;De=xe();)De!==!1&&(Ge.push(De),Ue(Ge));return Ge}return Fe(),Ie()};function ae(oe){return oe?oe.replace(K,Z):Z}return inlineStyleParser}var hasRequiredCjs$1;function requireCjs$1(){if(hasRequiredCjs$1)return cjs$1;hasRequiredCjs$1=1;var U=cjs$1&&cjs$1.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(cjs$1,"__esModule",{value:!0}),cjs$1.default=B;const j=U(requireInlineStyleParser());function B(q,V){let H=null;if(!q||typeof q!="string")return H;const $=(0,j.default)(q),K=typeof V=="function";return $.forEach(X=>{if(X.type!=="declaration")return;const{property:Q,value:W}=X;K?V(Q,W,X):W&&(H=H||{},H[Q]=W)}),H}return cjs$1}var utilities={},hasRequiredUtilities;function requireUtilities(){if(hasRequiredUtilities)return utilities;hasRequiredUtilities=1,Object.defineProperty(utilities,"__esModule",{value:!0}),utilities.camelCase=void 0;var U=/^--[a-zA-Z0-9_-]+$/,j=/-([a-z])/g,B=/^[^-]+$/,q=/^-(webkit|moz|ms|o|khtml)-/,V=/^-(ms)-/,H=function(Q){return!Q||B.test(Q)||U.test(Q)},$=function(Q,W){return W.toUpperCase()},K=function(Q,W){return"".concat(W,"-")},X=function(Q,W){return W===void 0&&(W={}),H(Q)?Q:(Q=Q.toLowerCase(),W.reactCompat?Q=Q.replace(V,K):Q=Q.replace(q,K),Q.replace(j,$))};return utilities.camelCase=X,utilities}var cjs,hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs;hasRequiredCjs=1;var U=cjs&&cjs.__importDefault||function(V){return V&&V.__esModule?V:{default:V}},j=U(requireCjs$1()),B=requireUtilities();function q(V,H){var $={};return!V||typeof V!="string"||(0,j.default)(V,function(K,X){K&&X&&($[(0,B.camelCase)(K,H)]=X)}),$}return q.default=q,cjs=q,cjs}var cjsExports=requireCjs();const styleToJs=getDefaultExportFromCjs$1(cjsExports),pointEnd=point$2("end"),pointStart=point$2("start");function point$2(U){return j;function j(B){const q=B&&B.position&&B.position[U]||{};if(typeof q.line=="number"&&q.line>0&&typeof q.column=="number"&&q.column>0)return{line:q.line,column:q.column,offset:typeof q.offset=="number"&&q.offset>-1?q.offset:void 0}}}function position$1(U){const j=pointStart(U),B=pointEnd(U);if(j&&B)return{start:j,end:B}}function stringifyPosition(U){return!U||typeof U!="object"?"":"position"in U||"type"in U?position(U.position):"start"in U||"end"in U?position(U):"line"in U||"column"in U?point$1(U):""}function point$1(U){return index(U&&U.line)+":"+index(U&&U.column)}function position(U){return point$1(U&&U.start)+"-"+point$1(U&&U.end)}function index(U){return U&&typeof U=="number"?U:1}class VFileMessage extends Error{constructor(j,B,q){super(),typeof B=="string"&&(q=B,B=void 0);let V="",H={},$=!1;if(B&&("line"in B&&"column"in B?H={place:B}:"start"in B&&"end"in B?H={place:B}:"type"in B?H={ancestors:[B],place:B.position}:H={...B}),typeof j=="string"?V=j:!H.cause&&j&&($=!0,V=j.message,H.cause=j),!H.ruleId&&!H.source&&typeof q=="string"){const X=q.indexOf(":");X===-1?H.ruleId=q:(H.source=q.slice(0,X),H.ruleId=q.slice(X+1))}if(!H.place&&H.ancestors&&H.ancestors){const X=H.ancestors[H.ancestors.length-1];X&&(H.place=X.position)}const K=H.place&&"start"in H.place?H.place.start:H.place;this.ancestors=H.ancestors||void 0,this.cause=H.cause||void 0,this.column=K?K.column:void 0,this.fatal=void 0,this.file="",this.message=V,this.line=K?K.line:void 0,this.name=stringifyPosition(H.place)||"1:1",this.place=H.place||void 0,this.reason=this.message,this.ruleId=H.ruleId||void 0,this.source=H.source||void 0,this.stack=$&&H.cause&&typeof H.cause.stack=="string"?H.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}VFileMessage.prototype.file="";VFileMessage.prototype.name="";VFileMessage.prototype.reason="";VFileMessage.prototype.message="";VFileMessage.prototype.stack="";VFileMessage.prototype.column=void 0;VFileMessage.prototype.line=void 0;VFileMessage.prototype.ancestors=void 0;VFileMessage.prototype.cause=void 0;VFileMessage.prototype.fatal=void 0;VFileMessage.prototype.place=void 0;VFileMessage.prototype.ruleId=void 0;VFileMessage.prototype.source=void 0;const own$3={}.hasOwnProperty,emptyMap=new Map,cap=/[A-Z]/g,tableElements=new Set(["table","tbody","thead","tfoot","tr"]),tableCellElement=new Set(["td","th"]),docs="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function toJsxRuntime(U,j){if(!j||j.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const B=j.filePath||void 0;let q;if(j.development){if(typeof j.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");q=developmentCreate(B,j.jsxDEV)}else{if(typeof j.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof j.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");q=productionCreate(B,j.jsx,j.jsxs)}const V={Fragment:j.Fragment,ancestors:[],components:j.components||{},create:q,elementAttributeNameCase:j.elementAttributeNameCase||"react",evaluater:j.createEvaluater?j.createEvaluater():void 0,filePath:B,ignoreInvalidStyle:j.ignoreInvalidStyle||!1,passKeys:j.passKeys!==!1,passNode:j.passNode||!1,schema:j.space==="svg"?svg:html$1,stylePropertyNameCase:j.stylePropertyNameCase||"dom",tableCellAlignToStyle:j.tableCellAlignToStyle!==!1},H=one$1(V,U,void 0);return H&&typeof H!="string"?H:V.create(U,V.Fragment,{children:H||void 0},void 0)}function one$1(U,j,B){if(j.type==="element")return element$1(U,j,B);if(j.type==="mdxFlowExpression"||j.type==="mdxTextExpression")return mdxExpression(U,j);if(j.type==="mdxJsxFlowElement"||j.type==="mdxJsxTextElement")return mdxJsxElement(U,j,B);if(j.type==="mdxjsEsm")return mdxEsm(U,j);if(j.type==="root")return root$3(U,j,B);if(j.type==="text")return text$3(U,j)}function element$1(U,j,B){const q=U.schema;let V=q;j.tagName.toLowerCase()==="svg"&&q.space==="html"&&(V=svg,U.schema=V),U.ancestors.push(j);const H=findComponentFromName(U,j.tagName,!1),$=createElementProps(U,j);let K=createChildren(U,j);return tableElements.has(j.tagName)&&(K=K.filter(function(X){return typeof X=="string"?!whitespace(X):!0})),addNode(U,$,H,j),addChildren($,K),U.ancestors.pop(),U.schema=q,U.create(j,H,$,B)}function mdxExpression(U,j){if(j.data&&j.data.estree&&U.evaluater){const q=j.data.estree.body[0];return q.type,U.evaluater.evaluateExpression(q.expression)}crashEstree(U,j.position)}function mdxEsm(U,j){if(j.data&&j.data.estree&&U.evaluater)return U.evaluater.evaluateProgram(j.data.estree);crashEstree(U,j.position)}function mdxJsxElement(U,j,B){const q=U.schema;let V=q;j.name==="svg"&&q.space==="html"&&(V=svg,U.schema=V),U.ancestors.push(j);const H=j.name===null?U.Fragment:findComponentFromName(U,j.name,!0),$=createJsxElementProps(U,j),K=createChildren(U,j);return addNode(U,$,H,j),addChildren($,K),U.ancestors.pop(),U.schema=q,U.create(j,H,$,B)}function root$3(U,j,B){const q={};return addChildren(q,createChildren(U,j)),U.create(j,U.Fragment,q,B)}function text$3(U,j){return j.value}function addNode(U,j,B,q){typeof B!="string"&&B!==U.Fragment&&U.passNode&&(j.node=q)}function addChildren(U,j){if(j.length>0){const B=j.length>1?j:j[0];B&&(U.children=B)}}function productionCreate(U,j,B){return q;function q(V,H,$,K){const Q=Array.isArray($.children)?B:j;return K?Q(H,$,K):Q(H,$)}}function developmentCreate(U,j){return B;function B(q,V,H,$){const K=Array.isArray(H.children),X=pointStart(q);return j(V,H,$,K,{columnNumber:X?X.column-1:void 0,fileName:U,lineNumber:X?X.line:void 0},void 0)}}function createElementProps(U,j){const B={};let q,V;for(V in j.properties)if(V!=="children"&&own$3.call(j.properties,V)){const H=createProperty(U,V,j.properties[V]);if(H){const[$,K]=H;U.tableCellAlignToStyle&&$==="align"&&typeof K=="string"&&tableCellElement.has(j.tagName)?q=K:B[$]=K}}if(q){const H=B.style||(B.style={});H[U.stylePropertyNameCase==="css"?"text-align":"textAlign"]=q}return B}function createJsxElementProps(U,j){const B={};for(const q of j.attributes)if(q.type==="mdxJsxExpressionAttribute")if(q.data&&q.data.estree&&U.evaluater){const H=q.data.estree.body[0];H.type;const $=H.expression;$.type;const K=$.properties[0];K.type,Object.assign(B,U.evaluater.evaluateExpression(K.argument))}else crashEstree(U,j.position);else{const V=q.name;let H;if(q.value&&typeof q.value=="object")if(q.value.data&&q.value.data.estree&&U.evaluater){const K=q.value.data.estree.body[0];K.type,H=U.evaluater.evaluateExpression(K.expression)}else crashEstree(U,j.position);else H=q.value===null?!0:q.value;B[V]=H}return B}function createChildren(U,j){const B=[];let q=-1;const V=U.passKeys?new Map:emptyMap;for(;++q<j.children.length;){const H=j.children[q];let $;if(U.passKeys){const X=H.type==="element"?H.tagName:H.type==="mdxJsxFlowElement"||H.type==="mdxJsxTextElement"?H.name:void 0;if(X){const Q=V.get(X)||0;$=X+"-"+Q,V.set(X,Q+1)}}const K=one$1(U,H,$);K!==void 0&&B.push(K)}return B}function createProperty(U,j,B){const q=find(U.schema,j);if(!(B==null||typeof B=="number"&&Number.isNaN(B))){if(Array.isArray(B)&&(B=q.commaSeparated?stringify$1(B):stringify(B)),q.property==="style"){let V=typeof B=="object"?B:parseStyle(U,String(B));return U.stylePropertyNameCase==="css"&&(V=transformStylesToCssCasing(V)),["style",V]}return[U.elementAttributeNameCase==="react"&&q.space?hastToReact[q.property]||q.property:q.attribute,B]}}function parseStyle(U,j){try{return styleToJs(j,{reactCompat:!0})}catch(B){if(U.ignoreInvalidStyle)return{};const q=B,V=new VFileMessage("Cannot parse `style` attribute",{ancestors:U.ancestors,cause:q,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw V.file=U.filePath||void 0,V.url=docs+"#cannot-parse-style-attribute",V}}function findComponentFromName(U,j,B){let q;if(!B)q={type:"Literal",value:j};else if(j.includes(".")){const V=j.split(".");let H=-1,$;for(;++H<V.length;){const K=name(V[H])?{type:"Identifier",name:V[H]}:{type:"Literal",value:V[H]};$=$?{type:"MemberExpression",object:$,property:K,computed:!!(H&&K.type==="Literal"),optional:!1}:K}q=$}else q=name(j)&&!/^[a-z]/.test(j)?{type:"Identifier",name:j}:{type:"Literal",value:j};if(q.type==="Literal"){const V=q.value;return own$3.call(U.components,V)?U.components[V]:V}if(U.evaluater)return U.evaluater.evaluateExpression(q);crashEstree(U)}function crashEstree(U,j){const B=new VFileMessage("Cannot handle MDX estrees without `createEvaluater`",{ancestors:U.ancestors,place:j,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw B.file=U.filePath||void 0,B.url=docs+"#cannot-handle-mdx-estrees-without-createevaluater",B}function transformStylesToCssCasing(U){const j={};let B;for(B in U)own$3.call(U,B)&&(j[transformStyleToCssCasing(B)]=U[B]);return j}function transformStyleToCssCasing(U){let j=U.replace(cap,toDash);return j.slice(0,3)==="ms-"&&(j="-"+j),j}function toDash(U){return"-"+U.toLowerCase()}const urlAttributes={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},emptyOptions$1={};function toString$1(U,j){const B=emptyOptions$1,q=typeof B.includeImageAlt=="boolean"?B.includeImageAlt:!0,V=typeof B.includeHtml=="boolean"?B.includeHtml:!0;return one(U,q,V)}function one(U,j,B){if(node(U)){if("value"in U)return U.type==="html"&&!B?"":U.value;if(j&&"alt"in U&&U.alt)return U.alt;if("children"in U)return all(U.children,j,B)}return Array.isArray(U)?all(U,j,B):""}function all(U,j,B){const q=[];let V=-1;for(;++V<U.length;)q[V]=one(U[V],j,B);return q.join("")}function node(U){return!!(U&&typeof U=="object")}const element=document.createElement("i");function decodeNamedCharacterReference(U){const j="&"+U+";";element.innerHTML=j;const B=element.textContent;return B.charCodeAt(B.length-1)===59&&U!=="semi"||B===j?!1:B}function splice(U,j,B,q){const V=U.length;let H=0,$;if(j<0?j=-j>V?0:V+j:j=j>V?V:j,B=B>0?B:0,q.length<1e4)$=Array.from(q),$.unshift(j,B),U.splice(...$);else for(B&&U.splice(j,B);H<q.length;)$=q.slice(H,H+1e4),$.unshift(j,0),U.splice(...$),H+=1e4,j+=1e4}function push(U,j){return U.length>0?(splice(U,U.length,0,j),U):j}const hasOwnProperty={}.hasOwnProperty;function combineExtensions(U){const j={};let B=-1;for(;++B<U.length;)syntaxExtension(j,U[B]);return j}function syntaxExtension(U,j){let B;for(B in j){const V=(hasOwnProperty.call(U,B)?U[B]:void 0)||(U[B]={}),H=j[B];let $;if(H)for($ in H){hasOwnProperty.call(V,$)||(V[$]=[]);const K=H[$];constructs(V[$],Array.isArray(K)?K:K?[K]:[])}}}function constructs(U,j){let B=-1;const q=[];for(;++B<j.length;)(j[B].add==="after"?U:q).push(j[B]);splice(U,0,0,q)}function decodeNumericCharacterReference(U,j){const B=Number.parseInt(U,j);return B<9||B===11||B>13&&B<32||B>126&&B<160||B>55295&&B<57344||B>64975&&B<65008||(B&65535)===65535||(B&65535)===65534||B>1114111?"":String.fromCodePoint(B)}function normalizeIdentifier(U){return U.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const asciiAlpha=regexCheck(/[A-Za-z]/),asciiAlphanumeric=regexCheck(/[\dA-Za-z]/),asciiAtext=regexCheck(/[#-'*+\--9=?A-Z^-~]/);function asciiControl(U){return U!==null&&(U<32||U===127)}const asciiDigit=regexCheck(/\d/),asciiHexDigit=regexCheck(/[\dA-Fa-f]/),asciiPunctuation=regexCheck(/[!-/:-@[-`{-~]/);function markdownLineEnding(U){return U!==null&&U<-2}function markdownLineEndingOrSpace(U){return U!==null&&(U<0||U===32)}function markdownSpace(U){return U===-2||U===-1||U===32}const unicodePunctuation=regexCheck(new RegExp("\\p{P}|\\p{S}","u")),unicodeWhitespace=regexCheck(/\s/);function regexCheck(U){return j;function j(B){return B!==null&&B>-1&&U.test(String.fromCharCode(B))}}function normalizeUri(U){const j=[];let B=-1,q=0,V=0;for(;++B<U.length;){const H=U.charCodeAt(B);let $="";if(H===37&&asciiAlphanumeric(U.charCodeAt(B+1))&&asciiAlphanumeric(U.charCodeAt(B+2)))V=2;else if(H<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(H))||($=String.fromCharCode(H));else if(H>55295&&H<57344){const K=U.charCodeAt(B+1);H<56320&&K>56319&&K<57344?($=String.fromCharCode(H,K),V=1):$=""}else $=String.fromCharCode(H);$&&(j.push(U.slice(q,B),encodeURIComponent($)),q=B+V+1,$=""),V&&(B+=V,V=0)}return j.join("")+U.slice(q)}function factorySpace(U,j,B,q){const V=q?q-1:Number.POSITIVE_INFINITY;let H=0;return $;function $(X){return markdownSpace(X)?(U.enter(B),K(X)):j(X)}function K(X){return markdownSpace(X)&&H++<V?(U.consume(X),K):(U.exit(B),j(X))}}const content$1={tokenize:initializeContent};function initializeContent(U){const j=U.attempt(this.parser.constructs.contentInitial,q,V);let B;return j;function q(K){if(K===null){U.consume(K);return}return U.enter("lineEnding"),U.consume(K),U.exit("lineEnding"),factorySpace(U,j,"linePrefix")}function V(K){return U.enter("paragraph"),H(K)}function H(K){const X=U.enter("chunkText",{contentType:"text",previous:B});return B&&(B.next=X),B=X,$(K)}function $(K){if(K===null){U.exit("chunkText"),U.exit("paragraph"),U.consume(K);return}return markdownLineEnding(K)?(U.consume(K),U.exit("chunkText"),H):(U.consume(K),$)}}const document$2={tokenize:initializeDocument},containerConstruct={tokenize:tokenizeContainer};function initializeDocument(U){const j=this,B=[];let q=0,V,H,$;return K;function K(he){if(q<B.length){const me=B[q];return j.containerState=me[1],U.attempt(me[0].continuation,X,Q)(he)}return Q(he)}function X(he){if(q++,j.containerState._closeFlow){j.containerState._closeFlow=void 0,V&&ue();const me=j.events.length;let be=me,ge;for(;be--;)if(j.events[be][0]==="exit"&&j.events[be][1].type==="chunkFlow"){ge=j.events[be][1].end;break}le(q);let Ee=me;for(;Ee<j.events.length;)j.events[Ee][1].end={...ge},Ee++;return splice(j.events,be+1,0,j.events.slice(me)),j.events.length=Ee,Q(he)}return K(he)}function Q(he){if(q===B.length){if(!V)return te(he);if(V.currentConstruct&&V.currentConstruct.concrete)return ae(he);j.interrupt=!!(V.currentConstruct&&!V._gfmTableDynamicInterruptHack)}return j.containerState={},U.check(containerConstruct,W,Z)(he)}function W(he){return V&&ue(),le(q),te(he)}function Z(he){return j.parser.lazy[j.now().line]=q!==B.length,$=j.now().offset,ae(he)}function te(he){return j.containerState={},U.attempt(containerConstruct,ie,ae)(he)}function ie(he){return q++,B.push([j.currentConstruct,j.containerState]),te(he)}function ae(he){if(he===null){V&&ue(),le(0),U.consume(he);return}return V=V||j.parser.flow(j.now()),U.enter("chunkFlow",{_tokenizer:V,contentType:"flow",previous:H}),oe(he)}function oe(he){if(he===null){de(U.exit("chunkFlow"),!0),le(0),U.consume(he);return}return markdownLineEnding(he)?(U.consume(he),de(U.exit("chunkFlow")),q=0,j.interrupt=void 0,K):(U.consume(he),oe)}function de(he,me){const be=j.sliceStream(he);if(me&&be.push(null),he.previous=H,H&&(H.next=he),H=he,V.defineSkip(he.start),V.write(be),j.parser.lazy[he.start.line]){let ge=V.events.length;for(;ge--;)if(V.events[ge][1].start.offset<$&&(!V.events[ge][1].end||V.events[ge][1].end.offset>$))return;const Ee=j.events.length;let Fe=Ee,Ue,ze;for(;Fe--;)if(j.events[Fe][0]==="exit"&&j.events[Fe][1].type==="chunkFlow"){if(Ue){ze=j.events[Fe][1].end;break}Ue=!0}for(le(q),ge=Ee;ge<j.events.length;)j.events[ge][1].end={...ze},ge++;splice(j.events,Fe+1,0,j.events.slice(Ee)),j.events.length=ge}}function le(he){let me=B.length;for(;me-- >he;){const be=B[me];j.containerState=be[1],be[0].exit.call(j,U)}B.length=he}function ue(){V.write([null]),H=void 0,V=void 0,j.containerState._closeFlow=void 0}}function tokenizeContainer(U,j,B){return factorySpace(U,U.attempt(this.parser.constructs.document,j,B),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function classifyCharacter(U){if(U===null||markdownLineEndingOrSpace(U)||unicodeWhitespace(U))return 1;if(unicodePunctuation(U))return 2}function resolveAll(U,j,B){const q=[];let V=-1;for(;++V<U.length;){const H=U[V].resolveAll;H&&!q.includes(H)&&(j=H(j,B),q.push(H))}return j}const attention={name:"attention",resolveAll:resolveAllAttention,tokenize:tokenizeAttention};function resolveAllAttention(U,j){let B=-1,q,V,H,$,K,X,Q,W;for(;++B<U.length;)if(U[B][0]==="enter"&&U[B][1].type==="attentionSequence"&&U[B][1]._close){for(q=B;q--;)if(U[q][0]==="exit"&&U[q][1].type==="attentionSequence"&&U[q][1]._open&&j.sliceSerialize(U[q][1]).charCodeAt(0)===j.sliceSerialize(U[B][1]).charCodeAt(0)){if((U[q][1]._close||U[B][1]._open)&&(U[B][1].end.offset-U[B][1].start.offset)%3&&!((U[q][1].end.offset-U[q][1].start.offset+U[B][1].end.offset-U[B][1].start.offset)%3))continue;X=U[q][1].end.offset-U[q][1].start.offset>1&&U[B][1].end.offset-U[B][1].start.offset>1?2:1;const Z={...U[q][1].end},te={...U[B][1].start};movePoint(Z,-X),movePoint(te,X),$={type:X>1?"strongSequence":"emphasisSequence",start:Z,end:{...U[q][1].end}},K={type:X>1?"strongSequence":"emphasisSequence",start:{...U[B][1].start},end:te},H={type:X>1?"strongText":"emphasisText",start:{...U[q][1].end},end:{...U[B][1].start}},V={type:X>1?"strong":"emphasis",start:{...$.start},end:{...K.end}},U[q][1].end={...$.start},U[B][1].start={...K.end},Q=[],U[q][1].end.offset-U[q][1].start.offset&&(Q=push(Q,[["enter",U[q][1],j],["exit",U[q][1],j]])),Q=push(Q,[["enter",V,j],["enter",$,j],["exit",$,j],["enter",H,j]]),Q=push(Q,resolveAll(j.parser.constructs.insideSpan.null,U.slice(q+1,B),j)),Q=push(Q,[["exit",H,j],["enter",K,j],["exit",K,j],["exit",V,j]]),U[B][1].end.offset-U[B][1].start.offset?(W=2,Q=push(Q,[["enter",U[B][1],j],["exit",U[B][1],j]])):W=0,splice(U,q-1,B-q+3,Q),B=q+Q.length-W-2;break}}for(B=-1;++B<U.length;)U[B][1].type==="attentionSequence"&&(U[B][1].type="data");return U}function tokenizeAttention(U,j){const B=this.parser.constructs.attentionMarkers.null,q=this.previous,V=classifyCharacter(q);let H;return $;function $(X){return H=X,U.enter("attentionSequence"),K(X)}function K(X){if(X===H)return U.consume(X),K;const Q=U.exit("attentionSequence"),W=classifyCharacter(X),Z=!W||W===2&&V||B.includes(X),te=!V||V===2&&W||B.includes(q);return Q._open=!!(H===42?Z:Z&&(V||!te)),Q._close=!!(H===42?te:te&&(W||!Z)),j(X)}}function movePoint(U,j){U.column+=j,U.offset+=j,U._bufferIndex+=j}const autolink={name:"autolink",tokenize:tokenizeAutolink};function tokenizeAutolink(U,j,B){let q=0;return V;function V(ie){return U.enter("autolink"),U.enter("autolinkMarker"),U.consume(ie),U.exit("autolinkMarker"),U.enter("autolinkProtocol"),H}function H(ie){return asciiAlpha(ie)?(U.consume(ie),$):ie===64?B(ie):Q(ie)}function $(ie){return ie===43||ie===45||ie===46||asciiAlphanumeric(ie)?(q=1,K(ie)):Q(ie)}function K(ie){return ie===58?(U.consume(ie),q=0,X):(ie===43||ie===45||ie===46||asciiAlphanumeric(ie))&&q++<32?(U.consume(ie),K):(q=0,Q(ie))}function X(ie){return ie===62?(U.exit("autolinkProtocol"),U.enter("autolinkMarker"),U.consume(ie),U.exit("autolinkMarker"),U.exit("autolink"),j):ie===null||ie===32||ie===60||asciiControl(ie)?B(ie):(U.consume(ie),X)}function Q(ie){return ie===64?(U.consume(ie),W):asciiAtext(ie)?(U.consume(ie),Q):B(ie)}function W(ie){return asciiAlphanumeric(ie)?Z(ie):B(ie)}function Z(ie){return ie===46?(U.consume(ie),q=0,W):ie===62?(U.exit("autolinkProtocol").type="autolinkEmail",U.enter("autolinkMarker"),U.consume(ie),U.exit("autolinkMarker"),U.exit("autolink"),j):te(ie)}function te(ie){if((ie===45||asciiAlphanumeric(ie))&&q++<63){const ae=ie===45?te:Z;return U.consume(ie),ae}return B(ie)}}const blankLine={partial:!0,tokenize:tokenizeBlankLine};function tokenizeBlankLine(U,j,B){return q;function q(H){return markdownSpace(H)?factorySpace(U,V,"linePrefix")(H):V(H)}function V(H){return H===null||markdownLineEnding(H)?j(H):B(H)}}const blockQuote={continuation:{tokenize:tokenizeBlockQuoteContinuation},exit,name:"blockQuote",tokenize:tokenizeBlockQuoteStart};function tokenizeBlockQuoteStart(U,j,B){const q=this;return V;function V($){if($===62){const K=q.containerState;return K.open||(U.enter("blockQuote",{_container:!0}),K.open=!0),U.enter("blockQuotePrefix"),U.enter("blockQuoteMarker"),U.consume($),U.exit("blockQuoteMarker"),H}return B($)}function H($){return markdownSpace($)?(U.enter("blockQuotePrefixWhitespace"),U.consume($),U.exit("blockQuotePrefixWhitespace"),U.exit("blockQuotePrefix"),j):(U.exit("blockQuotePrefix"),j($))}}function tokenizeBlockQuoteContinuation(U,j,B){const q=this;return V;function V($){return markdownSpace($)?factorySpace(U,H,"linePrefix",q.parser.constructs.disable.null.includes("codeIndented")?void 0:4)($):H($)}function H($){return U.attempt(blockQuote,j,B)($)}}function exit(U){U.exit("blockQuote")}const characterEscape={name:"characterEscape",tokenize:tokenizeCharacterEscape};function tokenizeCharacterEscape(U,j,B){return q;function q(H){return U.enter("characterEscape"),U.enter("escapeMarker"),U.consume(H),U.exit("escapeMarker"),V}function V(H){return asciiPunctuation(H)?(U.enter("characterEscapeValue"),U.consume(H),U.exit("characterEscapeValue"),U.exit("characterEscape"),j):B(H)}}const characterReference={name:"characterReference",tokenize:tokenizeCharacterReference};function tokenizeCharacterReference(U,j,B){const q=this;let V=0,H,$;return K;function K(Z){return U.enter("characterReference"),U.enter("characterReferenceMarker"),U.consume(Z),U.exit("characterReferenceMarker"),X}function X(Z){return Z===35?(U.enter("characterReferenceMarkerNumeric"),U.consume(Z),U.exit("characterReferenceMarkerNumeric"),Q):(U.enter("characterReferenceValue"),H=31,$=asciiAlphanumeric,W(Z))}function Q(Z){return Z===88||Z===120?(U.enter("characterReferenceMarkerHexadecimal"),U.consume(Z),U.exit("characterReferenceMarkerHexadecimal"),U.enter("characterReferenceValue"),H=6,$=asciiHexDigit,W):(U.enter("characterReferenceValue"),H=7,$=asciiDigit,W(Z))}function W(Z){if(Z===59&&V){const te=U.exit("characterReferenceValue");return $===asciiAlphanumeric&&!decodeNamedCharacterReference(q.sliceSerialize(te))?B(Z):(U.enter("characterReferenceMarker"),U.consume(Z),U.exit("characterReferenceMarker"),U.exit("characterReference"),j)}return $(Z)&&V++<H?(U.consume(Z),W):B(Z)}}const nonLazyContinuation={partial:!0,tokenize:tokenizeNonLazyContinuation},codeFenced={concrete:!0,name:"codeFenced",tokenize:tokenizeCodeFenced};function tokenizeCodeFenced(U,j,B){const q=this,V={partial:!0,tokenize:be};let H=0,$=0,K;return X;function X(ge){return Q(ge)}function Q(ge){const Ee=q.events[q.events.length-1];return H=Ee&&Ee[1].type==="linePrefix"?Ee[2].sliceSerialize(Ee[1],!0).length:0,K=ge,U.enter("codeFenced"),U.enter("codeFencedFence"),U.enter("codeFencedFenceSequence"),W(ge)}function W(ge){return ge===K?($++,U.consume(ge),W):$<3?B(ge):(U.exit("codeFencedFenceSequence"),markdownSpace(ge)?factorySpace(U,Z,"whitespace")(ge):Z(ge))}function Z(ge){return ge===null||markdownLineEnding(ge)?(U.exit("codeFencedFence"),q.interrupt?j(ge):U.check(nonLazyContinuation,oe,me)(ge)):(U.enter("codeFencedFenceInfo"),U.enter("chunkString",{contentType:"string"}),te(ge))}function te(ge){return ge===null||markdownLineEnding(ge)?(U.exit("chunkString"),U.exit("codeFencedFenceInfo"),Z(ge)):markdownSpace(ge)?(U.exit("chunkString"),U.exit("codeFencedFenceInfo"),factorySpace(U,ie,"whitespace")(ge)):ge===96&&ge===K?B(ge):(U.consume(ge),te)}function ie(ge){return ge===null||markdownLineEnding(ge)?Z(ge):(U.enter("codeFencedFenceMeta"),U.enter("chunkString",{contentType:"string"}),ae(ge))}function ae(ge){return ge===null||markdownLineEnding(ge)?(U.exit("chunkString"),U.exit("codeFencedFenceMeta"),Z(ge)):ge===96&&ge===K?B(ge):(U.consume(ge),ae)}function oe(ge){return U.attempt(V,me,de)(ge)}function de(ge){return U.enter("lineEnding"),U.consume(ge),U.exit("lineEnding"),le}function le(ge){return H>0&&markdownSpace(ge)?factorySpace(U,ue,"linePrefix",H+1)(ge):ue(ge)}function ue(ge){return ge===null||markdownLineEnding(ge)?U.check(nonLazyContinuation,oe,me)(ge):(U.enter("codeFlowValue"),he(ge))}function he(ge){return ge===null||markdownLineEnding(ge)?(U.exit("codeFlowValue"),ue(ge)):(U.consume(ge),he)}function me(ge){return U.exit("codeFenced"),j(ge)}function be(ge,Ee,Fe){let Ue=0;return ze;function ze(Ve){return ge.enter("lineEnding"),ge.consume(Ve),ge.exit("lineEnding"),xe}function xe(Ve){return ge.enter("codeFencedFence"),markdownSpace(Ve)?factorySpace(ge,Ie,"linePrefix",q.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Ve):Ie(Ve)}function Ie(Ve){return Ve===K?(ge.enter("codeFencedFenceSequence"),Ge(Ve)):Fe(Ve)}function Ge(Ve){return Ve===K?(Ue++,ge.consume(Ve),Ge):Ue>=$?(ge.exit("codeFencedFenceSequence"),markdownSpace(Ve)?factorySpace(ge,De,"whitespace")(Ve):De(Ve)):Fe(Ve)}function De(Ve){return Ve===null||markdownLineEnding(Ve)?(ge.exit("codeFencedFence"),Ee(Ve)):Fe(Ve)}}}function tokenizeNonLazyContinuation(U,j,B){const q=this;return V;function V($){return $===null?B($):(U.enter("lineEnding"),U.consume($),U.exit("lineEnding"),H)}function H($){return q.parser.lazy[q.now().line]?B($):j($)}}const codeIndented={name:"codeIndented",tokenize:tokenizeCodeIndented},furtherStart={partial:!0,tokenize:tokenizeFurtherStart};function tokenizeCodeIndented(U,j,B){const q=this;return V;function V(Q){return U.enter("codeIndented"),factorySpace(U,H,"linePrefix",5)(Q)}function H(Q){const W=q.events[q.events.length-1];return W&&W[1].type==="linePrefix"&&W[2].sliceSerialize(W[1],!0).length>=4?$(Q):B(Q)}function $(Q){return Q===null?X(Q):markdownLineEnding(Q)?U.attempt(furtherStart,$,X)(Q):(U.enter("codeFlowValue"),K(Q))}function K(Q){return Q===null||markdownLineEnding(Q)?(U.exit("codeFlowValue"),$(Q)):(U.consume(Q),K)}function X(Q){return U.exit("codeIndented"),j(Q)}}function tokenizeFurtherStart(U,j,B){const q=this;return V;function V($){return q.parser.lazy[q.now().line]?B($):markdownLineEnding($)?(U.enter("lineEnding"),U.consume($),U.exit("lineEnding"),V):factorySpace(U,H,"linePrefix",5)($)}function H($){const K=q.events[q.events.length-1];return K&&K[1].type==="linePrefix"&&K[2].sliceSerialize(K[1],!0).length>=4?j($):markdownLineEnding($)?V($):B($)}}const codeText={name:"codeText",previous,resolve:resolveCodeText,tokenize:tokenizeCodeText};function resolveCodeText(U){let j=U.length-4,B=3,q,V;if((U[B][1].type==="lineEnding"||U[B][1].type==="space")&&(U[j][1].type==="lineEnding"||U[j][1].type==="space")){for(q=B;++q<j;)if(U[q][1].type==="codeTextData"){U[B][1].type="codeTextPadding",U[j][1].type="codeTextPadding",B+=2,j-=2;break}}for(q=B-1,j++;++q<=j;)V===void 0?q!==j&&U[q][1].type!=="lineEnding"&&(V=q):(q===j||U[q][1].type==="lineEnding")&&(U[V][1].type="codeTextData",q!==V+2&&(U[V][1].end=U[q-1][1].end,U.splice(V+2,q-V-2),j-=q-V-2,q=V+2),V=void 0);return U}function previous(U){return U!==96||this.events[this.events.length-1][1].type==="characterEscape"}function tokenizeCodeText(U,j,B){let q=0,V,H;return $;function $(Z){return U.enter("codeText"),U.enter("codeTextSequence"),K(Z)}function K(Z){return Z===96?(U.consume(Z),q++,K):(U.exit("codeTextSequence"),X(Z))}function X(Z){return Z===null?B(Z):Z===32?(U.enter("space"),U.consume(Z),U.exit("space"),X):Z===96?(H=U.enter("codeTextSequence"),V=0,W(Z)):markdownLineEnding(Z)?(U.enter("lineEnding"),U.consume(Z),U.exit("lineEnding"),X):(U.enter("codeTextData"),Q(Z))}function Q(Z){return Z===null||Z===32||Z===96||markdownLineEnding(Z)?(U.exit("codeTextData"),X(Z)):(U.consume(Z),Q)}function W(Z){return Z===96?(U.consume(Z),V++,W):V===q?(U.exit("codeTextSequence"),U.exit("codeText"),j(Z)):(H.type="codeTextData",Q(Z))}}class SpliceBuffer{constructor(j){this.left=j?[...j]:[],this.right=[]}get(j){if(j<0||j>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+j+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return j<this.left.length?this.left[j]:this.right[this.right.length-j+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(j,B){const q=B??Number.POSITIVE_INFINITY;return q<this.left.length?this.left.slice(j,q):j>this.left.length?this.right.slice(this.right.length-q+this.left.length,this.right.length-j+this.left.length).reverse():this.left.slice(j).concat(this.right.slice(this.right.length-q+this.left.length).reverse())}splice(j,B,q){const V=B||0;this.setCursor(Math.trunc(j));const H=this.right.splice(this.right.length-V,Number.POSITIVE_INFINITY);return q&&chunkedPush(this.left,q),H.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(j){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(j)}pushMany(j){this.setCursor(Number.POSITIVE_INFINITY),chunkedPush(this.left,j)}unshift(j){this.setCursor(0),this.right.push(j)}unshiftMany(j){this.setCursor(0),chunkedPush(this.right,j.reverse())}setCursor(j){if(!(j===this.left.length||j>this.left.length&&this.right.length===0||j<0&&this.left.length===0))if(j<this.left.length){const B=this.left.splice(j,Number.POSITIVE_INFINITY);chunkedPush(this.right,B.reverse())}else{const B=this.right.splice(this.left.length+this.right.length-j,Number.POSITIVE_INFINITY);chunkedPush(this.left,B.reverse())}}}function chunkedPush(U,j){let B=0;if(j.length<1e4)U.push(...j);else for(;B<j.length;)U.push(...j.slice(B,B+1e4)),B+=1e4}function subtokenize(U){const j={};let B=-1,q,V,H,$,K,X,Q;const W=new SpliceBuffer(U);for(;++B<W.length;){for(;B in j;)B=j[B];if(q=W.get(B),B&&q[1].type==="chunkFlow"&&W.get(B-1)[1].type==="listItemPrefix"&&(X=q[1]._tokenizer.events,H=0,H<X.length&&X[H][1].type==="lineEndingBlank"&&(H+=2),H<X.length&&X[H][1].type==="content"))for(;++H<X.length&&X[H][1].type!=="content";)X[H][1].type==="chunkText"&&(X[H][1]._isInFirstContentOfListItem=!0,H++);if(q[0]==="enter")q[1].contentType&&(Object.assign(j,subcontent(W,B)),B=j[B],Q=!0);else if(q[1]._container){for(H=B,V=void 0;H--;)if($=W.get(H),$[1].type==="lineEnding"||$[1].type==="lineEndingBlank")$[0]==="enter"&&(V&&(W.get(V)[1].type="lineEndingBlank"),$[1].type="lineEnding",V=H);else if(!($[1].type==="linePrefix"||$[1].type==="listItemIndent"))break;V&&(q[1].end={...W.get(V)[1].start},K=W.slice(V,B),K.unshift(q),W.splice(V,B-V+1,K))}}return splice(U,0,Number.POSITIVE_INFINITY,W.slice(0)),!Q}function subcontent(U,j){const B=U.get(j)[1],q=U.get(j)[2];let V=j-1;const H=[];let $=B._tokenizer;$||($=q.parser[B.contentType](B.start),B._contentTypeTextTrailing&&($._contentTypeTextTrailing=!0));const K=$.events,X=[],Q={};let W,Z,te=-1,ie=B,ae=0,oe=0;const de=[oe];for(;ie;){for(;U.get(++V)[1]!==ie;);H.push(V),ie._tokenizer||(W=q.sliceStream(ie),ie.next||W.push(null),Z&&$.defineSkip(ie.start),ie._isInFirstContentOfListItem&&($._gfmTasklistFirstContentOfListItem=!0),$.write(W),ie._isInFirstContentOfListItem&&($._gfmTasklistFirstContentOfListItem=void 0)),Z=ie,ie=ie.next}for(ie=B;++te<K.length;)K[te][0]==="exit"&&K[te-1][0]==="enter"&&K[te][1].type===K[te-1][1].type&&K[te][1].start.line!==K[te][1].end.line&&(oe=te+1,de.push(oe),ie._tokenizer=void 0,ie.previous=void 0,ie=ie.next);for($.events=[],ie?(ie._tokenizer=void 0,ie.previous=void 0):de.pop(),te=de.length;te--;){const le=K.slice(de[te],de[te+1]),ue=H.pop();X.push([ue,ue+le.length-1]),U.splice(ue,2,le)}for(X.reverse(),te=-1;++te<X.length;)Q[ae+X[te][0]]=ae+X[te][1],ae+=X[te][1]-X[te][0]-1;return Q}const content={resolve:resolveContent,tokenize:tokenizeContent},continuationConstruct={partial:!0,tokenize:tokenizeContinuation};function resolveContent(U){return subtokenize(U),U}function tokenizeContent(U,j){let B;return q;function q(K){return U.enter("content"),B=U.enter("chunkContent",{contentType:"content"}),V(K)}function V(K){return K===null?H(K):markdownLineEnding(K)?U.check(continuationConstruct,$,H)(K):(U.consume(K),V)}function H(K){return U.exit("chunkContent"),U.exit("content"),j(K)}function $(K){return U.consume(K),U.exit("chunkContent"),B.next=U.enter("chunkContent",{contentType:"content",previous:B}),B=B.next,V}}function tokenizeContinuation(U,j,B){const q=this;return V;function V($){return U.exit("chunkContent"),U.enter("lineEnding"),U.consume($),U.exit("lineEnding"),factorySpace(U,H,"linePrefix")}function H($){if($===null||markdownLineEnding($))return B($);const K=q.events[q.events.length-1];return!q.parser.constructs.disable.null.includes("codeIndented")&&K&&K[1].type==="linePrefix"&&K[2].sliceSerialize(K[1],!0).length>=4?j($):U.interrupt(q.parser.constructs.flow,B,j)($)}}function factoryDestination(U,j,B,q,V,H,$,K,X){const Q=X||Number.POSITIVE_INFINITY;let W=0;return Z;function Z(le){return le===60?(U.enter(q),U.enter(V),U.enter(H),U.consume(le),U.exit(H),te):le===null||le===32||le===41||asciiControl(le)?B(le):(U.enter(q),U.enter($),U.enter(K),U.enter("chunkString",{contentType:"string"}),oe(le))}function te(le){return le===62?(U.enter(H),U.consume(le),U.exit(H),U.exit(V),U.exit(q),j):(U.enter(K),U.enter("chunkString",{contentType:"string"}),ie(le))}function ie(le){return le===62?(U.exit("chunkString"),U.exit(K),te(le)):le===null||le===60||markdownLineEnding(le)?B(le):(U.consume(le),le===92?ae:ie)}function ae(le){return le===60||le===62||le===92?(U.consume(le),ie):ie(le)}function oe(le){return!W&&(le===null||le===41||markdownLineEndingOrSpace(le))?(U.exit("chunkString"),U.exit(K),U.exit($),U.exit(q),j(le)):W<Q&&le===40?(U.consume(le),W++,oe):le===41?(U.consume(le),W--,oe):le===null||le===32||le===40||asciiControl(le)?B(le):(U.consume(le),le===92?de:oe)}function de(le){return le===40||le===41||le===92?(U.consume(le),oe):oe(le)}}function factoryLabel(U,j,B,q,V,H){const $=this;let K=0,X;return Q;function Q(ie){return U.enter(q),U.enter(V),U.consume(ie),U.exit(V),U.enter(H),W}function W(ie){return K>999||ie===null||ie===91||ie===93&&!X||ie===94&&!K&&"_hiddenFootnoteSupport"in $.parser.constructs?B(ie):ie===93?(U.exit(H),U.enter(V),U.consume(ie),U.exit(V),U.exit(q),j):markdownLineEnding(ie)?(U.enter("lineEnding"),U.consume(ie),U.exit("lineEnding"),W):(U.enter("chunkString",{contentType:"string"}),Z(ie))}function Z(ie){return ie===null||ie===91||ie===93||markdownLineEnding(ie)||K++>999?(U.exit("chunkString"),W(ie)):(U.consume(ie),X||(X=!markdownSpace(ie)),ie===92?te:Z)}function te(ie){return ie===91||ie===92||ie===93?(U.consume(ie),K++,Z):Z(ie)}}function factoryTitle(U,j,B,q,V,H){let $;return K;function K(te){return te===34||te===39||te===40?(U.enter(q),U.enter(V),U.consume(te),U.exit(V),$=te===40?41:te,X):B(te)}function X(te){return te===$?(U.enter(V),U.consume(te),U.exit(V),U.exit(q),j):(U.enter(H),Q(te))}function Q(te){return te===$?(U.exit(H),X($)):te===null?B(te):markdownLineEnding(te)?(U.enter("lineEnding"),U.consume(te),U.exit("lineEnding"),factorySpace(U,Q,"linePrefix")):(U.enter("chunkString",{contentType:"string"}),W(te))}function W(te){return te===$||te===null||markdownLineEnding(te)?(U.exit("chunkString"),Q(te)):(U.consume(te),te===92?Z:W)}function Z(te){return te===$||te===92?(U.consume(te),W):W(te)}}function factoryWhitespace(U,j){let B;return q;function q(V){return markdownLineEnding(V)?(U.enter("lineEnding"),U.consume(V),U.exit("lineEnding"),B=!0,q):markdownSpace(V)?factorySpace(U,q,B?"linePrefix":"lineSuffix")(V):j(V)}}const definition={name:"definition",tokenize:tokenizeDefinition},titleBefore={partial:!0,tokenize:tokenizeTitleBefore};function tokenizeDefinition(U,j,B){const q=this;let V;return H;function H(ie){return U.enter("definition"),$(ie)}function $(ie){return factoryLabel.call(q,U,K,B,"definitionLabel","definitionLabelMarker","definitionLabelString")(ie)}function K(ie){return V=normalizeIdentifier(q.sliceSerialize(q.events[q.events.length-1][1]).slice(1,-1)),ie===58?(U.enter("definitionMarker"),U.consume(ie),U.exit("definitionMarker"),X):B(ie)}function X(ie){return markdownLineEndingOrSpace(ie)?factoryWhitespace(U,Q)(ie):Q(ie)}function Q(ie){return factoryDestination(U,W,B,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(ie)}function W(ie){return U.attempt(titleBefore,Z,Z)(ie)}function Z(ie){return markdownSpace(ie)?factorySpace(U,te,"whitespace")(ie):te(ie)}function te(ie){return ie===null||markdownLineEnding(ie)?(U.exit("definition"),q.parser.defined.push(V),j(ie)):B(ie)}}function tokenizeTitleBefore(U,j,B){return q;function q(K){return markdownLineEndingOrSpace(K)?factoryWhitespace(U,V)(K):B(K)}function V(K){return factoryTitle(U,H,B,"definitionTitle","definitionTitleMarker","definitionTitleString")(K)}function H(K){return markdownSpace(K)?factorySpace(U,$,"whitespace")(K):$(K)}function $(K){return K===null||markdownLineEnding(K)?j(K):B(K)}}const hardBreakEscape={name:"hardBreakEscape",tokenize:tokenizeHardBreakEscape};function tokenizeHardBreakEscape(U,j,B){return q;function q(H){return U.enter("hardBreakEscape"),U.consume(H),V}function V(H){return markdownLineEnding(H)?(U.exit("hardBreakEscape"),j(H)):B(H)}}const headingAtx={name:"headingAtx",resolve:resolveHeadingAtx,tokenize:tokenizeHeadingAtx};function resolveHeadingAtx(U,j){let B=U.length-2,q=3,V,H;return U[q][1].type==="whitespace"&&(q+=2),B-2>q&&U[B][1].type==="whitespace"&&(B-=2),U[B][1].type==="atxHeadingSequence"&&(q===B-1||B-4>q&&U[B-2][1].type==="whitespace")&&(B-=q+1===B?2:4),B>q&&(V={type:"atxHeadingText",start:U[q][1].start,end:U[B][1].end},H={type:"chunkText",start:U[q][1].start,end:U[B][1].end,contentType:"text"},splice(U,q,B-q+1,[["enter",V,j],["enter",H,j],["exit",H,j],["exit",V,j]])),U}function tokenizeHeadingAtx(U,j,B){let q=0;return V;function V(W){return U.enter("atxHeading"),H(W)}function H(W){return U.enter("atxHeadingSequence"),$(W)}function $(W){return W===35&&q++<6?(U.consume(W),$):W===null||markdownLineEndingOrSpace(W)?(U.exit("atxHeadingSequence"),K(W)):B(W)}function K(W){return W===35?(U.enter("atxHeadingSequence"),X(W)):W===null||markdownLineEnding(W)?(U.exit("atxHeading"),j(W)):markdownSpace(W)?factorySpace(U,K,"whitespace")(W):(U.enter("atxHeadingText"),Q(W))}function X(W){return W===35?(U.consume(W),X):(U.exit("atxHeadingSequence"),K(W))}function Q(W){return W===null||W===35||markdownLineEndingOrSpace(W)?(U.exit("atxHeadingText"),K(W)):(U.consume(W),Q)}}const htmlBlockNames=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],htmlRawNames=["pre","script","style","textarea"],htmlFlow={concrete:!0,name:"htmlFlow",resolveTo:resolveToHtmlFlow,tokenize:tokenizeHtmlFlow},blankLineBefore={partial:!0,tokenize:tokenizeBlankLineBefore},nonLazyContinuationStart={partial:!0,tokenize:tokenizeNonLazyContinuationStart};function resolveToHtmlFlow(U){let j=U.length;for(;j--&&!(U[j][0]==="enter"&&U[j][1].type==="htmlFlow"););return j>1&&U[j-2][1].type==="linePrefix"&&(U[j][1].start=U[j-2][1].start,U[j+1][1].start=U[j-2][1].start,U.splice(j-2,2)),U}function tokenizeHtmlFlow(U,j,B){const q=this;let V,H,$,K,X;return Q;function Q(fe){return W(fe)}function W(fe){return U.enter("htmlFlow"),U.enter("htmlFlowData"),U.consume(fe),Z}function Z(fe){return fe===33?(U.consume(fe),te):fe===47?(U.consume(fe),H=!0,oe):fe===63?(U.consume(fe),V=3,q.interrupt?j:pe):asciiAlpha(fe)?(U.consume(fe),$=String.fromCharCode(fe),de):B(fe)}function te(fe){return fe===45?(U.consume(fe),V=2,ie):fe===91?(U.consume(fe),V=5,K=0,ae):asciiAlpha(fe)?(U.consume(fe),V=4,q.interrupt?j:pe):B(fe)}function ie(fe){return fe===45?(U.consume(fe),q.interrupt?j:pe):B(fe)}function ae(fe){const Qe="CDATA[";return fe===Qe.charCodeAt(K++)?(U.consume(fe),K===Qe.length?q.interrupt?j:Ie:ae):B(fe)}function oe(fe){return asciiAlpha(fe)?(U.consume(fe),$=String.fromCharCode(fe),de):B(fe)}function de(fe){if(fe===null||fe===47||fe===62||markdownLineEndingOrSpace(fe)){const Qe=fe===47,tt=$.toLowerCase();return!Qe&&!H&&htmlRawNames.includes(tt)?(V=1,q.interrupt?j(fe):Ie(fe)):htmlBlockNames.includes($.toLowerCase())?(V=6,Qe?(U.consume(fe),le):q.interrupt?j(fe):Ie(fe)):(V=7,q.interrupt&&!q.parser.lazy[q.now().line]?B(fe):H?ue(fe):he(fe))}return fe===45||asciiAlphanumeric(fe)?(U.consume(fe),$+=String.fromCharCode(fe),de):B(fe)}function le(fe){return fe===62?(U.consume(fe),q.interrupt?j:Ie):B(fe)}function ue(fe){return markdownSpace(fe)?(U.consume(fe),ue):ze(fe)}function he(fe){return fe===47?(U.consume(fe),ze):fe===58||fe===95||asciiAlpha(fe)?(U.consume(fe),me):markdownSpace(fe)?(U.consume(fe),he):ze(fe)}function me(fe){return fe===45||fe===46||fe===58||fe===95||asciiAlphanumeric(fe)?(U.consume(fe),me):be(fe)}function be(fe){return fe===61?(U.consume(fe),ge):markdownSpace(fe)?(U.consume(fe),be):he(fe)}function ge(fe){return fe===null||fe===60||fe===61||fe===62||fe===96?B(fe):fe===34||fe===39?(U.consume(fe),X=fe,Ee):markdownSpace(fe)?(U.consume(fe),ge):Fe(fe)}function Ee(fe){return fe===X?(U.consume(fe),X=null,Ue):fe===null||markdownLineEnding(fe)?B(fe):(U.consume(fe),Ee)}function Fe(fe){return fe===null||fe===34||fe===39||fe===47||fe===60||fe===61||fe===62||fe===96||markdownLineEndingOrSpace(fe)?be(fe):(U.consume(fe),Fe)}function Ue(fe){return fe===47||fe===62||markdownSpace(fe)?he(fe):B(fe)}function ze(fe){return fe===62?(U.consume(fe),xe):B(fe)}function xe(fe){return fe===null||markdownLineEnding(fe)?Ie(fe):markdownSpace(fe)?(U.consume(fe),xe):B(fe)}function Ie(fe){return fe===45&&V===2?(U.consume(fe),Se):fe===60&&V===1?(U.consume(fe),we):fe===62&&V===4?(U.consume(fe),ve):fe===63&&V===3?(U.consume(fe),pe):fe===93&&V===5?(U.consume(fe),Ye):markdownLineEnding(fe)&&(V===6||V===7)?(U.exit("htmlFlowData"),U.check(blankLineBefore,Oe,Ge)(fe)):fe===null||markdownLineEnding(fe)?(U.exit("htmlFlowData"),Ge(fe)):(U.consume(fe),Ie)}function Ge(fe){return U.check(nonLazyContinuationStart,De,Oe)(fe)}function De(fe){return U.enter("lineEnding"),U.consume(fe),U.exit("lineEnding"),Ve}function Ve(fe){return fe===null||markdownLineEnding(fe)?Ge(fe):(U.enter("htmlFlowData"),Ie(fe))}function Se(fe){return fe===45?(U.consume(fe),pe):Ie(fe)}function we(fe){return fe===47?(U.consume(fe),$="",$e):Ie(fe)}function $e(fe){if(fe===62){const Qe=$.toLowerCase();return htmlRawNames.includes(Qe)?(U.consume(fe),ve):Ie(fe)}return asciiAlpha(fe)&&$.length<8?(U.consume(fe),$+=String.fromCharCode(fe),$e):Ie(fe)}function Ye(fe){return fe===93?(U.consume(fe),pe):Ie(fe)}function pe(fe){return fe===62?(U.consume(fe),ve):fe===45&&V===2?(U.consume(fe),pe):Ie(fe)}function ve(fe){return fe===null||markdownLineEnding(fe)?(U.exit("htmlFlowData"),Oe(fe)):(U.consume(fe),ve)}function Oe(fe){return U.exit("htmlFlow"),j(fe)}}function tokenizeNonLazyContinuationStart(U,j,B){const q=this;return V;function V($){return markdownLineEnding($)?(U.enter("lineEnding"),U.consume($),U.exit("lineEnding"),H):B($)}function H($){return q.parser.lazy[q.now().line]?B($):j($)}}function tokenizeBlankLineBefore(U,j,B){return q;function q(V){return U.enter("lineEnding"),U.consume(V),U.exit("lineEnding"),U.attempt(blankLine,j,B)}}const htmlText={name:"htmlText",tokenize:tokenizeHtmlText};function tokenizeHtmlText(U,j,B){const q=this;let V,H,$;return K;function K(pe){return U.enter("htmlText"),U.enter("htmlTextData"),U.consume(pe),X}function X(pe){return pe===33?(U.consume(pe),Q):pe===47?(U.consume(pe),be):pe===63?(U.consume(pe),he):asciiAlpha(pe)?(U.consume(pe),Fe):B(pe)}function Q(pe){return pe===45?(U.consume(pe),W):pe===91?(U.consume(pe),H=0,ae):asciiAlpha(pe)?(U.consume(pe),ue):B(pe)}function W(pe){return pe===45?(U.consume(pe),ie):B(pe)}function Z(pe){return pe===null?B(pe):pe===45?(U.consume(pe),te):markdownLineEnding(pe)?($=Z,we(pe)):(U.consume(pe),Z)}function te(pe){return pe===45?(U.consume(pe),ie):Z(pe)}function ie(pe){return pe===62?Se(pe):pe===45?te(pe):Z(pe)}function ae(pe){const ve="CDATA[";return pe===ve.charCodeAt(H++)?(U.consume(pe),H===ve.length?oe:ae):B(pe)}function oe(pe){return pe===null?B(pe):pe===93?(U.consume(pe),de):markdownLineEnding(pe)?($=oe,we(pe)):(U.consume(pe),oe)}function de(pe){return pe===93?(U.consume(pe),le):oe(pe)}function le(pe){return pe===62?Se(pe):pe===93?(U.consume(pe),le):oe(pe)}function ue(pe){return pe===null||pe===62?Se(pe):markdownLineEnding(pe)?($=ue,we(pe)):(U.consume(pe),ue)}function he(pe){return pe===null?B(pe):pe===63?(U.consume(pe),me):markdownLineEnding(pe)?($=he,we(pe)):(U.consume(pe),he)}function me(pe){return pe===62?Se(pe):he(pe)}function be(pe){return asciiAlpha(pe)?(U.consume(pe),ge):B(pe)}function ge(pe){return pe===45||asciiAlphanumeric(pe)?(U.consume(pe),ge):Ee(pe)}function Ee(pe){return markdownLineEnding(pe)?($=Ee,we(pe)):markdownSpace(pe)?(U.consume(pe),Ee):Se(pe)}function Fe(pe){return pe===45||asciiAlphanumeric(pe)?(U.consume(pe),Fe):pe===47||pe===62||markdownLineEndingOrSpace(pe)?Ue(pe):B(pe)}function Ue(pe){return pe===47?(U.consume(pe),Se):pe===58||pe===95||asciiAlpha(pe)?(U.consume(pe),ze):markdownLineEnding(pe)?($=Ue,we(pe)):markdownSpace(pe)?(U.consume(pe),Ue):Se(pe)}function ze(pe){return pe===45||pe===46||pe===58||pe===95||asciiAlphanumeric(pe)?(U.consume(pe),ze):xe(pe)}function xe(pe){return pe===61?(U.consume(pe),Ie):markdownLineEnding(pe)?($=xe,we(pe)):markdownSpace(pe)?(U.consume(pe),xe):Ue(pe)}function Ie(pe){return pe===null||pe===60||pe===61||pe===62||pe===96?B(pe):pe===34||pe===39?(U.consume(pe),V=pe,Ge):markdownLineEnding(pe)?($=Ie,we(pe)):markdownSpace(pe)?(U.consume(pe),Ie):(U.consume(pe),De)}function Ge(pe){return pe===V?(U.consume(pe),V=void 0,Ve):pe===null?B(pe):markdownLineEnding(pe)?($=Ge,we(pe)):(U.consume(pe),Ge)}function De(pe){return pe===null||pe===34||pe===39||pe===60||pe===61||pe===96?B(pe):pe===47||pe===62||markdownLineEndingOrSpace(pe)?Ue(pe):(U.consume(pe),De)}function Ve(pe){return pe===47||pe===62||markdownLineEndingOrSpace(pe)?Ue(pe):B(pe)}function Se(pe){return pe===62?(U.consume(pe),U.exit("htmlTextData"),U.exit("htmlText"),j):B(pe)}function we(pe){return U.exit("htmlTextData"),U.enter("lineEnding"),U.consume(pe),U.exit("lineEnding"),$e}function $e(pe){return markdownSpace(pe)?factorySpace(U,Ye,"linePrefix",q.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(pe):Ye(pe)}function Ye(pe){return U.enter("htmlTextData"),$(pe)}}const labelEnd={name:"labelEnd",resolveAll:resolveAllLabelEnd,resolveTo:resolveToLabelEnd,tokenize:tokenizeLabelEnd},resourceConstruct={tokenize:tokenizeResource},referenceFullConstruct={tokenize:tokenizeReferenceFull},referenceCollapsedConstruct={tokenize:tokenizeReferenceCollapsed};function resolveAllLabelEnd(U){let j=-1;const B=[];for(;++j<U.length;){const q=U[j][1];if(B.push(U[j]),q.type==="labelImage"||q.type==="labelLink"||q.type==="labelEnd"){const V=q.type==="labelImage"?4:2;q.type="data",j+=V}}return U.length!==B.length&&splice(U,0,U.length,B),U}function resolveToLabelEnd(U,j){let B=U.length,q=0,V,H,$,K;for(;B--;)if(V=U[B][1],H){if(V.type==="link"||V.type==="labelLink"&&V._inactive)break;U[B][0]==="enter"&&V.type==="labelLink"&&(V._inactive=!0)}else if($){if(U[B][0]==="enter"&&(V.type==="labelImage"||V.type==="labelLink")&&!V._balanced&&(H=B,V.type!=="labelLink")){q=2;break}}else V.type==="labelEnd"&&($=B);const X={type:U[H][1].type==="labelLink"?"link":"image",start:{...U[H][1].start},end:{...U[U.length-1][1].end}},Q={type:"label",start:{...U[H][1].start},end:{...U[$][1].end}},W={type:"labelText",start:{...U[H+q+2][1].end},end:{...U[$-2][1].start}};return K=[["enter",X,j],["enter",Q,j]],K=push(K,U.slice(H+1,H+q+3)),K=push(K,[["enter",W,j]]),K=push(K,resolveAll(j.parser.constructs.insideSpan.null,U.slice(H+q+4,$-3),j)),K=push(K,[["exit",W,j],U[$-2],U[$-1],["exit",Q,j]]),K=push(K,U.slice($+1)),K=push(K,[["exit",X,j]]),splice(U,H,U.length,K),U}function tokenizeLabelEnd(U,j,B){const q=this;let V=q.events.length,H,$;for(;V--;)if((q.events[V][1].type==="labelImage"||q.events[V][1].type==="labelLink")&&!q.events[V][1]._balanced){H=q.events[V][1];break}return K;function K(te){return H?H._inactive?Z(te):($=q.parser.defined.includes(normalizeIdentifier(q.sliceSerialize({start:H.end,end:q.now()}))),U.enter("labelEnd"),U.enter("labelMarker"),U.consume(te),U.exit("labelMarker"),U.exit("labelEnd"),X):B(te)}function X(te){return te===40?U.attempt(resourceConstruct,W,$?W:Z)(te):te===91?U.attempt(referenceFullConstruct,W,$?Q:Z)(te):$?W(te):Z(te)}function Q(te){return U.attempt(referenceCollapsedConstruct,W,Z)(te)}function W(te){return j(te)}function Z(te){return H._balanced=!0,B(te)}}function tokenizeResource(U,j,B){return q;function q(Z){return U.enter("resource"),U.enter("resourceMarker"),U.consume(Z),U.exit("resourceMarker"),V}function V(Z){return markdownLineEndingOrSpace(Z)?factoryWhitespace(U,H)(Z):H(Z)}function H(Z){return Z===41?W(Z):factoryDestination(U,$,K,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(Z)}function $(Z){return markdownLineEndingOrSpace(Z)?factoryWhitespace(U,X)(Z):W(Z)}function K(Z){return B(Z)}function X(Z){return Z===34||Z===39||Z===40?factoryTitle(U,Q,B,"resourceTitle","resourceTitleMarker","resourceTitleString")(Z):W(Z)}function Q(Z){return markdownLineEndingOrSpace(Z)?factoryWhitespace(U,W)(Z):W(Z)}function W(Z){return Z===41?(U.enter("resourceMarker"),U.consume(Z),U.exit("resourceMarker"),U.exit("resource"),j):B(Z)}}function tokenizeReferenceFull(U,j,B){const q=this;return V;function V(K){return factoryLabel.call(q,U,H,$,"reference","referenceMarker","referenceString")(K)}function H(K){return q.parser.defined.includes(normalizeIdentifier(q.sliceSerialize(q.events[q.events.length-1][1]).slice(1,-1)))?j(K):B(K)}function $(K){return B(K)}}function tokenizeReferenceCollapsed(U,j,B){return q;function q(H){return U.enter("reference"),U.enter("referenceMarker"),U.consume(H),U.exit("referenceMarker"),V}function V(H){return H===93?(U.enter("referenceMarker"),U.consume(H),U.exit("referenceMarker"),U.exit("reference"),j):B(H)}}const labelStartImage={name:"labelStartImage",resolveAll:labelEnd.resolveAll,tokenize:tokenizeLabelStartImage};function tokenizeLabelStartImage(U,j,B){const q=this;return V;function V(K){return U.enter("labelImage"),U.enter("labelImageMarker"),U.consume(K),U.exit("labelImageMarker"),H}function H(K){return K===91?(U.enter("labelMarker"),U.consume(K),U.exit("labelMarker"),U.exit("labelImage"),$):B(K)}function $(K){return K===94&&"_hiddenFootnoteSupport"in q.parser.constructs?B(K):j(K)}}const labelStartLink={name:"labelStartLink",resolveAll:labelEnd.resolveAll,tokenize:tokenizeLabelStartLink};function tokenizeLabelStartLink(U,j,B){const q=this;return V;function V($){return U.enter("labelLink"),U.enter("labelMarker"),U.consume($),U.exit("labelMarker"),U.exit("labelLink"),H}function H($){return $===94&&"_hiddenFootnoteSupport"in q.parser.constructs?B($):j($)}}const lineEnding={name:"lineEnding",tokenize:tokenizeLineEnding};function tokenizeLineEnding(U,j){return B;function B(q){return U.enter("lineEnding"),U.consume(q),U.exit("lineEnding"),factorySpace(U,j,"linePrefix")}}const thematicBreak$1={name:"thematicBreak",tokenize:tokenizeThematicBreak};function tokenizeThematicBreak(U,j,B){let q=0,V;return H;function H(Q){return U.enter("thematicBreak"),$(Q)}function $(Q){return V=Q,K(Q)}function K(Q){return Q===V?(U.enter("thematicBreakSequence"),X(Q)):q>=3&&(Q===null||markdownLineEnding(Q))?(U.exit("thematicBreak"),j(Q)):B(Q)}function X(Q){return Q===V?(U.consume(Q),q++,X):(U.exit("thematicBreakSequence"),markdownSpace(Q)?factorySpace(U,K,"whitespace")(Q):K(Q))}}const list$1={continuation:{tokenize:tokenizeListContinuation},exit:tokenizeListEnd,name:"list",tokenize:tokenizeListStart},listItemPrefixWhitespaceConstruct={partial:!0,tokenize:tokenizeListItemPrefixWhitespace},indentConstruct={partial:!0,tokenize:tokenizeIndent};function tokenizeListStart(U,j,B){const q=this,V=q.events[q.events.length-1];let H=V&&V[1].type==="linePrefix"?V[2].sliceSerialize(V[1],!0).length:0,$=0;return K;function K(ie){const ae=q.containerState.type||(ie===42||ie===43||ie===45?"listUnordered":"listOrdered");if(ae==="listUnordered"?!q.containerState.marker||ie===q.containerState.marker:asciiDigit(ie)){if(q.containerState.type||(q.containerState.type=ae,U.enter(ae,{_container:!0})),ae==="listUnordered")return U.enter("listItemPrefix"),ie===42||ie===45?U.check(thematicBreak$1,B,Q)(ie):Q(ie);if(!q.interrupt||ie===49)return U.enter("listItemPrefix"),U.enter("listItemValue"),X(ie)}return B(ie)}function X(ie){return asciiDigit(ie)&&++$<10?(U.consume(ie),X):(!q.interrupt||$<2)&&(q.containerState.marker?ie===q.containerState.marker:ie===41||ie===46)?(U.exit("listItemValue"),Q(ie)):B(ie)}function Q(ie){return U.enter("listItemMarker"),U.consume(ie),U.exit("listItemMarker"),q.containerState.marker=q.containerState.marker||ie,U.check(blankLine,q.interrupt?B:W,U.attempt(listItemPrefixWhitespaceConstruct,te,Z))}function W(ie){return q.containerState.initialBlankLine=!0,H++,te(ie)}function Z(ie){return markdownSpace(ie)?(U.enter("listItemPrefixWhitespace"),U.consume(ie),U.exit("listItemPrefixWhitespace"),te):B(ie)}function te(ie){return q.containerState.size=H+q.sliceSerialize(U.exit("listItemPrefix"),!0).length,j(ie)}}function tokenizeListContinuation(U,j,B){const q=this;return q.containerState._closeFlow=void 0,U.check(blankLine,V,H);function V(K){return q.containerState.furtherBlankLines=q.containerState.furtherBlankLines||q.containerState.initialBlankLine,factorySpace(U,j,"listItemIndent",q.containerState.size+1)(K)}function H(K){return q.containerState.furtherBlankLines||!markdownSpace(K)?(q.containerState.furtherBlankLines=void 0,q.containerState.initialBlankLine=void 0,$(K)):(q.containerState.furtherBlankLines=void 0,q.containerState.initialBlankLine=void 0,U.attempt(indentConstruct,j,$)(K))}function $(K){return q.containerState._closeFlow=!0,q.interrupt=void 0,factorySpace(U,U.attempt(list$1,j,B),"linePrefix",q.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(K)}}function tokenizeIndent(U,j,B){const q=this;return factorySpace(U,V,"listItemIndent",q.containerState.size+1);function V(H){const $=q.events[q.events.length-1];return $&&$[1].type==="listItemIndent"&&$[2].sliceSerialize($[1],!0).length===q.containerState.size?j(H):B(H)}}function tokenizeListEnd(U){U.exit(this.containerState.type)}function tokenizeListItemPrefixWhitespace(U,j,B){const q=this;return factorySpace(U,V,"listItemPrefixWhitespace",q.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function V(H){const $=q.events[q.events.length-1];return!markdownSpace(H)&&$&&$[1].type==="listItemPrefixWhitespace"?j(H):B(H)}}const setextUnderline={name:"setextUnderline",resolveTo:resolveToSetextUnderline,tokenize:tokenizeSetextUnderline};function resolveToSetextUnderline(U,j){let B=U.length,q,V,H;for(;B--;)if(U[B][0]==="enter"){if(U[B][1].type==="content"){q=B;break}U[B][1].type==="paragraph"&&(V=B)}else U[B][1].type==="content"&&U.splice(B,1),!H&&U[B][1].type==="definition"&&(H=B);const $={type:"setextHeading",start:{...U[q][1].start},end:{...U[U.length-1][1].end}};return U[V][1].type="setextHeadingText",H?(U.splice(V,0,["enter",$,j]),U.splice(H+1,0,["exit",U[q][1],j]),U[q][1].end={...U[H][1].end}):U[q][1]=$,U.push(["exit",$,j]),U}function tokenizeSetextUnderline(U,j,B){const q=this;let V;return H;function H(Q){let W=q.events.length,Z;for(;W--;)if(q.events[W][1].type!=="lineEnding"&&q.events[W][1].type!=="linePrefix"&&q.events[W][1].type!=="content"){Z=q.events[W][1].type==="paragraph";break}return!q.parser.lazy[q.now().line]&&(q.interrupt||Z)?(U.enter("setextHeadingLine"),V=Q,$(Q)):B(Q)}function $(Q){return U.enter("setextHeadingLineSequence"),K(Q)}function K(Q){return Q===V?(U.consume(Q),K):(U.exit("setextHeadingLineSequence"),markdownSpace(Q)?factorySpace(U,X,"lineSuffix")(Q):X(Q))}function X(Q){return Q===null||markdownLineEnding(Q)?(U.exit("setextHeadingLine"),j(Q)):B(Q)}}const flow$1={tokenize:initializeFlow};function initializeFlow(U){const j=this,B=U.attempt(blankLine,q,U.attempt(this.parser.constructs.flowInitial,V,factorySpace(U,U.attempt(this.parser.constructs.flow,V,U.attempt(content,V)),"linePrefix")));return B;function q(H){if(H===null){U.consume(H);return}return U.enter("lineEndingBlank"),U.consume(H),U.exit("lineEndingBlank"),j.currentConstruct=void 0,B}function V(H){if(H===null){U.consume(H);return}return U.enter("lineEnding"),U.consume(H),U.exit("lineEnding"),j.currentConstruct=void 0,B}}const resolver={resolveAll:createResolver()},string$1=initializeFactory("string"),text$2=initializeFactory("text");function initializeFactory(U){return{resolveAll:createResolver(U==="text"?resolveAllLineSuffixes:void 0),tokenize:j};function j(B){const q=this,V=this.parser.constructs[U],H=B.attempt(V,$,K);return $;function $(W){return Q(W)?H(W):K(W)}function K(W){if(W===null){B.consume(W);return}return B.enter("data"),B.consume(W),X}function X(W){return Q(W)?(B.exit("data"),H(W)):(B.consume(W),X)}function Q(W){if(W===null)return!0;const Z=V[W];let te=-1;if(Z)for(;++te<Z.length;){const ie=Z[te];if(!ie.previous||ie.previous.call(q,q.previous))return!0}return!1}}}function createResolver(U){return j;function j(B,q){let V=-1,H;for(;++V<=B.length;)H===void 0?B[V]&&B[V][1].type==="data"&&(H=V,V++):(!B[V]||B[V][1].type!=="data")&&(V!==H+2&&(B[H][1].end=B[V-1][1].end,B.splice(H+2,V-H-2),V=H+2),H=void 0);return U?U(B,q):B}}function resolveAllLineSuffixes(U,j){let B=0;for(;++B<=U.length;)if((B===U.length||U[B][1].type==="lineEnding")&&U[B-1][1].type==="data"){const q=U[B-1][1],V=j.sliceStream(q);let H=V.length,$=-1,K=0,X;for(;H--;){const Q=V[H];if(typeof Q=="string"){for($=Q.length;Q.charCodeAt($-1)===32;)K++,$--;if($)break;$=-1}else if(Q===-2)X=!0,K++;else if(Q!==-1){H++;break}}if(j._contentTypeTextTrailing&&B===U.length&&(K=0),K){const Q={type:B===U.length||X||K<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:H?$:q.start._bufferIndex+$,_index:q.start._index+H,line:q.end.line,column:q.end.column-K,offset:q.end.offset-K},end:{...q.end}};q.end={...Q.start},q.start.offset===q.end.offset?Object.assign(q,Q):(U.splice(B,0,["enter",Q,j],["exit",Q,j]),B+=2)}B++}return U}const document$1={42:list$1,43:list$1,45:list$1,48:list$1,49:list$1,50:list$1,51:list$1,52:list$1,53:list$1,54:list$1,55:list$1,56:list$1,57:list$1,62:blockQuote},contentInitial={91:definition},flowInitial={[-2]:codeIndented,[-1]:codeIndented,32:codeIndented},flow={35:headingAtx,42:thematicBreak$1,45:[setextUnderline,thematicBreak$1],60:htmlFlow,61:setextUnderline,95:thematicBreak$1,96:codeFenced,126:codeFenced},string={38:characterReference,92:characterEscape},text$1={[-5]:lineEnding,[-4]:lineEnding,[-3]:lineEnding,33:labelStartImage,38:characterReference,42:attention,60:[autolink,htmlText],91:labelStartLink,92:[hardBreakEscape,characterEscape],93:labelEnd,95:attention,96:codeText},insideSpan={null:[attention,resolver]},attentionMarkers={null:[42,95]},disable={null:[]},defaultConstructs=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers,contentInitial,disable,document:document$1,flow,flowInitial,insideSpan,string,text:text$1},Symbol.toStringTag,{value:"Module"}));function createTokenizer(U,j,B){let q={_bufferIndex:-1,_index:0,line:B&&B.line||1,column:B&&B.column||1,offset:B&&B.offset||0};const V={},H=[];let $=[],K=[];const X={attempt:Ee(be),check:Ee(ge),consume:ue,enter:he,exit:me,interrupt:Ee(ge,{interrupt:!0})},Q={code:null,containerState:{},defineSkip:oe,events:[],now:ae,parser:U,previous:null,sliceSerialize:te,sliceStream:ie,write:Z};let W=j.tokenize.call(Q,X);return j.resolveAll&&H.push(j),Q;function Z(xe){return $=push($,xe),de(),$[$.length-1]!==null?[]:(Fe(j,0),Q.events=resolveAll(H,Q.events,Q),Q.events)}function te(xe,Ie){return serializeChunks(ie(xe),Ie)}function ie(xe){return sliceChunks($,xe)}function ae(){const{_bufferIndex:xe,_index:Ie,line:Ge,column:De,offset:Ve}=q;return{_bufferIndex:xe,_index:Ie,line:Ge,column:De,offset:Ve}}function oe(xe){V[xe.line]=xe.column,ze()}function de(){let xe;for(;q._index<$.length;){const Ie=$[q._index];if(typeof Ie=="string")for(xe=q._index,q._bufferIndex<0&&(q._bufferIndex=0);q._index===xe&&q._bufferIndex<Ie.length;)le(Ie.charCodeAt(q._bufferIndex));else le(Ie)}}function le(xe){W=W(xe)}function ue(xe){markdownLineEnding(xe)?(q.line++,q.column=1,q.offset+=xe===-3?2:1,ze()):xe!==-1&&(q.column++,q.offset++),q._bufferIndex<0?q._index++:(q._bufferIndex++,q._bufferIndex===$[q._index].length&&(q._bufferIndex=-1,q._index++)),Q.previous=xe}function he(xe,Ie){const Ge=Ie||{};return Ge.type=xe,Ge.start=ae(),Q.events.push(["enter",Ge,Q]),K.push(Ge),Ge}function me(xe){const Ie=K.pop();return Ie.end=ae(),Q.events.push(["exit",Ie,Q]),Ie}function be(xe,Ie){Fe(xe,Ie.from)}function ge(xe,Ie){Ie.restore()}function Ee(xe,Ie){return Ge;function Ge(De,Ve,Se){let we,$e,Ye,pe;return Array.isArray(De)?Oe(De):"tokenize"in De?Oe([De]):ve(De);function ve(He){return at;function at(xt){const gt=xt!==null&&He[xt],on=xt!==null&&He.null,tn=[...Array.isArray(gt)?gt:gt?[gt]:[],...Array.isArray(on)?on:on?[on]:[]];return Oe(tn)(xt)}}function Oe(He){return we=He,$e=0,He.length===0?Se:fe(He[$e])}function fe(He){return at;function at(xt){return pe=Ue(),Ye=He,He.partial||(Q.currentConstruct=He),He.name&&Q.parser.constructs.disable.null.includes(He.name)?tt():He.tokenize.call(Ie?Object.assign(Object.create(Q),Ie):Q,X,Qe,tt)(xt)}}function Qe(He){return xe(Ye,pe),Ve}function tt(He){return pe.restore(),++$e<we.length?fe(we[$e]):Se}}}function Fe(xe,Ie){xe.resolveAll&&!H.includes(xe)&&H.push(xe),xe.resolve&&splice(Q.events,Ie,Q.events.length-Ie,xe.resolve(Q.events.slice(Ie),Q)),xe.resolveTo&&(Q.events=xe.resolveTo(Q.events,Q))}function Ue(){const xe=ae(),Ie=Q.previous,Ge=Q.currentConstruct,De=Q.events.length,Ve=Array.from(K);return{from:De,restore:Se};function Se(){q=xe,Q.previous=Ie,Q.currentConstruct=Ge,Q.events.length=De,K=Ve,ze()}}function ze(){q.line in V&&q.column<2&&(q.column=V[q.line],q.offset+=V[q.line]-1)}}function sliceChunks(U,j){const B=j.start._index,q=j.start._bufferIndex,V=j.end._index,H=j.end._bufferIndex;let $;if(B===V)$=[U[B].slice(q,H)];else{if($=U.slice(B,V),q>-1){const K=$[0];typeof K=="string"?$[0]=K.slice(q):$.shift()}H>0&&$.push(U[V].slice(0,H))}return $}function serializeChunks(U,j){let B=-1;const q=[];let V;for(;++B<U.length;){const H=U[B];let $;if(typeof H=="string")$=H;else switch(H){case-5:{$="\r";break}case-4:{$=`
`;break}case-3:{$=`\r
`;break}case-2:{$=j?" ":"	";break}case-1:{if(!j&&V)continue;$=" ";break}default:$=String.fromCharCode(H)}V=H===-2,q.push($)}return q.join("")}function parse(U){const q={constructs:combineExtensions([defaultConstructs,...(U||{}).extensions||[]]),content:V(content$1),defined:[],document:V(document$2),flow:V(flow$1),lazy:{},string:V(string$1),text:V(text$2)};return q;function V(H){return $;function $(K){return createTokenizer(q,H,K)}}}function postprocess(U){for(;!subtokenize(U););return U}const search=/[\0\t\n\r]/g;function preprocess(){let U=1,j="",B=!0,q;return V;function V(H,$,K){const X=[];let Q,W,Z,te,ie;for(H=j+(typeof H=="string"?H.toString():new TextDecoder($||void 0).decode(H)),Z=0,j="",B&&(H.charCodeAt(0)===65279&&Z++,B=void 0);Z<H.length;){if(search.lastIndex=Z,Q=search.exec(H),te=Q&&Q.index!==void 0?Q.index:H.length,ie=H.charCodeAt(te),!Q){j=H.slice(Z);break}if(ie===10&&Z===te&&q)X.push(-3),q=void 0;else switch(q&&(X.push(-5),q=void 0),Z<te&&(X.push(H.slice(Z,te)),U+=te-Z),ie){case 0:{X.push(65533),U++;break}case 9:{for(W=Math.ceil(U/4)*4,X.push(-2);U++<W;)X.push(-1);break}case 10:{X.push(-4),U=1;break}default:q=!0,U=1}Z=te+1}return K&&(q&&X.push(-5),j&&X.push(j),X.push(null)),X}}const characterEscapeOrReference=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function decodeString(U){return U.replace(characterEscapeOrReference,decode)}function decode(U,j,B){if(j)return j;if(B.charCodeAt(0)===35){const V=B.charCodeAt(1),H=V===120||V===88;return decodeNumericCharacterReference(B.slice(H?2:1),H?16:10)}return decodeNamedCharacterReference(B)||U}const own$2={}.hasOwnProperty;function fromMarkdown(U,j,B){return typeof j!="string"&&(B=j,j=void 0),compiler(B)(postprocess(parse(B).document().write(preprocess()(U,j,!0))))}function compiler(U){const j={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:H($t),autolinkProtocol:Ue,autolinkEmail:Ue,atxHeading:H(ui),blockQuote:H(on),characterEscape:Ue,characterReference:Ue,codeFenced:H(tn),codeFencedFenceInfo:$,codeFencedFenceMeta:$,codeIndented:H(tn,$),codeText:H(ji,$),codeTextData:Ue,data:Ue,codeFlowValue:Ue,definition:H(ar),definitionDestinationString:$,definitionLabelString:$,definitionTitleString:$,emphasis:H(Nn),hardBreakEscape:H(Un),hardBreakTrailing:H(Un),htmlFlow:H(nn,$),htmlFlowData:Ue,htmlText:H(nn,$),htmlTextData:Ue,image:H(Ui),label:$,link:H($t),listItem:H(Bi),listItemValue:te,listOrdered:H(di,Z),listUnordered:H(di),paragraph:H(Qr),reference:fe,referenceString:$,resourceDestinationString:$,resourceTitleString:$,setextHeading:H(ui),strong:H(sr),thematicBreak:H(rn)},exit:{atxHeading:X(),atxHeadingSequence:be,autolink:X(),autolinkEmail:gt,autolinkProtocol:xt,blockQuote:X(),characterEscapeValue:ze,characterReferenceMarkerHexadecimal:tt,characterReferenceMarkerNumeric:tt,characterReferenceValue:He,characterReference:at,codeFenced:X(de),codeFencedFence:oe,codeFencedFenceInfo:ie,codeFencedFenceMeta:ae,codeFlowValue:ze,codeIndented:X(le),codeText:X(Ve),codeTextData:ze,data:ze,definition:X(),definitionDestinationString:me,definitionLabelString:ue,definitionTitleString:he,emphasis:X(),hardBreakEscape:X(Ie),hardBreakTrailing:X(Ie),htmlFlow:X(Ge),htmlFlowData:ze,htmlText:X(De),htmlTextData:ze,image:X(we),label:Ye,labelText:$e,lineEnding:xe,link:X(Se),listItem:X(),listOrdered:X(),listUnordered:X(),paragraph:X(),referenceString:Qe,resourceDestinationString:pe,resourceTitleString:ve,resource:Oe,setextHeading:X(Fe),setextHeadingLineSequence:Ee,setextHeadingText:ge,strong:X(),thematicBreak:X()}};configure(j,(U||{}).mdastExtensions||[]);const B={};return q;function q(je){let Ke={type:"root",children:[]};const it={stack:[Ke],tokenStack:[],config:j,enter:K,exit:Q,buffer:$,resume:W,data:B},st=[];let vt=-1;for(;++vt<je.length;)if(je[vt][1].type==="listOrdered"||je[vt][1].type==="listUnordered")if(je[vt][0]==="enter")st.push(vt);else{const an=st.pop();vt=V(je,an,vt)}for(vt=-1;++vt<je.length;){const an=j[je[vt][0]];own$2.call(an,je[vt][1].type)&&an[je[vt][1].type].call(Object.assign({sliceSerialize:je[vt][2].sliceSerialize},it),je[vt][1])}if(it.tokenStack.length>0){const an=it.tokenStack[it.tokenStack.length-1];(an[1]||defaultOnError).call(it,void 0,an[0])}for(Ke.position={start:point(je.length>0?je[0][1].start:{line:1,column:1,offset:0}),end:point(je.length>0?je[je.length-2][1].end:{line:1,column:1,offset:0})},vt=-1;++vt<j.transforms.length;)Ke=j.transforms[vt](Ke)||Ke;return Ke}function V(je,Ke,it){let st=Ke-1,vt=-1,an=!1,Mn,mt,Pe,Le;for(;++st<=it;){const Ne=je[st];switch(Ne[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Ne[0]==="enter"?vt++:vt--,Le=void 0;break}case"lineEndingBlank":{Ne[0]==="enter"&&(Mn&&!Le&&!vt&&!Pe&&(Pe=st),Le=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Le=void 0}if(!vt&&Ne[0]==="enter"&&Ne[1].type==="listItemPrefix"||vt===-1&&Ne[0]==="exit"&&(Ne[1].type==="listUnordered"||Ne[1].type==="listOrdered")){if(Mn){let Xe=st;for(mt=void 0;Xe--;){const Je=je[Xe];if(Je[1].type==="lineEnding"||Je[1].type==="lineEndingBlank"){if(Je[0]==="exit")continue;mt&&(je[mt][1].type="lineEndingBlank",an=!0),Je[1].type="lineEnding",mt=Xe}else if(!(Je[1].type==="linePrefix"||Je[1].type==="blockQuotePrefix"||Je[1].type==="blockQuotePrefixWhitespace"||Je[1].type==="blockQuoteMarker"||Je[1].type==="listItemIndent"))break}Pe&&(!mt||Pe<mt)&&(Mn._spread=!0),Mn.end=Object.assign({},mt?je[mt][1].start:Ne[1].end),je.splice(mt||st,0,["exit",Mn,Ne[2]]),st++,it++}if(Ne[1].type==="listItemPrefix"){const Xe={type:"listItem",_spread:!1,start:Object.assign({},Ne[1].start),end:void 0};Mn=Xe,je.splice(st,0,["enter",Xe,Ne[2]]),st++,it++,Pe=void 0,Le=!0}}}return je[Ke][1]._spread=an,it}function H(je,Ke){return it;function it(st){K.call(this,je(st),st),Ke&&Ke.call(this,st)}}function $(){this.stack.push({type:"fragment",children:[]})}function K(je,Ke,it){this.stack[this.stack.length-1].children.push(je),this.stack.push(je),this.tokenStack.push([Ke,it||void 0]),je.position={start:point(Ke.start),end:void 0}}function X(je){return Ke;function Ke(it){je&&je.call(this,it),Q.call(this,it)}}function Q(je,Ke){const it=this.stack.pop(),st=this.tokenStack.pop();if(st)st[0].type!==je.type&&(Ke?Ke.call(this,je,st[0]):(st[1]||defaultOnError).call(this,je,st[0]));else throw new Error("Cannot close `"+je.type+"` ("+stringifyPosition({start:je.start,end:je.end})+"): its not open");it.position.end=point(je.end)}function W(){return toString$1(this.stack.pop())}function Z(){this.data.expectingFirstListItemValue=!0}function te(je){if(this.data.expectingFirstListItemValue){const Ke=this.stack[this.stack.length-2];Ke.start=Number.parseInt(this.sliceSerialize(je),10),this.data.expectingFirstListItemValue=void 0}}function ie(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.lang=je}function ae(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.meta=je}function oe(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function de(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=je.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function le(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=je.replace(/(\r?\n|\r)$/g,"")}function ue(je){const Ke=this.resume(),it=this.stack[this.stack.length-1];it.label=Ke,it.identifier=normalizeIdentifier(this.sliceSerialize(je)).toLowerCase()}function he(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.title=je}function me(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.url=je}function be(je){const Ke=this.stack[this.stack.length-1];if(!Ke.depth){const it=this.sliceSerialize(je).length;Ke.depth=it}}function ge(){this.data.setextHeadingSlurpLineEnding=!0}function Ee(je){const Ke=this.stack[this.stack.length-1];Ke.depth=this.sliceSerialize(je).codePointAt(0)===61?1:2}function Fe(){this.data.setextHeadingSlurpLineEnding=void 0}function Ue(je){const it=this.stack[this.stack.length-1].children;let st=it[it.length-1];(!st||st.type!=="text")&&(st=Yt(),st.position={start:point(je.start),end:void 0},it.push(st)),this.stack.push(st)}function ze(je){const Ke=this.stack.pop();Ke.value+=this.sliceSerialize(je),Ke.position.end=point(je.end)}function xe(je){const Ke=this.stack[this.stack.length-1];if(this.data.atHardBreak){const it=Ke.children[Ke.children.length-1];it.position.end=point(je.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&j.canContainEols.includes(Ke.type)&&(Ue.call(this,je),ze.call(this,je))}function Ie(){this.data.atHardBreak=!0}function Ge(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=je}function De(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=je}function Ve(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=je}function Se(){const je=this.stack[this.stack.length-1];if(this.data.inReference){const Ke=this.data.referenceType||"shortcut";je.type+="Reference",je.referenceType=Ke,delete je.url,delete je.title}else delete je.identifier,delete je.label;this.data.referenceType=void 0}function we(){const je=this.stack[this.stack.length-1];if(this.data.inReference){const Ke=this.data.referenceType||"shortcut";je.type+="Reference",je.referenceType=Ke,delete je.url,delete je.title}else delete je.identifier,delete je.label;this.data.referenceType=void 0}function $e(je){const Ke=this.sliceSerialize(je),it=this.stack[this.stack.length-2];it.label=decodeString(Ke),it.identifier=normalizeIdentifier(Ke).toLowerCase()}function Ye(){const je=this.stack[this.stack.length-1],Ke=this.resume(),it=this.stack[this.stack.length-1];if(this.data.inReference=!0,it.type==="link"){const st=je.children;it.children=st}else it.alt=Ke}function pe(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.url=je}function ve(){const je=this.resume(),Ke=this.stack[this.stack.length-1];Ke.title=je}function Oe(){this.data.inReference=void 0}function fe(){this.data.referenceType="collapsed"}function Qe(je){const Ke=this.resume(),it=this.stack[this.stack.length-1];it.label=Ke,it.identifier=normalizeIdentifier(this.sliceSerialize(je)).toLowerCase(),this.data.referenceType="full"}function tt(je){this.data.characterReferenceType=je.type}function He(je){const Ke=this.sliceSerialize(je),it=this.data.characterReferenceType;let st;it?(st=decodeNumericCharacterReference(Ke,it==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):st=decodeNamedCharacterReference(Ke);const vt=this.stack[this.stack.length-1];vt.value+=st}function at(je){const Ke=this.stack.pop();Ke.position.end=point(je.end)}function xt(je){ze.call(this,je);const Ke=this.stack[this.stack.length-1];Ke.url=this.sliceSerialize(je)}function gt(je){ze.call(this,je);const Ke=this.stack[this.stack.length-1];Ke.url="mailto:"+this.sliceSerialize(je)}function on(){return{type:"blockquote",children:[]}}function tn(){return{type:"code",lang:null,meta:null,value:""}}function ji(){return{type:"inlineCode",value:""}}function ar(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Nn(){return{type:"emphasis",children:[]}}function ui(){return{type:"heading",depth:0,children:[]}}function Un(){return{type:"break"}}function nn(){return{type:"html",value:""}}function Ui(){return{type:"image",title:null,url:"",alt:null}}function $t(){return{type:"link",title:null,url:"",children:[]}}function di(je){return{type:"list",ordered:je.type==="listOrdered",start:null,spread:je._spread,children:[]}}function Bi(je){return{type:"listItem",spread:je._spread,checked:null,children:[]}}function Qr(){return{type:"paragraph",children:[]}}function sr(){return{type:"strong",children:[]}}function Yt(){return{type:"text",value:""}}function rn(){return{type:"thematicBreak"}}}function point(U){return{line:U.line,column:U.column,offset:U.offset}}function configure(U,j){let B=-1;for(;++B<j.length;){const q=j[B];Array.isArray(q)?configure(U,q):extension(U,q)}}function extension(U,j){let B;for(B in j)if(own$2.call(j,B))switch(B){case"canContainEols":{const q=j[B];q&&U[B].push(...q);break}case"transforms":{const q=j[B];q&&U[B].push(...q);break}case"enter":case"exit":{const q=j[B];q&&Object.assign(U[B],q);break}}}function defaultOnError(U,j){throw U?new Error("Cannot close `"+U.type+"` ("+stringifyPosition({start:U.start,end:U.end})+"): a different token (`"+j.type+"`, "+stringifyPosition({start:j.start,end:j.end})+") is open"):new Error("Cannot close document, a token (`"+j.type+"`, "+stringifyPosition({start:j.start,end:j.end})+") is still open")}function remarkParse(U){const j=this;j.parser=B;function B(q){return fromMarkdown(q,{...j.data("settings"),...U,extensions:j.data("micromarkExtensions")||[],mdastExtensions:j.data("fromMarkdownExtensions")||[]})}}function blockquote(U,j){const B={type:"element",tagName:"blockquote",properties:{},children:U.wrap(U.all(j),!0)};return U.patch(j,B),U.applyData(j,B)}function hardBreak(U,j){const B={type:"element",tagName:"br",properties:{},children:[]};return U.patch(j,B),[U.applyData(j,B),{type:"text",value:`
`}]}function code(U,j){const B=j.value?j.value+`
`:"",q={};j.lang&&(q.className=["language-"+j.lang]);let V={type:"element",tagName:"code",properties:q,children:[{type:"text",value:B}]};return j.meta&&(V.data={meta:j.meta}),U.patch(j,V),V=U.applyData(j,V),V={type:"element",tagName:"pre",properties:{},children:[V]},U.patch(j,V),V}function strikethrough(U,j){const B={type:"element",tagName:"del",properties:{},children:U.all(j)};return U.patch(j,B),U.applyData(j,B)}function emphasis(U,j){const B={type:"element",tagName:"em",properties:{},children:U.all(j)};return U.patch(j,B),U.applyData(j,B)}function footnoteReference(U,j){const B=typeof U.options.clobberPrefix=="string"?U.options.clobberPrefix:"user-content-",q=String(j.identifier).toUpperCase(),V=normalizeUri(q.toLowerCase()),H=U.footnoteOrder.indexOf(q);let $,K=U.footnoteCounts.get(q);K===void 0?(K=0,U.footnoteOrder.push(q),$=U.footnoteOrder.length):$=H+1,K+=1,U.footnoteCounts.set(q,K);const X={type:"element",tagName:"a",properties:{href:"#"+B+"fn-"+V,id:B+"fnref-"+V+(K>1?"-"+K:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String($)}]};U.patch(j,X);const Q={type:"element",tagName:"sup",properties:{},children:[X]};return U.patch(j,Q),U.applyData(j,Q)}function heading(U,j){const B={type:"element",tagName:"h"+j.depth,properties:{},children:U.all(j)};return U.patch(j,B),U.applyData(j,B)}function html(U,j){if(U.options.allowDangerousHtml){const B={type:"raw",value:j.value};return U.patch(j,B),U.applyData(j,B)}}function revert(U,j){const B=j.referenceType;let q="]";if(B==="collapsed"?q+="[]":B==="full"&&(q+="["+(j.label||j.identifier)+"]"),j.type==="imageReference")return[{type:"text",value:"!["+j.alt+q}];const V=U.all(j),H=V[0];H&&H.type==="text"?H.value="["+H.value:V.unshift({type:"text",value:"["});const $=V[V.length-1];return $&&$.type==="text"?$.value+=q:V.push({type:"text",value:q}),V}function imageReference(U,j){const B=String(j.identifier).toUpperCase(),q=U.definitionById.get(B);if(!q)return revert(U,j);const V={src:normalizeUri(q.url||""),alt:j.alt};q.title!==null&&q.title!==void 0&&(V.title=q.title);const H={type:"element",tagName:"img",properties:V,children:[]};return U.patch(j,H),U.applyData(j,H)}function image(U,j){const B={src:normalizeUri(j.url)};j.alt!==null&&j.alt!==void 0&&(B.alt=j.alt),j.title!==null&&j.title!==void 0&&(B.title=j.title);const q={type:"element",tagName:"img",properties:B,children:[]};return U.patch(j,q),U.applyData(j,q)}function inlineCode(U,j){const B={type:"text",value:j.value.replace(/\r?\n|\r/g," ")};U.patch(j,B);const q={type:"element",tagName:"code",properties:{},children:[B]};return U.patch(j,q),U.applyData(j,q)}function linkReference(U,j){const B=String(j.identifier).toUpperCase(),q=U.definitionById.get(B);if(!q)return revert(U,j);const V={href:normalizeUri(q.url||"")};q.title!==null&&q.title!==void 0&&(V.title=q.title);const H={type:"element",tagName:"a",properties:V,children:U.all(j)};return U.patch(j,H),U.applyData(j,H)}function link(U,j){const B={href:normalizeUri(j.url)};j.title!==null&&j.title!==void 0&&(B.title=j.title);const q={type:"element",tagName:"a",properties:B,children:U.all(j)};return U.patch(j,q),U.applyData(j,q)}function listItem(U,j,B){const q=U.all(j),V=B?listLoose(B):listItemLoose(j),H={},$=[];if(typeof j.checked=="boolean"){const W=q[0];let Z;W&&W.type==="element"&&W.tagName==="p"?Z=W:(Z={type:"element",tagName:"p",properties:{},children:[]},q.unshift(Z)),Z.children.length>0&&Z.children.unshift({type:"text",value:" "}),Z.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:j.checked,disabled:!0},children:[]}),H.className=["task-list-item"]}let K=-1;for(;++K<q.length;){const W=q[K];(V||K!==0||W.type!=="element"||W.tagName!=="p")&&$.push({type:"text",value:`
`}),W.type==="element"&&W.tagName==="p"&&!V?$.push(...W.children):$.push(W)}const X=q[q.length-1];X&&(V||X.type!=="element"||X.tagName!=="p")&&$.push({type:"text",value:`
`});const Q={type:"element",tagName:"li",properties:H,children:$};return U.patch(j,Q),U.applyData(j,Q)}function listLoose(U){let j=!1;if(U.type==="list"){j=U.spread||!1;const B=U.children;let q=-1;for(;!j&&++q<B.length;)j=listItemLoose(B[q])}return j}function listItemLoose(U){const j=U.spread;return j??U.children.length>1}function list(U,j){const B={},q=U.all(j);let V=-1;for(typeof j.start=="number"&&j.start!==1&&(B.start=j.start);++V<q.length;){const $=q[V];if($.type==="element"&&$.tagName==="li"&&$.properties&&Array.isArray($.properties.className)&&$.properties.className.includes("task-list-item")){B.className=["contains-task-list"];break}}const H={type:"element",tagName:j.ordered?"ol":"ul",properties:B,children:U.wrap(q,!0)};return U.patch(j,H),U.applyData(j,H)}function paragraph(U,j){const B={type:"element",tagName:"p",properties:{},children:U.all(j)};return U.patch(j,B),U.applyData(j,B)}function root$2(U,j){const B={type:"root",children:U.wrap(U.all(j))};return U.patch(j,B),U.applyData(j,B)}function strong(U,j){const B={type:"element",tagName:"strong",properties:{},children:U.all(j)};return U.patch(j,B),U.applyData(j,B)}function table(U,j){const B=U.all(j),q=B.shift(),V=[];if(q){const $={type:"element",tagName:"thead",properties:{},children:U.wrap([q],!0)};U.patch(j.children[0],$),V.push($)}if(B.length>0){const $={type:"element",tagName:"tbody",properties:{},children:U.wrap(B,!0)},K=pointStart(j.children[1]),X=pointEnd(j.children[j.children.length-1]);K&&X&&($.position={start:K,end:X}),V.push($)}const H={type:"element",tagName:"table",properties:{},children:U.wrap(V,!0)};return U.patch(j,H),U.applyData(j,H)}function tableRow(U,j,B){const q=B?B.children:void 0,H=(q?q.indexOf(j):1)===0?"th":"td",$=B&&B.type==="table"?B.align:void 0,K=$?$.length:j.children.length;let X=-1;const Q=[];for(;++X<K;){const Z=j.children[X],te={},ie=$?$[X]:void 0;ie&&(te.align=ie);let ae={type:"element",tagName:H,properties:te,children:[]};Z&&(ae.children=U.all(Z),U.patch(Z,ae),ae=U.applyData(Z,ae)),Q.push(ae)}const W={type:"element",tagName:"tr",properties:{},children:U.wrap(Q,!0)};return U.patch(j,W),U.applyData(j,W)}function tableCell(U,j){const B={type:"element",tagName:"td",properties:{},children:U.all(j)};return U.patch(j,B),U.applyData(j,B)}const tab=9,space=32;function trimLines(U){const j=String(U),B=/\r?\n|\r/g;let q=B.exec(j),V=0;const H=[];for(;q;)H.push(trimLine(j.slice(V,q.index),V>0,!0),q[0]),V=q.index+q[0].length,q=B.exec(j);return H.push(trimLine(j.slice(V),V>0,!1)),H.join("")}function trimLine(U,j,B){let q=0,V=U.length;if(j){let H=U.codePointAt(q);for(;H===tab||H===space;)q++,H=U.codePointAt(q)}if(B){let H=U.codePointAt(V-1);for(;H===tab||H===space;)V--,H=U.codePointAt(V-1)}return V>q?U.slice(q,V):""}function text(U,j){const B={type:"text",value:trimLines(String(j.value))};return U.patch(j,B),U.applyData(j,B)}function thematicBreak(U,j){const B={type:"element",tagName:"hr",properties:{},children:[]};return U.patch(j,B),U.applyData(j,B)}const handlers={blockquote,break:hardBreak,code,delete:strikethrough,emphasis,footnoteReference,heading,html,imageReference,image,inlineCode,linkReference,link,listItem,list,paragraph,root:root$2,strong,table,tableCell,tableRow,text,thematicBreak,toml:ignore,yaml:ignore,definition:ignore,footnoteDefinition:ignore};function ignore(){}const VOID=-1,PRIMITIVE=0,ARRAY=1,OBJECT=2,DATE=3,REGEXP=4,MAP=5,SET=6,ERROR=7,BIGINT=8,env=typeof self=="object"?self:globalThis,deserializer=(U,j)=>{const B=(V,H)=>(U.set(H,V),V),q=V=>{if(U.has(V))return U.get(V);const[H,$]=j[V];switch(H){case PRIMITIVE:case VOID:return B($,V);case ARRAY:{const K=B([],V);for(const X of $)K.push(q(X));return K}case OBJECT:{const K=B({},V);for(const[X,Q]of $)K[q(X)]=q(Q);return K}case DATE:return B(new Date($),V);case REGEXP:{const{source:K,flags:X}=$;return B(new RegExp(K,X),V)}case MAP:{const K=B(new Map,V);for(const[X,Q]of $)K.set(q(X),q(Q));return K}case SET:{const K=B(new Set,V);for(const X of $)K.add(q(X));return K}case ERROR:{const{name:K,message:X}=$;return B(new env[K](X),V)}case BIGINT:return B(BigInt($),V);case"BigInt":return B(Object(BigInt($)),V);case"ArrayBuffer":return B(new Uint8Array($).buffer,$);case"DataView":{const{buffer:K}=new Uint8Array($);return B(new DataView(K),$)}}return B(new env[H]($),V)};return q},deserialize=U=>deserializer(new Map,U)(0),EMPTY="",{toString}={},{keys}=Object,typeOf=U=>{const j=typeof U;if(j!=="object"||!U)return[PRIMITIVE,j];const B=toString.call(U).slice(8,-1);switch(B){case"Array":return[ARRAY,EMPTY];case"Object":return[OBJECT,EMPTY];case"Date":return[DATE,EMPTY];case"RegExp":return[REGEXP,EMPTY];case"Map":return[MAP,EMPTY];case"Set":return[SET,EMPTY];case"DataView":return[ARRAY,B]}return B.includes("Array")?[ARRAY,B]:B.includes("Error")?[ERROR,B]:[OBJECT,B]},shouldSkip=([U,j])=>U===PRIMITIVE&&(j==="function"||j==="symbol"),serializer=(U,j,B,q)=>{const V=($,K)=>{const X=q.push($)-1;return B.set(K,X),X},H=$=>{if(B.has($))return B.get($);let[K,X]=typeOf($);switch(K){case PRIMITIVE:{let W=$;switch(X){case"bigint":K=BIGINT,W=$.toString();break;case"function":case"symbol":if(U)throw new TypeError("unable to serialize "+X);W=null;break;case"undefined":return V([VOID],$)}return V([K,W],$)}case ARRAY:{if(X){let te=$;return X==="DataView"?te=new Uint8Array($.buffer):X==="ArrayBuffer"&&(te=new Uint8Array($)),V([X,[...te]],$)}const W=[],Z=V([K,W],$);for(const te of $)W.push(H(te));return Z}case OBJECT:{if(X)switch(X){case"BigInt":return V([X,$.toString()],$);case"Boolean":case"Number":case"String":return V([X,$.valueOf()],$)}if(j&&"toJSON"in $)return H($.toJSON());const W=[],Z=V([K,W],$);for(const te of keys($))(U||!shouldSkip(typeOf($[te])))&&W.push([H(te),H($[te])]);return Z}case DATE:return V([K,$.toISOString()],$);case REGEXP:{const{source:W,flags:Z}=$;return V([K,{source:W,flags:Z}],$)}case MAP:{const W=[],Z=V([K,W],$);for(const[te,ie]of $)(U||!(shouldSkip(typeOf(te))||shouldSkip(typeOf(ie))))&&W.push([H(te),H(ie)]);return Z}case SET:{const W=[],Z=V([K,W],$);for(const te of $)(U||!shouldSkip(typeOf(te)))&&W.push(H(te));return Z}}const{message:Q}=$;return V([K,{name:X,message:Q}],$)};return H},serialize=(U,{json:j,lossy:B}={})=>{const q=[];return serializer(!(j||B),!!j,new Map,q)(U),q},structuredClone$1=typeof structuredClone=="function"?(U,j)=>j&&("json"in j||"lossy"in j)?deserialize(serialize(U,j)):structuredClone(U):(U,j)=>deserialize(serialize(U,j));function defaultFootnoteBackContent(U,j){const B=[{type:"text",value:""}];return j>1&&B.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(j)}]}),B}function defaultFootnoteBackLabel(U,j){return"Back to reference "+(U+1)+(j>1?"-"+j:"")}function footer(U){const j=typeof U.options.clobberPrefix=="string"?U.options.clobberPrefix:"user-content-",B=U.options.footnoteBackContent||defaultFootnoteBackContent,q=U.options.footnoteBackLabel||defaultFootnoteBackLabel,V=U.options.footnoteLabel||"Footnotes",H=U.options.footnoteLabelTagName||"h2",$=U.options.footnoteLabelProperties||{className:["sr-only"]},K=[];let X=-1;for(;++X<U.footnoteOrder.length;){const Q=U.footnoteById.get(U.footnoteOrder[X]);if(!Q)continue;const W=U.all(Q),Z=String(Q.identifier).toUpperCase(),te=normalizeUri(Z.toLowerCase());let ie=0;const ae=[],oe=U.footnoteCounts.get(Z);for(;oe!==void 0&&++ie<=oe;){ae.length>0&&ae.push({type:"text",value:" "});let ue=typeof B=="string"?B:B(X,ie);typeof ue=="string"&&(ue={type:"text",value:ue}),ae.push({type:"element",tagName:"a",properties:{href:"#"+j+"fnref-"+te+(ie>1?"-"+ie:""),dataFootnoteBackref:"",ariaLabel:typeof q=="string"?q:q(X,ie),className:["data-footnote-backref"]},children:Array.isArray(ue)?ue:[ue]})}const de=W[W.length-1];if(de&&de.type==="element"&&de.tagName==="p"){const ue=de.children[de.children.length-1];ue&&ue.type==="text"?ue.value+=" ":de.children.push({type:"text",value:" "}),de.children.push(...ae)}else W.push(...ae);const le={type:"element",tagName:"li",properties:{id:j+"fn-"+te},children:U.wrap(W,!0)};U.patch(Q,le),K.push(le)}if(K.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:H,properties:{...structuredClone$1($),id:"footnote-label"},children:[{type:"text",value:V}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:U.wrap(K,!0)},{type:"text",value:`
`}]}}const convert=(function(U){if(U==null)return ok;if(typeof U=="function")return castFactory(U);if(typeof U=="object")return Array.isArray(U)?anyFactory(U):propertiesFactory(U);if(typeof U=="string")return typeFactory(U);throw new Error("Expected function, string, or object as test")});function anyFactory(U){const j=[];let B=-1;for(;++B<U.length;)j[B]=convert(U[B]);return castFactory(q);function q(...V){let H=-1;for(;++H<j.length;)if(j[H].apply(this,V))return!0;return!1}}function propertiesFactory(U){const j=U;return castFactory(B);function B(q){const V=q;let H;for(H in U)if(V[H]!==j[H])return!1;return!0}}function typeFactory(U){return castFactory(j);function j(B){return B&&B.type===U}}function castFactory(U){return j;function j(B,q,V){return!!(looksLikeANode(B)&&U.call(this,B,typeof q=="number"?q:void 0,V||void 0))}}function ok(){return!0}function looksLikeANode(U){return U!==null&&typeof U=="object"&&"type"in U}function color(U){return U}const empty=[],CONTINUE=!0,EXIT=!1,SKIP="skip";function visitParents(U,j,B,q){let V;typeof j=="function"&&typeof B!="function"?(q=B,B=j):V=j;const H=convert(V),$=q?-1:1;K(U,void 0,[])();function K(X,Q,W){const Z=X&&typeof X=="object"?X:{};if(typeof Z.type=="string"){const ie=typeof Z.tagName=="string"?Z.tagName:typeof Z.name=="string"?Z.name:void 0;Object.defineProperty(te,"name",{value:"node ("+(X.type+(ie?"<"+ie+">":""))+")"})}return te;function te(){let ie=empty,ae,oe,de;if((!j||H(X,Q,W[W.length-1]||void 0))&&(ie=toResult(B(X,W)),ie[0]===EXIT))return ie;if("children"in X&&X.children){const le=X;if(le.children&&ie[0]!==SKIP)for(oe=(q?le.children.length:-1)+$,de=W.concat(le);oe>-1&&oe<le.children.length;){const ue=le.children[oe];if(ae=K(ue,oe,de)(),ae[0]===EXIT)return ae;oe=typeof ae[1]=="number"?ae[1]:oe+$}}return ie}}}function toResult(U){return Array.isArray(U)?U:typeof U=="number"?[CONTINUE,U]:U==null?empty:[U]}function visit(U,j,B,q){let V,H,$;typeof j=="function"&&typeof B!="function"?(H=void 0,$=j,V=B):(H=j,$=B,V=q),visitParents(U,H,K,V);function K(X,Q){const W=Q[Q.length-1],Z=W?W.children.indexOf(X):void 0;return $(X,Z,W)}}const own$1={}.hasOwnProperty,emptyOptions={};function createState(U,j){const B=j||emptyOptions,q=new Map,V=new Map,H=new Map,$={...handlers,...B.handlers},K={all:Q,applyData,definitionById:q,footnoteById:V,footnoteCounts:H,footnoteOrder:[],handlers:$,one:X,options:B,patch,wrap:wrap$1};return visit(U,function(W){if(W.type==="definition"||W.type==="footnoteDefinition"){const Z=W.type==="definition"?q:V,te=String(W.identifier).toUpperCase();Z.has(te)||Z.set(te,W)}}),K;function X(W,Z){const te=W.type,ie=K.handlers[te];if(own$1.call(K.handlers,te)&&ie)return ie(K,W,Z);if(K.options.passThrough&&K.options.passThrough.includes(te)){if("children"in W){const{children:oe,...de}=W,le=structuredClone$1(de);return le.children=K.all(W),le}return structuredClone$1(W)}return(K.options.unknownHandler||defaultUnknownHandler)(K,W,Z)}function Q(W){const Z=[];if("children"in W){const te=W.children;let ie=-1;for(;++ie<te.length;){const ae=K.one(te[ie],W);if(ae){if(ie&&te[ie-1].type==="break"&&(!Array.isArray(ae)&&ae.type==="text"&&(ae.value=trimMarkdownSpaceStart(ae.value)),!Array.isArray(ae)&&ae.type==="element")){const oe=ae.children[0];oe&&oe.type==="text"&&(oe.value=trimMarkdownSpaceStart(oe.value))}Array.isArray(ae)?Z.push(...ae):Z.push(ae)}}}return Z}}function patch(U,j){U.position&&(j.position=position$1(U))}function applyData(U,j){let B=j;if(U&&U.data){const q=U.data.hName,V=U.data.hChildren,H=U.data.hProperties;if(typeof q=="string")if(B.type==="element")B.tagName=q;else{const $="children"in B?B.children:[B];B={type:"element",tagName:q,properties:{},children:$}}B.type==="element"&&H&&Object.assign(B.properties,structuredClone$1(H)),"children"in B&&B.children&&V!==null&&V!==void 0&&(B.children=V)}return B}function defaultUnknownHandler(U,j){const B=j.data||{},q="value"in j&&!(own$1.call(B,"hProperties")||own$1.call(B,"hChildren"))?{type:"text",value:j.value}:{type:"element",tagName:"div",properties:{},children:U.all(j)};return U.patch(j,q),U.applyData(j,q)}function wrap$1(U,j){const B=[];let q=-1;for(j&&B.push({type:"text",value:`
`});++q<U.length;)q&&B.push({type:"text",value:`
`}),B.push(U[q]);return j&&U.length>0&&B.push({type:"text",value:`
`}),B}function trimMarkdownSpaceStart(U){let j=0,B=U.charCodeAt(j);for(;B===9||B===32;)j++,B=U.charCodeAt(j);return U.slice(j)}function toHast(U,j){const B=createState(U,j),q=B.one(U,void 0),V=footer(B),H=Array.isArray(q)?{type:"root",children:q}:q||{type:"root",children:[]};return V&&H.children.push({type:"text",value:`
`},V),H}function remarkRehype(U,j){return U&&"run"in U?async function(B,q){const V=toHast(B,{file:q,...j});await U.run(V,q)}:function(B,q){return toHast(B,{file:q,...U||j})}}function bail(U){if(U)throw U}var extend$1,hasRequiredExtend;function requireExtend(){if(hasRequiredExtend)return extend$1;hasRequiredExtend=1;var U=Object.prototype.hasOwnProperty,j=Object.prototype.toString,B=Object.defineProperty,q=Object.getOwnPropertyDescriptor,V=function(Q){return typeof Array.isArray=="function"?Array.isArray(Q):j.call(Q)==="[object Array]"},H=function(Q){if(!Q||j.call(Q)!=="[object Object]")return!1;var W=U.call(Q,"constructor"),Z=Q.constructor&&Q.constructor.prototype&&U.call(Q.constructor.prototype,"isPrototypeOf");if(Q.constructor&&!W&&!Z)return!1;var te;for(te in Q);return typeof te>"u"||U.call(Q,te)},$=function(Q,W){B&&W.name==="__proto__"?B(Q,W.name,{enumerable:!0,configurable:!0,value:W.newValue,writable:!0}):Q[W.name]=W.newValue},K=function(Q,W){if(W==="__proto__")if(U.call(Q,W)){if(q)return q(Q,W).value}else return;return Q[W]};return extend$1=function X(){var Q,W,Z,te,ie,ae,oe=arguments[0],de=1,le=arguments.length,ue=!1;for(typeof oe=="boolean"&&(ue=oe,oe=arguments[1]||{},de=2),(oe==null||typeof oe!="object"&&typeof oe!="function")&&(oe={});de<le;++de)if(Q=arguments[de],Q!=null)for(W in Q)Z=K(oe,W),te=K(Q,W),oe!==te&&(ue&&te&&(H(te)||(ie=V(te)))?(ie?(ie=!1,ae=Z&&V(Z)?Z:[]):ae=Z&&H(Z)?Z:{},$(oe,{name:W,newValue:X(ue,ae,te)})):typeof te<"u"&&$(oe,{name:W,newValue:te}));return oe},extend$1}var extendExports=requireExtend();const extend=getDefaultExportFromCjs$1(extendExports);function isPlainObject(U){if(typeof U!="object"||U===null)return!1;const j=Object.getPrototypeOf(U);return(j===null||j===Object.prototype||Object.getPrototypeOf(j)===null)&&!(Symbol.toStringTag in U)&&!(Symbol.iterator in U)}function trough(){const U=[],j={run:B,use:q};return j;function B(...V){let H=-1;const $=V.pop();if(typeof $!="function")throw new TypeError("Expected function as last argument, not "+$);K(null,...V);function K(X,...Q){const W=U[++H];let Z=-1;if(X){$(X);return}for(;++Z<V.length;)(Q[Z]===null||Q[Z]===void 0)&&(Q[Z]=V[Z]);V=Q,W?wrap(W,K)(...Q):$(null,...Q)}}function q(V){if(typeof V!="function")throw new TypeError("Expected `middelware` to be a function, not "+V);return U.push(V),j}}function wrap(U,j){let B;return q;function q(...$){const K=U.length>$.length;let X;K&&$.push(V);try{X=U.apply(this,$)}catch(Q){const W=Q;if(K&&B)throw W;return V(W)}K||(X&&X.then&&typeof X.then=="function"?X.then(H,V):X instanceof Error?V(X):H(X))}function V($,...K){B||(B=!0,j($,...K))}function H($){V(null,$)}}const minpath={basename,dirname,extname,join,sep:"/"};function basename(U,j){if(j!==void 0&&typeof j!="string")throw new TypeError('"ext" argument must be a string');assertPath$1(U);let B=0,q=-1,V=U.length,H;if(j===void 0||j.length===0||j.length>U.length){for(;V--;)if(U.codePointAt(V)===47){if(H){B=V+1;break}}else q<0&&(H=!0,q=V+1);return q<0?"":U.slice(B,q)}if(j===U)return"";let $=-1,K=j.length-1;for(;V--;)if(U.codePointAt(V)===47){if(H){B=V+1;break}}else $<0&&(H=!0,$=V+1),K>-1&&(U.codePointAt(V)===j.codePointAt(K--)?K<0&&(q=V):(K=-1,q=$));return B===q?q=$:q<0&&(q=U.length),U.slice(B,q)}function dirname(U){if(assertPath$1(U),U.length===0)return".";let j=-1,B=U.length,q;for(;--B;)if(U.codePointAt(B)===47){if(q){j=B;break}}else q||(q=!0);return j<0?U.codePointAt(0)===47?"/":".":j===1&&U.codePointAt(0)===47?"//":U.slice(0,j)}function extname(U){assertPath$1(U);let j=U.length,B=-1,q=0,V=-1,H=0,$;for(;j--;){const K=U.codePointAt(j);if(K===47){if($){q=j+1;break}continue}B<0&&($=!0,B=j+1),K===46?V<0?V=j:H!==1&&(H=1):V>-1&&(H=-1)}return V<0||B<0||H===0||H===1&&V===B-1&&V===q+1?"":U.slice(V,B)}function join(...U){let j=-1,B;for(;++j<U.length;)assertPath$1(U[j]),U[j]&&(B=B===void 0?U[j]:B+"/"+U[j]);return B===void 0?".":normalize(B)}function normalize(U){assertPath$1(U);const j=U.codePointAt(0)===47;let B=normalizeString(U,!j);return B.length===0&&!j&&(B="."),B.length>0&&U.codePointAt(U.length-1)===47&&(B+="/"),j?"/"+B:B}function normalizeString(U,j){let B="",q=0,V=-1,H=0,$=-1,K,X;for(;++$<=U.length;){if($<U.length)K=U.codePointAt($);else{if(K===47)break;K=47}if(K===47){if(!(V===$-1||H===1))if(V!==$-1&&H===2){if(B.length<2||q!==2||B.codePointAt(B.length-1)!==46||B.codePointAt(B.length-2)!==46){if(B.length>2){if(X=B.lastIndexOf("/"),X!==B.length-1){X<0?(B="",q=0):(B=B.slice(0,X),q=B.length-1-B.lastIndexOf("/")),V=$,H=0;continue}}else if(B.length>0){B="",q=0,V=$,H=0;continue}}j&&(B=B.length>0?B+"/..":"..",q=2)}else B.length>0?B+="/"+U.slice(V+1,$):B=U.slice(V+1,$),q=$-V-1;V=$,H=0}else K===46&&H>-1?H++:H=-1}return B}function assertPath$1(U){if(typeof U!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(U))}const minproc={cwd};function cwd(){return"/"}function isUrl(U){return!!(U!==null&&typeof U=="object"&&"href"in U&&U.href&&"protocol"in U&&U.protocol&&U.auth===void 0)}function urlToPath(U){if(typeof U=="string")U=new URL(U);else if(!isUrl(U)){const j=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+U+"`");throw j.code="ERR_INVALID_ARG_TYPE",j}if(U.protocol!=="file:"){const j=new TypeError("The URL must be of scheme file");throw j.code="ERR_INVALID_URL_SCHEME",j}return getPathFromURLPosix(U)}function getPathFromURLPosix(U){if(U.hostname!==""){const q=new TypeError('File URL host must be "localhost" or empty on darwin');throw q.code="ERR_INVALID_FILE_URL_HOST",q}const j=U.pathname;let B=-1;for(;++B<j.length;)if(j.codePointAt(B)===37&&j.codePointAt(B+1)===50){const q=j.codePointAt(B+2);if(q===70||q===102){const V=new TypeError("File URL path must not include encoded / characters");throw V.code="ERR_INVALID_FILE_URL_PATH",V}}return decodeURIComponent(j)}const order=["history","path","basename","stem","extname","dirname"];class VFile{constructor(j){let B;j?isUrl(j)?B={path:j}:typeof j=="string"||isUint8Array$1(j)?B={value:j}:B=j:B={},this.cwd="cwd"in B?"":minproc.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let q=-1;for(;++q<order.length;){const H=order[q];H in B&&B[H]!==void 0&&B[H]!==null&&(this[H]=H==="history"?[...B[H]]:B[H])}let V;for(V in B)order.includes(V)||(this[V]=B[V])}get basename(){return typeof this.path=="string"?minpath.basename(this.path):void 0}set basename(j){assertNonEmpty(j,"basename"),assertPart(j,"basename"),this.path=minpath.join(this.dirname||"",j)}get dirname(){return typeof this.path=="string"?minpath.dirname(this.path):void 0}set dirname(j){assertPath(this.basename,"dirname"),this.path=minpath.join(j||"",this.basename)}get extname(){return typeof this.path=="string"?minpath.extname(this.path):void 0}set extname(j){if(assertPart(j,"extname"),assertPath(this.dirname,"extname"),j){if(j.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(j.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=minpath.join(this.dirname,this.stem+(j||""))}get path(){return this.history[this.history.length-1]}set path(j){isUrl(j)&&(j=urlToPath(j)),assertNonEmpty(j,"path"),this.path!==j&&this.history.push(j)}get stem(){return typeof this.path=="string"?minpath.basename(this.path,this.extname):void 0}set stem(j){assertNonEmpty(j,"stem"),assertPart(j,"stem"),this.path=minpath.join(this.dirname||"",j+(this.extname||""))}fail(j,B,q){const V=this.message(j,B,q);throw V.fatal=!0,V}info(j,B,q){const V=this.message(j,B,q);return V.fatal=void 0,V}message(j,B,q){const V=new VFileMessage(j,B,q);return this.path&&(V.name=this.path+":"+V.name,V.file=this.path),V.fatal=!1,this.messages.push(V),V}toString(j){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(j||void 0).decode(this.value)}}function assertPart(U,j){if(U&&U.includes(minpath.sep))throw new Error("`"+j+"` cannot be a path: did not expect `"+minpath.sep+"`")}function assertNonEmpty(U,j){if(!U)throw new Error("`"+j+"` cannot be empty")}function assertPath(U,j){if(!U)throw new Error("Setting `"+j+"` requires `path` to be set too")}function isUint8Array$1(U){return!!(U&&typeof U=="object"&&"byteLength"in U&&"byteOffset"in U)}const CallableInstance=(function(U){const q=this.constructor.prototype,V=q[U],H=function(){return V.apply(H,arguments)};return Object.setPrototypeOf(H,q),H}),own={}.hasOwnProperty;class Processor extends CallableInstance{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=trough()}copy(){const j=new Processor;let B=-1;for(;++B<this.attachers.length;){const q=this.attachers[B];j.use(...q)}return j.data(extend(!0,{},this.namespace)),j}data(j,B){return typeof j=="string"?arguments.length===2?(assertUnfrozen("data",this.frozen),this.namespace[j]=B,this):own.call(this.namespace,j)&&this.namespace[j]||void 0:j?(assertUnfrozen("data",this.frozen),this.namespace=j,this):this.namespace}freeze(){if(this.frozen)return this;const j=this;for(;++this.freezeIndex<this.attachers.length;){const[B,...q]=this.attachers[this.freezeIndex];if(q[0]===!1)continue;q[0]===!0&&(q[0]=void 0);const V=B.call(j,...q);typeof V=="function"&&this.transformers.use(V)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(j){this.freeze();const B=vfile(j),q=this.parser||this.Parser;return assertParser("parse",q),q(String(B),B)}process(j,B){const q=this;return this.freeze(),assertParser("process",this.parser||this.Parser),assertCompiler("process",this.compiler||this.Compiler),B?V(void 0,B):new Promise(V);function V(H,$){const K=vfile(j),X=q.parse(K);q.run(X,K,function(W,Z,te){if(W||!Z||!te)return Q(W);const ie=Z,ae=q.stringify(ie,te);looksLikeAValue(ae)?te.value=ae:te.result=ae,Q(W,te)});function Q(W,Z){W||!Z?$(W):H?H(Z):B(void 0,Z)}}}processSync(j){let B=!1,q;return this.freeze(),assertParser("processSync",this.parser||this.Parser),assertCompiler("processSync",this.compiler||this.Compiler),this.process(j,V),assertDone("processSync","process",B),q;function V(H,$){B=!0,bail(H),q=$}}run(j,B,q){assertNode(j),this.freeze();const V=this.transformers;return!q&&typeof B=="function"&&(q=B,B=void 0),q?H(void 0,q):new Promise(H);function H($,K){const X=vfile(B);V.run(j,X,Q);function Q(W,Z,te){const ie=Z||j;W?K(W):$?$(ie):q(void 0,ie,te)}}}runSync(j,B){let q=!1,V;return this.run(j,B,H),assertDone("runSync","run",q),V;function H($,K){bail($),V=K,q=!0}}stringify(j,B){this.freeze();const q=vfile(B),V=this.compiler||this.Compiler;return assertCompiler("stringify",V),assertNode(j),V(j,q)}use(j,...B){const q=this.attachers,V=this.namespace;if(assertUnfrozen("use",this.frozen),j!=null)if(typeof j=="function")X(j,B);else if(typeof j=="object")Array.isArray(j)?K(j):$(j);else throw new TypeError("Expected usable value, not `"+j+"`");return this;function H(Q){if(typeof Q=="function")X(Q,[]);else if(typeof Q=="object")if(Array.isArray(Q)){const[W,...Z]=Q;X(W,Z)}else $(Q);else throw new TypeError("Expected usable value, not `"+Q+"`")}function $(Q){if(!("plugins"in Q)&&!("settings"in Q))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");K(Q.plugins),Q.settings&&(V.settings=extend(!0,V.settings,Q.settings))}function K(Q){let W=-1;if(Q!=null)if(Array.isArray(Q))for(;++W<Q.length;){const Z=Q[W];H(Z)}else throw new TypeError("Expected a list of plugins, not `"+Q+"`")}function X(Q,W){let Z=-1,te=-1;for(;++Z<q.length;)if(q[Z][0]===Q){te=Z;break}if(te===-1)q.push([Q,...W]);else if(W.length>0){let[ie,...ae]=W;const oe=q[te][1];isPlainObject(oe)&&isPlainObject(ie)&&(ie=extend(!0,oe,ie)),q[te]=[Q,ie,...ae]}}}}const unified=new Processor().freeze();function assertParser(U,j){if(typeof j!="function")throw new TypeError("Cannot `"+U+"` without `parser`")}function assertCompiler(U,j){if(typeof j!="function")throw new TypeError("Cannot `"+U+"` without `compiler`")}function assertUnfrozen(U,j){if(j)throw new Error("Cannot call `"+U+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function assertNode(U){if(!isPlainObject(U)||typeof U.type!="string")throw new TypeError("Expected node, got `"+U+"`")}function assertDone(U,j,B){if(!B)throw new Error("`"+U+"` finished async. Use `"+j+"` instead")}function vfile(U){return looksLikeAVFile(U)?U:new VFile(U)}function looksLikeAVFile(U){return!!(U&&typeof U=="object"&&"message"in U&&"messages"in U)}function looksLikeAValue(U){return typeof U=="string"||isUint8Array(U)}function isUint8Array(U){return!!(U&&typeof U=="object"&&"byteLength"in U&&"byteOffset"in U)}const changelog="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",emptyPlugins=[],emptyRemarkRehypeOptions={allowDangerousHtml:!0},safeProtocol=/^(https?|ircs?|mailto|xmpp)$/i,deprecations=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function Markdown(U){const j=createProcessor(U),B=createFile(U);return post(j.runSync(j.parse(B),B),U)}function createProcessor(U){const j=U.rehypePlugins||emptyPlugins,B=U.remarkPlugins||emptyPlugins,q=U.remarkRehypeOptions?{...U.remarkRehypeOptions,...emptyRemarkRehypeOptions}:emptyRemarkRehypeOptions;return unified().use(remarkParse).use(B).use(remarkRehype,q).use(j)}function createFile(U){const j=U.children||"",B=new VFile;return typeof j=="string"&&(B.value=j),B}function post(U,j){const B=j.allowedElements,q=j.allowElement,V=j.components,H=j.disallowedElements,$=j.skipHtml,K=j.unwrapDisallowed,X=j.urlTransform||defaultUrlTransform;for(const W of deprecations)Object.hasOwn(j,W.from)&&(""+W.from+(W.to?"use `"+W.to+"` instead":"remove it")+changelog+W.id,void 0);return visit(U,Q),toJsxRuntime(U,{Fragment:jsxRuntimeExports.Fragment,components:V,ignoreInvalidStyle:!0,jsx:jsxRuntimeExports.jsx,jsxs:jsxRuntimeExports.jsxs,passKeys:!0,passNode:!0});function Q(W,Z,te){if(W.type==="raw"&&te&&typeof Z=="number")return $?te.children.splice(Z,1):te.children[Z]={type:"text",value:W.value},Z;if(W.type==="element"){let ie;for(ie in urlAttributes)if(Object.hasOwn(urlAttributes,ie)&&Object.hasOwn(W.properties,ie)){const ae=W.properties[ie],oe=urlAttributes[ie];(oe===null||oe.includes(W.tagName))&&(W.properties[ie]=X(String(ae||""),ie,W))}}if(W.type==="element"){let ie=B?!B.includes(W.tagName):H?H.includes(W.tagName):!1;if(!ie&&q&&typeof Z=="number"&&(ie=!q(W,Z,te)),ie&&te&&typeof Z=="number")return K&&W.children?te.children.splice(Z,1,...W.children):te.children.splice(Z,1),Z}}}function defaultUrlTransform(U){const j=U.indexOf(":"),B=U.indexOf("?"),q=U.indexOf("#"),V=U.indexOf("/");return j===-1||V!==-1&&j>V||B!==-1&&j>B||q!==-1&&j>q||safeProtocol.test(U.slice(0,j))?U:""}const sortOptions=[{key:"date_desc",label:"Date (Newest First)",icon:jsxRuntimeExports.jsx(CalendarIcon,{className:"w-5 h-5 text-gray-400"})},{key:"date_asc",label:"Date (Oldest First)",icon:jsxRuntimeExports.jsx(CalendarIcon,{className:"w-5 h-5 text-gray-400"})},{key:"score_desc",label:"Lead Score (High to Low)",icon:jsxRuntimeExports.jsx(ChartBarIcon,{className:"w-5 h-5 text-gray-400"})},{key:"score_asc",label:"Lead Score (Low to High)",icon:jsxRuntimeExports.jsx(ChartBarIcon,{className:"w-5 h-5 text-gray-400"})}],ChatbotLeadCard=({lead:U,onClick:j,style:B})=>{const q=V=>V>80?"border-green-500":V>60?"border-yellow-500":"border-gray-300";return jsxRuntimeExports.jsxs("div",{onClick:j,style:B,className:`bg-white rounded-lg shadow-md border-l-4 ${q(U.leadScore)} cursor-pointer hover:shadow-xl hover:scale-[1.02] transition-all duration-300 flex flex-col justify-between`,children:[jsxRuntimeExports.jsxs("div",{className:"p-5",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-800",children:U.userName}),jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-500",children:new Date(U.date).toLocaleDateString()})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-4",children:U.email}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-700 leading-relaxed h-20 overflow-hidden line-clamp-3",children:U.summary})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 px-5 py-3 rounded-b-lg flex justify-between items-center border-t",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Lead Score"}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-blue-600",children:U.leadScore})]})]})},ConversationHistory=({history:U})=>{const[j,B]=reactExports.useState(!1);return jsxRuntimeExports.jsxs("div",{className:"border rounded-lg",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>B(!j),className:"w-full flex justify-between items-center p-3 bg-gray-50 hover:bg-gray-100 transition-colors rounded-t-lg",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-700",children:"Conversation History"}),jsxRuntimeExports.jsx(ChevronDownIcon,{className:`w-5 h-5 text-gray-500 transition-transform ${j?"rotate-180":""}`})]}),j&&jsxRuntimeExports.jsx("div",{className:"p-4 bg-white border-t max-h-60 overflow-y-auto hide-scrollbar",children:jsxRuntimeExports.jsx("div",{className:"space-y-4",children:U.map((q,V)=>jsxRuntimeExports.jsxs("div",{className:`flex items-start gap-2.5 ${q.speaker==="user"?"justify-end":""}`,children:[q.speaker==="bot"&&jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600 text-sm flex-shrink-0",children:"AI"}),jsxRuntimeExports.jsx("div",{className:`max-w-[80%] p-3 rounded-lg ${q.speaker==="user"?"bg-blue-600 text-white rounded-br-none":"bg-gray-100 text-gray-800 rounded-bl-none"}`,children:jsxRuntimeExports.jsx("p",{className:"text-sm",children:q.text})})]},V))})})]})},DetailItem=({icon:U,label:j,value:B})=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-600 shadow-sm",children:U}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-800",children:B}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:j})]})]}),ChatbotLeadDetailModal=({lead:U,onClose:j,onAddLead:B})=>{const[q,V]=reactExports.useState(!1),H=async()=>{V(!0),await B(U)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 modal-overlay-animate-in",onClick:j,children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col modal-content-animate-in",onClick:$=>$.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 flex items-start justify-between p-5 border-b",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800",children:U.userName}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500",children:["Lead captured on ",new Date(U.date).toLocaleDateString()]})]}),jsxRuntimeExports.jsx("button",{onClick:j,className:"p-1 rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600",children:jsxRuntimeExports.jsx(CloseIcon,{className:"w-6 h-6"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 p-6 space-y-6 overflow-y-auto hide-scrollbar",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(DetailItem,{icon:jsxRuntimeExports.jsx(EnvelopeIcon,{className:"w-5 h-5"}),label:"Email",value:U.email}),jsxRuntimeExports.jsx(DetailItem,{icon:jsxRuntimeExports.jsx(PhoneIcon,{className:"w-5 h-5"}),label:"Mobile",value:U.mobile})]}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50/50 p-4 rounded-lg border-l-4 border-blue-400",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-800 font-semibold mb-2",children:"Conversation Summary"}),jsxRuntimeExports.jsx("div",{className:"text-gray-800 text-sm leading-relaxed prose prose-sm max-w-none prose-headings:font-bold prose-headings:text-gray-900 prose-p:text-gray-800 prose-strong:text-gray-900 prose-strong:font-semibold prose-ul:list-disc prose-ul:ml-4",children:jsxRuntimeExports.jsx(Markdown,{children:U.summary})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg flex items-center justify-between",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Lead Score"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-blue-600",children:U.leadScore})]}),jsxRuntimeExports.jsx(ConversationHistory,{history:U.conversationHistory})]}),jsxRuntimeExports.jsx("div",{className:"px-5 py-4 border-t bg-gray-50 rounded-b-xl flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:H,disabled:q,className:"w-full sm:w-auto px-5 py-2 flex justify-center bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-blue-400",children:q?jsxRuntimeExports.jsx(ButtonSpinner,{}):"Add Lead to CRM"})})]})})},ChatbotDataView=({isLoading:U,leads:j,onAddLead:B})=>{var ie;const[q,V]=reactExports.useState(null),[H,$]=reactExports.useState("date_desc"),[K,X]=reactExports.useState(!1),Q=reactExports.useRef(null),W=async ae=>{await B(ae),V(null)};reactExports.useEffect(()=>{const ae=oe=>{Q.current&&!Q.current.contains(oe.target)&&X(!1)};return document.addEventListener("mousedown",ae),()=>{document.removeEventListener("mousedown",ae)}},[]);const Z=reactExports.useMemo(()=>{const[ae,oe]=H.split("_"),de=[...j];return de.sort((le,ue)=>{if(ae==="date"){const he=new Date(le.date).getTime(),me=new Date(ue.date).getTime();return oe==="asc"?he-me:me-he}else{const he=le.leadScore,me=ue.leadScore;return oe==="asc"?he-me:me-he}}),de},[j,H]);if(U)return jsxRuntimeExports.jsx("div",{className:"p-8 h-full flex items-center justify-center bg-gray-50",children:jsxRuntimeExports.jsx(PageLoader,{})});const te=((ie=sortOptions.find(ae=>ae.key===H))==null?void 0:ie.label)||"Sort by";return jsxRuntimeExports.jsxs("div",{className:"p-6 md:p-8 h-full bg-gray-50 overflow-y-auto hide-scrollbar",children:[j.length>0&&jsxRuntimeExports.jsx("div",{className:"flex items-center justify-end gap-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"relative",ref:Q,children:[jsxRuntimeExports.jsxs("button",{onClick:()=>X(ae=>!ae),className:"flex items-center gap-2 text-sm bg-white border border-gray-300 rounded-md py-2 px-4 text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[jsxRuntimeExports.jsx(SortIcon,{className:"w-5 h-5 text-gray-500"}),jsxRuntimeExports.jsx("span",{children:te}),jsxRuntimeExports.jsx(ChevronDownIcon,{className:`w-5 h-5 text-gray-500 transition-transform ${K?"rotate-180":""}`})]}),K&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg border z-10 py-1",children:sortOptions.map(ae=>jsxRuntimeExports.jsxs("button",{onClick:()=>{$(ae.key),X(!1)},className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[ae.icon,jsxRuntimeExports.jsx("span",{className:"flex-1",children:ae.label}),H===ae.key&&jsxRuntimeExports.jsx(CheckIcon,{className:"w-5 h-5 text-blue-600"})]},ae.key))})]})}),Z.length>0?jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:Z.map((ae,oe)=>jsxRuntimeExports.jsx(ChatbotLeadCard,{lead:ae,onClick:()=>V(ae),style:{animation:"card-fade-in 0.5s ease-out forwards",animationDelay:`${oe*50}ms`,opacity:0}},ae.id))}):jsxRuntimeExports.jsxs("div",{className:"text-center h-full flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"No New Leads"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Leads captured from the chatbot will appear here."})]}),q&&jsxRuntimeExports.jsx(ChatbotLeadDetailModal,{lead:q,onClose:()=>V(null),onAddLead:W})]})},PriorityTag$1=({priority:U,theme:j})=>{const B=j==="light",q={Low:B?"bg-green-100 text-green-800":"bg-green-900/50 text-green-300",Medium:B?"bg-amber-100 text-amber-800":"bg-amber-900/50 text-amber-300",High:B?"bg-red-100 text-red-800":"bg-red-900/50 text-red-300"}[U];return jsxRuntimeExports.jsx("span",{className:`inline-block px-2.5 py-0.5 text-xs font-medium rounded-full ${q}`,children:U})},KanbanCard=({deal:U,theme:j="dark",style:B,onClick:q})=>{const V=j==="light",H=V?"p-4 bg-white rounded-lg border border-gray-200/80 shadow transition-all duration-200 ease-in-out w-full text-left relative group hover:-translate-y-1 hover:shadow-md":"kanban-card p-4 w-full text-left relative group",$=V?"text-gray-900":"text-white",K=V?"text-green-800":"text-green-300",X=V?"text-gray-800 font-semibold":"text-white font-semibold",Q=V?"text-gray-600":"text-white/80",W=V?"border-gray-200/80":"border-white/20",Z=te=>{te.dataTransfer.setData("dealId",U.id)};return jsxRuntimeExports.jsx("div",{className:`${H} kanban-card-animate-in`,style:B,draggable:"true",onDragStart:Z,onClick:q,children:jsxRuntimeExports.jsxs("div",{className:"cursor-pointer",children:[jsxRuntimeExports.jsx("h4",{className:`text-lg font-bold ${$}`,children:U.companyName}),jsxRuntimeExports.jsxs("p",{className:`mt-1 text-base font-semibold ${K}`,children:["$",U.dealValue.toLocaleString()]}),jsxRuntimeExports.jsxs("div",{className:"mt-3 space-y-1",children:[jsxRuntimeExports.jsx("p",{className:`text-sm ${X}`,children:U.contactPerson}),U.email&&jsxRuntimeExports.jsx("p",{className:`text-xs ${Q}`,children:U.email}),U.mobile&&jsxRuntimeExports.jsx("p",{className:`text-xs ${Q}`,children:U.mobile})]}),jsxRuntimeExports.jsx("div",{className:`mt-4 pt-3 border-t ${W}`,children:jsxRuntimeExports.jsx(PriorityTag$1,{priority:U.priority,theme:j})})]})})},KanbanColumn=({column:U,theme:j="dark",onCardDrop:B,onCardClick:q})=>{const[V,H]=reactExports.useState(!1),$=j==="light",K=$?"bg-slate-100 border border-slate-200/80 rounded-xl":"kanban-column",X=$?"text-slate-700 border-b border-slate-200":"text-white border-b border-white/20",Q=V?$?"bg-blue-100 border-2 !border-blue-400":"kanban-column-drag-over":"",W=ae=>{ae.preventDefault()},Z=ae=>{ae.preventDefault(),H(!0)},te=()=>{H(!1)},ie=ae=>{ae.preventDefault(),H(!1);const oe=ae.dataTransfer.getData("dealId");oe&&B(oe,U.id)};return jsxRuntimeExports.jsxs("div",{className:`flex-1 min-w-[300px] flex flex-col gap-4 p-4 transition-colors duration-200 ${K} ${Q}`,onDragOver:W,onDragEnter:Z,onDragLeave:te,onDrop:ie,children:[jsxRuntimeExports.jsxs("h3",{className:`text-lg font-semibold mb-2 pb-2 flex items-center justify-between ${X}`,children:[jsxRuntimeExports.jsx("span",{children:U.title}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-slate-500 bg-slate-200/80 px-2 py-0.5 rounded-full",children:U.deals.length})]}),jsxRuntimeExports.jsx("div",{className:"flex flex-col gap-4 overflow-y-auto pr-1.5 hide-scrollbar",children:U.deals.map((ae,oe)=>jsxRuntimeExports.jsx(KanbanCard,{deal:ae,theme:j,onClick:()=>q(ae),style:{animationDelay:`${oe*50}ms`}},ae.id))})]})},ManageLeadsView=({isLoading:U,kanbanData:j,searchQuery:B,onSearchQueryChange:q,onCardDrop:V,onCardClick:H})=>{const $=reactExports.useMemo(()=>{if(!Array.isArray(j))return[];if(!B.trim())return j;const K=B.toLowerCase();return j.map(X=>({...X,deals:X.deals.filter(Q=>Q.companyName.toLowerCase().includes(K)||Q.contactPerson.toLowerCase().includes(K)||Q.dealValue.toString().includes(K))}))},[j,B]);return U?jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:jsxRuntimeExports.jsx(PageLoader,{})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 px-6 md:px-8 py-3 border-b border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"relative max-w-sm",children:[jsxRuntimeExports.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:jsxRuntimeExports.jsx(SearchIcon,{className:"h-5 w-5 text-gray-400"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search leads...",value:B,onChange:K=>q(K.target.value),className:"w-full block pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"kanban-board h-full",children:Array.isArray($)&&$.map(K=>jsxRuntimeExports.jsx(KanbanColumn,{column:K,theme:"light",onCardDrop:V,onCardClick:H},K.id))})})]})},PriorityTag=({priority:U})=>{const j={Low:"priority-low",Medium:"priority-medium",High:"priority-high"}[U];return jsxRuntimeExports.jsx("span",{className:`priority-tag ${j}`,children:U})},DetailCard=({label:U,children:j})=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mb-1",children:U}),jsxRuntimeExports.jsx("div",{className:"text-gray-800",children:j})]}),LeadDetailsView=({deal:U,onEditClick:j})=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2 pb-2 border-b",children:"Summary"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:U.summary})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2 pb-2 border-b",children:"Meeting Notes"}),U.meetingNotes&&U.meetingNotes.trim()?jsxRuntimeExports.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:U.meetingNotes}):jsxRuntimeExports.jsx("p",{className:"text-gray-500 italic",children:"No notes added yet."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2 pb-2 border-b",children:"Comments"}),U.comments&&U.comments.trim()?jsxRuntimeExports.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:U.comments}):jsxRuntimeExports.jsx("p",{className:"text-gray-500 italic",children:"No comments added yet."})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(DetailCard,{label:"Deal Value",children:jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["$",U.dealValue.toLocaleString()]})}),jsxRuntimeExports.jsx(DetailCard,{label:"Priority",children:jsxRuntimeExports.jsx(PriorityTag,{priority:U.priority})}),jsxRuntimeExports.jsxs(DetailCard,{label:"Contact Person",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold",children:U.contactPerson}),U.email&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-2 text-gray-600",children:[jsxRuntimeExports.jsx(EnvelopeIcon,{className:"w-4 h-4 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-sm truncate",children:U.email})]}),U.mobile&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1 text-gray-600",children:[jsxRuntimeExports.jsx(PhoneIcon,{className:"w-4 h-4 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-sm",children:U.mobile})]})]}),jsxRuntimeExports.jsx(DetailCard,{label:"Assignee",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center text-xs font-bold text-gray-600",children:"U"}),jsxRuntimeExports.jsx("span",{children:"Unassigned"})]})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-xl flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:j,className:"px-5 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"Edit Details"})})]}),LeadDetailsEditForm=({formData:U,onFormChange:j,onSave:B,onCancel:q,onDelete:V,isSaving:H})=>{const[$,K]=reactExports.useState({}),X=ae=>{const oe={};return ae.companyName.trim()||(oe.companyName="Company Name cannot be empty."),ae.dealValue<0&&(oe.dealValue="Deal Value must be a non-negative number."),ae.contactPerson.trim()||(oe.contactPerson="Contact Person cannot be empty."),ae.summary.trim()||(oe.summary="Summary cannot be empty."),oe};reactExports.useEffect(()=>{K(X(U))},[U]);const Q=()=>{const ae=X(U);Object.keys(ae).length===0?B():K(ae)},W="w-full p-2 bg-white border rounded-md text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2",Z="border-gray-300 focus:ring-blue-500 focus:border-blue-500",te="border-red-500 focus:ring-red-500 focus:border-red-500",ie=Object.keys($).length===0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Company Name"}),jsxRuntimeExports.jsx("input",{name:"companyName",value:U.companyName,onChange:j,className:`${W} ${$.companyName?te:Z}`}),$.companyName&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-xs mt-1",children:$.companyName})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Summary"}),jsxRuntimeExports.jsx("textarea",{name:"summary",value:U.summary,onChange:j,className:`${W} ${$.summary?te:Z}`,rows:3}),$.summary&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-xs mt-1",children:$.summary})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Meeting Notes"}),jsxRuntimeExports.jsx("textarea",{name:"meetingNotes",value:U.meetingNotes||"",onChange:j,className:`${W} ${Z}`,rows:4,placeholder:"Add any meeting notes here..."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Comments"}),jsxRuntimeExports.jsx("textarea",{name:"comments",value:U.comments||"",onChange:j,className:`${W} ${Z}`,rows:4,placeholder:"Add general comments here..."})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Deal Value ($)"}),jsxRuntimeExports.jsx("input",{name:"dealValue",value:U.dealValue,onChange:j,className:`${W} ${$.dealValue?te:Z}`,type:"text"}),$.dealValue&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-xs mt-1",children:$.dealValue})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Priority"}),jsxRuntimeExports.jsxs("select",{name:"priority",value:U.priority,onChange:j,className:`${W} ${Z}`,children:[jsxRuntimeExports.jsx("option",{children:"Low"}),jsxRuntimeExports.jsx("option",{children:"Medium"}),jsxRuntimeExports.jsx("option",{children:"High"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Contact Person"}),jsxRuntimeExports.jsx("input",{name:"contactPerson",value:U.contactPerson,onChange:j,className:`${W} ${$.contactPerson?te:Z}`}),$.contactPerson&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-xs mt-1",children:$.contactPerson})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Email"}),jsxRuntimeExports.jsx("input",{name:"email",value:U.email||"",onChange:j,className:`${W} ${Z}`,type:"email",placeholder:"contact@example.com"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:"Mobile"}),jsxRuntimeExports.jsx("input",{name:"mobile",value:U.mobile||"",onChange:j,className:`${W} ${Z}`,type:"text",placeholder:"555-123-4567"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-xl flex justify-between items-center",children:[jsxRuntimeExports.jsxs("button",{onClick:V,disabled:H,className:"px-3 py-2 text-sm text-red-600 rounded-lg font-semibold hover:bg-red-100 transition-colors disabled:opacity-50 flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(TrashIcon,{className:"w-4 h-4"}),"Delete Lead"]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-3",children:[jsxRuntimeExports.jsx("button",{onClick:q,disabled:H,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Q,disabled:H||!ie,className:"px-4 py-2 w-28 flex justify-center bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-blue-400 disabled:cursor-not-allowed",children:H?jsxRuntimeExports.jsx(ButtonSpinner,{}):"Save"})]})]})]})},LeadDetailsModal=({deal:U,onClose:j,onSave:B,onDelete:q})=>{const[V,H]=reactExports.useState(!1),[$,K]=reactExports.useState({...U}),[X,Q]=reactExports.useState(!1);reactExports.useEffect(()=>{K({...U})},[U]),reactExports.useEffect(()=>{const ie=ae=>{ae.key==="Escape"&&j()};return window.addEventListener("keydown",ie),()=>window.removeEventListener("keydown",ie)},[j]);const W=ie=>{const{name:ae,value:oe}=ie.target,de=ae==="dealValue";K(le=>({...le,[ae]:de?Number(oe.replace(/[^0-9]/g,"")):oe}))},Z=async()=>{Q(!0);try{await B($),H(!1)}catch(ie){console.error("Failed to save deal details:",ie)}finally{Q(!1)}},te=()=>{K({...U}),H(!1)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 modal-overlay-animate-in lead-details-modal",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col modal-content-animate-in",onClick:ie=>ie.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800",children:U.companyName}),jsxRuntimeExports.jsx("button",{onClick:j,className:"p-1 rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600",children:jsxRuntimeExports.jsx(CloseIcon,{className:"w-6 h-6"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar",children:V?jsxRuntimeExports.jsx(LeadDetailsEditForm,{formData:$,onFormChange:W,onSave:Z,onCancel:te,isSaving:X,onDelete:()=>q($.id)}):jsxRuntimeExports.jsx(LeadDetailsView,{deal:$,onEditClick:()=>H(!0)})})]})})},ServiceCard=({ticket:U,columnTitle:j,style:B,onClick:q})=>{const V="p-4 bg-white rounded-lg border border-gray-200/80 shadow transition-all duration-200 ease-in-out w-full text-left relative group hover:-translate-y-1 hover:shadow-md",H=K=>{K.dataTransfer.setData("ticketId",U.id)},$=()=>{let K="Opened",X=U.dateOpened;return j==="Connected"&&U.dateConnected?(K="Connected",X=U.dateConnected):j==="Resolved"&&U.dateResolved&&(K="Resolved",X=U.dateResolved),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:[K,": ",new Date(X).toLocaleDateString()]})};return jsxRuntimeExports.jsx("div",{className:`${V} kanban-card-animate-in`,style:B,draggable:"true",onDragStart:H,onClick:q,children:jsxRuntimeExports.jsxs("div",{className:"cursor-pointer",children:[jsxRuntimeExports.jsx("h4",{className:"text-base font-bold text-gray-900",children:U.customerName}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-gray-600 leading-snug line-clamp-3",children:U.issueSummary}),jsxRuntimeExports.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200/80",children:$()})]})})},ServiceColumn=({column:U,onCardDrop:j,onCardClick:B})=>{const[q,V]=reactExports.useState(!1),H="bg-slate-100 border border-slate-200/80 rounded-xl",$="text-slate-700 border-b border-slate-200",K=q?"bg-blue-100 border-2 !border-blue-400":"",X=te=>{te.preventDefault()},Q=te=>{te.preventDefault(),V(!0)},W=()=>{V(!1)},Z=te=>{te.preventDefault(),V(!1);const ie=te.dataTransfer.getData("ticketId");ie&&j(ie,U.id)};return jsxRuntimeExports.jsxs("div",{className:`flex-1 min-w-[300px] flex flex-col gap-4 p-4 transition-colors duration-200 ${H} ${K}`,onDragOver:X,onDragEnter:Q,onDragLeave:W,onDrop:Z,children:[jsxRuntimeExports.jsxs("h3",{className:`text-lg font-semibold mb-2 pb-2 flex items-center justify-between ${$}`,children:[jsxRuntimeExports.jsx("span",{children:U.title}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-slate-500 bg-slate-200/80 px-2 py-0.5 rounded-full",children:U.tickets.length})]}),jsxRuntimeExports.jsx("div",{className:"flex flex-col gap-4 overflow-y-auto pr-1.5 hide-scrollbar",children:U.tickets.map((te,ie)=>jsxRuntimeExports.jsx(ServiceCard,{ticket:te,columnTitle:U.title,onClick:()=>B(te),style:{animationDelay:`${ie*50}ms`}},te.id))})]})},InboundServiceView=({isLoading:U,serviceBoardData:j,onCardDrop:B,onCardClick:q})=>U?jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:jsxRuntimeExports.jsx(PageLoader,{})}):jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"kanban-board h-full",children:j.map(V=>jsxRuntimeExports.jsx(ServiceColumn,{column:V,onCardDrop:B,onCardClick:q},V.id))})}),ReadOnlyField=({label:U,value:j})=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:U}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-gray-50 rounded-lg min-h-[6rem]",children:j&&j.trim()?jsxRuntimeExports.jsx("p",{className:"text-gray-800 whitespace-pre-wrap",children:j}):jsxRuntimeExports.jsxs("p",{className:"text-gray-500 italic",children:["No ",U.toLowerCase()," added yet."]})})]}),EditInputField=({label:U,name:j,value:B,onChange:q,type:V="text",placeholder:H})=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:U}),jsxRuntimeExports.jsx("input",{name:j,value:B||"",onChange:q,type:V,placeholder:H||`Enter ${U.toLowerCase()}...`,className:"w-full p-2 bg-white border border-gray-300 rounded-md text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"})]}),EditNoteField=({label:U,name:j,value:B,onChange:q})=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1 block",children:U}),jsxRuntimeExports.jsx("textarea",{name:j,value:B||"",onChange:q,className:"w-full p-2 bg-white border border-gray-300 rounded-md text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",rows:4,placeholder:`Add ${U.toLowerCase()} here...`})]}),ServiceTicketModal=({ticket:U,onClose:j,onSave:B})=>{const[q,V]=reactExports.useState(!1),[H,$]=reactExports.useState({...U}),[K,X]=reactExports.useState(!1);reactExports.useEffect(()=>{$({...U})},[U]),reactExports.useEffect(()=>{const ie=ae=>{ae.key==="Escape"&&j()};return window.addEventListener("keydown",ie),()=>window.removeEventListener("keydown",ie)},[j]);const Q=ie=>{const{name:ae,value:oe}=ie.target;$(de=>({...de,[ae]:oe}))},W=async()=>{X(!0);try{await B(H),V(!1)}catch(ie){console.error("Failed to save ticket:",ie)}finally{X(!1)}},Z=()=>{$({...U}),V(!1)},te=({ticket:ie})=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:"Customer Details"}),jsxRuntimeExports.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(UserCircleIcon,{className:"w-5 h-5 text-gray-500 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium truncate",title:ie.customerName,children:ie.customerName})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(EnvelopeIcon,{className:"w-5 h-5 text-gray-500 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 truncate",title:ie.contactEmail,children:ie.contactEmail||"N/A"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(PhoneIcon,{className:"w-5 h-5 text-gray-500 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 truncate",title:ie.contactPhone,children:ie.contactPhone||"N/A"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(MapPinIcon,{className:"w-5 h-5 text-gray-500 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 truncate",title:`${ie.city}, ${ie.country}`,children:ie.city&&ie.country?`${ie.city}, ${ie.country}`:"N/A"})]})]})]});return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 modal-overlay-animate-in",onClick:j,children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col modal-content-animate-in",onClick:ie=>ie.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 flex items-start justify-between p-5 border-b",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Ticket Details"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500",children:["Ticket ID: ",U.id]})]}),jsxRuntimeExports.jsx("button",{onClick:j,className:"p-1 rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600",children:jsxRuntimeExports.jsx(CloseIcon,{className:"w-6 h-6"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 p-6 space-y-6 overflow-y-auto hide-scrollbar",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:"Issue Summary"}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-blue-50/70 border-l-4 border-blue-400 rounded-r-lg",children:jsxRuntimeExports.jsx("p",{className:"text-gray-800",children:U.issueSummary})})]}),q?jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:"Edit Customer Details"}),jsxRuntimeExports.jsxs("div",{className:"p-4 border rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(EditInputField,{label:"Customer Name",name:"customerName",value:H.customerName,onChange:Q}),jsxRuntimeExports.jsx(EditInputField,{label:"Email",name:"contactEmail",value:H.contactEmail||"",onChange:Q,type:"email"}),jsxRuntimeExports.jsx(EditInputField,{label:"Mobile Number",name:"contactPhone",value:H.contactPhone||"",onChange:Q,placeholder:"+1 555-123-4567"}),jsxRuntimeExports.jsx(EditInputField,{label:"City",name:"city",value:H.city||"",onChange:Q}),jsxRuntimeExports.jsx(EditInputField,{label:"Country",name:"country",value:H.country||"",onChange:Q})]})]}),jsxRuntimeExports.jsx(EditNoteField,{label:"Notes",name:"notes",value:H.notes||"",onChange:Q}),jsxRuntimeExports.jsx(EditNoteField,{label:"Comments",name:"comments",value:H.comments||"",onChange:Q})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(te,{ticket:H}),jsxRuntimeExports.jsx(ReadOnlyField,{label:"Notes",value:H.notes}),jsxRuntimeExports.jsx(ReadOnlyField,{label:"Comments",value:H.comments})]})]}),jsxRuntimeExports.jsx("div",{className:"px-5 py-4 border-t bg-gray-50 rounded-b-xl flex justify-end space-x-3",children:q?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:Z,disabled:K,className:"px-5 py-2 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition-colors disabled:opacity-50",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:W,disabled:K,className:"px-5 py-2 w-28 flex justify-center bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-blue-400",children:K?jsxRuntimeExports.jsx(ButtonSpinner,{}):"Save"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>V(!0),className:"px-5 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"Edit Ticket"})})]})})},ConfirmationModal=({isOpen:U,title:j,message:B,onConfirm:q,onCancel:V,confirmButtonText:H="Confirm",cancelButtonText:$="Cancel"})=>U?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 modal-overlay-animate-in",onClick:V,children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md modal-content-animate-in",onClick:K=>K.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"p-6 text-center",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-gray-800",children:j}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-gray-600",children:B})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-xl flex justify-end space-x-3",children:[jsxRuntimeExports.jsx("button",{onClick:V,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:$}),jsxRuntimeExports.jsx("button",{onClick:q,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:H})]})]})}):null,CrmPage=()=>{const[U,j]=reactExports.useState([]),[B,q]=reactExports.useState([]),[V,H]=reactExports.useState([]),[$,K]=reactExports.useState(!0),[X,Q]=reactExports.useState("chatbotData"),[W,Z]=reactExports.useState(null),[te,ie]=reactExports.useState(null),[ae,oe]=reactExports.useState(""),[de,le]=reactExports.useState(null),[ue,he]=reactExports.useState(!1);reactExports.useEffect(()=>{(async()=>{var we,$e;K(!0),he(!1);try{const[Ye,pe,ve]=await Promise.all([getKanbanData(),getChatbotLeads(),getServiceBoardData()]);j(Ye),q(pe),H(ve)}catch(Ye){console.error("Failed to fetch CRM data:",Ye),((we=Ye==null?void 0:Ye.message)!=null&&we.includes("403")||($e=Ye==null?void 0:Ye.message)!=null&&$e.includes("Forbidden"))&&he(!0)}finally{K(!1)}})()},[]);const me=async(Se,we)=>{try{const $e=await updateDealColumn(Se,we);j($e)}catch($e){console.error("Error updating deal column:",$e)}},be=Se=>{Z(Se)},ge=()=>{Z(null)},Ee=async Se=>{const we=await updateDealDetails(Se);return j(we),Z(Se),we},Fe=async Se=>{if(window.confirm("Are you sure you want to delete this lead? This action cannot be undone."))try{const we=await deleteDeal(Se);j(we),Z(null)}catch(we){console.error("Error deleting deal:",we)}},Ue=async Se=>{const we={companyName:`${Se.userName}'s Company`,dealValue:0,contactPerson:Se.userName,email:Se.email,mobile:Se.mobile,summary:Se.summary,priority:"Medium",meetingNotes:"",comments:""};try{const[$e,Ye]=await Promise.all([addDeal(we),deleteChatbotLead(Se.id)]);j($e),q(Ye)}catch($e){console.error("Failed to add lead:",$e)}},ze=(Se,we)=>{let $e;for(const Ye of V)if(Ye.tickets.find(pe=>pe.id===Se)){$e=Ye.id;break}if($e!==we)if(we==="connected"||we==="resolved"){const Ye=V.find(pe=>pe.id===we);Ye&&le({ticketId:Se,targetColumnId:we,targetColumnTitle:Ye.title})}else{const Ye=updateTicketColumn(Se,we);H(Ye)}},xe=()=>{if(!de)return;const{ticketId:Se,targetColumnId:we}=de,$e=updateTicketColumn(Se,we);H($e),le(null)},Ie=()=>{le(null)},Ge=Se=>{ie(Se)},De=()=>{ie(null)},Ve=async Se=>{const we=await updateServiceTicketDetails(Se);H(we),ie(Se)};return ue?jsxRuntimeExports.jsx("div",{className:"w-full h-screen flex flex-col items-center justify-center bg-gray-50",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md p-8 bg-white rounded-lg shadow-lg text-center",children:[jsxRuntimeExports.jsx("div",{className:"mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-16 h-16 mx-auto text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"You don't have permission to access the CRM. Only administrators can view this page."}),jsxRuntimeExports.jsx("button",{onClick:()=>window.location.href="/",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Home"})]})}):jsxRuntimeExports.jsxs("div",{className:"w-full h-screen flex flex-col bg-white pt-16",children:[jsxRuntimeExports.jsx(CrmNavbar,{activeTab:X,onTabChange:Q}),jsxRuntimeExports.jsxs("main",{className:"flex-1 overflow-hidden flex flex-col",children:[X==="manageLeads"&&jsxRuntimeExports.jsx(ManageLeadsView,{isLoading:$,kanbanData:U,searchQuery:ae,onSearchQueryChange:oe,onCardDrop:me,onCardClick:be}),X==="chatbotData"&&jsxRuntimeExports.jsx(ChatbotDataView,{isLoading:$,leads:B,onAddLead:Ue}),X==="inboundService"&&jsxRuntimeExports.jsx(InboundServiceView,{isLoading:$,serviceBoardData:V,onCardDrop:ze,onCardClick:Ge})]}),W&&jsxRuntimeExports.jsx(LeadDetailsModal,{deal:W,onClose:ge,onSave:Ee,onDelete:Fe}),te&&jsxRuntimeExports.jsx(ServiceTicketModal,{ticket:te,onClose:De,onSave:Ve}),de&&jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:!!de,title:"Confirm Status Change",message:`Are you sure you want to move this ticket to the "${de.targetColumnTitle}" column?`,onConfirm:xe,onCancel:Ie,confirmButtonText:"Move Ticket"})]})};let sessionId=`session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`;const initChat=()=>{sessionId=`session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`},getUser=()=>{const U=localStorage.getItem("user");if(!U)return null;try{return JSON.parse(U)}catch{return null}};async function*streamResponse(U,j){try{const B=j?"/chat/inbound/message":"/chat/outbound/message",q=getUser(),V={session_id:sessionId,message:U};j&&q&&(V.user_id=q.id);const H=await fetch(`${API_BASE_URL}${B}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)});if(!H.ok)throw new Error(`HTTP error! status: ${H.status}`);const X=(await H.json()).response.split(" ");for(let Q=0;Q<X.length;Q++)await new Promise(W=>setTimeout(W,50)),yield{text:X[Q]+(Q<X.length-1?" ":"")}}catch(B){console.error("Error calling backend:",B),yield{text:"Sorry, I encountered an error. Please try again."}}}const sendMessage=(U,j)=>streamResponse(U,j),transcribeAudio=async(U,j)=>{try{const B=await fetch(`${API_BASE_URL}/chat/transcribe`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audio:U,mime_type:j})});if(!B.ok)throw new Error(`HTTP error! status: ${B.status}`);return(await B.json()).transcription}catch(B){return console.error("Error transcribing audio:",B),"Audio transcription failed. Please try again."}},blobToBase64=U=>new Promise((j,B)=>{const q=new FileReader;q.onloadend=()=>{var H;const V=(H=q.result)==null?void 0:H.toString().split(",")[1];V?j(V):B(new Error("Failed to convert blob to base64"))},q.onerror=B,q.readAsDataURL(U)}),handleApiError=U=>{var j,B;if(console.error("API Error:",U),typeof U=="object"&&U!==null&&"message"in U)try{const q=JSON.parse(U.message);return((j=q==null?void 0:q.error)==null?void 0:j.code)===429?"Too many requests. Please wait a moment and try again.":((B=q==null?void 0:q.error)==null?void 0:B.message)||"An unexpected error occurred."}catch{return U.message||"An unexpected error occurred."}return"An unexpected error occurred. Please try again later."},useAudioRecorder=({onTranscriptionComplete:U})=>{const[j,B]=reactExports.useState(!1),[q,V]=reactExports.useState(""),H=reactExports.useRef(null),$=reactExports.useRef([]),K=async()=>{try{const W=await navigator.mediaDevices.getUserMedia({audio:!0});H.current=new MediaRecorder(W),$.current=[],H.current.ondataavailable=Z=>{$.current.push(Z.data)},H.current.onstop=async()=>{V("Transcribing...");const Z=new Blob($.current,{type:"audio/webm"});try{const te=await blobToBase64(Z),ie=Z.type,ae=await transcribeAudio(te,ie);ae?(V(""),await U(ae)):V("Transcription failed. Please try again.")}catch(te){const ie=handleApiError(te);V(ie)}finally{W.getTracks().forEach(te=>te.stop())}},H.current.start(),B(!0),V("Recording...")}catch(W){console.error("Error accessing microphone:",W),V("Microphone access denied.")}},X=()=>{H.current&&j&&(H.current.stop(),B(!1))};return{isRecording:j,statusMessage:q,handleMicClick:()=>{j?X():K()}}},ChatBubble=({role:U,text:j})=>{const B=U==="user",q=B?"bg-blue-600 text-white self-end":"bg-gray-300 text-gray-800 self-start",V=j&&j.trim().length>0;return jsxRuntimeExports.jsx("div",{className:`w-full flex ${B?"justify-end":"justify-start"} chat-bubble-animate-in`,children:jsxRuntimeExports.jsx("div",{className:`max-w-[80%] md:max-w-[70%] p-3 rounded-2xl ${q} transition-all duration-300 ease-in-out`,children:V?jsxRuntimeExports.jsx("p",{className:"whitespace-pre-wrap",children:j}):jsxRuntimeExports.jsx(LoadingSpinner,{})})})},ChatMessageArea=({messages:U})=>{const j=reactExports.useRef(null);return reactExports.useEffect(()=>{j.current&&j.current.scrollTo({top:j.current.scrollHeight,behavior:"smooth"})},[U]),jsxRuntimeExports.jsx("div",{ref:j,className:"flex-1 px-3 sm:px-6 pt-3 sm:pt-6 pb-20 sm:pb-24 space-y-3 sm:space-y-4 overflow-y-auto scroll-smooth hide-scrollbar",children:U.map((B,q)=>jsxRuntimeExports.jsx(ChatBubble,{role:B.role,text:B.parts[0].text},q))})},ChatButton=({isLoading:U,isRecording:j,hasInput:B,onMicClick:q})=>{const V="flex-shrink-0 w-11 h-11 rounded-full flex items-center justify-center transition-all duration-200",H="disabled:bg-gray-200 disabled:text-gray-400 disabled:cursor-not-allowed";return B?jsxRuntimeExports.jsx("button",{type:"submit",disabled:U,className:`${V} bg-blue-600 text-white hover:bg-blue-700 ${H}`,"aria-label":"Send message",children:jsxRuntimeExports.jsx(SendIcon,{className:"w-6 h-6"})}):j?jsxRuntimeExports.jsx("button",{type:"button",onClick:q,className:`${V} bg-red-500 text-white hover:bg-red-600 animate-pulse`,"aria-label":"Stop recording",children:jsxRuntimeExports.jsx(StopIcon,{className:"w-6 h-6"})}):jsxRuntimeExports.jsx("button",{type:"button",onClick:q,disabled:U,className:`${V} bg-gray-200 text-gray-800 hover:bg-gray-300 ${H}`,"aria-label":"Start recording",children:jsxRuntimeExports.jsx(MicIcon,{className:"w-6 h-6"})})},ChatInput=({isLoading:U,isRecording:j,statusMessage:B,onSendMessage:q,onMicClick:V,transcribedText:H,onTranscribedTextUsed:$})=>{const[K,X]=reactExports.useState(""),Q=reactExports.useRef(null);reactExports.useEffect(()=>{var te;(te=Q.current)==null||te.focus()},[]),reactExports.useEffect(()=>{var te;!U&&!j&&((te=Q.current)==null||te.focus())},[U,j]),reactExports.useEffect(()=>{var te;H&&(X(H),$==null||$(),(te=Q.current)==null||te.focus())},[H,$]);const W=te=>{te.preventDefault(),K.trim()&&(q(K),X(""),setTimeout(()=>{var ie;return(ie=Q.current)==null?void 0:ie.focus()},0))},Z=te=>{te.key==="Enter"&&!te.shiftKey&&(te.preventDefault(),W(te))};return jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-4 bg-gradient-to-t from-white via-white/90 to-transparent",children:jsxRuntimeExports.jsxs("form",{onSubmit:W,className:"flex items-center w-full rounded-full bg-white shadow-lg border border-gray-200/80 py-1.5 pl-6 pr-2",children:[jsxRuntimeExports.jsx("textarea",{ref:Q,value:K,onChange:te=>X(te.target.value),onKeyDown:Z,placeholder:B||"Type or record a message...",className:"flex-grow w-full bg-transparent text-gray-800 placeholder-gray-500 focus:outline-none resize-none mr-3",rows:1,disabled:U||j}),jsxRuntimeExports.jsx(ChatButton,{isLoading:U,isRecording:j,hasInput:K.trim().length>0,onMicClick:V})]})})};var define_process_env_default={};function _mergeNamespaces(U,j){return j.forEach(function(B){B&&typeof B!="string"&&!Array.isArray(B)&&Object.keys(B).forEach(function(q){if(q!=="default"&&!(q in U)){var V=Object.getOwnPropertyDescriptor(B,q);Object.defineProperty(U,q,V.get?V:{enumerable:!0,get:function(){return B[q]}})}})}),Object.freeze(U)}var e$1=Object.defineProperty,h$1=(U,j,B)=>j in U?e$1(U,j,{enumerable:!0,configurable:!0,writable:!0,value:B}):U[j]=B,o$1=(U,j,B)=>h$1(U,typeof j!="symbol"?j+"":j,B);let _$1=class{constructor(){o$1(this,"_locking"),o$1(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let j;const B=new Promise(V=>j=()=>{this._locks-=1,V()}),q=this._locking.then(()=>j);return this._locking=this._locking.then(()=>B),q}};function assert(U,j){if(!U)throw new Error(j)}const FLOAT32_MAX=34028234663852886e22,FLOAT32_MIN=-34028234663852886e22,UINT32_MAX=4294967295,INT32_MAX=2147483647,INT32_MIN=-2147483648;function assertInt32(U){if(typeof U!="number")throw new Error("invalid int 32: "+typeof U);if(!Number.isInteger(U)||U>INT32_MAX||U<INT32_MIN)throw new Error("invalid int 32: "+U)}function assertUInt32(U){if(typeof U!="number")throw new Error("invalid uint 32: "+typeof U);if(!Number.isInteger(U)||U>UINT32_MAX||U<0)throw new Error("invalid uint 32: "+U)}function assertFloat32(U){if(typeof U!="number")throw new Error("invalid float 32: "+typeof U);if(Number.isFinite(U)&&(U>FLOAT32_MAX||U<FLOAT32_MIN))throw new Error("invalid float 32: "+U)}const enumTypeSymbol=Symbol("@bufbuild/protobuf/enum-type");function getEnumType(U){const j=U[enumTypeSymbol];return assert(j,"missing enum type on enum object"),j}function setEnumType(U,j,B,q){U[enumTypeSymbol]=makeEnumType(j,B.map(V=>({no:V.no,name:V.name,localName:U[V.no]})))}function makeEnumType(U,j,B){const q=Object.create(null),V=Object.create(null),H=[];for(const $ of j){const K=normalizeEnumValue($);H.push(K),q[$.name]=K,V[$.no]=K}return{typeName:U,values:H,findName($){return q[$]},findNumber($){return V[$]}}}function makeEnum(U,j,B){const q={};for(const V of j){const H=normalizeEnumValue(V);q[H.localName]=H.no,q[H.no]=H.localName}return setEnumType(q,U,j),q}function normalizeEnumValue(U){return"localName"in U?U:Object.assign(Object.assign({},U),{localName:U.name})}class Message{equals(j){return this.getType().runtime.util.equals(this.getType(),this,j)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(j,B){const q=this.getType(),V=q.runtime.bin,H=V.makeReadOptions(B);return V.readMessage(this,H.readerFactory(j),j.byteLength,H),this}fromJson(j,B){const q=this.getType(),V=q.runtime.json,H=V.makeReadOptions(B);return V.readMessage(q,j,H,this),this}fromJsonString(j,B){let q;try{q=JSON.parse(j)}catch(V){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(V instanceof Error?V.message:String(V)))}return this.fromJson(q,B)}toBinary(j){const B=this.getType(),q=B.runtime.bin,V=q.makeWriteOptions(j),H=V.writerFactory();return q.writeMessage(this,H,V),H.finish()}toJson(j){const B=this.getType(),q=B.runtime.json,V=q.makeWriteOptions(j);return q.writeMessage(this,V)}toJsonString(j){var B;const q=this.toJson(j);return JSON.stringify(q,null,(B=j==null?void 0:j.prettySpaces)!==null&&B!==void 0?B:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function makeMessageType(U,j,B,q){var V;const H=(V=q==null?void 0:q.localName)!==null&&V!==void 0?V:j.substring(j.lastIndexOf(".")+1),$={[H]:function(K){U.util.initFields(this),U.util.initPartial(K,this)}}[H];return Object.setPrototypeOf($.prototype,new Message),Object.assign($,{runtime:U,typeName:j,fields:U.util.newFieldList(B),fromBinary(K,X){return new $().fromBinary(K,X)},fromJson(K,X){return new $().fromJson(K,X)},fromJsonString(K,X){return new $().fromJsonString(K,X)},equals(K,X){return U.util.equals($,K,X)}}),$}function varint64read(){let U=0,j=0;for(let q=0;q<28;q+=7){let V=this.buf[this.pos++];if(U|=(V&127)<<q,(V&128)==0)return this.assertBounds(),[U,j]}let B=this.buf[this.pos++];if(U|=(B&15)<<28,j=(B&112)>>4,(B&128)==0)return this.assertBounds(),[U,j];for(let q=3;q<=31;q+=7){let V=this.buf[this.pos++];if(j|=(V&127)<<q,(V&128)==0)return this.assertBounds(),[U,j]}throw new Error("invalid varint")}function varint64write(U,j,B){for(let H=0;H<28;H=H+7){const $=U>>>H,K=!(!($>>>7)&&j==0),X=(K?$|128:$)&255;if(B.push(X),!K)return}const q=U>>>28&15|(j&7)<<4,V=j>>3!=0;if(B.push((V?q|128:q)&255),!!V){for(let H=3;H<31;H=H+7){const $=j>>>H,K=!!($>>>7),X=(K?$|128:$)&255;if(B.push(X),!K)return}B.push(j>>>31&1)}}const TWO_PWR_32_DBL=4294967296;function int64FromString(U){const j=U[0]==="-";j&&(U=U.slice(1));const B=1e6;let q=0,V=0;function H($,K){const X=Number(U.slice($,K));V*=B,q=q*B+X,q>=TWO_PWR_32_DBL&&(V=V+(q/TWO_PWR_32_DBL|0),q=q%TWO_PWR_32_DBL)}return H(-24,-18),H(-18,-12),H(-12,-6),H(-6),j?negate(q,V):newBits(q,V)}function int64ToString(U,j){let B=newBits(U,j);const q=B.hi&2147483648;q&&(B=negate(B.lo,B.hi));const V=uInt64ToString(B.lo,B.hi);return q?"-"+V:V}function uInt64ToString(U,j){if({lo:U,hi:j}=toUnsigned(U,j),j<=2097151)return String(TWO_PWR_32_DBL*j+U);const B=U&16777215,q=(U>>>24|j<<8)&16777215,V=j>>16&65535;let H=B+q*6777216+V*6710656,$=q+V*8147497,K=V*2;const X=1e7;return H>=X&&($+=Math.floor(H/X),H%=X),$>=X&&(K+=Math.floor($/X),$%=X),K.toString()+decimalFrom1e7WithLeadingZeros($)+decimalFrom1e7WithLeadingZeros(H)}function toUnsigned(U,j){return{lo:U>>>0,hi:j>>>0}}function newBits(U,j){return{lo:U|0,hi:j|0}}function negate(U,j){return j=~j,U?U=~U+1:j+=1,newBits(U,j)}const decimalFrom1e7WithLeadingZeros=U=>{const j=String(U);return"0000000".slice(j.length)+j};function varint32write(U,j){if(U>=0){for(;U>127;)j.push(U&127|128),U=U>>>7;j.push(U)}else{for(let B=0;B<9;B++)j.push(U&127|128),U=U>>7;j.push(1)}}function varint32read(){let U=this.buf[this.pos++],j=U&127;if((U&128)==0)return this.assertBounds(),j;if(U=this.buf[this.pos++],j|=(U&127)<<7,(U&128)==0)return this.assertBounds(),j;if(U=this.buf[this.pos++],j|=(U&127)<<14,(U&128)==0)return this.assertBounds(),j;if(U=this.buf[this.pos++],j|=(U&127)<<21,(U&128)==0)return this.assertBounds(),j;U=this.buf[this.pos++],j|=(U&15)<<28;for(let B=5;(U&128)!==0&&B<10;B++)U=this.buf[this.pos++];if((U&128)!=0)throw new Error("invalid varint");return this.assertBounds(),j>>>0}function makeInt64Support(){const U=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof U.getBigInt64=="function"&&typeof U.getBigUint64=="function"&&typeof U.setBigInt64=="function"&&typeof U.setBigUint64=="function"&&(typeof process!="object"||typeof define_process_env_default!="object"||define_process_env_default.BUF_BIGINT_DISABLE!=="1")){const V=BigInt("-9223372036854775808"),H=BigInt("9223372036854775807"),$=BigInt("0"),K=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(X){const Q=typeof X=="bigint"?X:BigInt(X);if(Q>H||Q<V)throw new Error("int64 invalid: ".concat(X));return Q},uParse(X){const Q=typeof X=="bigint"?X:BigInt(X);if(Q>K||Q<$)throw new Error("uint64 invalid: ".concat(X));return Q},enc(X){return U.setBigInt64(0,this.parse(X),!0),{lo:U.getInt32(0,!0),hi:U.getInt32(4,!0)}},uEnc(X){return U.setBigInt64(0,this.uParse(X),!0),{lo:U.getInt32(0,!0),hi:U.getInt32(4,!0)}},dec(X,Q){return U.setInt32(0,X,!0),U.setInt32(4,Q,!0),U.getBigInt64(0,!0)},uDec(X,Q){return U.setInt32(0,X,!0),U.setInt32(4,Q,!0),U.getBigUint64(0,!0)}}}const B=V=>assert(/^-?[0-9]+$/.test(V),"int64 invalid: ".concat(V)),q=V=>assert(/^[0-9]+$/.test(V),"uint64 invalid: ".concat(V));return{zero:"0",supported:!1,parse(V){return typeof V!="string"&&(V=V.toString()),B(V),V},uParse(V){return typeof V!="string"&&(V=V.toString()),q(V),V},enc(V){return typeof V!="string"&&(V=V.toString()),B(V),int64FromString(V)},uEnc(V){return typeof V!="string"&&(V=V.toString()),q(V),int64FromString(V)},dec(V,H){return int64ToString(V,H)},uDec(V,H){return uInt64ToString(V,H)}}}const protoInt64=makeInt64Support();var ScalarType;(function(U){U[U.DOUBLE=1]="DOUBLE",U[U.FLOAT=2]="FLOAT",U[U.INT64=3]="INT64",U[U.UINT64=4]="UINT64",U[U.INT32=5]="INT32",U[U.FIXED64=6]="FIXED64",U[U.FIXED32=7]="FIXED32",U[U.BOOL=8]="BOOL",U[U.STRING=9]="STRING",U[U.BYTES=12]="BYTES",U[U.UINT32=13]="UINT32",U[U.SFIXED32=15]="SFIXED32",U[U.SFIXED64=16]="SFIXED64",U[U.SINT32=17]="SINT32",U[U.SINT64=18]="SINT64"})(ScalarType||(ScalarType={}));var LongType;(function(U){U[U.BIGINT=0]="BIGINT",U[U.STRING=1]="STRING"})(LongType||(LongType={}));function scalarEquals(U,j,B){if(j===B)return!0;if(U==ScalarType.BYTES){if(!(j instanceof Uint8Array)||!(B instanceof Uint8Array)||j.length!==B.length)return!1;for(let q=0;q<j.length;q++)if(j[q]!==B[q])return!1;return!0}switch(U){case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return j==B}return!1}function scalarZeroValue(U,j){switch(U){case ScalarType.BOOL:return!1;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return j==0?protoInt64.zero:"0";case ScalarType.DOUBLE:case ScalarType.FLOAT:return 0;case ScalarType.BYTES:return new Uint8Array(0);case ScalarType.STRING:return"";default:return 0}}function isScalarZeroValue(U,j){switch(U){case ScalarType.BOOL:return j===!1;case ScalarType.STRING:return j==="";case ScalarType.BYTES:return j instanceof Uint8Array&&!j.byteLength;default:return j==0}}var WireType;(function(U){U[U.Varint=0]="Varint",U[U.Bit64=1]="Bit64",U[U.LengthDelimited=2]="LengthDelimited",U[U.StartGroup=3]="StartGroup",U[U.EndGroup=4]="EndGroup",U[U.Bit32=5]="Bit32"})(WireType||(WireType={}));class BinaryWriter{constructor(j){this.stack=[],this.textEncoder=j??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let j=0;for(let V=0;V<this.chunks.length;V++)j+=this.chunks[V].length;let B=new Uint8Array(j),q=0;for(let V=0;V<this.chunks.length;V++)B.set(this.chunks[V],q),q+=this.chunks[V].length;return this.chunks=[],B}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let j=this.finish(),B=this.stack.pop();if(!B)throw new Error("invalid state, fork stack empty");return this.chunks=B.chunks,this.buf=B.buf,this.uint32(j.byteLength),this.raw(j)}tag(j,B){return this.uint32((j<<3|B)>>>0)}raw(j){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(j),this}uint32(j){for(assertUInt32(j);j>127;)this.buf.push(j&127|128),j=j>>>7;return this.buf.push(j),this}int32(j){return assertInt32(j),varint32write(j,this.buf),this}bool(j){return this.buf.push(j?1:0),this}bytes(j){return this.uint32(j.byteLength),this.raw(j)}string(j){let B=this.textEncoder.encode(j);return this.uint32(B.byteLength),this.raw(B)}float(j){assertFloat32(j);let B=new Uint8Array(4);return new DataView(B.buffer).setFloat32(0,j,!0),this.raw(B)}double(j){let B=new Uint8Array(8);return new DataView(B.buffer).setFloat64(0,j,!0),this.raw(B)}fixed32(j){assertUInt32(j);let B=new Uint8Array(4);return new DataView(B.buffer).setUint32(0,j,!0),this.raw(B)}sfixed32(j){assertInt32(j);let B=new Uint8Array(4);return new DataView(B.buffer).setInt32(0,j,!0),this.raw(B)}sint32(j){return assertInt32(j),j=(j<<1^j>>31)>>>0,varint32write(j,this.buf),this}sfixed64(j){let B=new Uint8Array(8),q=new DataView(B.buffer),V=protoInt64.enc(j);return q.setInt32(0,V.lo,!0),q.setInt32(4,V.hi,!0),this.raw(B)}fixed64(j){let B=new Uint8Array(8),q=new DataView(B.buffer),V=protoInt64.uEnc(j);return q.setInt32(0,V.lo,!0),q.setInt32(4,V.hi,!0),this.raw(B)}int64(j){let B=protoInt64.enc(j);return varint64write(B.lo,B.hi,this.buf),this}sint64(j){let B=protoInt64.enc(j),q=B.hi>>31,V=B.lo<<1^q,H=(B.hi<<1|B.lo>>>31)^q;return varint64write(V,H,this.buf),this}uint64(j){let B=protoInt64.uEnc(j);return varint64write(B.lo,B.hi,this.buf),this}}class BinaryReader{constructor(j,B){this.varint64=varint64read,this.uint32=varint32read,this.buf=j,this.len=j.length,this.pos=0,this.view=new DataView(j.buffer,j.byteOffset,j.byteLength),this.textDecoder=B??new TextDecoder}tag(){let j=this.uint32(),B=j>>>3,q=j&7;if(B<=0||q<0||q>5)throw new Error("illegal tag: field no "+B+" wire type "+q);return[B,q]}skip(j,B){let q=this.pos;switch(j){case WireType.Varint:for(;this.buf[this.pos++]&128;);break;case WireType.Bit64:this.pos+=4;case WireType.Bit32:this.pos+=4;break;case WireType.LengthDelimited:let V=this.uint32();this.pos+=V;break;case WireType.StartGroup:for(;;){const[H,$]=this.tag();if($===WireType.EndGroup){if(B!==void 0&&H!==B)throw new Error("invalid end group tag");break}this.skip($,H)}break;default:throw new Error("cant skip wire type "+j)}return this.assertBounds(),this.buf.subarray(q,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let j=this.uint32();return j>>>1^-(j&1)}int64(){return protoInt64.dec(...this.varint64())}uint64(){return protoInt64.uDec(...this.varint64())}sint64(){let[j,B]=this.varint64(),q=-(j&1);return j=(j>>>1|(B&1)<<31)^q,B=B>>>1^q,protoInt64.dec(j,B)}bool(){let[j,B]=this.varint64();return j!==0||B!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return protoInt64.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return protoInt64.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let j=this.uint32(),B=this.pos;return this.pos+=j,this.assertBounds(),this.buf.subarray(B,B+j)}string(){return this.textDecoder.decode(this.bytes())}}function makeExtension(U,j,B,q){let V;return{typeName:j,extendee:B,get field(){if(!V){const H=typeof q=="function"?q():q;H.name=j.split(".").pop(),H.jsonName="[".concat(j,"]"),V=U.util.newFieldList([H]).list()[0]}return V},runtime:U}}function createExtensionContainer(U){const j=U.field.localName,B=Object.create(null);return B[j]=initExtensionField(U),[B,()=>B[j]]}function initExtensionField(U){const j=U.field;if(j.repeated)return[];if(j.default!==void 0)return j.default;switch(j.kind){case"enum":return j.T.values[0].no;case"scalar":return scalarZeroValue(j.T,j.L);case"message":const B=j.T,q=new B;return B.fieldWrapper?B.fieldWrapper.unwrapField(q):q;case"map":throw"map fields are not allowed to be extensions"}}function filterUnknownFields(U,j){if(!j.repeated&&(j.kind=="enum"||j.kind=="scalar")){for(let B=U.length-1;B>=0;--B)if(U[B].no==j.no)return[U[B]];return[]}return U.filter(B=>B.no===j.no)}let encTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),decTable=[];for(let U=0;U<encTable.length;U++)decTable[encTable[U].charCodeAt(0)]=U;decTable[45]=encTable.indexOf("+");decTable[95]=encTable.indexOf("/");const protoBase64={dec(U){let j=U.length*3/4;U[U.length-2]=="="?j-=2:U[U.length-1]=="="&&(j-=1);let B=new Uint8Array(j),q=0,V=0,H,$=0;for(let K=0;K<U.length;K++){if(H=decTable[U.charCodeAt(K)],H===void 0)switch(U[K]){case"=":V=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(V){case 0:$=H,V=1;break;case 1:B[q++]=$<<2|(H&48)>>4,$=H,V=2;break;case 2:B[q++]=($&15)<<4|(H&60)>>2,$=H,V=3;break;case 3:B[q++]=($&3)<<6|H,V=0;break}}if(V==1)throw Error("invalid base64 string.");return B.subarray(0,q)},enc(U){let j="",B=0,q,V=0;for(let H=0;H<U.length;H++)switch(q=U[H],B){case 0:j+=encTable[q>>2],V=(q&3)<<4,B=1;break;case 1:j+=encTable[V|q>>4],V=(q&15)<<2,B=2;break;case 2:j+=encTable[V|q>>6],j+=encTable[q&63],B=0;break}return B&&(j+=encTable[V],j+="=",B==1&&(j+="=")),j}};function getExtension(U,j,B){assertExtendee(j,U);const q=j.runtime.bin.makeReadOptions(B),V=filterUnknownFields(U.getType().runtime.bin.listUnknownFields(U),j.field),[H,$]=createExtensionContainer(j);for(const K of V)j.runtime.bin.readField(H,q.readerFactory(K.data),j.field,K.wireType,q);return $()}function setExtension(U,j,B,q){assertExtendee(j,U);const V=j.runtime.bin.makeReadOptions(q),H=j.runtime.bin.makeWriteOptions(q);if(hasExtension(U,j)){const Q=U.getType().runtime.bin.listUnknownFields(U).filter(W=>W.no!=j.field.no);U.getType().runtime.bin.discardUnknownFields(U);for(const W of Q)U.getType().runtime.bin.onUnknownField(U,W.no,W.wireType,W.data)}const $=H.writerFactory();let K=j.field;!K.opt&&!K.repeated&&(K.kind=="enum"||K.kind=="scalar")&&(K=Object.assign(Object.assign({},j.field),{opt:!0})),j.runtime.bin.writeField(K,B,$,H);const X=V.readerFactory($.finish());for(;X.pos<X.len;){const[Q,W]=X.tag(),Z=X.skip(W,Q);U.getType().runtime.bin.onUnknownField(U,Q,W,Z)}}function hasExtension(U,j){const B=U.getType();return j.extendee.typeName===B.typeName&&!!B.runtime.bin.listUnknownFields(U).find(q=>q.no==j.field.no)}function assertExtendee(U,j){assert(U.extendee.typeName==j.getType().typeName,"extension ".concat(U.typeName," can only be applied to message ").concat(U.extendee.typeName))}function isFieldSet(U,j){const B=U.localName;if(U.repeated)return j[B].length>0;if(U.oneof)return j[U.oneof.localName].case===B;switch(U.kind){case"enum":case"scalar":return U.opt||U.req?j[B]!==void 0:U.kind=="enum"?j[B]!==U.T.values[0].no:!isScalarZeroValue(U.T,j[B]);case"message":return j[B]!==void 0;case"map":return Object.keys(j[B]).length>0}}function clearField(U,j){const B=U.localName,q=!U.opt&&!U.req;if(U.repeated)j[B]=[];else if(U.oneof)j[U.oneof.localName]={case:void 0};else switch(U.kind){case"map":j[B]={};break;case"enum":j[B]=q?U.T.values[0].no:void 0;break;case"scalar":j[B]=q?scalarZeroValue(U.T,U.L):void 0;break;case"message":j[B]=void 0;break}}function isMessage(U,j){if(U===null||typeof U!="object"||!Object.getOwnPropertyNames(Message.prototype).every(q=>q in U&&typeof U[q]=="function"))return!1;const B=U.getType();return B===null||typeof B!="function"||!("typeName"in B)||typeof B.typeName!="string"?!1:j===void 0?!0:B.typeName==j.typeName}function wrapField(U,j){return isMessage(j)||!U.fieldWrapper?j:U.fieldWrapper.wrapField(j)}ScalarType.DOUBLE,ScalarType.FLOAT,ScalarType.INT64,ScalarType.UINT64,ScalarType.INT32,ScalarType.UINT32,ScalarType.BOOL,ScalarType.STRING,ScalarType.BYTES;const jsonReadDefaults={ignoreUnknownFields:!1},jsonWriteDefaults={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function makeReadOptions$1(U){return U?Object.assign(Object.assign({},jsonReadDefaults),U):jsonReadDefaults}function makeWriteOptions$1(U){return U?Object.assign(Object.assign({},jsonWriteDefaults),U):jsonWriteDefaults}const tokenNull=Symbol(),tokenIgnoredUnknownEnum=Symbol();function makeJsonFormat(){return{makeReadOptions:makeReadOptions$1,makeWriteOptions:makeWriteOptions$1,readMessage(U,j,B,q){if(j==null||Array.isArray(j)||typeof j!="object")throw new Error("cannot decode message ".concat(U.typeName," from JSON: ").concat(debugJsonValue(j)));q=q??new U;const V=new Map,H=B.typeRegistry;for(const[$,K]of Object.entries(j)){const X=U.fields.findJsonName($);if(X){if(X.oneof){if(K===null&&X.kind=="scalar")continue;const Q=V.get(X.oneof);if(Q!==void 0)throw new Error("cannot decode message ".concat(U.typeName,' from JSON: multiple keys for oneof "').concat(X.oneof.name,'" present: "').concat(Q,'", "').concat($,'"'));V.set(X.oneof,$)}readField$1(q,K,X,B,U)}else{let Q=!1;if(H!=null&&H.findExtension&&$.startsWith("[")&&$.endsWith("]")){const W=H.findExtension($.substring(1,$.length-1));if(W&&W.extendee.typeName==U.typeName){Q=!0;const[Z,te]=createExtensionContainer(W);readField$1(Z,K,W.field,B,W),setExtension(q,W,te(),B)}}if(!Q&&!B.ignoreUnknownFields)throw new Error("cannot decode message ".concat(U.typeName,' from JSON: key "').concat($,'" is unknown'))}}return q},writeMessage(U,j){const B=U.getType(),q={};let V;try{for(V of B.fields.byNumber()){if(!isFieldSet(V,U)){if(V.req)throw"required field not set";if(!j.emitDefaultValues||!canEmitFieldDefaultValue(V))continue}const $=V.oneof?U[V.oneof.localName].value:U[V.localName],K=writeField$1(V,$,j);K!==void 0&&(q[j.useProtoFieldName?V.name:V.jsonName]=K)}const H=j.typeRegistry;if(H!=null&&H.findExtensionFor)for(const $ of B.runtime.bin.listUnknownFields(U)){const K=H.findExtensionFor(B.typeName,$.no);if(K&&hasExtension(U,K)){const X=getExtension(U,K,j),Q=writeField$1(K.field,X,j);Q!==void 0&&(q[K.field.jsonName]=Q)}}}catch(H){const $=V?"cannot encode field ".concat(B.typeName,".").concat(V.name," to JSON"):"cannot encode message ".concat(B.typeName," to JSON"),K=H instanceof Error?H.message:String(H);throw new Error($+(K.length>0?": ".concat(K):""))}return q},readScalar(U,j,B){return readScalar$1(U,j,B??LongType.BIGINT,!0)},writeScalar(U,j,B){if(j!==void 0&&(B||isScalarZeroValue(U,j)))return writeScalar$1(U,j)},debug:debugJsonValue}}function debugJsonValue(U){if(U===null)return"null";switch(typeof U){case"object":return Array.isArray(U)?"array":"object";case"string":return U.length>100?"string":'"'.concat(U.split('"').join('\\"'),'"');default:return String(U)}}function readField$1(U,j,B,q,V){let H=B.localName;if(B.repeated){if(assert(B.kind!="map"),j===null)return;if(!Array.isArray(j))throw new Error("cannot decode field ".concat(V.typeName,".").concat(B.name," from JSON: ").concat(debugJsonValue(j)));const $=U[H];for(const K of j){if(K===null)throw new Error("cannot decode field ".concat(V.typeName,".").concat(B.name," from JSON: ").concat(debugJsonValue(K)));switch(B.kind){case"message":$.push(B.T.fromJson(K,q));break;case"enum":const X=readEnum(B.T,K,q.ignoreUnknownFields,!0);X!==tokenIgnoredUnknownEnum&&$.push(X);break;case"scalar":try{$.push(readScalar$1(B.T,K,B.L,!0))}catch(Q){let W="cannot decode field ".concat(V.typeName,".").concat(B.name," from JSON: ").concat(debugJsonValue(K));throw Q instanceof Error&&Q.message.length>0&&(W+=": ".concat(Q.message)),new Error(W)}break}}}else if(B.kind=="map"){if(j===null)return;if(typeof j!="object"||Array.isArray(j))throw new Error("cannot decode field ".concat(V.typeName,".").concat(B.name," from JSON: ").concat(debugJsonValue(j)));const $=U[H];for(const[K,X]of Object.entries(j)){if(X===null)throw new Error("cannot decode field ".concat(V.typeName,".").concat(B.name," from JSON: map value null"));let Q;try{Q=readMapKey(B.K,K)}catch(W){let Z="cannot decode map key for field ".concat(V.typeName,".").concat(B.name," from JSON: ").concat(debugJsonValue(j));throw W instanceof Error&&W.message.length>0&&(Z+=": ".concat(W.message)),new Error(Z)}switch(B.V.kind){case"message":$[Q]=B.V.T.fromJson(X,q);break;case"enum":const W=readEnum(B.V.T,X,q.ignoreUnknownFields,!0);W!==tokenIgnoredUnknownEnum&&($[Q]=W);break;case"scalar":try{$[Q]=readScalar$1(B.V.T,X,LongType.BIGINT,!0)}catch(Z){let te="cannot decode map value for field ".concat(V.typeName,".").concat(B.name," from JSON: ").concat(debugJsonValue(j));throw Z instanceof Error&&Z.message.length>0&&(te+=": ".concat(Z.message)),new Error(te)}break}}}else switch(B.oneof&&(U=U[B.oneof.localName]={case:H},H="value"),B.kind){case"message":const $=B.T;if(j===null&&$.typeName!="google.protobuf.Value")return;let K=U[H];isMessage(K)?K.fromJson(j,q):(U[H]=K=$.fromJson(j,q),$.fieldWrapper&&!B.oneof&&(U[H]=$.fieldWrapper.unwrapField(K)));break;case"enum":const X=readEnum(B.T,j,q.ignoreUnknownFields,!1);switch(X){case tokenNull:clearField(B,U);break;case tokenIgnoredUnknownEnum:break;default:U[H]=X;break}break;case"scalar":try{const Q=readScalar$1(B.T,j,B.L,!1);switch(Q){case tokenNull:clearField(B,U);break;default:U[H]=Q;break}}catch(Q){let W="cannot decode field ".concat(V.typeName,".").concat(B.name," from JSON: ").concat(debugJsonValue(j));throw Q instanceof Error&&Q.message.length>0&&(W+=": ".concat(Q.message)),new Error(W)}break}}function readMapKey(U,j){if(U===ScalarType.BOOL)switch(j){case"true":j=!0;break;case"false":j=!1;break}return readScalar$1(U,j,LongType.BIGINT,!0).toString()}function readScalar$1(U,j,B,q){if(j===null)return q?scalarZeroValue(U,B):tokenNull;switch(U){case ScalarType.DOUBLE:case ScalarType.FLOAT:if(j==="NaN")return Number.NaN;if(j==="Infinity")return Number.POSITIVE_INFINITY;if(j==="-Infinity")return Number.NEGATIVE_INFINITY;if(j===""||typeof j=="string"&&j.trim().length!==j.length||typeof j!="string"&&typeof j!="number")break;const V=Number(j);if(Number.isNaN(V)||!Number.isFinite(V))break;return U==ScalarType.FLOAT&&assertFloat32(V),V;case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.UINT32:let H;if(typeof j=="number"?H=j:typeof j=="string"&&j.length>0&&j.trim().length===j.length&&(H=Number(j)),H===void 0)break;return U==ScalarType.UINT32||U==ScalarType.FIXED32?assertUInt32(H):assertInt32(H),H;case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:if(typeof j!="number"&&typeof j!="string")break;const $=protoInt64.parse(j);return B?$.toString():$;case ScalarType.FIXED64:case ScalarType.UINT64:if(typeof j!="number"&&typeof j!="string")break;const K=protoInt64.uParse(j);return B?K.toString():K;case ScalarType.BOOL:if(typeof j!="boolean")break;return j;case ScalarType.STRING:if(typeof j!="string")break;try{encodeURIComponent(j)}catch{throw new Error("invalid UTF8")}return j;case ScalarType.BYTES:if(j==="")return new Uint8Array(0);if(typeof j!="string")break;return protoBase64.dec(j)}throw new Error}function readEnum(U,j,B,q){if(j===null)return U.typeName=="google.protobuf.NullValue"?0:q?U.values[0].no:tokenNull;switch(typeof j){case"number":if(Number.isInteger(j))return j;break;case"string":const V=U.findName(j);if(V!==void 0)return V.no;if(B)return tokenIgnoredUnknownEnum;break}throw new Error("cannot decode enum ".concat(U.typeName," from JSON: ").concat(debugJsonValue(j)))}function canEmitFieldDefaultValue(U){return U.repeated||U.kind=="map"?!0:!(U.oneof||U.kind=="message"||U.opt||U.req)}function writeField$1(U,j,B){if(U.kind=="map"){assert(typeof j=="object"&&j!=null);const q={},V=Object.entries(j);switch(U.V.kind){case"scalar":for(const[$,K]of V)q[$.toString()]=writeScalar$1(U.V.T,K);break;case"message":for(const[$,K]of V)q[$.toString()]=K.toJson(B);break;case"enum":const H=U.V.T;for(const[$,K]of V)q[$.toString()]=writeEnum(H,K,B.enumAsInteger);break}return B.emitDefaultValues||V.length>0?q:void 0}if(U.repeated){assert(Array.isArray(j));const q=[];switch(U.kind){case"scalar":for(let V=0;V<j.length;V++)q.push(writeScalar$1(U.T,j[V]));break;case"enum":for(let V=0;V<j.length;V++)q.push(writeEnum(U.T,j[V],B.enumAsInteger));break;case"message":for(let V=0;V<j.length;V++)q.push(j[V].toJson(B));break}return B.emitDefaultValues||q.length>0?q:void 0}switch(U.kind){case"scalar":return writeScalar$1(U.T,j);case"enum":return writeEnum(U.T,j,B.enumAsInteger);case"message":return wrapField(U.T,j).toJson(B)}}function writeEnum(U,j,B){var q;if(assert(typeof j=="number"),U.typeName=="google.protobuf.NullValue")return null;if(B)return j;const V=U.findNumber(j);return(q=V==null?void 0:V.name)!==null&&q!==void 0?q:j}function writeScalar$1(U,j){switch(U){case ScalarType.INT32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.FIXED32:case ScalarType.UINT32:return assert(typeof j=="number"),j;case ScalarType.FLOAT:case ScalarType.DOUBLE:return assert(typeof j=="number"),Number.isNaN(j)?"NaN":j===Number.POSITIVE_INFINITY?"Infinity":j===Number.NEGATIVE_INFINITY?"-Infinity":j;case ScalarType.STRING:return assert(typeof j=="string"),j;case ScalarType.BOOL:return assert(typeof j=="boolean"),j;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return assert(typeof j=="bigint"||typeof j=="string"||typeof j=="number"),j.toString();case ScalarType.BYTES:return assert(j instanceof Uint8Array),protoBase64.enc(j)}}const unknownFieldsSymbol=Symbol("@bufbuild/protobuf/unknown-fields"),readDefaults={readUnknownFields:!0,readerFactory:U=>new BinaryReader(U)},writeDefaults={writeUnknownFields:!0,writerFactory:()=>new BinaryWriter};function makeReadOptions(U){return U?Object.assign(Object.assign({},readDefaults),U):readDefaults}function makeWriteOptions(U){return U?Object.assign(Object.assign({},writeDefaults),U):writeDefaults}function makeBinaryFormat(){return{makeReadOptions,makeWriteOptions,listUnknownFields(U){var j;return(j=U[unknownFieldsSymbol])!==null&&j!==void 0?j:[]},discardUnknownFields(U){delete U[unknownFieldsSymbol]},writeUnknownFields(U,j){const q=U[unknownFieldsSymbol];if(q)for(const V of q)j.tag(V.no,V.wireType).raw(V.data)},onUnknownField(U,j,B,q){const V=U;Array.isArray(V[unknownFieldsSymbol])||(V[unknownFieldsSymbol]=[]),V[unknownFieldsSymbol].push({no:j,wireType:B,data:q})},readMessage(U,j,B,q,V){const H=U.getType(),$=V?j.len:j.pos+B;let K,X;for(;j.pos<$&&([K,X]=j.tag(),!(V===!0&&X==WireType.EndGroup));){const Q=H.fields.find(K);if(!Q){const W=j.skip(X,K);q.readUnknownFields&&this.onUnknownField(U,K,X,W);continue}readField(U,j,Q,X,q)}if(V&&(X!=WireType.EndGroup||K!==B))throw new Error("invalid end group tag")},readField,writeMessage(U,j,B){const q=U.getType();for(const V of q.fields.byNumber()){if(!isFieldSet(V,U)){if(V.req)throw new Error("cannot encode field ".concat(q.typeName,".").concat(V.name," to binary: required field not set"));continue}const H=V.oneof?U[V.oneof.localName].value:U[V.localName];writeField(V,H,j,B)}return B.writeUnknownFields&&this.writeUnknownFields(U,j),j},writeField(U,j,B,q){j!==void 0&&writeField(U,j,B,q)}}}function readField(U,j,B,q,V){let{repeated:H,localName:$}=B;switch(B.oneof&&(U=U[B.oneof.localName],U.case!=$&&delete U.value,U.case=$,$="value"),B.kind){case"scalar":case"enum":const K=B.kind=="enum"?ScalarType.INT32:B.T;let X=readScalar;if(B.kind=="scalar"&&B.L>0&&(X=readScalarLTString),H){let te=U[$];if(q==WireType.LengthDelimited&&K!=ScalarType.STRING&&K!=ScalarType.BYTES){let ae=j.uint32()+j.pos;for(;j.pos<ae;)te.push(X(j,K))}else te.push(X(j,K))}else U[$]=X(j,K);break;case"message":const Q=B.T;H?U[$].push(readMessageField(j,new Q,V,B)):isMessage(U[$])?readMessageField(j,U[$],V,B):(U[$]=readMessageField(j,new Q,V,B),Q.fieldWrapper&&!B.oneof&&!B.repeated&&(U[$]=Q.fieldWrapper.unwrapField(U[$])));break;case"map":let[W,Z]=readMapEntry(B,j,V);U[$][W]=Z;break}}function readMessageField(U,j,B,q){const V=j.getType().runtime.bin,H=q==null?void 0:q.delimited;return V.readMessage(j,U,H?q.no:U.uint32(),B,H),j}function readMapEntry(U,j,B){const q=j.uint32(),V=j.pos+q;let H,$;for(;j.pos<V;){const[K]=j.tag();switch(K){case 1:H=readScalar(j,U.K);break;case 2:switch(U.V.kind){case"scalar":$=readScalar(j,U.V.T);break;case"enum":$=j.int32();break;case"message":$=readMessageField(j,new U.V.T,B,void 0);break}break}}if(H===void 0&&(H=scalarZeroValue(U.K,LongType.BIGINT)),typeof H!="string"&&typeof H!="number"&&(H=H.toString()),$===void 0)switch(U.V.kind){case"scalar":$=scalarZeroValue(U.V.T,LongType.BIGINT);break;case"enum":$=U.V.T.values[0].no;break;case"message":$=new U.V.T;break}return[H,$]}function readScalarLTString(U,j){const B=readScalar(U,j);return typeof B=="bigint"?B.toString():B}function readScalar(U,j){switch(j){case ScalarType.STRING:return U.string();case ScalarType.BOOL:return U.bool();case ScalarType.DOUBLE:return U.double();case ScalarType.FLOAT:return U.float();case ScalarType.INT32:return U.int32();case ScalarType.INT64:return U.int64();case ScalarType.UINT64:return U.uint64();case ScalarType.FIXED64:return U.fixed64();case ScalarType.BYTES:return U.bytes();case ScalarType.FIXED32:return U.fixed32();case ScalarType.SFIXED32:return U.sfixed32();case ScalarType.SFIXED64:return U.sfixed64();case ScalarType.SINT64:return U.sint64();case ScalarType.UINT32:return U.uint32();case ScalarType.SINT32:return U.sint32()}}function writeField(U,j,B,q){assert(j!==void 0);const V=U.repeated;switch(U.kind){case"scalar":case"enum":let H=U.kind=="enum"?ScalarType.INT32:U.T;if(V)if(assert(Array.isArray(j)),U.packed)writePacked(B,H,U.no,j);else for(const $ of j)writeScalar(B,H,U.no,$);else writeScalar(B,H,U.no,j);break;case"message":if(V){assert(Array.isArray(j));for(const $ of j)writeMessageField(B,q,U,$)}else writeMessageField(B,q,U,j);break;case"map":assert(typeof j=="object"&&j!=null);for(const[$,K]of Object.entries(j))writeMapEntry(B,q,U,$,K);break}}function writeMapEntry(U,j,B,q,V){U.tag(B.no,WireType.LengthDelimited),U.fork();let H=q;switch(B.K){case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.UINT32:case ScalarType.SFIXED32:case ScalarType.SINT32:H=Number.parseInt(q);break;case ScalarType.BOOL:assert(q=="true"||q=="false"),H=q=="true";break}switch(writeScalar(U,B.K,1,H),B.V.kind){case"scalar":writeScalar(U,B.V.T,2,V);break;case"enum":writeScalar(U,ScalarType.INT32,2,V);break;case"message":assert(V!==void 0),U.tag(2,WireType.LengthDelimited).bytes(V.toBinary(j));break}U.join()}function writeMessageField(U,j,B,q){const V=wrapField(B.T,q);B.delimited?U.tag(B.no,WireType.StartGroup).raw(V.toBinary(j)).tag(B.no,WireType.EndGroup):U.tag(B.no,WireType.LengthDelimited).bytes(V.toBinary(j))}function writeScalar(U,j,B,q){assert(q!==void 0);let[V,H]=scalarTypeInfo(j);U.tag(B,V)[H](q)}function writePacked(U,j,B,q){if(!q.length)return;U.tag(B,WireType.LengthDelimited).fork();let[,V]=scalarTypeInfo(j);for(let H=0;H<q.length;H++)U[V](q[H]);U.join()}function scalarTypeInfo(U){let j=WireType.Varint;switch(U){case ScalarType.BYTES:case ScalarType.STRING:j=WireType.LengthDelimited;break;case ScalarType.DOUBLE:case ScalarType.FIXED64:case ScalarType.SFIXED64:j=WireType.Bit64;break;case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.FLOAT:j=WireType.Bit32;break}const B=ScalarType[U].toLowerCase();return[j,B]}function makeUtilCommon(){return{setEnumType,initPartial(U,j){if(U===void 0)return;const B=j.getType();for(const q of B.fields.byMember()){const V=q.localName,H=j,$=U;if($[V]!=null)switch(q.kind){case"oneof":const K=$[V].case;if(K===void 0)continue;const X=q.findField(K);let Q=$[V].value;X&&X.kind=="message"&&!isMessage(Q,X.T)?Q=new X.T(Q):X&&X.kind==="scalar"&&X.T===ScalarType.BYTES&&(Q=toU8Arr(Q)),H[V]={case:K,value:Q};break;case"scalar":case"enum":let W=$[V];q.T===ScalarType.BYTES&&(W=q.repeated?W.map(toU8Arr):toU8Arr(W)),H[V]=W;break;case"map":switch(q.V.kind){case"scalar":case"enum":if(q.V.T===ScalarType.BYTES)for(const[ie,ae]of Object.entries($[V]))H[V][ie]=toU8Arr(ae);else Object.assign(H[V],$[V]);break;case"message":const te=q.V.T;for(const ie of Object.keys($[V])){let ae=$[V][ie];te.fieldWrapper||(ae=new te(ae)),H[V][ie]=ae}break}break;case"message":const Z=q.T;if(q.repeated)H[V]=$[V].map(te=>isMessage(te,Z)?te:new Z(te));else{const te=$[V];Z.fieldWrapper?Z.typeName==="google.protobuf.BytesValue"?H[V]=toU8Arr(te):H[V]=te:H[V]=isMessage(te,Z)?te:new Z(te)}break}}},equals(U,j,B){return j===B?!0:!j||!B?!1:U.fields.byMember().every(q=>{const V=j[q.localName],H=B[q.localName];if(q.repeated){if(V.length!==H.length)return!1;switch(q.kind){case"message":return V.every(($,K)=>q.T.equals($,H[K]));case"scalar":return V.every(($,K)=>scalarEquals(q.T,$,H[K]));case"enum":return V.every(($,K)=>scalarEquals(ScalarType.INT32,$,H[K]))}throw new Error("repeated cannot contain ".concat(q.kind))}switch(q.kind){case"message":return q.T.equals(V,H);case"enum":return scalarEquals(ScalarType.INT32,V,H);case"scalar":return scalarEquals(q.T,V,H);case"oneof":if(V.case!==H.case)return!1;const $=q.findField(V.case);if($===void 0)return!0;switch($.kind){case"message":return $.T.equals(V.value,H.value);case"enum":return scalarEquals(ScalarType.INT32,V.value,H.value);case"scalar":return scalarEquals($.T,V.value,H.value)}throw new Error("oneof cannot contain ".concat($.kind));case"map":const K=Object.keys(V).concat(Object.keys(H));switch(q.V.kind){case"message":const X=q.V.T;return K.every(W=>X.equals(V[W],H[W]));case"enum":return K.every(W=>scalarEquals(ScalarType.INT32,V[W],H[W]));case"scalar":const Q=q.V.T;return K.every(W=>scalarEquals(Q,V[W],H[W]))}break}})},clone(U){const j=U.getType(),B=new j,q=B;for(const V of j.fields.byMember()){const H=U[V.localName];let $;if(V.repeated)$=H.map(cloneSingularField);else if(V.kind=="map"){$=q[V.localName];for(const[K,X]of Object.entries(H))$[K]=cloneSingularField(X)}else V.kind=="oneof"?$=V.findField(H.case)?{case:H.case,value:cloneSingularField(H.value)}:{case:void 0}:$=cloneSingularField(H);q[V.localName]=$}for(const V of j.runtime.bin.listUnknownFields(U))j.runtime.bin.onUnknownField(q,V.no,V.wireType,V.data);return B}}}function cloneSingularField(U){if(U===void 0)return U;if(isMessage(U))return U.clone();if(U instanceof Uint8Array){const j=new Uint8Array(U.byteLength);return j.set(U),j}return U}function toU8Arr(U){return U instanceof Uint8Array?U:new Uint8Array(U)}function makeProtoRuntime(U,j,B){return{syntax:U,json:makeJsonFormat(),bin:makeBinaryFormat(),util:Object.assign(Object.assign({},makeUtilCommon()),{newFieldList:j,initFields:B}),makeMessageType(q,V,H){return makeMessageType(this,q,V,H)},makeEnum,makeEnumType,getEnumType,makeExtension(q,V,H){return makeExtension(this,q,V,H)}}}class InternalFieldList{constructor(j,B){this._fields=j,this._normalizer=B}findJsonName(j){if(!this.jsonNames){const B={};for(const q of this.list())B[q.jsonName]=B[q.name]=q;this.jsonNames=B}return this.jsonNames[j]}find(j){if(!this.numbers){const B={};for(const q of this.list())B[q.no]=q;this.numbers=B}return this.numbers[j]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((j,B)=>j.no-B.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const j=this.members;let B;for(const q of this.list())q.oneof?q.oneof!==B&&(B=q.oneof,j.push(B)):j.push(q)}return this.members}}function localFieldName(U,j){const B=protoCamelCase(U);return j?B:safeObjectProperty(safeMessageProperty(B))}function localOneofName(U){return localFieldName(U,!1)}const fieldJsonName=protoCamelCase;function protoCamelCase(U){let j=!1;const B=[];for(let q=0;q<U.length;q++){let V=U.charAt(q);switch(V){case"_":j=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":B.push(V),j=!1;break;default:j&&(j=!1,V=V.toUpperCase()),B.push(V);break}}return B.join("")}const reservedObjectProperties=new Set(["constructor","toString","toJSON","valueOf"]),reservedMessageProperties=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),fallback=U=>"".concat(U,"$"),safeMessageProperty=U=>reservedMessageProperties.has(U)?fallback(U):U,safeObjectProperty=U=>reservedObjectProperties.has(U)?fallback(U):U;class InternalOneofInfo{constructor(j){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=j,this.localName=localOneofName(j)}addField(j){assert(j.oneof===this,"field ".concat(j.name," not one of ").concat(this.name)),this.fields.push(j)}findField(j){if(!this._lookup){this._lookup=Object.create(null);for(let B=0;B<this.fields.length;B++)this._lookup[this.fields[B].localName]=this.fields[B]}return this._lookup[j]}}function normalizeFieldInfos(U,j){var B,q,V,H,$,K;const X=[];let Q;for(const W of typeof U=="function"?U():U){const Z=W;if(Z.localName=localFieldName(W.name,W.oneof!==void 0),Z.jsonName=(B=W.jsonName)!==null&&B!==void 0?B:fieldJsonName(W.name),Z.repeated=(q=W.repeated)!==null&&q!==void 0?q:!1,W.kind=="scalar"&&(Z.L=(V=W.L)!==null&&V!==void 0?V:LongType.BIGINT),Z.delimited=(H=W.delimited)!==null&&H!==void 0?H:!1,Z.req=($=W.req)!==null&&$!==void 0?$:!1,Z.opt=(K=W.opt)!==null&&K!==void 0?K:!1,W.packed===void 0&&(Z.packed=W.kind=="enum"||W.kind=="scalar"&&W.T!=ScalarType.BYTES&&W.T!=ScalarType.STRING),W.oneof!==void 0){const te=typeof W.oneof=="string"?W.oneof:W.oneof.name;(!Q||Q.name!=te)&&(Q=new InternalOneofInfo(te)),Z.oneof=Q,Q.addField(Z)}X.push(Z)}return X}const proto3=makeProtoRuntime("proto3",U=>new InternalFieldList(U,j=>normalizeFieldInfos(j)),U=>{for(const j of U.getType().fields.byMember()){if(j.opt)continue;const B=j.localName,q=U;if(j.repeated){q[B]=[];continue}switch(j.kind){case"oneof":q[B]={case:void 0};break;case"enum":q[B]=0;break;case"map":q[B]={};break;case"scalar":q[B]=scalarZeroValue(j.T,j.L);break}}});class Timestamp extends Message{constructor(j){super(),this.seconds=protoInt64.zero,this.nanos=0,proto3.util.initPartial(j,this)}fromJson(j,B){if(typeof j!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(proto3.json.debug(j)));const q=j.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!q)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const V=Date.parse(q[1]+"-"+q[2]+"-"+q[3]+"T"+q[4]+":"+q[5]+":"+q[6]+(q[8]?q[8]:"Z"));if(Number.isNaN(V))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(V<Date.parse("0001-01-01T00:00:00Z")||V>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=protoInt64.parse(V/1e3),this.nanos=0,q[7]&&(this.nanos=parseInt("1"+q[7]+"0".repeat(9-q[7].length))-1e9),this}toJson(j){const B=Number(this.seconds)*1e3;if(B<Date.parse("0001-01-01T00:00:00Z")||B>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let q="Z";if(this.nanos>0){const V=(this.nanos+1e9).toString().substring(1);V.substring(3)==="000000"?q="."+V.substring(0,3)+"Z":V.substring(6)==="000"?q="."+V.substring(0,6)+"Z":q="."+V+"Z"}return new Date(B).toISOString().replace(".000Z",q)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Timestamp.fromDate(new Date)}static fromDate(j){const B=j.getTime();return new Timestamp({seconds:protoInt64.parse(Math.floor(B/1e3)),nanos:B%1e3*1e6})}static fromBinary(j,B){return new Timestamp().fromBinary(j,B)}static fromJson(j,B){return new Timestamp().fromJson(j,B)}static fromJsonString(j,B){return new Timestamp().fromJsonString(j,B)}static equals(j,B){return proto3.util.equals(Timestamp,j,B)}}Timestamp.runtime=proto3;Timestamp.typeName="google.protobuf.Timestamp";Timestamp.fields=proto3.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const MetricsBatch=proto3.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Timestamp},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:TimeSeriesMetric,repeated:!0},{no:5,name:"events",kind:"message",T:EventMetric,repeated:!0}]),TimeSeriesMetric=proto3.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:MetricSample,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),MetricSample=proto3.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Timestamp},{no:3,name:"value",kind:"scalar",T:2}]),EventMetric=proto3.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Timestamp},{no:7,name:"normalized_end_timestamp",kind:"message",T:Timestamp,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),BackupCodecPolicy$1=proto3.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),TrackType=proto3.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),TrackSource=proto3.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),VideoQuality$1=proto3.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ConnectionQuality$1=proto3.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ClientConfigSetting=proto3.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),DisconnectReason=proto3.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),ReconnectReason=proto3.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),SubscriptionError=proto3.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),AudioTrackFeature=proto3.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Room$1=proto3.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Codec,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:TimedVersion}]),Codec=proto3.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ParticipantPermission=proto3.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:proto3.getEnumType(TrackSource),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),ParticipantInfo=proto3.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(ParticipantInfo_State)},{no:4,name:"tracks",kind:"message",T:TrackInfo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ParticipantPermission},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:proto3.getEnumType(ParticipantInfo_Kind)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)},{no:18,name:"kind_details",kind:"enum",T:proto3.getEnumType(ParticipantInfo_KindDetail),repeated:!0}]),ParticipantInfo_State=proto3.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ParticipantInfo_Kind=proto3.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),ParticipantInfo_KindDetail=proto3.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Encryption_Type=proto3.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),SimulcastCodecInfo=proto3.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),TrackInfo=proto3.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:10,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:SimulcastCodecInfo,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:TimedVersion},{no:19,name:"audio_features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:proto3.getEnumType(BackupCodecPolicy$1)}]),VideoLayer=proto3.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),DataPacket=proto3.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:proto3.getEnumType(DataPacket_Kind)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:UserPacket,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ActiveSpeakerUpdate,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:SipDTMF,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Transcription,oneof:"value"},{no:8,name:"metrics",kind:"message",T:MetricsBatch,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:ChatMessage,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:RpcRequest,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:RpcAck,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:RpcResponse,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:DataStream_Header,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:DataStream_Chunk,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:DataStream_Trailer,oneof:"value"}]),DataPacket_Kind=proto3.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ActiveSpeakerUpdate=proto3.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),SpeakerInfo=proto3.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),UserPacket=proto3.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),SipDTMF=proto3.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Transcription=proto3.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:TranscriptionSegment,repeated:!0}]),TranscriptionSegment=proto3.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),ChatMessage=proto3.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),RpcRequest=proto3.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),RpcAck=proto3.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),RpcResponse=proto3.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:RpcError$1,oneof:"value"}]),RpcError$1=proto3.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),ParticipantTracks=proto3.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),ServerInfo=proto3.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:proto3.getEnumType(ServerInfo_Edition)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ServerInfo_Edition=proto3.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ClientInfo=proto3.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:proto3.getEnumType(ClientInfo_SDK)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),ClientInfo_SDK=proto3.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),ClientConfiguration=proto3.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:VideoConfiguration},{no:2,name:"screen",kind:"message",T:VideoConfiguration},{no:3,name:"resume_connection",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)},{no:4,name:"disabled_codecs",kind:"message",T:DisabledCodecs},{no:5,name:"force_relay",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),VideoConfiguration=proto3.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),DisabledCodecs=proto3.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Codec,repeated:!0},{no:2,name:"publish",kind:"message",T:Codec,repeated:!0}]),TimedVersion=proto3.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),DataStream_OperationType=proto3.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),DataStream_TextHeader=proto3.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:proto3.getEnumType(DataStream_OperationType)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),DataStream_ByteHeader=proto3.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),DataStream_Header=proto3.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:DataStream_TextHeader,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:DataStream_ByteHeader,oneof:"content_header"}],{localName:"DataStream_Header"}),DataStream_Chunk=proto3.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),DataStream_Trailer=proto3.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),SignalTarget=proto3.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),StreamState=proto3.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),CandidateProtocol=proto3.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),SignalRequest=proto3.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:4,name:"add_track",kind:"message",T:AddTrackRequest,oneof:"message"},{no:5,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:6,name:"subscription",kind:"message",T:UpdateSubscription,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:UpdateTrackSettings,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:UpdateVideoLayers,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:SubscriptionPermission,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:SyncState,oneof:"message"},{no:13,name:"simulate",kind:"message",T:SimulateScenario,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:UpdateParticipantMetadata,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ping,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:UpdateLocalAudioTrack,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:UpdateLocalVideoTrack,oneof:"message"}]),SignalResponse=proto3.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:JoinResponse,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:4,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:5,name:"update",kind:"message",T:ParticipantUpdate,oneof:"message"},{no:6,name:"track_published",kind:"message",T:TrackPublishedResponse,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:9,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:SpeakersChanged,oneof:"message"},{no:11,name:"room_update",kind:"message",T:RoomUpdate,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:ConnectionQualityUpdate,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:StreamStateUpdate,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:SubscribedQualityUpdate,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:SubscriptionPermissionUpdate,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:TrackUnpublishedResponse,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ReconnectResponse,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Pong,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SubscriptionResponse,oneof:"message"},{no:22,name:"request_response",kind:"message",T:RequestResponse,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:TrackSubscribed,oneof:"message"}]),SimulcastCodec=proto3.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),AddTrackRequest=proto3.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:9,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:SimulcastCodec,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:proto3.getEnumType(BackupCodecPolicy$1)}]),TrickleRequest=proto3.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)},{no:3,name:"final",kind:"scalar",T:8}]),MuteTrackRequest=proto3.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),JoinResponse=proto3.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Room$1},{no:2,name:"participant",kind:"message",T:ParticipantInfo},{no:3,name:"other_participants",kind:"message",T:ParticipantInfo,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ClientConfiguration},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:ServerInfo},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Codec,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),ReconnectResponse=proto3.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ClientConfiguration}]),TrackPublishedResponse=proto3.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:TrackInfo}]),TrackUnpublishedResponse=proto3.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),SessionDescription=proto3.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),ParticipantUpdate=proto3.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ParticipantInfo,repeated:!0}]),UpdateSubscription=proto3.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ParticipantTracks,repeated:!0}]),UpdateTrackSettings=proto3.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),UpdateLocalAudioTrack=proto3.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),UpdateLocalVideoTrack=proto3.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),LeaveRequest=proto3.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)},{no:3,name:"action",kind:"enum",T:proto3.getEnumType(LeaveRequest_Action)},{no:4,name:"regions",kind:"message",T:RegionSettings}]),LeaveRequest_Action=proto3.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),UpdateVideoLayers=proto3.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),UpdateParticipantMetadata=proto3.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),ICEServer=proto3.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),SpeakersChanged=proto3.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),RoomUpdate=proto3.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Room$1}]),ConnectionQualityInfo=proto3.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:proto3.getEnumType(ConnectionQuality$1)},{no:3,name:"score",kind:"scalar",T:2}]),ConnectionQualityUpdate=proto3.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ConnectionQualityInfo,repeated:!0}]),StreamStateInfo=proto3.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(StreamState)}]),StreamStateUpdate=proto3.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:StreamStateInfo,repeated:!0}]),SubscribedQuality=proto3.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"enabled",kind:"scalar",T:8}]),SubscribedCodec=proto3.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:SubscribedQuality,repeated:!0}]),SubscribedQualityUpdate=proto3.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:SubscribedQuality,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:SubscribedCodec,repeated:!0}]),TrackPermission=proto3.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),SubscriptionPermission=proto3.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:TrackPermission,repeated:!0}]),SubscriptionPermissionUpdate=proto3.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),SyncState=proto3.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:SessionDescription},{no:2,name:"subscription",kind:"message",T:UpdateSubscription},{no:3,name:"publish_tracks",kind:"message",T:TrackPublishedResponse,repeated:!0},{no:4,name:"data_channels",kind:"message",T:DataChannelInfo,repeated:!0},{no:5,name:"offer",kind:"message",T:SessionDescription},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),DataChannelInfo=proto3.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)}]),SimulateScenario=proto3.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:proto3.getEnumType(CandidateProtocol),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ping=proto3.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Pong=proto3.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),RegionSettings=proto3.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:RegionInfo,repeated:!0}]),RegionInfo=proto3.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),SubscriptionResponse=proto3.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:proto3.getEnumType(SubscriptionError)}]),RequestResponse=proto3.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(RequestResponse_Reason)},{no:3,name:"message",kind:"scalar",T:9}]),RequestResponse_Reason=proto3.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),TrackSubscribed=proto3.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function getDefaultExportFromCjs(U){return U&&U.__esModule&&Object.prototype.hasOwnProperty.call(U,"default")?U.default:U}var loglevel$1={exports:{}},loglevel=loglevel$1.exports,hasRequiredLoglevel;function requireLoglevel(){return hasRequiredLoglevel||(hasRequiredLoglevel=1,(function(U){(function(j,B){U.exports?U.exports=B():j.log=B()})(loglevel,function(){var j=function(){},B="undefined",q=typeof window!==B&&typeof window.navigator!==B&&/Trident\/|MSIE /.test(window.navigator.userAgent),V=["trace","debug","info","warn","error"],H={},$=null;function K(oe,de){var le=oe[de];if(typeof le.bind=="function")return le.bind(oe);try{return Function.prototype.bind.call(le,oe)}catch{return function(){return Function.prototype.apply.apply(le,[oe,arguments])}}}function X(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function Q(oe){return oe==="debug"&&(oe="log"),typeof console===B?!1:oe==="trace"&&q?X:console[oe]!==void 0?K(console,oe):console.log!==void 0?K(console,"log"):j}function W(){for(var oe=this.getLevel(),de=0;de<V.length;de++){var le=V[de];this[le]=de<oe?j:this.methodFactory(le,oe,this.name)}if(this.log=this.debug,typeof console===B&&oe<this.levels.SILENT)return"No console available for logging"}function Z(oe){return function(){typeof console!==B&&(W.call(this),this[oe].apply(this,arguments))}}function te(oe,de,le){return Q(oe)||Z.apply(this,arguments)}function ie(oe,de){var le=this,ue,he,me,be="loglevel";typeof oe=="string"?be+=":"+oe:typeof oe=="symbol"&&(be=void 0);function ge(xe){var Ie=(V[xe]||"silent").toUpperCase();if(!(typeof window===B||!be)){try{window.localStorage[be]=Ie;return}catch{}try{window.document.cookie=encodeURIComponent(be)+"="+Ie+";"}catch{}}}function Ee(){var xe;if(!(typeof window===B||!be)){try{xe=window.localStorage[be]}catch{}if(typeof xe===B)try{var Ie=window.document.cookie,Ge=encodeURIComponent(be),De=Ie.indexOf(Ge+"=");De!==-1&&(xe=/^([^;]+)/.exec(Ie.slice(De+Ge.length+1))[1])}catch{}return le.levels[xe]===void 0&&(xe=void 0),xe}}function Fe(){if(!(typeof window===B||!be)){try{window.localStorage.removeItem(be)}catch{}try{window.document.cookie=encodeURIComponent(be)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function Ue(xe){var Ie=xe;if(typeof Ie=="string"&&le.levels[Ie.toUpperCase()]!==void 0&&(Ie=le.levels[Ie.toUpperCase()]),typeof Ie=="number"&&Ie>=0&&Ie<=le.levels.SILENT)return Ie;throw new TypeError("log.setLevel() called with invalid level: "+xe)}le.name=oe,le.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},le.methodFactory=de||te,le.getLevel=function(){return me??he??ue},le.setLevel=function(xe,Ie){return me=Ue(xe),Ie!==!1&&ge(me),W.call(le)},le.setDefaultLevel=function(xe){he=Ue(xe),Ee()||le.setLevel(xe,!1)},le.resetLevel=function(){me=null,Fe(),W.call(le)},le.enableAll=function(xe){le.setLevel(le.levels.TRACE,xe)},le.disableAll=function(xe){le.setLevel(le.levels.SILENT,xe)},le.rebuild=function(){if($!==le&&(ue=Ue($.getLevel())),W.call(le),$===le)for(var xe in H)H[xe].rebuild()},ue=Ue($?$.getLevel():"WARN");var ze=Ee();ze!=null&&(me=Ue(ze)),W.call(le)}$=new ie,$.getLogger=function(de){if(typeof de!="symbol"&&typeof de!="string"||de==="")throw new TypeError("You must supply a name when creating a logger.");var le=H[de];return le||(le=H[de]=new ie(de,$.methodFactory)),le};var ae=typeof window!==B?window.log:void 0;return $.noConflict=function(){return typeof window!==B&&window.log===$&&(window.log=ae),$},$.getLoggers=function(){return H},$.default=$,$})})(loglevel$1)),loglevel$1.exports}var loglevelExports=requireLoglevel(),LogLevel;(function(U){U[U.trace=0]="trace",U[U.debug=1]="debug",U[U.info=2]="info",U[U.warn=3]="warn",U[U.error=4]="error",U[U.silent=5]="silent"})(LogLevel||(LogLevel={}));var LoggerNames;(function(U){U.Default="livekit",U.Room="livekit-room",U.Participant="livekit-participant",U.Track="livekit-track",U.Publication="livekit-track-publication",U.Engine="livekit-engine",U.Signal="livekit-signal",U.PCManager="livekit-pc-manager",U.PCTransport="livekit-pc-transport",U.E2EE="lk-e2ee"})(LoggerNames||(LoggerNames={}));let livekitLogger=loglevelExports.getLogger("livekit");Object.values(LoggerNames).map(U=>loglevelExports.getLogger(U));livekitLogger.setDefaultLevel(LogLevel.info);function getLogger(U){const j=loglevelExports.getLogger(U);return j.setDefaultLevel(livekitLogger.getLevel()),j}const workerLogger=loglevelExports.getLogger("lk-e2ee"),maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,4*300,9*300,16*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(j){this._retryDelays=j!==void 0?[...j]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(j){if(j.retryCount>=this._retryDelays.length)return null;const B=this._retryDelays[j.retryCount];return j.retryCount<=1?B:B+Math.random()*1e3}}function __rest(U,j){var B={};for(var q in U)Object.prototype.hasOwnProperty.call(U,q)&&j.indexOf(q)<0&&(B[q]=U[q]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,q=Object.getOwnPropertySymbols(U);V<q.length;V++)j.indexOf(q[V])<0&&Object.prototype.propertyIsEnumerable.call(U,q[V])&&(B[q[V]]=U[q[V]]);return B}function __awaiter$1(U,j,B,q){function V(H){return H instanceof B?H:new B(function($){$(H)})}return new(B||(B=Promise))(function(H,$){function K(W){try{Q(q.next(W))}catch(Z){$(Z)}}function X(W){try{Q(q.throw(W))}catch(Z){$(Z)}}function Q(W){W.done?H(W.value):V(W.value).then(K,X)}Q((q=q.apply(U,j||[])).next())})}function __values(U){var j=typeof Symbol=="function"&&Symbol.iterator,B=j&&U[j],q=0;if(B)return B.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&q>=U.length&&(U=void 0),{value:U&&U[q++],done:!U}}};throw new TypeError(j?"Object is not iterable.":"Symbol.iterator is not defined.")}function __asyncValues(U){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var j=U[Symbol.asyncIterator],B;return j?j.call(U):(U=typeof __values=="function"?__values(U):U[Symbol.iterator](),B={},q("next"),q("throw"),q("return"),B[Symbol.asyncIterator]=function(){return this},B);function q(H){B[H]=U[H]&&function($){return new Promise(function(K,X){$=U[H]($),V(K,X,$.done,$.value)})}}function V(H,$,K,X){Promise.resolve(X).then(function(Q){H({value:Q,done:K})},$)}}typeof SuppressedError=="function"&&SuppressedError;var events={exports:{}},hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events.exports;hasRequiredEvents=1;var U=typeof Reflect=="object"?Reflect:null,j=U&&typeof U.apply=="function"?U.apply:function(be,ge,Ee){return Function.prototype.apply.call(be,ge,Ee)},B;U&&typeof U.ownKeys=="function"?B=U.ownKeys:Object.getOwnPropertySymbols?B=function(be){return Object.getOwnPropertyNames(be).concat(Object.getOwnPropertySymbols(be))}:B=function(be){return Object.getOwnPropertyNames(be)};function q(me){console&&console.warn&&console.warn(me)}var V=Number.isNaN||function(be){return be!==be};function H(){H.init.call(this)}events.exports=H,events.exports.once=le,H.EventEmitter=H,H.prototype._events=void 0,H.prototype._eventsCount=0,H.prototype._maxListeners=void 0;var $=10;function K(me){if(typeof me!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof me)}Object.defineProperty(H,"defaultMaxListeners",{enumerable:!0,get:function(){return $},set:function(me){if(typeof me!="number"||me<0||V(me))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+me+".");$=me}}),H.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},H.prototype.setMaxListeners=function(be){if(typeof be!="number"||be<0||V(be))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+be+".");return this._maxListeners=be,this};function X(me){return me._maxListeners===void 0?H.defaultMaxListeners:me._maxListeners}H.prototype.getMaxListeners=function(){return X(this)},H.prototype.emit=function(be){for(var ge=[],Ee=1;Ee<arguments.length;Ee++)ge.push(arguments[Ee]);var Fe=be==="error",Ue=this._events;if(Ue!==void 0)Fe=Fe&&Ue.error===void 0;else if(!Fe)return!1;if(Fe){var ze;if(ge.length>0&&(ze=ge[0]),ze instanceof Error)throw ze;var xe=new Error("Unhandled error."+(ze?" ("+ze.message+")":""));throw xe.context=ze,xe}var Ie=Ue[be];if(Ie===void 0)return!1;if(typeof Ie=="function")j(Ie,this,ge);else for(var Ge=Ie.length,De=ae(Ie,Ge),Ee=0;Ee<Ge;++Ee)j(De[Ee],this,ge);return!0};function Q(me,be,ge,Ee){var Fe,Ue,ze;if(K(ge),Ue=me._events,Ue===void 0?(Ue=me._events=Object.create(null),me._eventsCount=0):(Ue.newListener!==void 0&&(me.emit("newListener",be,ge.listener?ge.listener:ge),Ue=me._events),ze=Ue[be]),ze===void 0)ze=Ue[be]=ge,++me._eventsCount;else if(typeof ze=="function"?ze=Ue[be]=Ee?[ge,ze]:[ze,ge]:Ee?ze.unshift(ge):ze.push(ge),Fe=X(me),Fe>0&&ze.length>Fe&&!ze.warned){ze.warned=!0;var xe=new Error("Possible EventEmitter memory leak detected. "+ze.length+" "+String(be)+" listeners added. Use emitter.setMaxListeners() to increase limit");xe.name="MaxListenersExceededWarning",xe.emitter=me,xe.type=be,xe.count=ze.length,q(xe)}return me}H.prototype.addListener=function(be,ge){return Q(this,be,ge,!1)},H.prototype.on=H.prototype.addListener,H.prototype.prependListener=function(be,ge){return Q(this,be,ge,!0)};function W(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z(me,be,ge){var Ee={fired:!1,wrapFn:void 0,target:me,type:be,listener:ge},Fe=W.bind(Ee);return Fe.listener=ge,Ee.wrapFn=Fe,Fe}H.prototype.once=function(be,ge){return K(ge),this.on(be,Z(this,be,ge)),this},H.prototype.prependOnceListener=function(be,ge){return K(ge),this.prependListener(be,Z(this,be,ge)),this},H.prototype.removeListener=function(be,ge){var Ee,Fe,Ue,ze,xe;if(K(ge),Fe=this._events,Fe===void 0)return this;if(Ee=Fe[be],Ee===void 0)return this;if(Ee===ge||Ee.listener===ge)--this._eventsCount===0?this._events=Object.create(null):(delete Fe[be],Fe.removeListener&&this.emit("removeListener",be,Ee.listener||ge));else if(typeof Ee!="function"){for(Ue=-1,ze=Ee.length-1;ze>=0;ze--)if(Ee[ze]===ge||Ee[ze].listener===ge){xe=Ee[ze].listener,Ue=ze;break}if(Ue<0)return this;Ue===0?Ee.shift():oe(Ee,Ue),Ee.length===1&&(Fe[be]=Ee[0]),Fe.removeListener!==void 0&&this.emit("removeListener",be,xe||ge)}return this},H.prototype.off=H.prototype.removeListener,H.prototype.removeAllListeners=function(be){var ge,Ee,Fe;if(Ee=this._events,Ee===void 0)return this;if(Ee.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Ee[be]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Ee[be]),this;if(arguments.length===0){var Ue=Object.keys(Ee),ze;for(Fe=0;Fe<Ue.length;++Fe)ze=Ue[Fe],ze!=="removeListener"&&this.removeAllListeners(ze);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(ge=Ee[be],typeof ge=="function")this.removeListener(be,ge);else if(ge!==void 0)for(Fe=ge.length-1;Fe>=0;Fe--)this.removeListener(be,ge[Fe]);return this};function te(me,be,ge){var Ee=me._events;if(Ee===void 0)return[];var Fe=Ee[be];return Fe===void 0?[]:typeof Fe=="function"?ge?[Fe.listener||Fe]:[Fe]:ge?de(Fe):ae(Fe,Fe.length)}H.prototype.listeners=function(be){return te(this,be,!0)},H.prototype.rawListeners=function(be){return te(this,be,!1)},H.listenerCount=function(me,be){return typeof me.listenerCount=="function"?me.listenerCount(be):ie.call(me,be)},H.prototype.listenerCount=ie;function ie(me){var be=this._events;if(be!==void 0){var ge=be[me];if(typeof ge=="function")return 1;if(ge!==void 0)return ge.length}return 0}H.prototype.eventNames=function(){return this._eventsCount>0?B(this._events):[]};function ae(me,be){for(var ge=new Array(be),Ee=0;Ee<be;++Ee)ge[Ee]=me[Ee];return ge}function oe(me,be){for(;be+1<me.length;be++)me[be]=me[be+1];me.pop()}function de(me){for(var be=new Array(me.length),ge=0;ge<be.length;++ge)be[ge]=me[ge].listener||me[ge];return be}function le(me,be){return new Promise(function(ge,Ee){function Fe(ze){me.removeListener(be,Ue),Ee(ze)}function Ue(){typeof me.removeListener=="function"&&me.removeListener("error",Fe),ge([].slice.call(arguments))}he(me,be,Ue,{once:!0}),be!=="error"&&ue(me,Fe,{once:!0})})}function ue(me,be,ge){typeof me.on=="function"&&he(me,"error",be,ge)}function he(me,be,ge,Ee){if(typeof me.on=="function")Ee.once?me.once(be,ge):me.on(be,ge);else if(typeof me.addEventListener=="function")me.addEventListener(be,function Fe(Ue){Ee.once&&me.removeEventListener(be,Fe),ge(Ue)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof me)}return events.exports}var eventsExports=requireEvents();let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(U,j,B){const q=U.match(j);return q&&q.length>=B&&parseInt(q[B],10)}function wrapPeerConnectionEvent(U,j,B){if(!U.RTCPeerConnection)return;const q=U.RTCPeerConnection.prototype,V=q.addEventListener;q.addEventListener=function($,K){if($!==j)return V.apply(this,arguments);const X=Q=>{const W=B(Q);W&&(K.handleEvent?K.handleEvent(W):K(W))};return this._eventMap=this._eventMap||{},this._eventMap[j]||(this._eventMap[j]=new Map),this._eventMap[j].set(K,X),V.apply(this,[$,X])};const H=q.removeEventListener;q.removeEventListener=function($,K){if($!==j||!this._eventMap||!this._eventMap[j])return H.apply(this,arguments);if(!this._eventMap[j].has(K))return H.apply(this,arguments);const X=this._eventMap[j].get(K);return this._eventMap[j].delete(K),this._eventMap[j].size===0&&delete this._eventMap[j],Object.keys(this._eventMap).length===0&&delete this._eventMap,H.apply(this,[$,X])},Object.defineProperty(q,"on"+j,{get(){return this["_on"+j]},set($){this["_on"+j]&&(this.removeEventListener(j,this["_on"+j]),delete this["_on"+j]),$&&this.addEventListener(j,this["_on"+j]=$)},enumerable:!0,configurable:!0})}function disableLog(U){return typeof U!="boolean"?new Error("Argument type: "+typeof U+". Please use a boolean."):(logDisabled_=U,U?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(U){return typeof U!="boolean"?new Error("Argument type: "+typeof U+". Please use a boolean."):(deprecationWarnings_=!U,"adapter.js deprecation warnings "+(U?"disabled":"enabled"))}function log(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(U,j){deprecationWarnings_&&console.warn(U+" is deprecated, please use "+j+" instead.")}function detectBrowser(U){const j={browser:null,version:null};if(typeof U>"u"||!U.navigator||!U.navigator.userAgent)return j.browser="Not a browser.",j;const{navigator:B}=U;if(B.userAgentData&&B.userAgentData.brands){const q=B.userAgentData.brands.find(V=>V.brand==="Chromium");if(q)return{browser:"chrome",version:parseInt(q.version,10)}}if(B.mozGetUserMedia)j.browser="firefox",j.version=extractVersion(B.userAgent,/Firefox\/(\d+)\./,1);else if(B.webkitGetUserMedia||U.isSecureContext===!1&&U.webkitRTCPeerConnection)j.browser="chrome",j.version=extractVersion(B.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(U.RTCPeerConnection&&B.userAgent.match(/AppleWebKit\/(\d+)\./))j.browser="safari",j.version=extractVersion(B.userAgent,/AppleWebKit\/(\d+)\./,1),j.supportsUnifiedPlan=U.RTCRtpTransceiver&&"currentDirection"in U.RTCRtpTransceiver.prototype;else return j.browser="Not a supported browser.",j;return j}function isObject(U){return Object.prototype.toString.call(U)==="[object Object]"}function compactObject(U){return isObject(U)?Object.keys(U).reduce(function(j,B){const q=isObject(U[B]),V=q?compactObject(U[B]):U[B],H=q&&!Object.keys(V).length;return V===void 0||H?j:Object.assign(j,{[B]:V})},{}):U}function walkStats(U,j,B){!j||B.has(j.id)||(B.set(j.id,j),Object.keys(j).forEach(q=>{q.endsWith("Id")?walkStats(U,U.get(j[q]),B):q.endsWith("Ids")&&j[q].forEach(V=>{walkStats(U,U.get(V),B)})}))}function filterStats(U,j,B){const q=B?"outbound-rtp":"inbound-rtp",V=new Map;if(j===null)return V;const H=[];return U.forEach($=>{$.type==="track"&&$.trackIdentifier===j.id&&H.push($)}),H.forEach($=>{U.forEach(K=>{K.type===q&&K.trackId===$.id&&walkStats(U,K,V)})}),V}const logging=log;function shimGetUserMedia$2(U,j){const B=U&&U.navigator;if(!B.mediaDevices)return;const q=function(K){if(typeof K!="object"||K.mandatory||K.optional)return K;const X={};return Object.keys(K).forEach(Q=>{if(Q==="require"||Q==="advanced"||Q==="mediaSource")return;const W=typeof K[Q]=="object"?K[Q]:{ideal:K[Q]};W.exact!==void 0&&typeof W.exact=="number"&&(W.min=W.max=W.exact);const Z=function(te,ie){return te?te+ie.charAt(0).toUpperCase()+ie.slice(1):ie==="deviceId"?"sourceId":ie};if(W.ideal!==void 0){X.optional=X.optional||[];let te={};typeof W.ideal=="number"?(te[Z("min",Q)]=W.ideal,X.optional.push(te),te={},te[Z("max",Q)]=W.ideal,X.optional.push(te)):(te[Z("",Q)]=W.ideal,X.optional.push(te))}W.exact!==void 0&&typeof W.exact!="number"?(X.mandatory=X.mandatory||{},X.mandatory[Z("",Q)]=W.exact):["min","max"].forEach(te=>{W[te]!==void 0&&(X.mandatory=X.mandatory||{},X.mandatory[Z(te,Q)]=W[te])})}),K.advanced&&(X.optional=(X.optional||[]).concat(K.advanced)),X},V=function(K,X){if(j.version>=61)return X(K);if(K=JSON.parse(JSON.stringify(K)),K&&typeof K.audio=="object"){const Q=function(W,Z,te){Z in W&&!(te in W)&&(W[te]=W[Z],delete W[Z])};K=JSON.parse(JSON.stringify(K)),Q(K.audio,"autoGainControl","googAutoGainControl"),Q(K.audio,"noiseSuppression","googNoiseSuppression"),K.audio=q(K.audio)}if(K&&typeof K.video=="object"){let Q=K.video.facingMode;Q=Q&&(typeof Q=="object"?Q:{ideal:Q});const W=j.version<66;if(Q&&(Q.exact==="user"||Q.exact==="environment"||Q.ideal==="user"||Q.ideal==="environment")&&!(B.mediaDevices.getSupportedConstraints&&B.mediaDevices.getSupportedConstraints().facingMode&&!W)){delete K.video.facingMode;let Z;if(Q.exact==="environment"||Q.ideal==="environment"?Z=["back","rear"]:(Q.exact==="user"||Q.ideal==="user")&&(Z=["front"]),Z)return B.mediaDevices.enumerateDevices().then(te=>{te=te.filter(ae=>ae.kind==="videoinput");let ie=te.find(ae=>Z.some(oe=>ae.label.toLowerCase().includes(oe)));return!ie&&te.length&&Z.includes("back")&&(ie=te[te.length-1]),ie&&(K.video.deviceId=Q.exact?{exact:ie.deviceId}:{ideal:ie.deviceId}),K.video=q(K.video),logging("chrome: "+JSON.stringify(K)),X(K)})}K.video=q(K.video)}return logging("chrome: "+JSON.stringify(K)),X(K)},H=function(K){return j.version>=64?K:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[K.name]||K.name,message:K.message,constraint:K.constraint||K.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},$=function(K,X,Q){V(K,W=>{B.webkitGetUserMedia(W,X,Z=>{Q&&Q(H(Z))})})};if(B.getUserMedia=$.bind(B),B.mediaDevices.getUserMedia){const K=B.mediaDevices.getUserMedia.bind(B.mediaDevices);B.mediaDevices.getUserMedia=function(X){return V(X,Q=>K(Q).then(W=>{if(Q.audio&&!W.getAudioTracks().length||Q.video&&!W.getVideoTracks().length)throw W.getTracks().forEach(Z=>{Z.stop()}),new DOMException("","NotFoundError");return W},W=>Promise.reject(H(W))))}}}function shimMediaStream(U){U.MediaStream=U.MediaStream||U.webkitMediaStream}function shimOnTrack$1(U){if(typeof U=="object"&&U.RTCPeerConnection&&!("ontrack"in U.RTCPeerConnection.prototype)){Object.defineProperty(U.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(B){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=B)},enumerable:!0,configurable:!0});const j=U.RTCPeerConnection.prototype.setRemoteDescription;U.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=q=>{q.stream.addEventListener("addtrack",V=>{let H;U.RTCPeerConnection.prototype.getReceivers?H=this.getReceivers().find(K=>K.track&&K.track.id===V.track.id):H={track:V.track};const $=new Event("track");$.track=V.track,$.receiver=H,$.transceiver={receiver:H},$.streams=[q.stream],this.dispatchEvent($)}),q.stream.getTracks().forEach(V=>{let H;U.RTCPeerConnection.prototype.getReceivers?H=this.getReceivers().find(K=>K.track&&K.track.id===V.id):H={track:V};const $=new Event("track");$.track=V,$.receiver=H,$.transceiver={receiver:H},$.streams=[q.stream],this.dispatchEvent($)})},this.addEventListener("addstream",this._ontrackpoly)),j.apply(this,arguments)}}else wrapPeerConnectionEvent(U,"track",j=>(j.transceiver||Object.defineProperty(j,"transceiver",{value:{receiver:j.receiver}}),j))}function shimGetSendersWithDtmf(U){if(typeof U=="object"&&U.RTCPeerConnection&&!("getSenders"in U.RTCPeerConnection.prototype)&&"createDTMFSender"in U.RTCPeerConnection.prototype){const j=function(V,H){return{track:H,get dtmf(){return this._dtmf===void 0&&(H.kind==="audio"?this._dtmf=V.createDTMFSender(H):this._dtmf=null),this._dtmf},_pc:V}};if(!U.RTCPeerConnection.prototype.getSenders){U.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const V=U.RTCPeerConnection.prototype.addTrack;U.RTCPeerConnection.prototype.addTrack=function(K,X){let Q=V.apply(this,arguments);return Q||(Q=j(this,K),this._senders.push(Q)),Q};const H=U.RTCPeerConnection.prototype.removeTrack;U.RTCPeerConnection.prototype.removeTrack=function(K){H.apply(this,arguments);const X=this._senders.indexOf(K);X!==-1&&this._senders.splice(X,1)}}const B=U.RTCPeerConnection.prototype.addStream;U.RTCPeerConnection.prototype.addStream=function(H){this._senders=this._senders||[],B.apply(this,[H]),H.getTracks().forEach($=>{this._senders.push(j(this,$))})};const q=U.RTCPeerConnection.prototype.removeStream;U.RTCPeerConnection.prototype.removeStream=function(H){this._senders=this._senders||[],q.apply(this,[H]),H.getTracks().forEach($=>{const K=this._senders.find(X=>X.track===$);K&&this._senders.splice(this._senders.indexOf(K),1)})}}else if(typeof U=="object"&&U.RTCPeerConnection&&"getSenders"in U.RTCPeerConnection.prototype&&"createDTMFSender"in U.RTCPeerConnection.prototype&&U.RTCRtpSender&&!("dtmf"in U.RTCRtpSender.prototype)){const j=U.RTCPeerConnection.prototype.getSenders;U.RTCPeerConnection.prototype.getSenders=function(){const q=j.apply(this,[]);return q.forEach(V=>V._pc=this),q},Object.defineProperty(U.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimSenderReceiverGetStats(U){if(!(typeof U=="object"&&U.RTCPeerConnection&&U.RTCRtpSender&&U.RTCRtpReceiver))return;if(!("getStats"in U.RTCRtpSender.prototype)){const B=U.RTCPeerConnection.prototype.getSenders;B&&(U.RTCPeerConnection.prototype.getSenders=function(){const H=B.apply(this,[]);return H.forEach($=>$._pc=this),H});const q=U.RTCPeerConnection.prototype.addTrack;q&&(U.RTCPeerConnection.prototype.addTrack=function(){const H=q.apply(this,arguments);return H._pc=this,H}),U.RTCRtpSender.prototype.getStats=function(){const H=this;return this._pc.getStats().then($=>filterStats($,H.track,!0))}}if(!("getStats"in U.RTCRtpReceiver.prototype)){const B=U.RTCPeerConnection.prototype.getReceivers;B&&(U.RTCPeerConnection.prototype.getReceivers=function(){const V=B.apply(this,[]);return V.forEach(H=>H._pc=this),V}),wrapPeerConnectionEvent(U,"track",q=>(q.receiver._pc=q.srcElement,q)),U.RTCRtpReceiver.prototype.getStats=function(){const V=this;return this._pc.getStats().then(H=>filterStats(H,V.track,!1))}}if(!("getStats"in U.RTCRtpSender.prototype&&"getStats"in U.RTCRtpReceiver.prototype))return;const j=U.RTCPeerConnection.prototype.getStats;U.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof U.MediaStreamTrack){const q=arguments[0];let V,H,$;return this.getSenders().forEach(K=>{K.track===q&&(V?$=!0:V=K)}),this.getReceivers().forEach(K=>(K.track===q&&(H?$=!0:H=K),K.track===q)),$||V&&H?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):V?V.getStats():H?H.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return j.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(U){U.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map($=>this._shimmedLocalStreams[$][0])};const j=U.RTCPeerConnection.prototype.addTrack;U.RTCPeerConnection.prototype.addTrack=function($,K){if(!K)return j.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const X=j.apply(this,arguments);return this._shimmedLocalStreams[K.id]?this._shimmedLocalStreams[K.id].indexOf(X)===-1&&this._shimmedLocalStreams[K.id].push(X):this._shimmedLocalStreams[K.id]=[K,X],X};const B=U.RTCPeerConnection.prototype.addStream;U.RTCPeerConnection.prototype.addStream=function($){this._shimmedLocalStreams=this._shimmedLocalStreams||{},$.getTracks().forEach(Q=>{if(this.getSenders().find(Z=>Z.track===Q))throw new DOMException("Track already exists.","InvalidAccessError")});const K=this.getSenders();B.apply(this,arguments);const X=this.getSenders().filter(Q=>K.indexOf(Q)===-1);this._shimmedLocalStreams[$.id]=[$].concat(X)};const q=U.RTCPeerConnection.prototype.removeStream;U.RTCPeerConnection.prototype.removeStream=function($){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[$.id],q.apply(this,arguments)};const V=U.RTCPeerConnection.prototype.removeTrack;U.RTCPeerConnection.prototype.removeTrack=function($){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},$&&Object.keys(this._shimmedLocalStreams).forEach(K=>{const X=this._shimmedLocalStreams[K].indexOf($);X!==-1&&this._shimmedLocalStreams[K].splice(X,1),this._shimmedLocalStreams[K].length===1&&delete this._shimmedLocalStreams[K]}),V.apply(this,arguments)}}function shimAddTrackRemoveTrack(U,j){if(!U.RTCPeerConnection)return;if(U.RTCPeerConnection.prototype.addTrack&&j.version>=65)return shimAddTrackRemoveTrackWithNative(U);const B=U.RTCPeerConnection.prototype.getLocalStreams;U.RTCPeerConnection.prototype.getLocalStreams=function(){const W=B.apply(this);return this._reverseStreams=this._reverseStreams||{},W.map(Z=>this._reverseStreams[Z.id])};const q=U.RTCPeerConnection.prototype.addStream;U.RTCPeerConnection.prototype.addStream=function(W){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},W.getTracks().forEach(Z=>{if(this.getSenders().find(ie=>ie.track===Z))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[W.id]){const Z=new U.MediaStream(W.getTracks());this._streams[W.id]=Z,this._reverseStreams[Z.id]=W,W=Z}q.apply(this,[W])};const V=U.RTCPeerConnection.prototype.removeStream;U.RTCPeerConnection.prototype.removeStream=function(W){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},V.apply(this,[this._streams[W.id]||W]),delete this._reverseStreams[this._streams[W.id]?this._streams[W.id].id:W.id],delete this._streams[W.id]},U.RTCPeerConnection.prototype.addTrack=function(W,Z){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const te=[].slice.call(arguments,1);if(te.length!==1||!te[0].getTracks().find(oe=>oe===W))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(oe=>oe.track===W))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const ae=this._streams[Z.id];if(ae)ae.addTrack(W),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const oe=new U.MediaStream([W]);this._streams[Z.id]=oe,this._reverseStreams[oe.id]=Z,this.addStream(oe)}return this.getSenders().find(oe=>oe.track===W)};function H(Q,W){let Z=W.sdp;return Object.keys(Q._reverseStreams||[]).forEach(te=>{const ie=Q._reverseStreams[te],ae=Q._streams[ie.id];Z=Z.replace(new RegExp(ae.id,"g"),ie.id)}),new RTCSessionDescription({type:W.type,sdp:Z})}function $(Q,W){let Z=W.sdp;return Object.keys(Q._reverseStreams||[]).forEach(te=>{const ie=Q._reverseStreams[te],ae=Q._streams[ie.id];Z=Z.replace(new RegExp(ie.id,"g"),ae.id)}),new RTCSessionDescription({type:W.type,sdp:Z})}["createOffer","createAnswer"].forEach(function(Q){const W=U.RTCPeerConnection.prototype[Q],Z={[Q](){const te=arguments;return arguments.length&&typeof arguments[0]=="function"?W.apply(this,[ae=>{const oe=H(this,ae);te[0].apply(null,[oe])},ae=>{te[1]&&te[1].apply(null,ae)},arguments[2]]):W.apply(this,arguments).then(ae=>H(this,ae))}};U.RTCPeerConnection.prototype[Q]=Z[Q]});const K=U.RTCPeerConnection.prototype.setLocalDescription;U.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?K.apply(this,arguments):(arguments[0]=$(this,arguments[0]),K.apply(this,arguments))};const X=Object.getOwnPropertyDescriptor(U.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(U.RTCPeerConnection.prototype,"localDescription",{get(){const Q=X.get.apply(this);return Q.type===""?Q:H(this,Q)}}),U.RTCPeerConnection.prototype.removeTrack=function(W){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!W._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(W._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let te;Object.keys(this._streams).forEach(ie=>{this._streams[ie].getTracks().find(oe=>W.track===oe)&&(te=this._streams[ie])}),te&&(te.getTracks().length===1?this.removeStream(this._reverseStreams[te.id]):te.removeTrack(W.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(U,j){!U.RTCPeerConnection&&U.webkitRTCPeerConnection&&(U.RTCPeerConnection=U.webkitRTCPeerConnection),U.RTCPeerConnection&&j.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(B){const q=U.RTCPeerConnection.prototype[B],V={[B](){return arguments[0]=new(B==="addIceCandidate"?U.RTCIceCandidate:U.RTCSessionDescription)(arguments[0]),q.apply(this,arguments)}};U.RTCPeerConnection.prototype[B]=V[B]})}function fixNegotiationNeeded(U,j){wrapPeerConnectionEvent(U,"negotiationneeded",B=>{const q=B.target;if(!((j.version<72||q.getConfiguration&&q.getConfiguration().sdpSemantics==="plan-b")&&q.signalingState!=="stable"))return B})}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded,shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative,shimGetSendersWithDtmf,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats});function shimGetUserMedia$1(U,j){const B=U&&U.navigator,q=U&&U.MediaStreamTrack;if(B.getUserMedia=function(V,H,$){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),B.mediaDevices.getUserMedia(V).then(H,$)},!(j.version>55&&"autoGainControl"in B.mediaDevices.getSupportedConstraints())){const V=function($,K,X){K in $&&!(X in $)&&($[X]=$[K],delete $[K])},H=B.mediaDevices.getUserMedia.bind(B.mediaDevices);if(B.mediaDevices.getUserMedia=function($){return typeof $=="object"&&typeof $.audio=="object"&&($=JSON.parse(JSON.stringify($)),V($.audio,"autoGainControl","mozAutoGainControl"),V($.audio,"noiseSuppression","mozNoiseSuppression")),H($)},q&&q.prototype.getSettings){const $=q.prototype.getSettings;q.prototype.getSettings=function(){const K=$.apply(this,arguments);return V(K,"mozAutoGainControl","autoGainControl"),V(K,"mozNoiseSuppression","noiseSuppression"),K}}if(q&&q.prototype.applyConstraints){const $=q.prototype.applyConstraints;q.prototype.applyConstraints=function(K){return this.kind==="audio"&&typeof K=="object"&&(K=JSON.parse(JSON.stringify(K)),V(K,"autoGainControl","mozAutoGainControl"),V(K,"noiseSuppression","mozNoiseSuppression")),$.apply(this,[K])}}}}function shimGetDisplayMedia(U,j){U.navigator.mediaDevices&&"getDisplayMedia"in U.navigator.mediaDevices||U.navigator.mediaDevices&&(U.navigator.mediaDevices.getDisplayMedia=function(q){if(!(q&&q.video)){const V=new DOMException("getDisplayMedia without video constraints is undefined");return V.name="NotFoundError",V.code=8,Promise.reject(V)}return q.video===!0?q.video={mediaSource:j}:q.video.mediaSource=j,U.navigator.mediaDevices.getUserMedia(q)})}function shimOnTrack(U){typeof U=="object"&&U.RTCTrackEvent&&"receiver"in U.RTCTrackEvent.prototype&&!("transceiver"in U.RTCTrackEvent.prototype)&&Object.defineProperty(U.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(U,j){if(typeof U!="object"||!(U.RTCPeerConnection||U.mozRTCPeerConnection))return;!U.RTCPeerConnection&&U.mozRTCPeerConnection&&(U.RTCPeerConnection=U.mozRTCPeerConnection),j.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(V){const H=U.RTCPeerConnection.prototype[V],$={[V](){return arguments[0]=new(V==="addIceCandidate"?U.RTCIceCandidate:U.RTCSessionDescription)(arguments[0]),H.apply(this,arguments)}};U.RTCPeerConnection.prototype[V]=$[V]});const B={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},q=U.RTCPeerConnection.prototype.getStats;U.RTCPeerConnection.prototype.getStats=function(){const[H,$,K]=arguments;return q.apply(this,[H||null]).then(X=>{if(j.version<53&&!$)try{X.forEach(Q=>{Q.type=B[Q.type]||Q.type})}catch(Q){if(Q.name!=="TypeError")throw Q;X.forEach((W,Z)=>{X.set(Z,Object.assign({},W,{type:B[W.type]||W.type}))})}return X}).then($,K)}}function shimSenderGetStats(U){if(!(typeof U=="object"&&U.RTCPeerConnection&&U.RTCRtpSender)||U.RTCRtpSender&&"getStats"in U.RTCRtpSender.prototype)return;const j=U.RTCPeerConnection.prototype.getSenders;j&&(U.RTCPeerConnection.prototype.getSenders=function(){const V=j.apply(this,[]);return V.forEach(H=>H._pc=this),V});const B=U.RTCPeerConnection.prototype.addTrack;B&&(U.RTCPeerConnection.prototype.addTrack=function(){const V=B.apply(this,arguments);return V._pc=this,V}),U.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(U){if(!(typeof U=="object"&&U.RTCPeerConnection&&U.RTCRtpSender)||U.RTCRtpSender&&"getStats"in U.RTCRtpReceiver.prototype)return;const j=U.RTCPeerConnection.prototype.getReceivers;j&&(U.RTCPeerConnection.prototype.getReceivers=function(){const q=j.apply(this,[]);return q.forEach(V=>V._pc=this),q}),wrapPeerConnectionEvent(U,"track",B=>(B.receiver._pc=B.srcElement,B)),U.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(U){!U.RTCPeerConnection||"removeStream"in U.RTCPeerConnection.prototype||(U.RTCPeerConnection.prototype.removeStream=function(B){deprecated("removeStream","removeTrack"),this.getSenders().forEach(q=>{q.track&&B.getTracks().includes(q.track)&&this.removeTrack(q)})})}function shimRTCDataChannel(U){U.DataChannel&&!U.RTCDataChannel&&(U.RTCDataChannel=U.DataChannel)}function shimAddTransceiver(U){if(!(typeof U=="object"&&U.RTCPeerConnection))return;const j=U.RTCPeerConnection.prototype.addTransceiver;j&&(U.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let q=arguments[1]&&arguments[1].sendEncodings;q===void 0&&(q=[]),q=[...q];const V=q.length>0;V&&q.forEach($=>{if("rid"in $&&!/^[a-z0-9]{0,16}$/i.test($.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in $&&!(parseFloat($.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in $&&!(parseFloat($.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const H=j.apply(this,arguments);if(V){const{sender:$}=H,K=$.getParameters();(!("encodings"in K)||K.encodings.length===1&&Object.keys(K.encodings[0]).length===0)&&(K.encodings=q,$.sendEncodings=q,this.setParametersPromises.push($.setParameters(K).then(()=>{delete $.sendEncodings}).catch(()=>{delete $.sendEncodings})))}return H})}function shimGetParameters(U){if(!(typeof U=="object"&&U.RTCRtpSender))return;const j=U.RTCRtpSender.prototype.getParameters;j&&(U.RTCRtpSender.prototype.getParameters=function(){const q=j.apply(this,arguments);return"encodings"in q||(q.encodings=[].concat(this.sendEncodings||[{}])),q})}function shimCreateOffer(U){if(!(typeof U=="object"&&U.RTCPeerConnection))return;const j=U.RTCPeerConnection.prototype.createOffer;U.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>j.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):j.apply(this,arguments)}}function shimCreateAnswer(U){if(!(typeof U=="object"&&U.RTCPeerConnection))return;const j=U.RTCPeerConnection.prototype.createAnswer;U.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>j.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):j.apply(this,arguments)}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver,shimCreateAnswer,shimCreateOffer,shimGetDisplayMedia,shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack,shimPeerConnection,shimRTCDataChannel,shimReceiverGetStats,shimRemoveStream,shimSenderGetStats});function shimLocalStreamsAPI(U){if(!(typeof U!="object"||!U.RTCPeerConnection)){if("getLocalStreams"in U.RTCPeerConnection.prototype||(U.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in U.RTCPeerConnection.prototype)){const j=U.RTCPeerConnection.prototype.addTrack;U.RTCPeerConnection.prototype.addStream=function(q){this._localStreams||(this._localStreams=[]),this._localStreams.includes(q)||this._localStreams.push(q),q.getAudioTracks().forEach(V=>j.call(this,V,q)),q.getVideoTracks().forEach(V=>j.call(this,V,q))},U.RTCPeerConnection.prototype.addTrack=function(q){for(var V=arguments.length,H=new Array(V>1?V-1:0),$=1;$<V;$++)H[$-1]=arguments[$];return H&&H.forEach(K=>{this._localStreams?this._localStreams.includes(K)||this._localStreams.push(K):this._localStreams=[K]}),j.apply(this,arguments)}}"removeStream"in U.RTCPeerConnection.prototype||(U.RTCPeerConnection.prototype.removeStream=function(B){this._localStreams||(this._localStreams=[]);const q=this._localStreams.indexOf(B);if(q===-1)return;this._localStreams.splice(q,1);const V=B.getTracks();this.getSenders().forEach(H=>{V.includes(H.track)&&this.removeTrack(H)})})}}function shimRemoteStreamsAPI(U){if(!(typeof U!="object"||!U.RTCPeerConnection)&&("getRemoteStreams"in U.RTCPeerConnection.prototype||(U.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in U.RTCPeerConnection.prototype))){Object.defineProperty(U.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(B){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=B),this.addEventListener("track",this._onaddstreampoly=q=>{q.streams.forEach(V=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(V))return;this._remoteStreams.push(V);const H=new Event("addstream");H.stream=V,this.dispatchEvent(H)})})}});const j=U.RTCPeerConnection.prototype.setRemoteDescription;U.RTCPeerConnection.prototype.setRemoteDescription=function(){const q=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(V){V.streams.forEach(H=>{if(q._remoteStreams||(q._remoteStreams=[]),q._remoteStreams.indexOf(H)>=0)return;q._remoteStreams.push(H);const $=new Event("addstream");$.stream=H,q.dispatchEvent($)})}),j.apply(q,arguments)}}}function shimCallbacksAPI(U){if(typeof U!="object"||!U.RTCPeerConnection)return;const j=U.RTCPeerConnection.prototype,B=j.createOffer,q=j.createAnswer,V=j.setLocalDescription,H=j.setRemoteDescription,$=j.addIceCandidate;j.createOffer=function(Q,W){const Z=arguments.length>=2?arguments[2]:arguments[0],te=B.apply(this,[Z]);return W?(te.then(Q,W),Promise.resolve()):te},j.createAnswer=function(Q,W){const Z=arguments.length>=2?arguments[2]:arguments[0],te=q.apply(this,[Z]);return W?(te.then(Q,W),Promise.resolve()):te};let K=function(X,Q,W){const Z=V.apply(this,[X]);return W?(Z.then(Q,W),Promise.resolve()):Z};j.setLocalDescription=K,K=function(X,Q,W){const Z=H.apply(this,[X]);return W?(Z.then(Q,W),Promise.resolve()):Z},j.setRemoteDescription=K,K=function(X,Q,W){const Z=$.apply(this,[X]);return W?(Z.then(Q,W),Promise.resolve()):Z},j.addIceCandidate=K}function shimGetUserMedia(U){const j=U&&U.navigator;if(j.mediaDevices&&j.mediaDevices.getUserMedia){const B=j.mediaDevices,q=B.getUserMedia.bind(B);j.mediaDevices.getUserMedia=V=>q(shimConstraints(V))}!j.getUserMedia&&j.mediaDevices&&j.mediaDevices.getUserMedia&&(j.getUserMedia=(function(q,V,H){j.mediaDevices.getUserMedia(q).then(V,H)}).bind(j))}function shimConstraints(U){return U&&U.video!==void 0?Object.assign({},U,{video:compactObject(U.video)}):U}function shimRTCIceServerUrls(U){if(!U.RTCPeerConnection)return;const j=U.RTCPeerConnection;U.RTCPeerConnection=function(q,V){if(q&&q.iceServers){const H=[];for(let $=0;$<q.iceServers.length;$++){let K=q.iceServers[$];K.urls===void 0&&K.url?(deprecated("RTCIceServer.url","RTCIceServer.urls"),K=JSON.parse(JSON.stringify(K)),K.urls=K.url,delete K.url,H.push(K)):H.push(q.iceServers[$])}q.iceServers=H}return new j(q,V)},U.RTCPeerConnection.prototype=j.prototype,"generateCertificate"in j&&Object.defineProperty(U.RTCPeerConnection,"generateCertificate",{get(){return j.generateCertificate}})}function shimTrackEventTransceiver(U){typeof U=="object"&&U.RTCTrackEvent&&"receiver"in U.RTCTrackEvent.prototype&&!("transceiver"in U.RTCTrackEvent.prototype)&&Object.defineProperty(U.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(U){const j=U.RTCPeerConnection.prototype.createOffer;U.RTCPeerConnection.prototype.createOffer=function(q){if(q){typeof q.offerToReceiveAudio<"u"&&(q.offerToReceiveAudio=!!q.offerToReceiveAudio);const V=this.getTransceivers().find($=>$.receiver.track.kind==="audio");q.offerToReceiveAudio===!1&&V?V.direction==="sendrecv"?V.setDirection?V.setDirection("sendonly"):V.direction="sendonly":V.direction==="recvonly"&&(V.setDirection?V.setDirection("inactive"):V.direction="inactive"):q.offerToReceiveAudio===!0&&!V&&this.addTransceiver("audio",{direction:"recvonly"}),typeof q.offerToReceiveVideo<"u"&&(q.offerToReceiveVideo=!!q.offerToReceiveVideo);const H=this.getTransceivers().find($=>$.receiver.track.kind==="video");q.offerToReceiveVideo===!1&&H?H.direction==="sendrecv"?H.setDirection?H.setDirection("sendonly"):H.direction="sendonly":H.direction==="recvonly"&&(H.setDirection?H.setDirection("inactive"):H.direction="inactive"):q.offerToReceiveVideo===!0&&!H&&this.addTransceiver("video",{direction:"recvonly"})}return j.apply(this,arguments)}}function shimAudioContext(U){typeof U!="object"||U.AudioContext||(U.AudioContext=U.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext,shimCallbacksAPI,shimConstraints,shimCreateOfferLegacy,shimGetUserMedia,shimLocalStreamsAPI,shimRTCIceServerUrls,shimRemoteStreamsAPI,shimTrackEventTransceiver}),sdp$1={exports:{}},hasRequiredSdp;function requireSdp(){return hasRequiredSdp||(hasRequiredSdp=1,(function(U){const j={};j.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},j.localCName=j.generateIdentifier(),j.splitLines=function(B){return B.trim().split(`
`).map(q=>q.trim())},j.splitSections=function(B){return B.split(`
m=`).map((V,H)=>(H>0?"m="+V:V).trim()+`\r
`)},j.getDescription=function(B){const q=j.splitSections(B);return q&&q[0]},j.getMediaSections=function(B){const q=j.splitSections(B);return q.shift(),q},j.matchPrefix=function(B,q){return j.splitLines(B).filter(V=>V.indexOf(q)===0)},j.parseCandidate=function(B){let q;B.indexOf("a=candidate:")===0?q=B.substring(12).split(" "):q=B.substring(10).split(" ");const V={foundation:q[0],component:{1:"rtp",2:"rtcp"}[q[1]]||q[1],protocol:q[2].toLowerCase(),priority:parseInt(q[3],10),ip:q[4],address:q[4],port:parseInt(q[5],10),type:q[7]};for(let H=8;H<q.length;H+=2)switch(q[H]){case"raddr":V.relatedAddress=q[H+1];break;case"rport":V.relatedPort=parseInt(q[H+1],10);break;case"tcptype":V.tcpType=q[H+1];break;case"ufrag":V.ufrag=q[H+1],V.usernameFragment=q[H+1];break;default:V[q[H]]===void 0&&(V[q[H]]=q[H+1]);break}return V},j.writeCandidate=function(B){const q=[];q.push(B.foundation);const V=B.component;V==="rtp"?q.push(1):V==="rtcp"?q.push(2):q.push(V),q.push(B.protocol.toUpperCase()),q.push(B.priority),q.push(B.address||B.ip),q.push(B.port);const H=B.type;return q.push("typ"),q.push(H),H!=="host"&&B.relatedAddress&&B.relatedPort&&(q.push("raddr"),q.push(B.relatedAddress),q.push("rport"),q.push(B.relatedPort)),B.tcpType&&B.protocol.toLowerCase()==="tcp"&&(q.push("tcptype"),q.push(B.tcpType)),(B.usernameFragment||B.ufrag)&&(q.push("ufrag"),q.push(B.usernameFragment||B.ufrag)),"candidate:"+q.join(" ")},j.parseIceOptions=function(B){return B.substring(14).split(" ")},j.parseRtpMap=function(B){let q=B.substring(9).split(" ");const V={payloadType:parseInt(q.shift(),10)};return q=q[0].split("/"),V.name=q[0],V.clockRate=parseInt(q[1],10),V.channels=q.length===3?parseInt(q[2],10):1,V.numChannels=V.channels,V},j.writeRtpMap=function(B){let q=B.payloadType;B.preferredPayloadType!==void 0&&(q=B.preferredPayloadType);const V=B.channels||B.numChannels||1;return"a=rtpmap:"+q+" "+B.name+"/"+B.clockRate+(V!==1?"/"+V:"")+`\r
`},j.parseExtmap=function(B){const q=B.substring(9).split(" ");return{id:parseInt(q[0],10),direction:q[0].indexOf("/")>0?q[0].split("/")[1]:"sendrecv",uri:q[1],attributes:q.slice(2).join(" ")}},j.writeExtmap=function(B){return"a=extmap:"+(B.id||B.preferredId)+(B.direction&&B.direction!=="sendrecv"?"/"+B.direction:"")+" "+B.uri+(B.attributes?" "+B.attributes:"")+`\r
`},j.parseFmtp=function(B){const q={};let V;const H=B.substring(B.indexOf(" ")+1).split(";");for(let $=0;$<H.length;$++)V=H[$].trim().split("="),q[V[0].trim()]=V[1];return q},j.writeFmtp=function(B){let q="",V=B.payloadType;if(B.preferredPayloadType!==void 0&&(V=B.preferredPayloadType),B.parameters&&Object.keys(B.parameters).length){const H=[];Object.keys(B.parameters).forEach($=>{B.parameters[$]!==void 0?H.push($+"="+B.parameters[$]):H.push($)}),q+="a=fmtp:"+V+" "+H.join(";")+`\r
`}return q},j.parseRtcpFb=function(B){const q=B.substring(B.indexOf(" ")+1).split(" ");return{type:q.shift(),parameter:q.join(" ")}},j.writeRtcpFb=function(B){let q="",V=B.payloadType;return B.preferredPayloadType!==void 0&&(V=B.preferredPayloadType),B.rtcpFeedback&&B.rtcpFeedback.length&&B.rtcpFeedback.forEach(H=>{q+="a=rtcp-fb:"+V+" "+H.type+(H.parameter&&H.parameter.length?" "+H.parameter:"")+`\r
`}),q},j.parseSsrcMedia=function(B){const q=B.indexOf(" "),V={ssrc:parseInt(B.substring(7,q),10)},H=B.indexOf(":",q);return H>-1?(V.attribute=B.substring(q+1,H),V.value=B.substring(H+1)):V.attribute=B.substring(q+1),V},j.parseSsrcGroup=function(B){const q=B.substring(13).split(" ");return{semantics:q.shift(),ssrcs:q.map(V=>parseInt(V,10))}},j.getMid=function(B){const q=j.matchPrefix(B,"a=mid:")[0];if(q)return q.substring(6)},j.parseFingerprint=function(B){const q=B.substring(14).split(" ");return{algorithm:q[0].toLowerCase(),value:q[1].toUpperCase()}},j.getDtlsParameters=function(B,q){return{role:"auto",fingerprints:j.matchPrefix(B+q,"a=fingerprint:").map(j.parseFingerprint)}},j.writeDtlsParameters=function(B,q){let V="a=setup:"+q+`\r
`;return B.fingerprints.forEach(H=>{V+="a=fingerprint:"+H.algorithm+" "+H.value+`\r
`}),V},j.parseCryptoLine=function(B){const q=B.substring(9).split(" ");return{tag:parseInt(q[0],10),cryptoSuite:q[1],keyParams:q[2],sessionParams:q.slice(3)}},j.writeCryptoLine=function(B){return"a=crypto:"+B.tag+" "+B.cryptoSuite+" "+(typeof B.keyParams=="object"?j.writeCryptoKeyParams(B.keyParams):B.keyParams)+(B.sessionParams?" "+B.sessionParams.join(" "):"")+`\r
`},j.parseCryptoKeyParams=function(B){if(B.indexOf("inline:")!==0)return null;const q=B.substring(7).split("|");return{keyMethod:"inline",keySalt:q[0],lifeTime:q[1],mkiValue:q[2]?q[2].split(":")[0]:void 0,mkiLength:q[2]?q[2].split(":")[1]:void 0}},j.writeCryptoKeyParams=function(B){return B.keyMethod+":"+B.keySalt+(B.lifeTime?"|"+B.lifeTime:"")+(B.mkiValue&&B.mkiLength?"|"+B.mkiValue+":"+B.mkiLength:"")},j.getCryptoParameters=function(B,q){return j.matchPrefix(B+q,"a=crypto:").map(j.parseCryptoLine)},j.getIceParameters=function(B,q){const V=j.matchPrefix(B+q,"a=ice-ufrag:")[0],H=j.matchPrefix(B+q,"a=ice-pwd:")[0];return V&&H?{usernameFragment:V.substring(12),password:H.substring(10)}:null},j.writeIceParameters=function(B){let q="a=ice-ufrag:"+B.usernameFragment+`\r
a=ice-pwd:`+B.password+`\r
`;return B.iceLite&&(q+=`a=ice-lite\r
`),q},j.parseRtpParameters=function(B){const q={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},H=j.splitLines(B)[0].split(" ");q.profile=H[2];for(let K=3;K<H.length;K++){const X=H[K],Q=j.matchPrefix(B,"a=rtpmap:"+X+" ")[0];if(Q){const W=j.parseRtpMap(Q),Z=j.matchPrefix(B,"a=fmtp:"+X+" ");switch(W.parameters=Z.length?j.parseFmtp(Z[0]):{},W.rtcpFeedback=j.matchPrefix(B,"a=rtcp-fb:"+X+" ").map(j.parseRtcpFb),q.codecs.push(W),W.name.toUpperCase()){case"RED":case"ULPFEC":q.fecMechanisms.push(W.name.toUpperCase());break}}}j.matchPrefix(B,"a=extmap:").forEach(K=>{q.headerExtensions.push(j.parseExtmap(K))});const $=j.matchPrefix(B,"a=rtcp-fb:* ").map(j.parseRtcpFb);return q.codecs.forEach(K=>{$.forEach(X=>{K.rtcpFeedback.find(W=>W.type===X.type&&W.parameter===X.parameter)||K.rtcpFeedback.push(X)})}),q},j.writeRtpDescription=function(B,q){let V="";V+="m="+B+" ",V+=q.codecs.length>0?"9":"0",V+=" "+(q.profile||"UDP/TLS/RTP/SAVPF")+" ",V+=q.codecs.map($=>$.preferredPayloadType!==void 0?$.preferredPayloadType:$.payloadType).join(" ")+`\r
`,V+=`c=IN IP4 0.0.0.0\r
`,V+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,q.codecs.forEach($=>{V+=j.writeRtpMap($),V+=j.writeFmtp($),V+=j.writeRtcpFb($)});let H=0;return q.codecs.forEach($=>{$.maxptime>H&&(H=$.maxptime)}),H>0&&(V+="a=maxptime:"+H+`\r
`),q.headerExtensions&&q.headerExtensions.forEach($=>{V+=j.writeExtmap($)}),V},j.parseRtpEncodingParameters=function(B){const q=[],V=j.parseRtpParameters(B),H=V.fecMechanisms.indexOf("RED")!==-1,$=V.fecMechanisms.indexOf("ULPFEC")!==-1,K=j.matchPrefix(B,"a=ssrc:").map(te=>j.parseSsrcMedia(te)).filter(te=>te.attribute==="cname"),X=K.length>0&&K[0].ssrc;let Q;const W=j.matchPrefix(B,"a=ssrc-group:FID").map(te=>te.substring(17).split(" ").map(ae=>parseInt(ae,10)));W.length>0&&W[0].length>1&&W[0][0]===X&&(Q=W[0][1]),V.codecs.forEach(te=>{if(te.name.toUpperCase()==="RTX"&&te.parameters.apt){let ie={ssrc:X,codecPayloadType:parseInt(te.parameters.apt,10)};X&&Q&&(ie.rtx={ssrc:Q}),q.push(ie),H&&(ie=JSON.parse(JSON.stringify(ie)),ie.fec={ssrc:X,mechanism:$?"red+ulpfec":"red"},q.push(ie))}}),q.length===0&&X&&q.push({ssrc:X});let Z=j.matchPrefix(B,"b=");return Z.length&&(Z[0].indexOf("b=TIAS:")===0?Z=parseInt(Z[0].substring(7),10):Z[0].indexOf("b=AS:")===0?Z=parseInt(Z[0].substring(5),10)*1e3*.95-2e3*8:Z=void 0,q.forEach(te=>{te.maxBitrate=Z})),q},j.parseRtcpParameters=function(B){const q={},V=j.matchPrefix(B,"a=ssrc:").map(K=>j.parseSsrcMedia(K)).filter(K=>K.attribute==="cname")[0];V&&(q.cname=V.value,q.ssrc=V.ssrc);const H=j.matchPrefix(B,"a=rtcp-rsize");q.reducedSize=H.length>0,q.compound=H.length===0;const $=j.matchPrefix(B,"a=rtcp-mux");return q.mux=$.length>0,q},j.writeRtcpParameters=function(B){let q="";return B.reducedSize&&(q+=`a=rtcp-rsize\r
`),B.mux&&(q+=`a=rtcp-mux\r
`),B.ssrc!==void 0&&B.cname&&(q+="a=ssrc:"+B.ssrc+" cname:"+B.cname+`\r
`),q},j.parseMsid=function(B){let q;const V=j.matchPrefix(B,"a=msid:");if(V.length===1)return q=V[0].substring(7).split(" "),{stream:q[0],track:q[1]};const H=j.matchPrefix(B,"a=ssrc:").map($=>j.parseSsrcMedia($)).filter($=>$.attribute==="msid");if(H.length>0)return q=H[0].value.split(" "),{stream:q[0],track:q[1]}},j.parseSctpDescription=function(B){const q=j.parseMLine(B),V=j.matchPrefix(B,"a=max-message-size:");let H;V.length>0&&(H=parseInt(V[0].substring(19),10)),isNaN(H)&&(H=65536);const $=j.matchPrefix(B,"a=sctp-port:");if($.length>0)return{port:parseInt($[0].substring(12),10),protocol:q.fmt,maxMessageSize:H};const K=j.matchPrefix(B,"a=sctpmap:");if(K.length>0){const X=K[0].substring(10).split(" ");return{port:parseInt(X[0],10),protocol:X[1],maxMessageSize:H}}},j.writeSctpDescription=function(B,q){let V=[];return B.protocol!=="DTLS/SCTP"?V=["m="+B.kind+" 9 "+B.protocol+" "+q.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+q.port+`\r
`]:V=["m="+B.kind+" 9 "+B.protocol+" "+q.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+q.port+" "+q.protocol+` 65535\r
`],q.maxMessageSize!==void 0&&V.push("a=max-message-size:"+q.maxMessageSize+`\r
`),V.join("")},j.generateSessionId=function(){return Math.random().toString().substr(2,22)},j.writeSessionBoilerplate=function(B,q,V){let H;const $=q!==void 0?q:2;return B?H=B:H=j.generateSessionId(),`v=0\r
o=`+(V||"thisisadapterortc")+" "+H+" "+$+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},j.getDirection=function(B,q){const V=j.splitLines(B);for(let H=0;H<V.length;H++)switch(V[H]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return V[H].substring(2)}return q?j.getDirection(q):"sendrecv"},j.getKind=function(B){return j.splitLines(B)[0].split(" ")[0].substring(2)},j.isRejected=function(B){return B.split(" ",2)[1]==="0"},j.parseMLine=function(B){const V=j.splitLines(B)[0].substring(2).split(" ");return{kind:V[0],port:parseInt(V[1],10),protocol:V[2],fmt:V.slice(3).join(" ")}},j.parseOLine=function(B){const V=j.matchPrefix(B,"o=")[0].substring(2).split(" ");return{username:V[0],sessionId:V[1],sessionVersion:parseInt(V[2],10),netType:V[3],addressType:V[4],address:V[5]}},j.isValidSDP=function(B){if(typeof B!="string"||B.length===0)return!1;const q=j.splitLines(B);for(let V=0;V<q.length;V++)if(q[V].length<2||q[V].charAt(1)!=="=")return!1;return!0},U.exports=j})(sdp$1)),sdp$1.exports}var sdpExports=requireSdp(),SDPUtils=getDefaultExportFromCjs(sdpExports),sdp=_mergeNamespaces({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(U){if(!U.RTCIceCandidate||U.RTCIceCandidate&&"foundation"in U.RTCIceCandidate.prototype)return;const j=U.RTCIceCandidate;U.RTCIceCandidate=function(q){if(typeof q=="object"&&q.candidate&&q.candidate.indexOf("a=")===0&&(q=JSON.parse(JSON.stringify(q)),q.candidate=q.candidate.substring(2)),q.candidate&&q.candidate.length){const V=new j(q),H=SDPUtils.parseCandidate(q.candidate);for(const $ in H)$ in V||Object.defineProperty(V,$,{value:H[$]});return V.toJSON=function(){return{candidate:V.candidate,sdpMid:V.sdpMid,sdpMLineIndex:V.sdpMLineIndex,usernameFragment:V.usernameFragment}},V}return new j(q)},U.RTCIceCandidate.prototype=j.prototype,wrapPeerConnectionEvent(U,"icecandidate",B=>(B.candidate&&Object.defineProperty(B,"candidate",{value:new U.RTCIceCandidate(B.candidate),writable:"false"}),B))}function shimRTCIceCandidateRelayProtocol(U){!U.RTCIceCandidate||U.RTCIceCandidate&&"relayProtocol"in U.RTCIceCandidate.prototype||wrapPeerConnectionEvent(U,"icecandidate",j=>{if(j.candidate){const B=SDPUtils.parseCandidate(j.candidate.candidate);B.type==="relay"&&(j.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[B.priority>>24])}return j})}function shimMaxMessageSize(U,j){if(!U.RTCPeerConnection)return;"sctp"in U.RTCPeerConnection.prototype||Object.defineProperty(U.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const B=function(K){if(!K||!K.sdp)return!1;const X=SDPUtils.splitSections(K.sdp);return X.shift(),X.some(Q=>{const W=SDPUtils.parseMLine(Q);return W&&W.kind==="application"&&W.protocol.indexOf("SCTP")!==-1})},q=function(K){const X=K.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(X===null||X.length<2)return-1;const Q=parseInt(X[1],10);return Q!==Q?-1:Q},V=function(K){let X=65536;return j.browser==="firefox"&&(j.version<57?K===-1?X=16384:X=2147483637:j.version<60?X=j.version===57?65535:65536:X=2147483637),X},H=function(K,X){let Q=65536;j.browser==="firefox"&&j.version===57&&(Q=65535);const W=SDPUtils.matchPrefix(K.sdp,"a=max-message-size:");return W.length>0?Q=parseInt(W[0].substring(19),10):j.browser==="firefox"&&X!==-1&&(Q=2147483637),Q},$=U.RTCPeerConnection.prototype.setRemoteDescription;U.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,j.browser==="chrome"&&j.version>=76){const{sdpSemantics:X}=this.getConfiguration();X==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(B(arguments[0])){const X=q(arguments[0]),Q=V(X),W=H(arguments[0],X);let Z;Q===0&&W===0?Z=Number.POSITIVE_INFINITY:Q===0||W===0?Z=Math.max(Q,W):Z=Math.min(Q,W);const te={};Object.defineProperty(te,"maxMessageSize",{get(){return Z}}),this._sctp=te}return $.apply(this,arguments)}}function shimSendThrowTypeError(U){if(!(U.RTCPeerConnection&&"createDataChannel"in U.RTCPeerConnection.prototype))return;function j(q,V){const H=q.send;q.send=function(){const K=arguments[0],X=K.length||K.size||K.byteLength;if(q.readyState==="open"&&V.sctp&&X>V.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+V.sctp.maxMessageSize+" bytes)");return H.apply(q,arguments)}}const B=U.RTCPeerConnection.prototype.createDataChannel;U.RTCPeerConnection.prototype.createDataChannel=function(){const V=B.apply(this,arguments);return j(V,this),V},wrapPeerConnectionEvent(U,"datachannel",q=>(j(q.channel,q.target),q))}function shimConnectionState(U){if(!U.RTCPeerConnection||"connectionState"in U.RTCPeerConnection.prototype)return;const j=U.RTCPeerConnection.prototype;Object.defineProperty(j,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(j,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(B){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),B&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=B)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(B=>{const q=j[B];j[B]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=V=>{const H=V.target;if(H._lastConnectionState!==H.connectionState){H._lastConnectionState=H.connectionState;const $=new Event("connectionstatechange",V);H.dispatchEvent($)}return V},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),q.apply(this,arguments)}})}function removeExtmapAllowMixed(U,j){if(!U.RTCPeerConnection||j.browser==="chrome"&&j.version>=71||j.browser==="safari"&&j.version>=605)return;const B=U.RTCPeerConnection.prototype.setRemoteDescription;U.RTCPeerConnection.prototype.setRemoteDescription=function(V){if(V&&V.sdp&&V.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const H=V.sdp.split(`
`).filter($=>$.trim()!=="a=extmap-allow-mixed").join(`
`);U.RTCSessionDescription&&V instanceof U.RTCSessionDescription?arguments[0]=new U.RTCSessionDescription({type:V.type,sdp:H}):V.sdp=H}return B.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(U,j){if(!(U.RTCPeerConnection&&U.RTCPeerConnection.prototype))return;const B=U.RTCPeerConnection.prototype.addIceCandidate;!B||B.length===0||(U.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(j.browser==="chrome"&&j.version<78||j.browser==="firefox"&&j.version<68||j.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():B.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(U,j){if(!(U.RTCPeerConnection&&U.RTCPeerConnection.prototype))return;const B=U.RTCPeerConnection.prototype.setLocalDescription;!B||B.length===0||(U.RTCPeerConnection.prototype.setLocalDescription=function(){let V=arguments[0]||{};if(typeof V!="object"||V.type&&V.sdp)return B.apply(this,arguments);if(V={type:V.type,sdp:V.sdp},!V.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":V.type="offer";break;default:V.type="answer";break}return V.sdp||V.type!=="offer"&&V.type!=="answer"?B.apply(this,[V]):(V.type==="offer"?this.createOffer:this.createAnswer).apply(this).then($=>B.apply(this,[$]))})}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimConnectionState,shimMaxMessageSize,shimParameterlessSetLocalDescription,shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError});function adapterFactory(){let{window:U}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const B=log,q=detectBrowser(U),V={browserDetails:q,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(q.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!j.shimChrome)return B("Chrome shim is not included in this adapter release."),V;if(q.version===null)return B("Chrome shim can not determine version, not shimming."),V;B("adapter.js shimming chrome."),V.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(U,q),shimParameterlessSetLocalDescription(U),shimGetUserMedia$2(U,q),shimMediaStream(U),shimPeerConnection$1(U,q),shimOnTrack$1(U),shimAddTrackRemoveTrack(U,q),shimGetSendersWithDtmf(U),shimSenderReceiverGetStats(U),fixNegotiationNeeded(U,q),shimRTCIceCandidate(U),shimRTCIceCandidateRelayProtocol(U),shimConnectionState(U),shimMaxMessageSize(U,q),shimSendThrowTypeError(U),removeExtmapAllowMixed(U,q);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!j.shimFirefox)return B("Firefox shim is not included in this adapter release."),V;B("adapter.js shimming firefox."),V.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(U,q),shimParameterlessSetLocalDescription(U),shimGetUserMedia$1(U,q),shimPeerConnection(U,q),shimOnTrack(U),shimRemoveStream(U),shimSenderGetStats(U),shimReceiverGetStats(U),shimRTCDataChannel(U),shimAddTransceiver(U),shimGetParameters(U),shimCreateOffer(U),shimCreateAnswer(U),shimRTCIceCandidate(U),shimConnectionState(U),shimMaxMessageSize(U,q),shimSendThrowTypeError(U);break;case"safari":if(!safariShim||!j.shimSafari)return B("Safari shim is not included in this adapter release."),V;B("adapter.js shimming safari."),V.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(U,q),shimParameterlessSetLocalDescription(U),shimRTCIceServerUrls(U),shimCreateOfferLegacy(U),shimCallbacksAPI(U),shimLocalStreamsAPI(U),shimRemoteStreamsAPI(U),shimTrackEventTransceiver(U),shimGetUserMedia(U),shimAudioContext(U),shimRTCIceCandidate(U),shimRTCIceCandidateRelayProtocol(U),shimMaxMessageSize(U,q),shimSendThrowTypeError(U),removeExtmapAllowMixed(U,q);break;default:B("Unsupported browser!");break}return V}adapterFactory({window:typeof window>"u"?void 0:window});const DECRYPTION_FAILURE_TOLERANCE=10,E2EE_FLAG="lk_e2ee",SALT="LKFrameEncryptionKey",KEY_PROVIDER_DEFAULTS={sharedKey:!1,ratchetSalt:SALT,ratchetWindowSize:8,failureTolerance:DECRYPTION_FAILURE_TOLERANCE,keyringSize:16,allowKeyExtraction:!1};var KeyProviderEvent;(function(U){U.SetKey="setKey",U.RatchetRequest="ratchetRequest",U.KeyRatcheted="keyRatcheted"})(KeyProviderEvent||(KeyProviderEvent={}));var KeyHandlerEvent;(function(U){U.KeyRatcheted="keyRatcheted"})(KeyHandlerEvent||(KeyHandlerEvent={}));var EncryptionEvent;(function(U){U.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",U.EncryptionError="encryptionError"})(EncryptionEvent||(EncryptionEvent={}));var CryptorEvent;(function(U){U.Error="cryptorError"})(CryptorEvent||(CryptorEvent={}));function isE2EESupported(){return isInsertableStreamSupported()||isScriptTransformSupported()}function isScriptTransformSupported(){return typeof window.RTCRtpScriptTransform<"u"}function isInsertableStreamSupported(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class BaseKeyProvider extends eventsExports.EventEmitter{constructor(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(B,q)=>{livekitLogger.debug("key ratcheted event received",{material:B,keyIndex:q})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},KEY_PROVIDER_DEFAULTS),j),this.on(KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(j,B,q){const V={key:j,participantIdentity:B,keyIndex:q};if(!this.options.sharedKey&&!B)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(B??"shared","-").concat(q??0),V),this.emit(KeyProviderEvent.SetKey,V)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(j,B){this.emit(KeyProviderEvent.RatchetRequest,j,B)}}class LivekitError extends Error{constructor(j,B){super(B||"an error has occured"),this.name="LiveKitError",this.code=j}}var ConnectionErrorReason;(function(U){U[U.NotAllowed=0]="NotAllowed",U[U.ServerUnreachable=1]="ServerUnreachable",U[U.InternalError=2]="InternalError",U[U.Cancelled=3]="Cancelled",U[U.LeaveRequest=4]="LeaveRequest"})(ConnectionErrorReason||(ConnectionErrorReason={}));class ConnectionError extends LivekitError{constructor(j,B,q,V){super(1,j),this.name="ConnectionError",this.status=q,this.reason=B,this.context=V,this.reasonName=ConnectionErrorReason[B]}}class DeviceUnsupportedError extends LivekitError{constructor(j){super(21,j??"device is unsupported"),this.name="DeviceUnsupportedError"}}class TrackInvalidError extends LivekitError{constructor(j){super(20,j??"track is invalid"),this.name="TrackInvalidError"}}class UnsupportedServer extends LivekitError{constructor(j){super(10,j??"unsupported server"),this.name="UnsupportedServer"}}class UnexpectedConnectionState extends LivekitError{constructor(j){super(12,j??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class NegotiationError extends LivekitError{constructor(j){super(13,j??"unable to negotiate"),this.name="NegotiationError"}}class PublishTrackError extends LivekitError{constructor(j,B){super(15,j),this.name="PublishTrackError",this.status=B}}class SignalRequestError extends LivekitError{constructor(j,B){super(15,j),this.reason=B,this.reasonName=typeof B=="string"?B:RequestResponse_Reason[B]}}var MediaDeviceFailure;(function(U){U.PermissionDenied="PermissionDenied",U.NotFound="NotFound",U.DeviceInUse="DeviceInUse",U.Other="Other"})(MediaDeviceFailure||(MediaDeviceFailure={}));(function(U){function j(B){if(B&&"name"in B)return B.name==="NotFoundError"||B.name==="DevicesNotFoundError"?U.NotFound:B.name==="NotAllowedError"||B.name==="PermissionDeniedError"?U.PermissionDenied:B.name==="NotReadableError"||B.name==="TrackStartError"?U.DeviceInUse:U.Other}U.getFailure=j})(MediaDeviceFailure||(MediaDeviceFailure={}));var CryptorErrorReason;(function(U){U[U.InvalidKey=0]="InvalidKey",U[U.MissingKey=1]="MissingKey",U[U.InternalError=2]="InternalError"})(CryptorErrorReason||(CryptorErrorReason={}));var RoomEvent;(function(U){U.Connected="connected",U.Reconnecting="reconnecting",U.SignalReconnecting="signalReconnecting",U.Reconnected="reconnected",U.Disconnected="disconnected",U.ConnectionStateChanged="connectionStateChanged",U.MediaDevicesChanged="mediaDevicesChanged",U.ParticipantConnected="participantConnected",U.ParticipantDisconnected="participantDisconnected",U.TrackPublished="trackPublished",U.TrackSubscribed="trackSubscribed",U.TrackSubscriptionFailed="trackSubscriptionFailed",U.TrackUnpublished="trackUnpublished",U.TrackUnsubscribed="trackUnsubscribed",U.TrackMuted="trackMuted",U.TrackUnmuted="trackUnmuted",U.LocalTrackPublished="localTrackPublished",U.LocalTrackUnpublished="localTrackUnpublished",U.LocalAudioSilenceDetected="localAudioSilenceDetected",U.ActiveSpeakersChanged="activeSpeakersChanged",U.ParticipantMetadataChanged="participantMetadataChanged",U.ParticipantNameChanged="participantNameChanged",U.ParticipantAttributesChanged="participantAttributesChanged",U.RoomMetadataChanged="roomMetadataChanged",U.DataReceived="dataReceived",U.SipDTMFReceived="sipDTMFReceived",U.TranscriptionReceived="transcriptionReceived",U.ConnectionQualityChanged="connectionQualityChanged",U.TrackStreamStateChanged="trackStreamStateChanged",U.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",U.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",U.AudioPlaybackStatusChanged="audioPlaybackChanged",U.VideoPlaybackStatusChanged="videoPlaybackChanged",U.MediaDevicesError="mediaDevicesError",U.ParticipantPermissionsChanged="participantPermissionsChanged",U.SignalConnected="signalConnected",U.RecordingStatusChanged="recordingStatusChanged",U.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",U.EncryptionError="encryptionError",U.DCBufferStatusChanged="dcBufferStatusChanged",U.ActiveDeviceChanged="activeDeviceChanged",U.ChatMessage="chatMessage",U.LocalTrackSubscribed="localTrackSubscribed",U.MetricsReceived="metricsReceived"})(RoomEvent||(RoomEvent={}));var ParticipantEvent;(function(U){U.TrackPublished="trackPublished",U.TrackSubscribed="trackSubscribed",U.TrackSubscriptionFailed="trackSubscriptionFailed",U.TrackUnpublished="trackUnpublished",U.TrackUnsubscribed="trackUnsubscribed",U.TrackMuted="trackMuted",U.TrackUnmuted="trackUnmuted",U.LocalTrackPublished="localTrackPublished",U.LocalTrackUnpublished="localTrackUnpublished",U.ParticipantMetadataChanged="participantMetadataChanged",U.ParticipantNameChanged="participantNameChanged",U.DataReceived="dataReceived",U.SipDTMFReceived="sipDTMFReceived",U.TranscriptionReceived="transcriptionReceived",U.IsSpeakingChanged="isSpeakingChanged",U.ConnectionQualityChanged="connectionQualityChanged",U.TrackStreamStateChanged="trackStreamStateChanged",U.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",U.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",U.MediaDevicesError="mediaDevicesError",U.AudioStreamAcquired="audioStreamAcquired",U.ParticipantPermissionsChanged="participantPermissionsChanged",U.PCTrackAdded="pcTrackAdded",U.AttributesChanged="attributesChanged",U.LocalTrackSubscribed="localTrackSubscribed",U.ChatMessage="chatMessage"})(ParticipantEvent||(ParticipantEvent={}));var EngineEvent;(function(U){U.TransportsCreated="transportsCreated",U.Connected="connected",U.Disconnected="disconnected",U.Resuming="resuming",U.Resumed="resumed",U.Restarting="restarting",U.Restarted="restarted",U.SignalResumed="signalResumed",U.SignalRestarted="signalRestarted",U.Closing="closing",U.MediaTrackAdded="mediaTrackAdded",U.ActiveSpeakersUpdate="activeSpeakersUpdate",U.DataPacketReceived="dataPacketReceived",U.RTPVideoMapUpdate="rtpVideoMapUpdate",U.DCBufferStatusChanged="dcBufferStatusChanged",U.ParticipantUpdate="participantUpdate",U.RoomUpdate="roomUpdate",U.SpeakersChanged="speakersChanged",U.StreamStateChanged="streamStateChanged",U.ConnectionQualityUpdate="connectionQualityUpdate",U.SubscriptionError="subscriptionError",U.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",U.RemoteMute="remoteMute",U.SubscribedQualityUpdate="subscribedQualityUpdate",U.LocalTrackUnpublished="localTrackUnpublished",U.LocalTrackSubscribed="localTrackSubscribed",U.Offline="offline",U.SignalRequestResponse="signalRequestResponse",U.SignalConnected="signalConnected"})(EngineEvent||(EngineEvent={}));var TrackEvent;(function(U){U.Message="message",U.Muted="muted",U.Unmuted="unmuted",U.Restarted="restarted",U.Ended="ended",U.Subscribed="subscribed",U.Unsubscribed="unsubscribed",U.UpdateSettings="updateSettings",U.UpdateSubscription="updateSubscription",U.AudioPlaybackStarted="audioPlaybackStarted",U.AudioPlaybackFailed="audioPlaybackFailed",U.AudioSilenceDetected="audioSilenceDetected",U.VisibilityChanged="visibilityChanged",U.VideoDimensionsChanged="videoDimensionsChanged",U.VideoPlaybackStarted="videoPlaybackStarted",U.VideoPlaybackFailed="videoPlaybackFailed",U.ElementAttached="elementAttached",U.ElementDetached="elementDetached",U.UpstreamPaused="upstreamPaused",U.UpstreamResumed="upstreamResumed",U.SubscriptionPermissionChanged="subscriptionPermissionChanged",U.SubscriptionStatusChanged="subscriptionStatusChanged",U.SubscriptionFailed="subscriptionFailed",U.TrackProcessorUpdate="trackProcessorUpdate",U.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",U.TranscriptionReceived="transcriptionReceived",U.TimeSyncUpdate="timeSyncUpdate"})(TrackEvent||(TrackEvent={}));function cloneDeep(U){return typeof U>"u"?U:typeof structuredClone=="function"?structuredClone(U):JSON.parse(JSON.stringify(U))}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i;let browserDetails;function getBrowser(U){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const B=navigator.userAgent.toLowerCase();if(browserDetails===void 0||j){const q=browsersList.find(V=>{let{test:H}=V;return H.test(B)});browserDetails=q==null?void 0:q.describe(B)}return browserDetails}const browsersList=[{test:/firefox|iceweasel|fxios/i,describe(U){return{name:"Firefox",version:getMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,U),os:U.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:getOSVersion(U)}}},{test:/chrom|crios|crmo/i,describe(U){return{name:"Chrome",version:getMatch(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,U),os:U.toLowerCase().includes("crios")?"iOS":void 0,osVersion:getOSVersion(U)}}},{test:/safari|applewebkit/i,describe(U){return{name:"Safari",version:getMatch(commonVersionIdentifier,U),os:U.includes("mobile/")?"iOS":"macOS",osVersion:getOSVersion(U)}}}];function getMatch(U,j){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const q=j.match(U);return q&&q.length>=B&&q[B]||""}function getOSVersion(U){return U.includes("mac os")?getMatch(/\(.+?(\d+_\d+(:?_\d+)?)/,U,1).replace(/_/g,"."):void 0}var version$1="2.11.3";const version=version$1,protocolVersion=15;class CriticalTimers{}CriticalTimers.setTimeout=function(){return setTimeout(...arguments)};CriticalTimers.setInterval=function(){return setInterval(...arguments)};CriticalTimers.clearTimeout=function(){return clearTimeout(...arguments)};CriticalTimers.clearInterval=function(){return clearInterval(...arguments)};const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];var VideoQuality;(function(U){U[U.LOW=0]="LOW",U[U.MEDIUM=1]="MEDIUM",U[U.HIGH=2]="HIGH"})(VideoQuality||(VideoQuality={}));class Track extends eventsExports.EventEmitter{constructor(j,B){let q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var V;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Track.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=livekitLogger,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()},this.log=getLogger((V=q.loggerName)!==null&&V!==void 0?V:LoggerNames.Track),this.loggerContextCb=q.loggerContextCb,this.setMaxListeners(100),this.kind=B,this._mediaStreamTrack=j,this._mediaStreamID=j.id,this.source=Track.Source.Unknown}get logContext(){var j;return Object.assign(Object.assign({},(j=this.loggerContextCb)===null||j===void 0?void 0:j.call(this)),getLogContextFromTrack(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(j){let B="audio";this.kind===Track.Kind.Video&&(B="video"),this.attachedElements.length===0&&this.kind===Track.Kind.Video&&this.addAppVisibilityListener(),j||(B==="audio"&&(recycledElements.forEach(H=>{H.parentElement===null&&!j&&(j=H)}),j&&recycledElements.splice(recycledElements.indexOf(j),1)),j||(j=document.createElement(B))),this.attachedElements.includes(j)||this.attachedElements.push(j),attachToElement(this.mediaStreamTrack,j);const q=j.srcObject.getTracks(),V=q.some(H=>H.kind==="audio");return j.play().then(()=>{this.emit(V?TrackEvent.AudioPlaybackStarted:TrackEvent.VideoPlaybackStarted)}).catch(H=>{H.name==="NotAllowedError"?this.emit(V?TrackEvent.AudioPlaybackFailed:TrackEvent.VideoPlaybackFailed,H):H.name==="AbortError"?livekitLogger.debug("".concat(V?"audio":"video"," playback aborted, likely due to new play request")):livekitLogger.warn("could not playback ".concat(V?"audio":"video"),H),V&&j&&q.some($=>$.kind==="video")&&H.name==="NotAllowedError"&&(j.muted=!0,j.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,j),j}detach(j){try{if(j){detachTrack(this.mediaStreamTrack,j);const q=this.attachedElements.indexOf(j);return q>=0&&(this.attachedElements.splice(q,1),this.recycleElement(j),this.emit(TrackEvent.ElementDetached,j)),j}const B=[];return this.attachedElements.forEach(q=>{detachTrack(this.mediaStreamTrack,q),B.push(q),this.recycleElement(q),this.emit(TrackEvent.ElementDetached,q)}),this.attachedElements=[],B}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(j){j.loggerName&&(this.log=getLogger(j.loggerName)),j.loggerContextCb&&(this.loggerContextCb=j.loggerContextCb)}recycleElement(j){if(j instanceof HTMLAudioElement){let B=!0;j.pause(),recycledElements.forEach(q=>{q.parentElement||(B=!1)}),B&&recycledElements.push(j)}}handleAppVisibilityChanged(){return __awaiter$1(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Track.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(j=>j.play().catch(()=>{})),0)})}addAppVisibilityListener(){isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function attachToElement(U,j){let B;j.srcObject instanceof MediaStream?B=j.srcObject:B=new MediaStream;let q;U.kind==="audio"?q=B.getAudioTracks():q=B.getVideoTracks(),q.includes(U)||(q.forEach(V=>{B.removeTrack(V)}),B.addTrack(U)),(!isSafari()||!(j instanceof HTMLVideoElement))&&(j.autoplay=!0),j.muted=B.getAudioTracks().length===0,j instanceof HTMLVideoElement&&(j.playsInline=!0),j.srcObject!==B&&(j.srcObject=B,(isSafari()||isFireFox())&&j instanceof HTMLVideoElement&&setTimeout(()=>{j.srcObject=B,j.play().catch(()=>{})},0))}function detachTrack(U,j){if(j.srcObject instanceof MediaStream){const B=j.srcObject;B.removeTrack(U),B.getTracks().length>0?j.srcObject=B:j.srcObject=null}}(function(U){let j;(function(Q){Q.Audio="audio",Q.Video="video",Q.Unknown="unknown"})(j=U.Kind||(U.Kind={}));let B;(function(Q){Q.Camera="camera",Q.Microphone="microphone",Q.ScreenShare="screen_share",Q.ScreenShareAudio="screen_share_audio",Q.Unknown="unknown"})(B=U.Source||(U.Source={}));let q;(function(Q){Q.Active="active",Q.Paused="paused",Q.Unknown="unknown"})(q=U.StreamState||(U.StreamState={}));function V(Q){switch(Q){case j.Audio:return TrackType.AUDIO;case j.Video:return TrackType.VIDEO;default:return TrackType.DATA}}U.kindToProto=V;function H(Q){switch(Q){case TrackType.AUDIO:return j.Audio;case TrackType.VIDEO:return j.Video;default:return j.Unknown}}U.kindFromProto=H;function $(Q){switch(Q){case B.Camera:return TrackSource.CAMERA;case B.Microphone:return TrackSource.MICROPHONE;case B.ScreenShare:return TrackSource.SCREEN_SHARE;case B.ScreenShareAudio:return TrackSource.SCREEN_SHARE_AUDIO;default:return TrackSource.UNKNOWN}}U.sourceToProto=$;function K(Q){switch(Q){case TrackSource.CAMERA:return B.Camera;case TrackSource.MICROPHONE:return B.Microphone;case TrackSource.SCREEN_SHARE:return B.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return B.ScreenShareAudio;default:return B.Unknown}}U.sourceFromProto=K;function X(Q){switch(Q){case StreamState.ACTIVE:return q.Active;case StreamState.PAUSED:return q.Paused;default:return q.Unknown}}U.streamStateFromProto=X})(Track||(Track={}));class VideoPreset{constructor(j,B,q,V,H){if(typeof j=="object")this.width=j.width,this.height=j.height,this.aspectRatio=j.aspectRatio,this.encoding={maxBitrate:j.maxBitrate,maxFramerate:j.maxFramerate,priority:j.priority};else if(B!==void 0&&q!==void 0)this.width=j,this.height=B,this.aspectRatio=j/B,this.encoding={maxBitrate:q,maxFramerate:V,priority:H};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const backupCodecs=["vp8","h264"],videoCodecs=["vp8","h264","vp9","av1"];function isBackupCodec(U){return!!backupCodecs.find(j=>j===U)}var BackupCodecPolicy;(function(U){U[U.PREFER_REGRESSION=0]="PREFER_REGRESSION",U[U.SIMULCAST=1]="SIMULCAST",U[U.REGRESSION=2]="REGRESSION"})(BackupCodecPolicy||(BackupCodecPolicy={}));var AudioPresets;(function(U){U.telephone={maxBitrate:12e3},U.speech={maxBitrate:24e3},U.music={maxBitrate:48e3},U.musicStereo={maxBitrate:64e3},U.musicHighQuality={maxBitrate:96e3},U.musicHighQualityStereo={maxBitrate:128e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,9e4,20),h180:new VideoPreset(320,180,16e4,20),h216:new VideoPreset(384,216,18e4,20),h360:new VideoPreset(640,360,45e4,20),h540:new VideoPreset(960,540,8e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,7e4,20),h180:new VideoPreset(240,180,125e3,20),h240:new VideoPreset(320,240,14e4,20),h360:new VideoPreset(480,360,33e4,20),h480:new VideoPreset(640,480,5e5,20),h540:new VideoPreset(720,540,6e5,25),h720:new VideoPreset(960,720,13e5,30),h1080:new VideoPreset(1440,1080,23e5,30),h1440:new VideoPreset(1920,1440,38e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3,"medium"),h360fps15:new VideoPreset(640,360,4e5,15,"medium"),h720fps5:new VideoPreset(1280,720,8e5,5,"medium"),h720fps15:new VideoPreset(1280,720,15e5,15,"medium"),h720fps30:new VideoPreset(1280,720,2e6,30,"medium"),h1080fps15:new VideoPreset(1920,1080,25e5,15,"medium"),h1080fps30:new VideoPreset(1920,1080,5e6,30,"medium"),original:new VideoPreset(0,0,7e6,30,"medium")},separator="|",ddExtensionURI="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function unpackStreamId(U){const j=U.split(separator);return j.length>1?[j[0],U.substr(j[0].length+1)]:[U,""]}function sleep$1(U){return __awaiter$1(this,void 0,void 0,function*(){return new Promise(j=>CriticalTimers.setTimeout(j,U))})}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){if(!("getCapabilities"in RTCRtpSender)||isSafari())return!1;const U=RTCRtpSender.getCapabilities("video");let j=!1;if(U){for(const B of U.codecs)if(B.mimeType==="video/AV1"){j=!0;break}}return j}function supportsVP9(){if(!("getCapabilities"in RTCRtpSender)||isFireFox())return!1;if(isSafari()){const B=getBrowser();if(B!=null&&B.version&&compareVersions(B.version,"16")<0)return!1}const U=RTCRtpSender.getCapabilities("video");let j=!1;if(U){for(const B of U.codecs)if(B.mimeType==="video/VP9"){j=!0;break}}return j}function isSVCCodec(U){return U==="av1"||U==="vp9"}function supportsSetSinkId(U){return document?(U||(U=document.createElement("audio")),"setSinkId"in U):!1}function isBrowserSupported(){return typeof RTCPeerConnection>"u"?!1:supportsTransceiver()||supportsAddTrack()}function isFireFox(){var U;return((U=getBrowser())===null||U===void 0?void 0:U.name)==="Firefox"}function isSafari(){var U;return((U=getBrowser())===null||U===void 0?void 0:U.name)==="Safari"}function isSafari17(){const U=getBrowser();return(U==null?void 0:U.name)==="Safari"&&U.version.startsWith("17.")}function isMobile(){var U,j;return isWeb()?(j=(U=navigator.userAgentData)===null||U===void 0?void 0:U.mobile)!==null&&j!==void 0?j:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isE2EESimulcastSupported(){const U=getBrowser(),j="17.2";if(U)return U.name!=="Safari"&&U.os!=="iOS"||U.os==="iOS"&&U.osVersion&&compareVersions(j,U.osVersion)>=0?!0:U.name==="Safari"&&compareVersions(j,U.version)>=0}function isWeb(){return typeof document<"u"}function isReactNative(){return navigator.product=="ReactNative"}function isCloud(U){return U.hostname.endsWith(".livekit.cloud")||U.hostname.endsWith(".livekit.run")}function getLKReactNativeInfo(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function getReactNativeOs(){if(!isReactNative())return;let U=getLKReactNativeInfo();if(U)return U.platform}function getDevicePixelRatio(){if(isWeb())return window.devicePixelRatio;if(isReactNative()){let U=getLKReactNativeInfo();if(U)return U.devicePixelRatio}return 1}function compareVersions(U,j){const B=U.split("."),q=j.split("."),V=Math.min(B.length,q.length);for(let H=0;H<V;++H){const $=parseInt(B[H],10),K=parseInt(q[H],10);if($>K)return 1;if($<K)return-1;if(H===V-1&&$===K)return 0}return U===""&&j!==""?-1:j===""?1:B.length==q.length?0:B.length<q.length?-1:1}function roDispatchCallback(U){for(const j of U)j.target.handleResize(j)}function ioDispatchCallback(U){for(const j of U)j.target.handleVisibilityChanged(j)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:null,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){var U;const j=new ClientInfo({sdk:ClientInfo_SDK.JS,protocol:protocolVersion,version});return isReactNative()&&(j.os=(U=getReactNativeOs())!==null&&U!==void 0?U:""),j}function createDummyVideoStreamTrack(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,q=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const V=document.createElement("canvas");V.width=U,V.height=j;const H=V.getContext("2d");H==null||H.fillRect(0,0,V.width,V.height),q&&H&&(H.beginPath(),H.arc(U/2,j/2,50,0,Math.PI*2,!0),H.closePath(),H.fillStyle="grey",H.fill());const $=V.captureStream(),[K]=$.getTracks();if(!K)throw Error("Could not get empty media stream video track");return K.enabled=B,K}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const U=new AudioContext,j=U.createOscillator(),B=U.createGain();B.gain.setValueAtTime(0,0);const q=U.createMediaStreamDestination();if(j.connect(B),B.connect(q),j.start(),[emptyAudioStreamTrack]=q.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack.clone()}class Future{constructor(j,B){this.onFinally=B,this.promise=new Promise((q,V)=>__awaiter$1(this,void 0,void 0,function*(){this.resolve=q,this.reject=V,j&&(yield j(q,V))})).finally(()=>{var q;return(q=this.onFinally)===null||q===void 0?void 0:q.call(this)})}}function isVideoCodec(U){return videoCodecs.includes(U)}function unwrapConstraint(U){if(typeof U=="string"||typeof U=="number")return U;if(Array.isArray(U))return U[0];if(U.exact)return Array.isArray(U.exact)?U.exact[0]:U.exact;if(U.ideal)return Array.isArray(U.ideal)?U.ideal[0]:U.ideal;throw Error("could not unwrap constraint")}function toWebsocketUrl(U){return U.startsWith("http")?U.replace(/^(http)/,"ws"):U}function toHttpUrl(U){return U.startsWith("ws")?U.replace(/^(ws)/,"http"):U}function extractTranscriptionSegments(U,j){return U.segments.map(B=>{let{id:q,text:V,language:H,startTime:$,endTime:K,final:X}=B;var Q;const W=(Q=j.get(q))!==null&&Q!==void 0?Q:Date.now(),Z=Date.now();return X?j.delete(q):j.set(q,W),{id:q,text:V,startTime:Number.parseInt($.toString()),endTime:Number.parseInt(K.toString()),final:X,language:H,firstReceivedTime:W,lastReceivedTime:Z}})}function extractChatMessage(U){const{id:j,timestamp:B,message:q,editTimestamp:V}=U;return{id:j,timestamp:Number.parseInt(B.toString()),editTimestamp:V?Number.parseInt(V.toString()):void 0,message:q}}function getDisconnectReasonFromConnectionError(U){switch(U.reason){case ConnectionErrorReason.LeaveRequest:return U.context;case ConnectionErrorReason.Cancelled:return DisconnectReason.CLIENT_INITIATED;case ConnectionErrorReason.NotAllowed:return DisconnectReason.USER_REJECTED;case ConnectionErrorReason.ServerUnreachable:return DisconnectReason.JOIN_FAILURE;default:return DisconnectReason.UNKNOWN_REASON}}function bigIntToNumber(U){return U!==void 0?Number(U):void 0}function numberToBigInt(U){return U!==void 0?BigInt(U):void 0}function isLocalTrack(U){return!!U&&!(U instanceof MediaStreamTrack)&&U.isLocal}function isAudioTrack(U){return!!U&&U.kind==Track.Kind.Audio}function isVideoTrack(U){return!!U&&U.kind==Track.Kind.Video}function isLocalVideoTrack(U){return isLocalTrack(U)&&isVideoTrack(U)}function isLocalAudioTrack(U){return isLocalTrack(U)&&isAudioTrack(U)}function isRemoteTrack(U){return!!U&&!U.isLocal}function isRemotePub(U){return!!U&&!U.isLocal}function isRemoteVideoTrack(U){return isRemoteTrack(U)&&isVideoTrack(U)}function isLocalParticipant(U){return U.isLocal}function splitUtf8(U,j){const B=[];let q=new TextEncoder().encode(U);for(;q.length>j;){let V=j;for(;V>0;){const H=q[V];if(H!==void 0&&(H&192)!==128)break;V--}B.push(q.slice(0,V)),q=q.slice(V)}return q.length>0&&B.push(q),B}function mergeDefaultOptions(U,j,B){var q,V,H,$;const{optionsWithoutProcessor:K,audioProcessor:X,videoProcessor:Q}=extractProcessorsFromOptions(U??{}),W=j==null?void 0:j.processor,Z=B==null?void 0:B.processor,te=K??{};return te.audio===!0&&(te.audio={}),te.video===!0&&(te.video={}),te.audio&&(mergeObjectWithoutOverwriting(te.audio,j),(q=(H=te.audio).deviceId)!==null&&q!==void 0||(H.deviceId={ideal:"default"}),(X||W)&&(te.audio.processor=X??W)),te.video&&(mergeObjectWithoutOverwriting(te.video,B),(V=($=te.video).deviceId)!==null&&V!==void 0||($.deviceId={ideal:"default"}),(Q||Z)&&(te.video.processor=Q??Z)),te}function mergeObjectWithoutOverwriting(U,j){return Object.keys(j).forEach(B=>{U[B]===void 0&&(U[B]=j[B])}),U}function constraintsForOptions(U){var j,B,q,V;const H={};if(U.video)if(typeof U.video=="object"){const $={},K=$,X=U.video;Object.keys(X).forEach(Q=>{switch(Q){case"resolution":mergeObjectWithoutOverwriting(K,X.resolution);break;default:K[Q]=X[Q]}}),H.video=$,(j=(q=H.video).deviceId)!==null&&j!==void 0||(q.deviceId={ideal:"default"})}else H.video=U.video?{deviceId:{ideal:"default"}}:!1;else H.video=!1;return U.audio?typeof U.audio=="object"?(H.audio=U.audio,(B=(V=H.audio).deviceId)!==null&&B!==void 0||(V.deviceId={ideal:"default"})):H.audio={deviceId:{ideal:"default"}}:H.audio=!1,H}function detectSilence(U){return __awaiter$1(this,arguments,void 0,function(j){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const q=getNewAudioContext();if(q){const V=q.createAnalyser();V.fftSize=2048;const H=V.frequencyBinCount,$=new Uint8Array(H);q.createMediaStreamSource(new MediaStream([j.mediaStreamTrack])).connect(V),yield sleep$1(B),V.getByteTimeDomainData($);const X=$.some(Q=>Q!==128&&Q!==0);return q.close(),!X}return!1})()})}function getNewAudioContext(){var U;const j=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(j){const B=new j({latencyHint:"interactive"});if(B.state==="suspended"&&typeof window<"u"&&(!((U=window.document)===null||U===void 0)&&U.body)){const q=()=>__awaiter$1(this,void 0,void 0,function*(){var V;try{B.state==="suspended"&&(yield B.resume())}catch(H){console.warn("Error trying to auto-resume audio context",H)}(V=window.document.body)===null||V===void 0||V.removeEventListener("click",q)});window.document.body.addEventListener("click",q)}return B}}function sourceToKind(U){return U===Track.Source.Microphone?"audioinput":U===Track.Source.Camera?"videoinput":void 0}function screenCaptureToDisplayMediaStreamOptions(U){var j,B;let q=(j=U.video)!==null&&j!==void 0?j:!0;return U.resolution&&U.resolution.width>0&&U.resolution.height>0&&(q=typeof q=="boolean"?{}:q,isSafari()?q=Object.assign(Object.assign({},q),{width:{max:U.resolution.width},height:{max:U.resolution.height},frameRate:U.resolution.frameRate}):q=Object.assign(Object.assign({},q),{width:{ideal:U.resolution.width},height:{ideal:U.resolution.height},frameRate:U.resolution.frameRate})),{audio:(B=U.audio)!==null&&B!==void 0?B:!1,video:q,controller:U.controller,selfBrowserSurface:U.selfBrowserSurface,surfaceSwitching:U.surfaceSwitching,systemAudio:U.systemAudio,preferCurrentTab:U.preferCurrentTab}}function mimeTypeToVideoCodecString(U){return U.split("/")[1].toLowerCase()}function getTrackPublicationInfo(U){const j=[];return U.forEach(B=>{B.track!==void 0&&j.push(new TrackPublishedResponse({cid:B.track.mediaStreamID,track:B.trackInfo}))}),j}function getLogContextFromTrack(U){return"mediaStreamTrack"in U?{trackID:U.sid,source:U.source,muted:U.isMuted,enabled:U.mediaStreamTrack.enabled,kind:U.kind,streamID:U.mediaStreamID,streamTrackID:U.mediaStreamTrack.id}:{trackID:U.trackSid,enabled:U.isEnabled,muted:U.isMuted,trackInfo:Object.assign({mimeType:U.mimeType,name:U.trackName,encrypted:U.isEncrypted,kind:U.kind,source:U.source},U.track?getLogContextFromTrack(U.track):{})}}function supportsSynchronizationSources(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function diffAttributes(U,j){var B;U===void 0&&(U={}),j===void 0&&(j={});const q=[...Object.keys(j),...Object.keys(U)],V={};for(const H of q)U[H]!==j[H]&&(V[H]=(B=j[H])!==null&&B!==void 0?B:"");return V}function extractProcessorsFromOptions(U){const j=Object.assign({},U);let B,q;return typeof j.audio=="object"&&j.audio.processor&&(B=j.audio.processor,j.audio=Object.assign(Object.assign({},j.audio),{processor:void 0})),typeof j.video=="object"&&j.video.processor&&(q=j.video.processor,j.video=Object.assign(Object.assign({},j.video),{processor:void 0})),{audioProcessor:B,videoProcessor:q,optionsWithoutProcessor:cloneDeep(j)}}function getTrackSourceFromProto(U){switch(U){case TrackSource.CAMERA:return Track.Source.Camera;case TrackSource.MICROPHONE:return Track.Source.Microphone;case TrackSource.SCREEN_SHARE:return Track.Source.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return Track.Source.ScreenShareAudio;default:return Track.Source.Unknown}}class E2EEManager extends eventsExports.EventEmitter{constructor(j){super(),this.onWorkerMessage=B=>{var q,V;const{kind:H,data:$}=B.data;switch(H){case"error":livekitLogger.error($.error.message),this.emit(EncryptionEvent.EncryptionError,$.error);break;case"initAck":$.enabled&&this.keyProvider.getKeys().forEach(K=>{this.postKey(K)});break;case"enable":if($.enabled&&this.keyProvider.getKeys().forEach(K=>{this.postKey(K)}),this.encryptionEnabled!==$.enabled&&$.participantIdentity===((q=this.room)===null||q===void 0?void 0:q.localParticipant.identity))this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,$.enabled,this.room.localParticipant),this.encryptionEnabled=$.enabled;else if($.participantIdentity){const K=(V=this.room)===null||V===void 0?void 0:V.getParticipantByIdentity($.participantIdentity);if(!K)throw TypeError("couldn't set encryption status, participant not found".concat($.participantIdentity));this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,$.enabled,K)}break;case"ratchetKey":this.keyProvider.emit(KeyProviderEvent.KeyRatcheted,$.material,$.keyIndex);break}},this.onWorkerError=B=>{livekitLogger.error("e2ee worker encountered an error:",{error:B.error}),this.emit(EncryptionEvent.EncryptionError,B.error)},this.keyProvider=j.keyProvider,this.worker=j.worker,this.encryptionEnabled=!1}setup(j){if(!isE2EESupported())throw new DeviceUnsupportedError("tried to setup end-to-end encryption on an unsupported browser");if(livekitLogger.info("setting up e2ee"),j!==this.room){this.room=j,this.setupEventListeners(j,this.keyProvider);const B={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:workerLogger.getLevel()}};this.worker&&(livekitLogger.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(B))}}setParticipantCryptorEnabled(j,B){livekitLogger.debug("set e2ee to ".concat(j," for participant ").concat(B)),this.postEnable(j,B)}setSifTrailer(j){!j||j.length===0?livekitLogger.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(j)}setupEngine(j){j.on(EngineEvent.RTPVideoMapUpdate,B=>{this.postRTPMap(B)})}setupEventListeners(j,B){j.on(RoomEvent.TrackPublished,(q,V)=>this.setParticipantCryptorEnabled(q.trackInfo.encryption!==Encryption_Type.NONE,V.identity)),j.on(RoomEvent.ConnectionStateChanged,q=>{q===ConnectionState.Connected&&j.remoteParticipants.forEach(V=>{V.trackPublications.forEach(H=>{this.setParticipantCryptorEnabled(H.trackInfo.encryption!==Encryption_Type.NONE,V.identity)})})}).on(RoomEvent.TrackUnsubscribed,(q,V,H)=>{var $;const K={kind:"removeTransform",data:{participantIdentity:H.identity,trackId:q.mediaStreamID}};($=this.worker)===null||$===void 0||$.postMessage(K)}).on(RoomEvent.TrackSubscribed,(q,V,H)=>{this.setupE2EEReceiver(q,H.identity,V.trackInfo)}).on(RoomEvent.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");B.getKeys().forEach(q=>{this.postKey(q)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),j.localParticipant.on(ParticipantEvent.LocalTrackPublished,q=>__awaiter$1(this,void 0,void 0,function*(){this.setupE2EESender(q.track,q.track.sender)})),B.on(KeyProviderEvent.SetKey,q=>this.postKey(q)).on(KeyProviderEvent.RatchetRequest,(q,V)=>this.postRatchetRequest(q,V,B.getOptions().allowKeyExtraction))}postRatchetRequest(j,B,q){if(!this.worker)throw Error("could not ratchet key, worker is missing");const V={kind:"ratchetRequest",data:{participantIdentity:j,keyIndex:B,extractable:q}};this.worker.postMessage(V)}postKey(j){let{key:B,participantIdentity:q,keyIndex:V}=j;var H;if(!this.worker)throw Error("could not set key, worker is missing");const $={kind:"setKey",data:{participantIdentity:q,isPublisher:q===((H=this.room)===null||H===void 0?void 0:H.localParticipant.identity),key:B,keyIndex:V}};this.worker.postMessage($)}postEnable(j,B){if(this.worker){const q={kind:"enable",data:{enabled:j,participantIdentity:B}};this.worker.postMessage(q)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(j){var B;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((B=this.room)===null||B===void 0)&&B.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const q={kind:"setRTPMap",data:{map:j,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(q)}postSifTrailer(j){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const B={kind:"setSifTrailer",data:{trailer:j}};this.worker.postMessage(B)}setupE2EEReceiver(j,B,q){if(j.receiver){if(!(q!=null&&q.mimeType)||q.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(j.receiver,j.mediaStreamID,B,j.kind==="video"?mimeTypeToVideoCodecString(q.mimeType):void 0)}}setupE2EESender(j,B){if(!isLocalTrack(j)||!B){B||livekitLogger.warn("early return because sender is not ready");return}this.handleSender(B,j.mediaStreamID,void 0)}handleReceiver(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){if(this.worker){if(isScriptTransformSupported()){const H={kind:"decode",participantIdentity:q,trackId:B,codec:V};j.transform=new RTCRtpScriptTransform(this.worker,H)}else{if(E2EE_FLAG in j&&V){const X={kind:"updateCodec",data:{trackId:B,codec:V,participantIdentity:q}};this.worker.postMessage(X);return}let H=j.writableStream,$=j.readableStream;if(!H||!$){const X=j.createEncodedStreams();j.writableStream=X.writable,H=X.writable,j.readableStream=X.readable,$=X.readable}const K={kind:"decode",data:{readableStream:$,writableStream:H,trackId:B,codec:V,participantIdentity:q}};this.worker.postMessage(K,[$,H])}j[E2EE_FLAG]=!0}})}handleSender(j,B,q){var V;if(!(E2EE_FLAG in j||!this.worker)){if(!(!((V=this.room)===null||V===void 0)&&V.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(isScriptTransformSupported()){livekitLogger.info("initialize script transform");const H={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:B,codec:q};j.transform=new RTCRtpScriptTransform(this.worker,H)}else{livekitLogger.info("initialize encoded streams");const H=j.createEncodedStreams(),$={kind:"encode",data:{readableStream:H.readable,writableStream:H.writable,codec:q,trackId:B,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage($,[H.readable,H.writable])}j[E2EE_FLAG]=!0}}}const defaultId="default";class DeviceManager{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new DeviceManager),this.instance}get previousDevices(){return this._previousDevices}getDevices(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var H;if(((H=DeviceManager.userMediaPromiseMap)===null||H===void 0?void 0:H.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{B?yield DeviceManager.userMediaPromiseMap.get(B):yield Promise.all(DeviceManager.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let $=yield navigator.mediaDevices.enumerateDevices();if(V&&!(isSafari()&&q.hasDeviceInUse(B))&&($.filter(X=>X.kind===B).length===0||$.some(X=>{const Q=X.label==="",W=B?X.kind===B:!0;return Q&&W}))){const X={video:B!=="audioinput"&&B!=="audiooutput",audio:B!=="videoinput"&&{deviceId:{ideal:"default"}}},Q=yield navigator.mediaDevices.getUserMedia(X);$=yield navigator.mediaDevices.enumerateDevices(),Q.getTracks().forEach(W=>{W.stop()})}return q._previousDevices=$,B&&($=$.filter(K=>K.kind===B)),$})()})}normalizeDeviceId(j,B,q){return __awaiter$1(this,void 0,void 0,function*(){if(B!==defaultId)return B;const V=yield this.getDevices(j),H=V.find(K=>K.deviceId===defaultId);if(!H){livekitLogger.warn("could not reliably determine default device");return}const $=V.find(K=>K.deviceId!==defaultId&&K.groupId===(q??H.groupId));if(!$){livekitLogger.warn("could not reliably determine default device");return}return $==null?void 0:$.deviceId})}hasDeviceInUse(j){return j?DeviceManager.userMediaPromiseMap.has(j):DeviceManager.userMediaPromiseMap.size>0}}DeviceManager.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];DeviceManager.userMediaPromiseMap=new Map;var QueueTaskStatus;(function(U){U[U.WAITING=0]="WAITING",U[U.RUNNING=1]="RUNNING",U[U.COMPLETED=2]="COMPLETED"})(QueueTaskStatus||(QueueTaskStatus={}));class AsyncQueue{constructor(){this.pendingTasks=new Map,this.taskMutex=new _$1,this.nextTaskIndex=0}run(j){return __awaiter$1(this,void 0,void 0,function*(){const B={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:QueueTaskStatus.WAITING};this.pendingTasks.set(B.id,B);const q=yield this.taskMutex.lock();try{return B.executedAt=Date.now(),B.status=QueueTaskStatus.RUNNING,yield j()}finally{B.status=QueueTaskStatus.COMPLETED,this.pendingTasks.delete(B.id),q()}})}flush(){return __awaiter$1(this,void 0,void 0,function*(){return this.run(()=>__awaiter$1(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function createRtcUrl(U,j){const B=new URL(toWebsocketUrl(U));return j.forEach((q,V)=>{B.searchParams.set(V,q)}),appendUrlPath(B,"rtc")}function createValidateUrl(U){const j=new URL(toHttpUrl(U));return appendUrlPath(j,"validate")}function ensureTrailingSlash(U){return U.endsWith("/")?U:"".concat(U,"/")}function appendUrlPath(U,j){return U.pathname="".concat(ensureTrailingSlash(U.pathname)).concat(j),U.toString()}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(U){const j=passThroughQueueSignals.indexOf(U.case)>=0;return livekitLogger.trace("request allowed to bypass queue:",{canPass:j,req:U}),j}var SignalConnectionState;(function(U){U[U.CONNECTING=0]="CONNECTING",U[U.CONNECTED=1]="CONNECTED",U[U.RECONNECTING=2]="RECONNECTING",U[U.DISCONNECTING=3]="DISCONNECTING",U[U.DISCONNECTED=4]="DISCONNECTED"})(SignalConnectionState||(SignalConnectionState={}));class SignalClient{get currentState(){return this.state}get isDisconnected(){return this.state===SignalConnectionState.DISCONNECTING||this.state===SignalConnectionState.DISCONNECTED}get isEstablishingConnection(){return this.state===SignalConnectionState.CONNECTING||this.state===SignalConnectionState.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var q;this.rtt=0,this.state=SignalConnectionState.DISCONNECTED,this.log=livekitLogger,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=getLogger((q=B.loggerName)!==null&&q!==void 0?q:LoggerNames.Signal),this.loggerContextCb=B.loggerContextCb,this.useJSON=j,this.requestQueue=new AsyncQueue,this.queuedRequests=[],this.closingLock=new _$1,this.connectionLock=new _$1,this.state=SignalConnectionState.DISCONNECTED}get logContext(){var j,B;return(B=(j=this.loggerContextCb)===null||j===void 0?void 0:j.call(this))!==null&&B!==void 0?B:{}}join(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){return this.state=SignalConnectionState.CONNECTING,this.options=q,yield this.connect(j,B,q,V)})}reconnect(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=SignalConnectionState.RECONNECTING,this.clearPingInterval(),yield this.connect(j,B,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:q,reconnectReason:V}))})}connect(j,B,q,V){this.connectOptions=q;const H=getClientInfo(),$=createConnectionParams(B,H,q),K=createRtcUrl(j,$),X=createValidateUrl(K);return new Promise((Q,W)=>__awaiter$1(this,void 0,void 0,function*(){const Z=yield this.connectionLock.lock();try{const te=()=>__awaiter$1(this,void 0,void 0,function*(){this.close(),clearTimeout(ie),W(new ConnectionError("room connection has been cancelled (signal)",ConnectionErrorReason.Cancelled))}),ie=setTimeout(()=>{this.close(),W(new ConnectionError("room connection has timed out (signal)",ConnectionErrorReason.ServerUnreachable))},q.websocketTimeout);V!=null&&V.aborted&&te(),V==null||V.addEventListener("abort",te);const ae=new URL(K);ae.searchParams.has("access_token")&&ae.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(ae),Object.assign({reconnect:q.reconnect,reconnectReason:q.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(K),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(ie)},this.ws.onerror=oe=>__awaiter$1(this,void 0,void 0,function*(){if(this.state!==SignalConnectionState.CONNECTED){this.state=SignalConnectionState.DISCONNECTED,clearTimeout(ie);try{const de=yield fetch(X);if(de.status.toFixed(0).startsWith("4")){const le=yield de.text();W(new ConnectionError(le,ConnectionErrorReason.NotAllowed,de.status))}else W(new ConnectionError("Encountered unknown websocket error during connection: ".concat(oe.toString()),ConnectionErrorReason.InternalError,de.status))}catch(de){W(new ConnectionError(de instanceof Error?de.message:"server was not reachable",ConnectionErrorReason.ServerUnreachable))}return}this.handleWSError(oe)}),this.ws.onmessage=oe=>__awaiter$1(this,void 0,void 0,function*(){var de,le,ue;let he;if(typeof oe.data=="string"){const me=JSON.parse(oe.data);he=SignalResponse.fromJson(me,{ignoreUnknownFields:!0})}else if(oe.data instanceof ArrayBuffer)he=SignalResponse.fromBinary(new Uint8Array(oe.data));else{this.log.error("could not decode websocket message: ".concat(typeof oe.data),this.logContext);return}if(this.state!==SignalConnectionState.CONNECTED){let me=!1;if(((de=he.message)===null||de===void 0?void 0:de.case)==="join"?(this.state=SignalConnectionState.CONNECTED,V==null||V.removeEventListener("abort",te),this.pingTimeoutDuration=he.message.value.pingTimeout,this.pingIntervalDuration=he.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),Q(he.message.value)):this.state===SignalConnectionState.RECONNECTING&&he.message.case!=="leave"?(this.state=SignalConnectionState.CONNECTED,V==null||V.removeEventListener("abort",te),this.startPingInterval(),((le=he.message)===null||le===void 0?void 0:le.case)==="reconnect"?Q(he.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),Q(void 0),me=!0)):this.isEstablishingConnection&&he.message.case==="leave"?W(new ConnectionError("Received leave request while trying to (re)connect",ConnectionErrorReason.LeaveRequest,void 0,he.message.value.reason)):q.reconnect||W(new ConnectionError("did not receive join response, got ".concat((ue=he.message)===null||ue===void 0?void 0:ue.case," instead"),ConnectionErrorReason.InternalError)),!me)return}this.signalLatency&&(yield sleep$1(this.signalLatency)),this.handleSignalResponse(he)}),this.ws.onclose=oe=>{this.isEstablishingConnection&&W(new ConnectionError("Websocket got closed during a (re)connection attempt",ConnectionErrorReason.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:oe.reason,code:oe.code,wasClean:oe.wasClean,state:this.state})),this.handleOnClose(oe.reason)}}finally{Z()}}))}close(){return __awaiter$1(this,arguments,void 0,function(){var j=this;let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const q=yield j.closingLock.lock();try{if(j.clearPingInterval(),B&&(j.state=SignalConnectionState.DISCONNECTING),j.ws){j.ws.onmessage=null,j.ws.onopen=null,j.ws.onclose=null;const V=new Promise(H=>{j.ws?j.ws.onclose=()=>{H()}:H()});j.ws.readyState<j.ws.CLOSING&&(j.ws.close(),yield Promise.race([V,sleep$1(250)])),j.ws=void 0}}finally{B&&(j.state=SignalConnectionState.DISCONNECTED),q()}})()})}sendOffer(j){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:j.sdp})),this.sendRequest({case:"offer",value:toProtoSessionDescription(j)})}sendAnswer(j){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:j.sdp})),this.sendRequest({case:"answer",value:toProtoSessionDescription(j)})}sendIceCandidate(j,B){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:j})),this.sendRequest({case:"trickle",value:new TrickleRequest({candidateInit:JSON.stringify(j),target:B})})}sendMuteTrack(j,B){return this.sendRequest({case:"mute",value:new MuteTrackRequest({sid:j,muted:B})})}sendAddTrack(j){return this.sendRequest({case:"addTrack",value:j})}sendUpdateLocalMetadata(j,B){return __awaiter$1(this,arguments,void 0,function(q,V){var H=this;let $=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const K=H.getNextRequestId();return yield H.sendRequest({case:"updateMetadata",value:new UpdateParticipantMetadata({requestId:K,metadata:q,name:V,attributes:$})}),K})()})}sendUpdateTrackSettings(j){this.sendRequest({case:"trackSetting",value:j})}sendUpdateSubscription(j){return this.sendRequest({case:"subscription",value:j})}sendSyncState(j){return this.sendRequest({case:"syncState",value:j})}sendUpdateVideoLayers(j,B){return this.sendRequest({case:"updateLayers",value:new UpdateVideoLayers({trackSid:j,layers:B})})}sendUpdateSubscriptionPermissions(j,B){return this.sendRequest({case:"subscriptionPermission",value:new SubscriptionPermission({allParticipants:j,trackPermissions:B})})}sendSimulateScenario(j){return this.sendRequest({case:"simulate",value:j})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:protoInt64.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ping({timestamp:protoInt64.parse(Date.now()),rtt:protoInt64.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(j,B){return this.sendRequest({case:"updateAudioTrack",value:new UpdateLocalAudioTrack({trackSid:j,features:B})})}sendLeave(){return this.sendRequest({case:"leave",value:new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.DISCONNECT})})}sendRequest(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!V&&!canPassThroughQueue(B)&&q.state===SignalConnectionState.RECONNECTING){q.queuedRequests.push(()=>__awaiter$1(q,void 0,void 0,function*(){yield this.sendRequest(B,!0)}));return}if(V||(yield q.requestQueue.flush()),q.signalLatency&&(yield sleep$1(q.signalLatency)),!q.ws||q.ws.readyState!==q.ws.OPEN){q.log.error("cannot send signal request before connected, type: ".concat(B==null?void 0:B.case),q.logContext);return}const $=new SignalRequest({message:B});try{q.useJSON?q.ws.send($.toJsonString()):q.ws.send($.toBinary())}catch(K){q.log.error("error sending signal message",Object.assign(Object.assign({},q.logContext),{error:K}))}})()})}handleSignalResponse(j){var B,q;const V=j.message;if(V==null){this.log.debug("received unsupported message",this.logContext);return}let H=!1;if(V.case==="answer"){const $=fromProtoSessionDescription(V.value);this.onAnswer&&this.onAnswer($)}else if(V.case==="offer"){const $=fromProtoSessionDescription(V.value);this.onOffer&&this.onOffer($)}else if(V.case==="trickle"){const $=JSON.parse(V.value.candidateInit);this.onTrickle&&this.onTrickle($,V.value.target)}else V.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((B=V.value.participants)!==null&&B!==void 0?B:[]):V.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(V.value):V.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((q=V.value.speakers)!==null&&q!==void 0?q:[]):V.case==="leave"?this.onLeave&&this.onLeave(V.value):V.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(V.value.sid,V.value.muted):V.case==="roomUpdate"?this.onRoomUpdate&&V.value.room&&this.onRoomUpdate(V.value.room):V.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(V.value):V.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(V.value):V.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(V.value):V.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(V.value):V.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(V.value):V.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(V.value):V.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(V.value):V.case==="pong"||(V.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(V.value.lastPingTimestamp.toString()),this.resetPingTimeout(),H=!0):V.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(V.value):V.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(V.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:V.case})));H||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const j=this.queuedRequests.shift();j&&this.requestQueue.run(j)}}handleOnClose(j){return __awaiter$1(this,void 0,void 0,function*(){if(this.state===SignalConnectionState.DISCONNECTED)return;const B=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(j),Object.assign(Object.assign({},this.logContext),{reason:j})),B&&B(j)})}handleWSError(j){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:j}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=CriticalTimers.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(U){const j={type:"offer",sdp:U.sdp};switch(U.type){case"answer":case"offer":case"pranswer":case"rollback":j.type=U.type;break}return j}function toProtoSessionDescription(U){return new SessionDescription({sdp:U.sdp,type:U.type})}function createConnectionParams(U,j,B){var q;const V=new URLSearchParams;return V.set("access_token",U),B.reconnect&&(V.set("reconnect","1"),B.sid&&V.set("sid",B.sid)),V.set("auto_subscribe",B.autoSubscribe?"1":"0"),V.set("sdk",isReactNative()?"reactnative":"js"),V.set("version",j.version),V.set("protocol",j.protocol.toString()),j.deviceModel&&V.set("device_model",j.deviceModel),j.os&&V.set("os",j.os),j.osVersion&&V.set("os_version",j.osVersion),j.browser&&V.set("browser",j.browser),j.browserVersion&&V.set("browser_version",j.browserVersion),B.adaptiveStream&&V.set("adaptive_stream","1"),B.reconnectReason&&V.set("reconnect_reason",B.reconnectReason.toString()),!((q=navigator.connection)===null||q===void 0)&&q.type&&V.set("network",navigator.connection.type),V}var lib={},parser={},grammar={exports:{}},hasRequiredGrammar;function requireGrammar(){if(hasRequiredGrammar)return grammar.exports;hasRequiredGrammar=1;var U=grammar.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(j){return j.encoding?"rtpmap:%d %s/%s/%s":j.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(j){return j.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(j){return j.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(j){return"extmap:%d"+(j.direction?"/%s":"%v")+(j["encrypt-uri"]?" %s":"%v")+" %s"+(j.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(j){return j.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(j){var B="candidate:%s %d %s %d %s %d typ %s";return B+=j.raddr!=null?" raddr %s rport %d":"%v%v",B+=j.tcptype!=null?" tcptype %s":"%v",j.generation!=null&&(B+=" generation %d"),B+=j["network-id"]!=null?" network-id %d":"%v",B+=j["network-cost"]!=null?" network-cost %d":"%v",B}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(j){var B="ssrc:%d";return j.attribute!=null&&(B+=" %s",j.value!=null&&(B+=":%s")),B}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(j){return j.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(j){return j.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(j){return"imageattr:%s %s %s"+(j.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(j){return"simulcast:%s %s"+(j.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(j){return"ts-refclk:%s"+(j.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(j){var B="mediaclk:";return B+=j.id!=null?"id=%s %s":"%v%s",B+=j.mediaClockValue!=null?"=%s":"",B+=j.rateNumerator!=null?" rate=%s":"",B+=j.rateDenominator!=null?"/%s":"",B}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(U).forEach(function(j){var B=U[j];B.forEach(function(q){q.reg||(q.reg=/(.*)/),q.format||(q.format="%s")})}),grammar.exports}var hasRequiredParser;function requireParser(){return hasRequiredParser||(hasRequiredParser=1,(function(U){var j=function(K){return String(Number(K))===K?Number(K):K},B=function(K,X,Q,W){if(W&&!Q)X[W]=j(K[1]);else for(var Z=0;Z<Q.length;Z+=1)K[Z+1]!=null&&(X[Q[Z]]=j(K[Z+1]))},q=function(K,X,Q){var W=K.name&&K.names;K.push&&!X[K.push]?X[K.push]=[]:W&&!X[K.name]&&(X[K.name]={});var Z=K.push?{}:W?X[K.name]:X;B(Q.match(K.reg),Z,K.names,K.name),K.push&&X[K.push].push(Z)},V=requireGrammar(),H=RegExp.prototype.test.bind(/^([a-z])=(.*)/);U.parse=function(K){var X={},Q=[],W=X;return K.split(/(\r\n|\r|\n)/).filter(H).forEach(function(Z){var te=Z[0],ie=Z.slice(2);te==="m"&&(Q.push({rtp:[],fmtp:[]}),W=Q[Q.length-1]);for(var ae=0;ae<(V[te]||[]).length;ae+=1){var oe=V[te][ae];if(oe.reg.test(ie))return q(oe,W,ie)}}),X.media=Q,X};var $=function(K,X){var Q=X.split(/=(.+)/,2);return Q.length===2?K[Q[0]]=j(Q[1]):Q.length===1&&X.length>1&&(K[Q[0]]=void 0),K};U.parseParams=function(K){return K.split(/;\s?/).reduce($,{})},U.parseFmtpConfig=U.parseParams,U.parsePayloads=function(K){return K.toString().split(" ").map(Number)},U.parseRemoteCandidates=function(K){for(var X=[],Q=K.split(" ").map(j),W=0;W<Q.length;W+=3)X.push({component:Q[W],ip:Q[W+1],port:Q[W+2]});return X},U.parseImageAttributes=function(K){return K.split(" ").map(function(X){return X.substring(1,X.length-1).split(",").reduce($,{})})},U.parseSimulcastStreamList=function(K){return K.split(";").map(function(X){return X.split(",").map(function(Q){var W,Z=!1;return Q[0]!=="~"?W=j(Q):(W=j(Q.substring(1,Q.length)),Z=!0),{scid:W,paused:Z}})})}})(parser)),parser}var writer$1,hasRequiredWriter$1;function requireWriter$1(){if(hasRequiredWriter$1)return writer$1;hasRequiredWriter$1=1;var U=requireGrammar(),j=/%[sdv%]/g,B=function($){var K=1,X=arguments,Q=X.length;return $.replace(j,function(W){if(K>=Q)return W;var Z=X[K];switch(K+=1,W){case"%%":return"%";case"%s":return String(Z);case"%d":return Number(Z);case"%v":return""}})},q=function($,K,X){var Q=K.format instanceof Function?K.format(K.push?X:X[K.name]):K.format,W=[$+"="+Q];if(K.names)for(var Z=0;Z<K.names.length;Z+=1){var te=K.names[Z];K.name?W.push(X[K.name][te]):W.push(X[K.names[Z]])}else W.push(X[K.name]);return B.apply(null,W)},V=["v","o","s","i","u","e","p","c","b","t","r","z","a"],H=["i","c","b","a"];return writer$1=function($,K){K=K||{},$.version==null&&($.version=0),$.name==null&&($.name=" "),$.media.forEach(function(Z){Z.payloads==null&&(Z.payloads="")});var X=K.outerOrder||V,Q=K.innerOrder||H,W=[];return X.forEach(function(Z){U[Z].forEach(function(te){te.name in $&&$[te.name]!=null?W.push(q(Z,te,$)):te.push in $&&$[te.push]!=null&&$[te.push].forEach(function(ie){W.push(q(Z,te,ie))})})}),$.media.forEach(function(Z){W.push(q("m",U.m[0],Z)),Q.forEach(function(te){U[te].forEach(function(ie){ie.name in Z&&Z[ie.name]!=null?W.push(q(te,ie,Z)):ie.push in Z&&Z[ie.push]!=null&&Z[ie.push].forEach(function(ae){W.push(q(te,ie,ae))})})})}),W.join(`\r
`)+`\r
`},writer$1}var hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;var U=requireParser(),j=requireWriter$1(),B=requireGrammar();return lib.grammar=B,lib.write=j,lib.parse=U.parse,lib.parseParams=U.parseParams,lib.parseFmtpConfig=U.parseFmtpConfig,lib.parsePayloads=U.parsePayloads,lib.parseRemoteCandidates=U.parseRemoteCandidates,lib.parseImageAttributes=U.parseImageAttributes,lib.parseSimulcastStreamList=U.parseSimulcastStreamList,lib}var libExports=requireLib();function r$1(U,j,B){var q,V,H;j===void 0&&(j=50),B===void 0&&(B={});var $=(q=B.isImmediate)!=null&&q,K=(V=B.callback)!=null&&V,X=B.maxWait,Q=Date.now(),W=[];function Z(){if(X!==void 0){var ie=Date.now()-Q;if(ie+j>=X)return X-ie}return j}var te=function(){var ie=[].slice.call(arguments),ae=this;return new Promise(function(oe,de){var le=$&&H===void 0;if(H!==void 0&&clearTimeout(H),H=setTimeout(function(){if(H=void 0,Q=Date.now(),!$){var he=U.apply(ae,ie);K&&K(he),W.forEach(function(me){return(0,me.resolve)(he)}),W=[]}},Z()),le){var ue=U.apply(ae,ie);return K&&K(ue),oe(ue)}W.push({resolve:oe,reject:de})})};return te.cancel=function(ie){H!==void 0&&clearTimeout(H),W.forEach(function(ae){return(0,ae.reject)(ie)}),W=[]},te}const startBitrateForSVC=.7,debounceInterval=20,PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class PCTransport extends eventsExports.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(j){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var q;super(),this.log=livekitLogger,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=r$1(V=>__awaiter$1(this,void 0,void 0,function*(){this.emit(PCEvents.NegotiationStarted);try{yield this.createAndSendOffer()}catch(H){if(V)V(H);else throw H}}),debounceInterval),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=getLogger((q=B.loggerName)!==null&&q!==void 0?q:LoggerNames.PCTransport),this.loggerOptions=B,this.config=j,this._pc=this.createPC()}createPC(){const j=new RTCPeerConnection(this.config);return j.onicecandidate=B=>{var q;B.candidate&&((q=this.onIceCandidate)===null||q===void 0||q.call(this,B.candidate))},j.onicecandidateerror=B=>{var q;(q=this.onIceCandidateError)===null||q===void 0||q.call(this,B)},j.oniceconnectionstatechange=()=>{var B;(B=this.onIceConnectionStateChange)===null||B===void 0||B.call(this,j.iceConnectionState)},j.onsignalingstatechange=()=>{var B;(B=this.onSignalingStatechange)===null||B===void 0||B.call(this,j.signalingState)},j.onconnectionstatechange=()=>{var B;(B=this.onConnectionStateChange)===null||B===void 0||B.call(this,j.connectionState)},j.ondatachannel=B=>{var q;(q=this.onDataChannel)===null||q===void 0||q.call(this,B)},j.ontrack=B=>{var q;(q=this.onTrack)===null||q===void 0||q.call(this,B)},j}get logContext(){var j,B;return Object.assign({},(B=(j=this.loggerOptions).loggerContextCb)===null||B===void 0?void 0:B.call(j))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(j){return __awaiter$1(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(j);this.pendingCandidates.push(j)})}setRemoteDescription(j){return __awaiter$1(this,void 0,void 0,function*(){var B;let q;if(j.type==="offer"){let{stereoMids:V,nackMids:H}=extractStereoAndNackAudioFromOffer(j);this.remoteStereoMids=V,this.remoteNackMids=H}else if(j.type==="answer"){const V=libExports.parse((B=j.sdp)!==null&&B!==void 0?B:"");V.media.forEach(H=>{H.type==="audio"&&this.trackBitrates.some($=>{if(!$.transceiver||H.mid!=$.transceiver.mid)return!1;let K=0;if(H.rtp.some(Q=>Q.codec.toUpperCase()===$.codec.toUpperCase()?(K=Q.payload,!0):!1),K===0)return!0;let X=!1;for(const Q of H.fmtp)if(Q.payload===K){Q.config=Q.config.split(";").filter(W=>!W.includes("maxaveragebitrate")).join(";"),$.maxbr>0&&(Q.config+=";maxaveragebitrate=".concat($.maxbr*1e3)),X=!0;break}return X||$.maxbr>0&&H.fmtp.push({payload:K,config:"maxaveragebitrate=".concat($.maxbr*1e3)}),!0})}),q=libExports.write(V)}yield this.setMungedSDP(j,q,!0),this.pendingCandidates.forEach(V=>{this.pc.addIceCandidate(V)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):j.type==="answer"&&(this.emit(PCEvents.NegotiationComplete),j.sdp&&libExports.parse(j.sdp).media.forEach(H=>{H.type==="video"&&this.emit(PCEvents.RTPVideoPayloadTypes,H.rtp)}))})}createAndSendOffer(j){return __awaiter$1(this,void 0,void 0,function*(){var B;if(this.onOffer===void 0)return;if(j!=null&&j.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const H=this._pc.remoteDescription;if(j!=null&&j.iceRestart&&H)yield this._pc.setRemoteDescription(H);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const q=yield this.pc.createOffer(j);this.log.debug("original offer",Object.assign({sdp:q.sdp},this.logContext));const V=libExports.parse((B=q.sdp)!==null&&B!==void 0?B:"");V.media.forEach(H=>{ensureIPAddrMatchVersion(H),H.type==="audio"?ensureAudioNackAndStereo(H,[],[]):H.type==="video"&&this.trackBitrates.some($=>{if(!H.msid||!$.cid||!H.msid.includes($.cid))return!1;let K=0;if(H.rtp.some(Q=>Q.codec.toUpperCase()===$.codec.toUpperCase()?(K=Q.payload,!0):!1),K===0||(isSVCCodec($.codec)&&this.ensureVideoDDExtensionForSVC(H,V),$.codec!=="av1"))return!0;const X=Math.round($.maxbr*startBitrateForSVC);for(const Q of H.fmtp)if(Q.payload===K){Q.config.includes("x-google-start-bitrate")||(Q.config+=";x-google-start-bitrate=".concat(X));break}return!0})}),yield this.setMungedSDP(q,libExports.write(V)),this.onOffer(q)})}createAndSetAnswer(){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.pc.createAnswer(),q=libExports.parse((j=B.sdp)!==null&&j!==void 0?j:"");return q.media.forEach(V=>{ensureIPAddrMatchVersion(V),V.type==="audio"&&ensureAudioNackAndStereo(V,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(B,libExports.write(q)),B})}createDataChannel(j,B){return this.pc.createDataChannel(j,B)}addTransceiver(j,B){return this.pc.addTransceiver(j,B)}addTrack(j){if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot add track");return this._pc.addTrack(j)}setTrackCodecBitrate(j){this.trackBitrates.push(j)}setConfiguration(j){var B;if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot configure");return(B=this._pc)===null||B===void 0?void 0:B.setConfiguration(j)}canRemoveTrack(){var j;return!!(!((j=this._pc)===null||j===void 0)&&j.removeTrack)}removeTrack(j){var B;return(B=this._pc)===null||B===void 0?void 0:B.removeTrack(j)}getConnectionState(){var j,B;return(B=(j=this._pc)===null||j===void 0?void 0:j.connectionState)!==null&&B!==void 0?B:"closed"}getICEConnectionState(){var j,B;return(B=(j=this._pc)===null||j===void 0?void 0:j.iceConnectionState)!==null&&B!==void 0?B:"closed"}getSignallingState(){var j,B;return(B=(j=this._pc)===null||j===void 0?void 0:j.signalingState)!==null&&B!==void 0?B:"closed"}getTransceivers(){var j,B;return(B=(j=this._pc)===null||j===void 0?void 0:j.getTransceivers())!==null&&B!==void 0?B:[]}getSenders(){var j,B;return(B=(j=this._pc)===null||j===void 0?void 0:j.getSenders())!==null&&B!==void 0?B:[]}getLocalDescription(){var j;return(j=this._pc)===null||j===void 0?void 0:j.localDescription}getRemoteDescription(){var j;return(j=this.pc)===null||j===void 0?void 0:j.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return __awaiter$1(this,void 0,void 0,function*(){var j;if(!this._pc)return;let B="";const q=new Map,V=new Map;if((yield this._pc.getStats()).forEach(K=>{switch(K.type){case"transport":B=K.selectedCandidatePairId;break;case"candidate-pair":B===""&&K.selected&&(B=K.id),q.set(K.id,K);break;case"remote-candidate":V.set(K.id,"".concat(K.address,":").concat(K.port));break}}),B==="")return;const $=(j=q.get(B))===null||j===void 0?void 0:j.remoteCandidateId;if($!==void 0)return V.get($)})}setMungedSDP(j,B,q){return __awaiter$1(this,void 0,void 0,function*(){if(B){const V=j.sdp;j.sdp=B;try{this.log.debug("setting munged ".concat(q?"remote":"local"," description"),this.logContext),q?yield this.pc.setRemoteDescription(j):yield this.pc.setLocalDescription(j);return}catch(H){this.log.warn("not able to set ".concat(j.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:H,sdp:B})),j.sdp=V}}try{q?yield this.pc.setRemoteDescription(j):yield this.pc.setLocalDescription(j)}catch(V){let H="unknown error";V instanceof Error?H=V.message:typeof V=="string"&&(H=V);const $={error:H,sdp:j.sdp};throw!q&&this.pc.remoteDescription&&($.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(j.type),Object.assign(Object.assign({},this.logContext),{fields:$})),new NegotiationError(H)}})}ensureVideoDDExtensionForSVC(j,B){var q,V;if(!((q=j.ext)===null||q===void 0?void 0:q.some($=>$.uri===ddExtensionURI))){if(this.ddExtID===0){let $=0;B.media.forEach(K=>{var X;K.type==="video"&&((X=K.ext)===null||X===void 0||X.forEach(Q=>{Q.value>$&&($=Q.value)}))}),this.ddExtID=$+1}(V=j.ext)===null||V===void 0||V.push({value:this.ddExtID,uri:ddExtensionURI})}}}function ensureAudioNackAndStereo(U,j,B){let q=0;U.rtp.some(V=>V.codec==="opus"?(q=V.payload,!0):!1),q>0&&(U.rtcpFb||(U.rtcpFb=[]),B.includes(U.mid)&&!U.rtcpFb.some(V=>V.payload===q&&V.type==="nack")&&U.rtcpFb.push({payload:q,type:"nack"}),j.includes(U.mid)&&U.fmtp.some(V=>V.payload===q?(V.config.includes("stereo=1")||(V.config+=";stereo=1"),!0):!1))}function extractStereoAndNackAudioFromOffer(U){var j;const B=[],q=[],V=libExports.parse((j=U.sdp)!==null&&j!==void 0?j:"");let H=0;return V.media.forEach($=>{var K;$.type==="audio"&&($.rtp.some(X=>X.codec==="opus"?(H=X.payload,!0):!1),!((K=$.rtcpFb)===null||K===void 0)&&K.some(X=>X.payload===H&&X.type==="nack")&&q.push($.mid),$.fmtp.some(X=>X.payload===H?(X.config.includes("sprop-stereo=1")&&B.push($.mid),!0):!1))}),{stereoMids:B,nackMids:q}}function ensureIPAddrMatchVersion(U){if(U.connection){const j=U.connection.ip.indexOf(":")>=0;(U.connection.version===4&&j||U.connection.version===6&&!j)&&(U.connection.ip="0.0.0.0",U.connection.version=4)}}const defaultVideoCodec="vp8",publishDefaults={audioPreset:AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:defaultVideoCodec,backupCodec:!0},audioDefaults={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},videoDefaults={deviceId:{ideal:"default"},resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,disconnectOnPageLeave:!0,webAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var PCTransportState;(function(U){U[U.NEW=0]="NEW",U[U.CONNECTING=1]="CONNECTING",U[U.CONNECTED=2]="CONNECTED",U[U.FAILED=3]="FAILED",U[U.CLOSING=4]="CLOSING",U[U.CLOSED=5]="CLOSED"})(PCTransportState||(PCTransportState={}));class PCTransportManager{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(j,B,q){var V;this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.log=livekitLogger,this.updateState=()=>{var H;const $=this.state,K=this.requiredTransports.map(X=>X.getConnectionState());K.every(X=>X==="connected")?this.state=PCTransportState.CONNECTED:K.some(X=>X==="failed")?this.state=PCTransportState.FAILED:K.some(X=>X==="connecting")?this.state=PCTransportState.CONNECTING:K.every(X=>X==="closed")?this.state=PCTransportState.CLOSED:K.some(X=>X==="closed")?this.state=PCTransportState.CLOSING:K.every(X=>X==="new")&&(this.state=PCTransportState.NEW),$!==this.state&&(this.log.debug("pc state change: from ".concat(PCTransportState[$]," to ").concat(PCTransportState[this.state]),this.logContext),(H=this.onStateChange)===null||H===void 0||H.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=getLogger((V=q.loggerName)!==null&&V!==void 0?V:LoggerNames.PCManager),this.loggerOptions=q,this.isPublisherConnectionRequired=!B,this.isSubscriberConnectionRequired=B,this.publisher=new PCTransport(j,q),this.subscriber=new PCTransport(j,q),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=H=>{var $;($=this.onIceCandidate)===null||$===void 0||$.call(this,H,SignalTarget.PUBLISHER)},this.subscriber.onIceCandidate=H=>{var $;($=this.onIceCandidate)===null||$===void 0||$.call(this,H,SignalTarget.SUBSCRIBER)},this.subscriber.onDataChannel=H=>{var $;($=this.onDataChannel)===null||$===void 0||$.call(this,H)},this.subscriber.onTrack=H=>{var $;($=this.onTrack)===null||$===void 0||$.call(this,H)},this.publisher.onOffer=H=>{var $;($=this.onPublisherOffer)===null||$===void 0||$.call(this,H)},this.state=PCTransportState.NEW,this.connectionLock=new _$1,this.remoteOfferLock=new _$1}get logContext(){var j,B;return Object.assign({},(B=(j=this.loggerOptions).loggerContextCb)===null||B===void 0?void 0:B.call(j))}requirePublisher(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=j,this.updateState()}requireSubscriber(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=j,this.updateState()}createAndSendPublisherOffer(j){return this.publisher.createAndSendOffer(j)}setPublisherAnswer(j){return this.publisher.setRemoteDescription(j)}removeTrack(j){return this.publisher.removeTrack(j)}close(){return __awaiter$1(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const j=this.publisher;for(const B of j.getSenders())try{j.canRemoveTrack()&&j.removeTrack(B)}catch(q){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:q}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return __awaiter$1(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(j,B){return __awaiter$1(this,void 0,void 0,function*(){B===SignalTarget.PUBLISHER?yield this.publisher.addIceCandidate(j):yield this.subscriber.addIceCandidate(j)})}createSubscriberAnswerFromOffer(j){return __awaiter$1(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:j.type,sdp:j.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const B=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(j),yield this.subscriber.createAndSetAnswer()}finally{B()}})}updateConfiguration(j,B){this.publisher.setConfiguration(j),this.subscriber.setConfiguration(j),B&&this.triggerIceRestart()}ensurePCTransportConnection(j,B){return __awaiter$1(this,void 0,void 0,function*(){var q;const V=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((q=this.requiredTransports)===null||q===void 0?void 0:q.map(H=>this.ensureTransportConnected(H,j,B)))}finally{V()}})}negotiate(j){return __awaiter$1(this,void 0,void 0,function*(){return new Promise((B,q)=>__awaiter$1(this,void 0,void 0,function*(){const V=setTimeout(()=>{q("negotiation timed out")},this.peerConnectionTimeout),H=()=>{clearTimeout(V),q("negotiation aborted")};j.signal.addEventListener("abort",H),this.publisher.once(PCEvents.NegotiationStarted,()=>{j.signal.aborted||this.publisher.once(PCEvents.NegotiationComplete,()=>{clearTimeout(V),B()})}),yield this.publisher.negotiate($=>{clearTimeout(V),q($)})}))})}addPublisherTransceiver(j,B){return this.publisher.addTransceiver(j,B)}addPublisherTrack(j){return this.publisher.addTrack(j)}createPublisherDataChannel(j,B){return this.publisher.createDataChannel(j,B)}getConnectedAddress(j){return j===SignalTarget.PUBLISHER?this.publisher.getConnectedAddress():j===SignalTarget.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const j=[];return this.isPublisherConnectionRequired&&j.push(this.publisher),this.isSubscriberConnectionRequired&&j.push(this.subscriber),j}ensureTransportConnected(j,B){return __awaiter$1(this,arguments,void 0,function(q,V){var H=this;let $=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(q.getConnectionState()!=="connected")return new Promise((X,Q)=>__awaiter$1(H,void 0,void 0,function*(){const W=()=>{this.log.warn("abort transport connection",this.logContext),CriticalTimers.clearTimeout(Z),Q(new ConnectionError("room connection has been cancelled",ConnectionErrorReason.Cancelled))};V!=null&&V.signal.aborted&&W(),V==null||V.signal.addEventListener("abort",W);const Z=CriticalTimers.setTimeout(()=>{V==null||V.signal.removeEventListener("abort",W),Q(new ConnectionError("could not establish pc connection",ConnectionErrorReason.InternalError))},$);for(;this.state!==PCTransportState.CONNECTED;)if(yield sleep$1(50),V!=null&&V.signal.aborted){Q(new ConnectionError("room connection has been cancelled",ConnectionErrorReason.Cancelled));return}CriticalTimers.clearTimeout(Z),V==null||V.signal.removeEventListener("abort",W),X()}))})()})}}class RpcError extends Error{constructor(j,B,q){super(B),this.code=j,this.message=truncateBytes(B,RpcError.MAX_MESSAGE_BYTES),this.data=q?truncateBytes(q,RpcError.MAX_DATA_BYTES):void 0}static fromProto(j){return new RpcError(j.code,j.message,j.data)}toProto(){return new RpcError$1({code:this.code,message:this.message,data:this.data})}static builtIn(j,B){return new RpcError(RpcError.ErrorCode[j],RpcError.ErrorMessage[j],B)}}RpcError.MAX_MESSAGE_BYTES=256;RpcError.MAX_DATA_BYTES=15360;RpcError.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};RpcError.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const MAX_PAYLOAD_BYTES=15360;function byteLength(U){return new TextEncoder().encode(U).length}function truncateBytes(U,j){if(byteLength(U)<=j)return U;let B=0,q=U.length;const V=new TextEncoder;for(;B<q;){const H=Math.floor((B+q+1)/2);V.encode(U.slice(0,H)).length<=j?B=H:q=H-1}return U.slice(0,B)}const monitorFrequency=2e3;function computeBitrate(U,j){if(!j)return 0;let B,q;return"bytesReceived"in U?(B=U.bytesReceived,q=j.bytesReceived):"bytesSent"in U&&(B=U.bytesSent,q=j.bytesSent),B===void 0||q===void 0||U.timestamp===void 0||j.timestamp===void 0?0:(B-q)*8*1e3/(U.timestamp-j.timestamp)}const defaultDimensionsTimeout=1e3;class LocalTrack extends Track{get sender(){return this._sender}set sender(j){this._sender=j}get constraints(){return this._constraints}constructor(j,B,q){let V=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,H=arguments.length>4?arguments[4]:void 0;super(j,B,H),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=r$1(()=>__awaiter$1(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>__awaiter$1(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=V,this.muteLock=new _$1,this.pauseUpstreamLock=new _$1,this.processorLock=new _$1,this.restartLock=new _$1,this.setMediaStreamTrack(j,!0),this._constraints=j.getConstraints(),q&&(this._constraints=q)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:j,height:B}=this._mediaStreamTrack.getSettings();if(j&&B)return{width:j,height:B}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var j,B;return(B=(j=this.processor)===null||j===void 0?void 0:j.processedTrack)!==null&&B!==void 0?B:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(j,B){return __awaiter$1(this,void 0,void 0,function*(){var q;if(j===this._mediaStreamTrack&&!B)return;this._mediaStreamTrack&&(this.attachedElements.forEach(H=>{detachTrack(this._mediaStreamTrack,H)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([j]),j&&(j.addEventListener("ended",this.handleEnded),j.addEventListener("mute",this.handleTrackMuteEvent),j.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=j.getConstraints());let V;if(this.processor&&j){const H=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(attachToElement(j,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:j,kind:this.kind,element:this.processorElement}),V=this.processor.processedTrack}finally{H()}}this.sender&&((q=this.sender.transport)===null||q===void 0?void 0:q.state)!=="closed"&&(yield this.sender.replaceTrack(V??j)),!this.providedByUser&&this._mediaStreamTrack!==j&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=j,j&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(H=>{attachToElement(V??j,H)}))})}waitForDimensions(){return __awaiter$1(this,arguments,void 0,function(){var j=this;let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:defaultDimensionsTimeout;return(function*(){var q;if(j.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((q=getBrowser())===null||q===void 0?void 0:q.os)==="iOS"&&(yield sleep$1(10));const V=Date.now();for(;Date.now()-V<B;){const H=j.dimensions;if(H)return H;yield sleep$1(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")})()})}setDeviceId(j){return __awaiter$1(this,void 0,void 0,function*(){return this._constraints.deviceId===j&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(j)||(this._constraints.deviceId=j,this.isMuted)?!0:(yield this.restartTrack(),unwrapConstraint(j)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return __awaiter$1(this,arguments,void 0,function(){var j=this;let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(j.source===Track.Source.ScreenShare)return;const{deviceId:q,groupId:V}=j._mediaStreamTrack.getSettings(),H=j.kind===Track.Kind.Audio?"audioinput":"videoinput";return B?DeviceManager.getInstance().normalizeDeviceId(H,q,V):q})()})}mute(){return __awaiter$1(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return __awaiter$1(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(j,B){return __awaiter$1(this,void 0,void 0,function*(){if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");let q,V;return typeof B=="boolean"?q=B:B!==void 0&&(q=B.userProvidedTrack,V=B.stopProcessor),this.providedByUser=q??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(j),V&&this.processor&&(yield this.stopProcessor()),this})}restart(j){return __awaiter$1(this,void 0,void 0,function*(){this.manuallyStopped=!1;const B=yield this.restartLock.lock();try{j||(j=this._constraints);const{deviceId:q,facingMode:V}=j,H=__rest(j,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:j}));const $={audio:!1,video:!1};this.kind===Track.Kind.Video?$.video=q||V?{deviceId:q,facingMode:V}:!0:$.audio=q?{deviceId:q}:!0,this.attachedElements.forEach(Q=>{detachTrack(this.mediaStreamTrack,Q)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const X=(yield navigator.mediaDevices.getUserMedia($)).getTracks()[0];return yield X.applyConstraints(H),X.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(X),this._constraints=j,this.emit(TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{B()}})}setTrackMuted(j){this.log.debug("setting ".concat(this.kind," track ").concat(j?"muted":"unmuted"),this.logContext),!(this.isMuted===j&&this._mediaStreamTrack.enabled!==j)&&(this.isMuted=j,this._mediaStreamTrack.enabled=!j,this.emit(j?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const j=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter$1(this,void 0,void 0,function*(){yield j.handleAppVisibilityChanged.call(this),isMobile()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var j;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(j=this.processor)===null||j===void 0||j.destroy(),this.processor=void 0}pauseUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const q=getBrowser();if((q==null?void 0:q.name)==="Safari"&&compareVersions(q.version,"12.0")<0)throw new DeviceUnsupportedError("pauseUpstream is not supported on Safari < 12.");((j=this.sender.transport)===null||j===void 0?void 0:j.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{B()}})}resumeUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),((j=this.sender.transport)===null||j===void 0?void 0:j.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{B()}})}getRTCStatsReport(){return __awaiter$1(this,void 0,void 0,function*(){var j;return!((j=this.sender)===null||j===void 0)&&j.getStats?yield this.sender.getStats():void 0})}setProcessor(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var H;const $=yield q.processorLock.lock();try{q.log.debug("setting up processor",q.logContext);const K=document.createElement(q.kind),X={kind:q.kind,track:q._mediaStreamTrack,element:K,audioContext:q.audioContext};if(yield B.init(X),q.log.debug("processor initialized",q.logContext),q.processor&&(yield q.stopProcessor()),q.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(attachToElement(q._mediaStreamTrack,K),K.muted=!0,K.play().catch(Q=>q.log.error("failed to play processor element",Object.assign(Object.assign({},q.logContext),{error:Q}))),q.processor=B,q.processorElement=K,q.processor.processedTrack){for(const Q of q.attachedElements)Q!==q.processorElement&&V&&(detachTrack(q._mediaStreamTrack,Q),attachToElement(q.processor.processedTrack,Q));yield(H=q.sender)===null||H===void 0?void 0:H.replaceTrack(q.processor.processedTrack)}q.emit(TrackEvent.TrackProcessorUpdate,q.processor)}finally{$()}})()})}getProcessor(){return this.processor}stopProcessor(){return __awaiter$1(this,arguments,void 0,function(){var j=this;let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var q,V;j.processor&&(j.log.debug("stopping processor",j.logContext),(q=j.processor.processedTrack)===null||q===void 0||q.stop(),yield j.processor.destroy(),j.processor=void 0,B||((V=j.processorElement)===null||V===void 0||V.remove(),j.processorElement=void 0),yield j._mediaStreamTrack.applyConstraints(j._constraints),yield j.setMediaStreamTrack(j._mediaStreamTrack,!0),j.emit(TrackEvent.TrackProcessorUpdate))})()})}}class LocalAudioTrack extends LocalTrack{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(j,B){let q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,V=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;super(j,Track.Kind.Audio,B,q,H),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let $;try{$=yield this.getSenderStats()}catch(K){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:K}));return}$&&this.prevStats&&(this._currentBitrate=computeBitrate($,this.prevStats)),this.prevStats=$}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=V,this.checkForSilence()}mute(){const j=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter$1(this,void 0,void 0,function*(){const B=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield j.mute.call(this),this)}finally{B()}})}unmute(){const j=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter$1(this,void 0,void 0,function*(){const B=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const q=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==unwrapConstraint(this._constraints.deviceId);return this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||q)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield j.unmute.call(this),this}finally{B()}})}restartTrack(j){return __awaiter$1(this,void 0,void 0,function*(){let B;if(j){const q=constraintsForOptions({audio:j});typeof q.audio!="boolean"&&(B=q.audio)}yield this.restart(B)})}restart(j){const B=Object.create(null,{restart:{get:()=>super.restart}});return __awaiter$1(this,void 0,void 0,function*(){const q=yield B.restart.call(this,j);return this.checkForSilence(),q})}startMonitor(){isWeb()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency)))}setProcessor(j){return __awaiter$1(this,void 0,void 0,function*(){var B;const q=yield this.processorLock.lock();try{if(!isReactNative()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const V={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(j.name),this.logContext),yield j.init(V),this.processor=j,this.processor.processedTrack&&(yield(B=this.sender)===null||B===void 0?void 0:B.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(TrackEvent.TrackProcessorUpdate,this.processor)}finally{q()}})}setAudioContext(j){this.audioContext=j}getSenderStats(){return __awaiter$1(this,void 0,void 0,function*(){var j;if(!(!((j=this.sender)===null||j===void 0)&&j.getStats))return;const B=yield this.sender.getStats();let q;return B.forEach(V=>{V.type==="outbound-rtp"&&(q={type:"audio",streamId:V.id,packetsSent:V.packetsSent,packetsLost:V.packetsLost,bytesSent:V.bytesSent,timestamp:V.timestamp,roundTripTime:V.roundTripTime,jitter:V.jitter})}),q})}checkForSilence(){return __awaiter$1(this,void 0,void 0,function*(){const j=yield detectSilence(this);return j&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(TrackEvent.AudioSilenceDetected)),j})}}function mediaTrackToLocalTrack(U,j,B){switch(U.kind){case"audio":return new LocalAudioTrack(U,j,!1,void 0,B);case"video":return new LocalVideoTrack(U,j,!1,B);default:throw new TrackInvalidError("unsupported track type: ".concat(U.kind))}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=U=>[{scaleResolutionDownBy:2,fps:U.encoding.maxFramerate}].map(B=>{var q,V;return new VideoPreset(Math.floor(U.width/B.scaleResolutionDownBy),Math.floor(U.height/B.scaleResolutionDownBy),Math.max(15e4,Math.floor(U.encoding.maxBitrate/(Math.pow(B.scaleResolutionDownBy,2)*(((q=U.encoding.maxFramerate)!==null&&q!==void 0?q:30)/((V=B.fps)!==null&&V!==void 0?V:30))))),B.fps,U.encoding.priority)}),videoRids=["q","h","f"];function computeVideoEncodings(U,j,B,q){var V,H;let $=q==null?void 0:q.videoEncoding;U&&($=q==null?void 0:q.screenShareEncoding);const K=q==null?void 0:q.simulcast,X=q==null?void 0:q.scalabilityMode,Q=q==null?void 0:q.videoCodec;if(!$&&!K&&!X||!j||!B)return[{}];$||($=determineAppropriateEncoding(U,j,B,Q),livekitLogger.debug("using video encoding",$));const W=$.maxFramerate,Z=new VideoPreset(j,B,$.maxBitrate,$.maxFramerate,$.priority);if(X&&isSVCCodec(Q)){const ae=new ScalabilityMode(X),oe=[];if(ae.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(X));const de=getBrowser();if(isSafari()||isReactNative()||(de==null?void 0:de.name)==="Chrome"&&compareVersions(de==null?void 0:de.version,"113")<0){const le=ae.suffix=="h"?2:3;for(let ue=0;ue<ae.spatial;ue+=1)oe.push({rid:videoRids[2-ue],maxBitrate:$.maxBitrate/Math.pow(le,ue),maxFramerate:Z.encoding.maxFramerate});oe[0].scalabilityMode=X}else oe.push({maxBitrate:$.maxBitrate,maxFramerate:Z.encoding.maxFramerate,scalabilityMode:X});return Z.encoding.priority&&(oe[0].priority=Z.encoding.priority,oe[0].networkPriority=Z.encoding.priority),livekitLogger.debug("using svc encoding",{encodings:oe}),oe}if(!K)return[$];let te=[];U?te=(V=sortPresets(q==null?void 0:q.screenShareSimulcastLayers))!==null&&V!==void 0?V:defaultSimulcastLayers(U,Z):te=(H=sortPresets(q==null?void 0:q.videoSimulcastLayers))!==null&&H!==void 0?H:defaultSimulcastLayers(U,Z);let ie;if(te.length>0){const ae=te[0];te.length>1&&([,ie]=te);const oe=Math.max(j,B);if(oe>=960&&ie)return encodingsFromPresets(j,B,[ae,ie,Z],W);if(oe>=480)return encodingsFromPresets(j,B,[ae,Z],W)}return encodingsFromPresets(j,B,[Z])}function computeTrackBackupEncodings(U,j,B){var q,V,H,$;if(!B.backupCodec||B.backupCodec===!0||B.backupCodec.codec===B.videoCodec)return;j!==B.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:j,backup:B.backupCodec.codec}),B.videoCodec=j,B.videoEncoding=B.backupCodec.encoding;const K=U.mediaStreamTrack.getSettings(),X=(q=K.width)!==null&&q!==void 0?q:(V=U.dimensions)===null||V===void 0?void 0:V.width,Q=(H=K.height)!==null&&H!==void 0?H:($=U.dimensions)===null||$===void 0?void 0:$.height;return U.source===Track.Source.ScreenShare&&B.simulcast&&(B.simulcast=!1),computeVideoEncodings(U.source===Track.Source.ScreenShare,X,Q,B)}function determineAppropriateEncoding(U,j,B,q){const V=presetsForResolution(U,j,B);let{encoding:H}=V[0];const $=Math.max(j,B);for(let K=0;K<V.length;K+=1){const X=V[K];if(H=X.encoding,X.width>=$)break}if(q)switch(q){case"av1":H=Object.assign({},H),H.maxBitrate=H.maxBitrate*.7;break;case"vp9":H=Object.assign({},H),H.maxBitrate=H.maxBitrate*.85;break}return H}function presetsForResolution(U,j,B){if(U)return presetsScreenShare;const q=j>B?j/B:B/j;return Math.abs(q-16/9)<Math.abs(q-4/3)?presets169:presets43}function defaultSimulcastLayers(U,j){if(U)return computeDefaultScreenShareSimulcastPresets(j);const{width:B,height:q}=j,V=B>q?B/q:q/B;return Math.abs(V-16/9)<Math.abs(V-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(U,j,B,q){const V=[];if(B.forEach((H,$)=>{if($>=videoRids.length)return;const K=Math.min(U,j),Q={rid:videoRids[$],scaleResolutionDownBy:Math.max(1,K/Math.min(H.width,H.height)),maxBitrate:H.encoding.maxBitrate},W=q&&H.encoding.maxFramerate?Math.min(q,H.encoding.maxFramerate):H.encoding.maxFramerate;W&&(Q.maxFramerate=W);const Z=isFireFox()||$===0;H.encoding.priority&&Z&&(Q.priority=H.encoding.priority,Q.networkPriority=H.encoding.priority),V.push(Q)}),isReactNative()&&getReactNativeOs()==="ios"){let H;V.forEach(K=>{H?K.maxFramerate&&K.maxFramerate>H&&(H=K.maxFramerate):H=K.maxFramerate});let $=!0;V.forEach(K=>{var X;K.maxFramerate!=H&&($&&($=!1,livekitLogger.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),livekitLogger.info('Setting framerate of encoding "'.concat((X=K.rid)!==null&&X!==void 0?X:"",'" to ').concat(H)),K.maxFramerate=H)})}return V}function sortPresets(U){if(U)return U.sort((j,B)=>{const{encoding:q}=j,{encoding:V}=B;return q.maxBitrate>V.maxBitrate?1:q.maxBitrate<V.maxBitrate?-1:q.maxBitrate===V.maxBitrate&&q.maxFramerate&&V.maxFramerate?q.maxFramerate>V.maxFramerate?1:-1:0})}class ScalabilityMode{constructor(j){const B=j.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!B)throw new Error("invalid scalability mode");if(this.spatial=parseInt(B[1]),this.temporal=parseInt(B[2]),B.length>3)switch(B[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=B[3]}}toString(){var j;return"L".concat(this.spatial,"T").concat(this.temporal).concat((j=this.suffix)!==null&&j!==void 0?j:"")}}function getDefaultDegradationPreference(U){return U.source===Track.Source.ScreenShare||U.constraints.height&&unwrapConstraint(U.constraints.height)>=1080?"maintain-resolution":"balanced"}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{get sender(){return this._sender}set sender(j){this._sender=j,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(j,B){let q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,V=arguments.length>3?arguments[3]:void 0;super(j,Track.Kind.Video,B,q,V),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let H;try{H=yield this.getSenderStats()}catch(K){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:K}));return}const $=new Map(H.map(K=>[K.rid,K]));if(this.prevStats){let K=0;$.forEach((X,Q)=>{var W;const Z=(W=this.prevStats)===null||W===void 0?void 0:W.get(Q);K+=computeBitrate(X,Z)}),this._currentBitrate=K}this.prevStats=$}),this.senderLock=new _$1}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(j){var B;if(this.signalClient=j,!isWeb())return;const q=(B=this.sender)===null||B===void 0?void 0:B.getParameters();q&&(this.encodings=q.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(j=>{j.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const j=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return __awaiter$1(this,void 0,void 0,function*(){var B,q,V,H,$;yield j.pauseUpstream.call(this);try{for(var K=!0,X=__asyncValues(this.simulcastCodecs.values()),Q;Q=yield X.next(),B=Q.done,!B;K=!0)H=Q.value,K=!1,yield($=H.sender)===null||$===void 0?void 0:$.replaceTrack(null)}catch(W){q={error:W}}finally{try{!K&&!B&&(V=X.return)&&(yield V.call(X))}finally{if(q)throw q.error}}})}resumeUpstream(){const j=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return __awaiter$1(this,void 0,void 0,function*(){var B,q,V,H,$;yield j.resumeUpstream.call(this);try{for(var K=!0,X=__asyncValues(this.simulcastCodecs.values()),Q;Q=yield X.next(),B=Q.done,!B;K=!0){H=Q.value,K=!1;const W=H;yield($=W.sender)===null||$===void 0?void 0:$.replaceTrack(W.mediaStreamTrack)}}catch(W){q={error:W}}finally{try{!K&&!B&&(V=X.return)&&(yield V.call(X))}finally{if(q)throw q.error}}})}mute(){const j=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter$1(this,void 0,void 0,function*(){const B=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield j.mute.call(this),this)}finally{B()}})}unmute(){const j=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter$1(this,void 0,void 0,function*(){const B=yield this.muteLock.lock();try{return this.isMuted?(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield j.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{B()}})}setTrackMuted(j){super.setTrackMuted(j);for(const B of this.simulcastCodecs.values())B.mediaStreamTrack.enabled=!j}getSenderStats(){return __awaiter$1(this,void 0,void 0,function*(){var j;if(!(!((j=this.sender)===null||j===void 0)&&j.getStats))return[];const B=[],q=yield this.sender.getStats();return q.forEach(V=>{var H;if(V.type==="outbound-rtp"){const $={type:"video",streamId:V.id,frameHeight:V.frameHeight,frameWidth:V.frameWidth,framesPerSecond:V.framesPerSecond,framesSent:V.framesSent,firCount:V.firCount,pliCount:V.pliCount,nackCount:V.nackCount,packetsSent:V.packetsSent,bytesSent:V.bytesSent,qualityLimitationReason:V.qualityLimitationReason,qualityLimitationDurations:V.qualityLimitationDurations,qualityLimitationResolutionChanges:V.qualityLimitationResolutionChanges,rid:(H=V.rid)!==null&&H!==void 0?H:V.id,retransmittedPacketsSent:V.retransmittedPacketsSent,targetBitrate:V.targetBitrate,timestamp:V.timestamp},K=q.get(V.remoteId);K&&($.jitter=K.jitter,$.packetsLost=K.packetsLost,$.roundTripTime=K.roundTripTime),B.push($)}}),B.sort((V,H)=>{var $,K;return(($=H.frameWidth)!==null&&$!==void 0?$:0)-((K=V.frameWidth)!==null&&K!==void 0?K:0)}),B})}setPublishingQuality(j){const B=[];for(let q=VideoQuality.LOW;q<=VideoQuality.HIGH;q+=1)B.push(new SubscribedQuality({quality:q,enabled:q<=j}));this.log.debug("setting publishing quality. max quality ".concat(j),this.logContext),this.setPublishingLayers(B)}restartTrack(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q,V,H,$;let K;if(j){const Z=constraintsForOptions({video:j});typeof Z.video!="boolean"&&(K=Z.video)}yield this.restart(K);try{for(var X=!0,Q=__asyncValues(this.simulcastCodecs.values()),W;W=yield Q.next(),B=W.done,!B;X=!0){H=W.value,X=!1;const Z=H;Z.sender&&(($=Z.sender.transport)===null||$===void 0?void 0:$.state)!=="closed"&&(Z.mediaStreamTrack=this.mediaStreamTrack.clone(),yield Z.sender.replaceTrack(Z.mediaStreamTrack))}}catch(Z){q={error:Z}}finally{try{!X&&!B&&(V=Q.return)&&(yield V.call(Q))}finally{if(q)throw q.error}}})}setProcessor(j){const B=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return __awaiter$1(this,arguments,void 0,function(q){var V=this;let H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var $,K,X,Q,W,Z;if(yield B.setProcessor.call(V,q,H),!((W=V.processor)===null||W===void 0)&&W.processedTrack)try{for(var te=!0,ie=__asyncValues(V.simulcastCodecs.values()),ae;ae=yield ie.next(),$=ae.done,!$;te=!0)Q=ae.value,te=!1,yield(Z=Q.sender)===null||Z===void 0?void 0:Z.replaceTrack(V.processor.processedTrack)}catch(oe){K={error:oe}}finally{try{!te&&!$&&(X=ie.return)&&(yield X.call(ie))}finally{if(K)throw K.error}}})()})}setDegradationPreference(j){return __awaiter$1(this,void 0,void 0,function*(){if(this.degradationPreference=j,this.sender)try{this.log.debug("setting degradationPreference to ".concat(j),this.logContext);const B=this.sender.getParameters();B.degradationPreference=j,this.sender.setParameters(B)}catch(B){this.log.warn("failed to set degradationPreference",Object.assign({error:B},this.logContext))}})}addSimulcastTrack(j,B){if(this.simulcastCodecs.has(j)){this.log.error("".concat(j," already added, skipping adding simulcast codec"),this.logContext);return}const q={codec:j,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:B};return this.simulcastCodecs.set(j,q),q}setSimulcastTrackSender(j,B){const q=this.simulcastCodecs.get(j);q&&(q.sender=B,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}setPublishingCodecs(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q,V,H,$,K,X;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:j,currentCodec:this.codec})),!this.codec&&j.length>0)return yield this.setPublishingLayers(j[0].qualities),[];this.subscribedCodecs=j;const Q=[];try{for(B=!0,q=__asyncValues(j);V=yield q.next(),H=V.done,!H;B=!0){X=V.value,B=!1;const W=X;if(!this.codec||this.codec===W.codec)yield this.setPublishingLayers(W.qualities);else{const Z=this.simulcastCodecs.get(W.codec);if(this.log.debug("try setPublishingCodec for ".concat(W.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:Z})),!Z||!Z.sender){for(const te of W.qualities)if(te.enabled){Q.push(W.codec);break}}else Z.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(W.codec),this.logContext),yield setPublishingLayersForSender(Z.sender,Z.encodings,W.qualities,this.senderLock,this.log,this.logContext))}}}catch(W){$={error:W}}finally{try{!B&&!H&&(K=q.return)&&(yield K.call(q))}finally{if($)throw $.error}}return Q})}setPublishingLayers(j){return __awaiter$1(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:j})),!(!this.sender||!this.encodings)&&(yield setPublishingLayersForSender(this.sender,this.encodings,j,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const j=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter$1(this,void 0,void 0,function*(){yield j.handleAppVisibilityChanged.call(this),isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function setPublishingLayersForSender(U,j,B,q,V,H){return __awaiter$1(this,void 0,void 0,function*(){const $=yield q.lock();V.debug("setPublishingLayersForSender",Object.assign(Object.assign({},H),{sender:U,qualities:B,senderEncodings:j}));try{const K=U.getParameters(),{encodings:X}=K;if(!X)return;if(X.length!==j.length){V.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},H),{encodings:X,senderEncodings:j}));return}let Q=!1;const W=getBrowser();if((W==null?void 0:W.name)==="Chrome"&&compareVersions(W==null?void 0:W.version,"133")>0&&X[0].scalabilityMode){const te=X[0],ie=new ScalabilityMode(te.scalabilityMode);let ae=VideoQuality$1.OFF;if(B.forEach(oe=>{oe.enabled&&(ae===VideoQuality$1.OFF||oe.quality>ae)&&(ae=oe.quality)}),ae===VideoQuality$1.OFF)te.active&&(te.active=!1,Q=!0);else if(!te.active||ie.spatial!==ae+1){Q=!0,te.active=!0;const oe=new ScalabilityMode(j[0].scalabilityMode);ie.spatial=ae+1,ie.suffix=oe.suffix,ie.spatial===1&&(ie.suffix=void 0),te.scalabilityMode=ie.toString(),te.scaleResolutionDownBy=Math.pow(2,2-ae),j[0].maxBitrate&&(te.maxBitrate=j[0].maxBitrate/(te.scaleResolutionDownBy*te.scaleResolutionDownBy))}}else X.forEach((te,ie)=>{var ae;let oe=(ae=te.rid)!==null&&ae!==void 0?ae:"";oe===""&&(oe="q");const de=videoQualityForRid(oe),le=B.find(ue=>ue.quality===de);le&&te.active!==le.enabled&&(Q=!0,te.active=le.enabled,V.debug("setting layer ".concat(le.quality," to ").concat(te.active?"enabled":"disabled"),H),isFireFox()&&(le.enabled?(te.scaleResolutionDownBy=j[ie].scaleResolutionDownBy,te.maxBitrate=j[ie].maxBitrate,te.maxFrameRate=j[ie].maxFrameRate):(te.scaleResolutionDownBy=4,te.maxBitrate=10,te.maxFrameRate=2)))});Q&&(K.encodings=X,V.debug("setting encodings",Object.assign(Object.assign({},H),{encodings:K.encodings})),yield U.setParameters(K))}finally{$()}})}function videoQualityForRid(U){switch(U){case"f":return VideoQuality.HIGH;case"h":return VideoQuality.MEDIUM;case"q":return VideoQuality.LOW;default:return VideoQuality.HIGH}}function videoLayersFromEncodings(U,j,B,q){if(!B)return[new VideoLayer({quality:VideoQuality.HIGH,width:U,height:j,bitrate:0,ssrc:0})];if(q){const V=B[0].scalabilityMode,H=new ScalabilityMode(V),$=[],K=H.suffix=="h"?1.5:2,X=H.suffix=="h"?2:3;for(let Q=0;Q<H.spatial;Q+=1)$.push(new VideoLayer({quality:Math.min(VideoQuality.HIGH,H.spatial-1)-Q,width:Math.ceil(U/Math.pow(K,Q)),height:Math.ceil(j/Math.pow(K,Q)),bitrate:B[0].maxBitrate?Math.ceil(B[0].maxBitrate/Math.pow(X,Q)):0,ssrc:0}));return $}return B.map(V=>{var H,$,K;const X=(H=V.scaleResolutionDownBy)!==null&&H!==void 0?H:1;let Q=videoQualityForRid(($=V.rid)!==null&&$!==void 0?$:"");return new VideoLayer({quality:Q,width:Math.ceil(U/X),height:Math.ceil(j/X),bitrate:(K=V.maxBitrate)!==null&&K!==void 0?K:0,ssrc:0})})}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect";var PCState;(function(U){U[U.New=0]="New",U[U.Connected=1]="Connected",U[U.Disconnected=2]="Disconnected",U[U.Reconnecting=3]="Reconnecting",U[U.Closed=4]="Closed"})(PCState||(PCState={}));class RTCEngine extends eventsExports.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(j){var B;super(),this.options=j,this.rtcConfig={},this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=PCState.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=livekitLogger,this.handleDataChannel=q=>__awaiter$1(this,[q],void 0,function(V){var H=this;let{channel:$}=V;return(function*(){if($){if($.label===reliableDataChannel)H.reliableDCSub=$;else if($.label===lossyDataChannel)H.lossyDCSub=$;else return;H.log.debug("on data channel ".concat($.id,", ").concat($.label),H.logContext),$.onmessage=H.handleDataMessage}})()}),this.handleDataMessage=q=>__awaiter$1(this,void 0,void 0,function*(){var V,H;const $=yield this.dataProcessLock.lock();try{let K;if(q.data instanceof ArrayBuffer)K=q.data;else if(q.data instanceof Blob)K=yield q.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:q.data}));return}const X=DataPacket.fromBinary(new Uint8Array(K));((V=X.value)===null||V===void 0?void 0:V.case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,X.value.value.speakers):(((H=X.value)===null||H===void 0?void 0:H.case)==="user"&&applyUserDataCompat(X,X.value.value),this.emit(EngineEvent.DataPacketReceived,X))}finally{$()}}),this.handleDataError=q=>{const H=q.currentTarget.maxRetransmits===0?"lossy":"reliable";if(q instanceof ErrorEvent&&q.error){const{error:$}=q.error;this.log.error("DataChannel error on ".concat(H,": ").concat(q.message),Object.assign(Object.assign({},this.logContext),{error:$}))}else this.log.error("Unknown DataChannel error on ".concat(H),Object.assign(Object.assign({},this.logContext),{event:q}))},this.handleBufferedAmountLow=q=>{const H=q.currentTarget.maxRetransmits===0?DataPacket_Kind.LOSSY:DataPacket_Kind.RELIABLE;this.updateAndEmitDCBufferStatus(H)},this.handleDisconnect=(q,V)=>{if(this._isClosed)return;this.log.warn("".concat(q," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const H=X=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(X,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),this.close()},$=Date.now()-this.reconnectStart;let K=this.getNextRetryDelay({elapsedMs:$,retryCount:this.reconnectAttempts});if(K===null){H($);return}q===leaveReconnect&&(K=0),this.log.debug("reconnecting in ".concat(K,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(V).finally(()=>this.reconnectTimeout=void 0),K)},this.waitForRestarted=()=>new Promise((q,V)=>{this.pcState===PCState.Connected&&q();const H=()=>{this.off(EngineEvent.Disconnected,$),q()},$=()=>{this.off(EngineEvent.Restarted,H),V()};this.once(EngineEvent.Restarted,H),this.once(EngineEvent.Disconnected,$)}),this.updateAndEmitDCBufferStatus=q=>{const V=this.isBufferStatusLow(q);typeof V<"u"&&V!==this.dcBufferStatus.get(q)&&(this.dcBufferStatus.set(q,V),this.emit(EngineEvent.DCBufferStatusChanged,V,q))},this.isBufferStatusLow=q=>{const V=this.dataChannelForKind(q);if(V)return V.bufferedAmount<=V.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===SignalConnectionState.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ReconnectReason.RR_SIGNAL_DISCONNECTED))},this.log=getLogger((B=j.loggerName)!==null&&B!==void 0?B:LoggerNames.Engine),this.loggerOptions={loggerName:j.loggerName,loggerContextCb:()=>this.logContext},this.client=new SignalClient(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new _$1,this.dataProcessLock=new _$1,this.dcBufferStatus=new Map([[DataPacket_Kind.LOSSY,!0],[DataPacket_Kind.RELIABLE,!0]]),this.client.onParticipantUpdate=q=>this.emit(EngineEvent.ParticipantUpdate,q),this.client.onConnectionQuality=q=>this.emit(EngineEvent.ConnectionQualityUpdate,q),this.client.onRoomUpdate=q=>this.emit(EngineEvent.RoomUpdate,q),this.client.onSubscriptionError=q=>this.emit(EngineEvent.SubscriptionError,q),this.client.onSubscriptionPermissionUpdate=q=>this.emit(EngineEvent.SubscriptionPermissionUpdate,q),this.client.onSpeakersChanged=q=>this.emit(EngineEvent.SpeakersChanged,q),this.client.onStreamStateUpdate=q=>this.emit(EngineEvent.StreamStateChanged,q),this.client.onRequestResponse=q=>this.emit(EngineEvent.SignalRequestResponse,q)}get logContext(){var j,B,q,V,H,$,K,X;return{room:(B=(j=this.latestJoinResponse)===null||j===void 0?void 0:j.room)===null||B===void 0?void 0:B.name,roomID:(V=(q=this.latestJoinResponse)===null||q===void 0?void 0:q.room)===null||V===void 0?void 0:V.sid,participant:($=(H=this.latestJoinResponse)===null||H===void 0?void 0:H.participant)===null||$===void 0?void 0:$.identity,pID:(X=(K=this.latestJoinResponse)===null||K===void 0?void 0:K.participant)===null||X===void 0?void 0:X.sid}}join(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){this.url=j,this.token=B,this.signalOpts=q,this.maxJoinAttempts=q.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const H=yield this.client.join(j,B,q,V);return this._isClosed=!1,this.latestJoinResponse=H,this.subscriberPrimary=H.subscriberPrimary,this.pcManager||(yield this.configure(H)),(!this.subscriberPrimary||H.fastPublish)&&this.negotiate(),this.clientConfiguration=H.clientConfiguration,setTimeout(()=>{this.emit(EngineEvent.SignalConnected)},10),H}catch(H){if(H instanceof ConnectionError&&H.reason===ConnectionErrorReason.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(j,B,q,V);throw H}})}close(){return __awaiter$1(this,void 0,void 0,function*(){const j=yield this.closingLock.lock();if(this.isClosed){j();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{j()}})}cleanupPeerConnections(){return __awaiter$1(this,void 0,void 0,function*(){var j;yield(j=this.pcManager)===null||j===void 0?void 0:j.close(),this.pcManager=void 0;const B=q=>{q&&(q.close(),q.onbufferedamountlow=null,q.onclose=null,q.onclosing=null,q.onerror=null,q.onmessage=null,q.onopen=null)};B(this.lossyDC),B(this.lossyDCSub),B(this.reliableDC),B(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return __awaiter$1(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(j){if(this.pendingTrackResolvers[j.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((B,q)=>{const V=setTimeout(()=>{delete this.pendingTrackResolvers[j.cid],q(new ConnectionError("publication of local track timed out, no response from server",ConnectionErrorReason.InternalError))},1e4);this.pendingTrackResolvers[j.cid]={resolve:H=>{clearTimeout(V),B(H)},reject:()=>{clearTimeout(V),q(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(j)})}removeTrack(j){if(j.track&&this.pendingTrackResolvers[j.track.id]){const{reject:B}=this.pendingTrackResolvers[j.track.id];B&&B(),delete this.pendingTrackResolvers[j.track.id]}try{return this.pcManager.removeTrack(j),!0}catch(B){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:B}))}return!1}updateMuteStatus(j,B){this.client.sendMuteTrack(j,B)}get dataSubscriberReadyState(){var j;return(j=this.reliableDCSub)===null||j===void 0?void 0:j.readyState}getConnectedServerAddress(){return __awaiter$1(this,void 0,void 0,function*(){var j;return(j=this.pcManager)===null||j===void 0?void 0:j.getConnectedAddress()})}setRegionUrlProvider(j){this.regionUrlProvider=j}configure(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q;if(this.pcManager&&this.pcManager.currentState!==PCTransportState.NEW)return;this.participantSid=(B=j.participant)===null||B===void 0?void 0:B.sid;const V=this.makeRTCConfiguration(j);this.pcManager=new PCTransportManager(V,j.subscriberPrimary,this.loggerOptions),this.emit(EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(H,$)=>{this.client.sendIceCandidate(H,$)},this.pcManager.onPublisherOffer=H=>{this.client.sendOffer(H)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(H,$,K)=>__awaiter$1(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(H),this.logContext),["closed","disconnected","failed"].includes($)&&(this.publisherConnectionPromise=void 0),H===PCTransportState.CONNECTED){const W=this.pcState===PCState.New;this.pcState=PCState.Connected,W&&this.emit(EngineEvent.Connected,j)}else H===PCTransportState.FAILED&&this.pcState===PCState.Connected&&(this.pcState=PCState.Disconnected,this.handleDisconnect("peerconnection failed",K==="failed"?ReconnectReason.RR_SUBSCRIBER_FAILED:ReconnectReason.RR_PUBLISHER_FAILED));const X=this.client.isDisconnected||this.client.currentState===SignalConnectionState.RECONNECTING,Q=[PCTransportState.FAILED,PCTransportState.CLOSING,PCTransportState.CLOSED].includes(H);X&&Q&&!this._isClosed&&this.emit(EngineEvent.Offline)}),this.pcManager.onTrack=H=>{this.emit(EngineEvent.MediaTrackAdded,H.track,H.streams[0],H.receiver)},supportOptionalDatachannel((q=j.serverInfo)===null||q===void 0?void 0:q.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=j=>__awaiter$1(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:j.type})),yield this.pcManager.setPublisherAnswer(j))}),this.client.onTrickle=(j,B)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:j,target:B})),this.pcManager.addIceCandidate(j,B))},this.client.onOffer=j=>__awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)return;const B=yield this.pcManager.createSubscriberAnswerFromOffer(j);this.client.sendAnswer(B)}),this.client.onLocalTrackPublished=j=>{var B;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:j.cid,track:(B=j.track)===null||B===void 0?void 0:B.sid})),!this.pendingTrackResolvers[j.cid]){this.log.error("missing track resolver for ".concat(j.cid),Object.assign(Object.assign({},this.logContext),{cid:j.cid}));return}const{resolve:q}=this.pendingTrackResolvers[j.cid];delete this.pendingTrackResolvers[j.cid],q(j.track)},this.client.onLocalTrackUnpublished=j=>{this.emit(EngineEvent.LocalTrackUnpublished,j)},this.client.onLocalTrackSubscribed=j=>{this.emit(EngineEvent.LocalTrackSubscribed,j)},this.client.onTokenRefresh=j=>{this.token=j},this.client.onRemoteMuteChanged=(j,B)=>{this.emit(EngineEvent.RemoteMute,j,B)},this.client.onSubscribedQualityUpdate=j=>{this.emit(EngineEvent.SubscribedQualityUpdate,j)},this.client.onClose=()=>{this.handleDisconnect("signal",ReconnectReason.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=j=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:j==null?void 0:j.reason})),j.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(j.regions)),j.action){case LeaveRequest_Action.DISCONNECT:this.emit(EngineEvent.Disconnected,j==null?void 0:j.reason),this.close();break;case LeaveRequest_Action.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(leaveReconnect);break;case LeaveRequest_Action.RESUME:this.handleDisconnect(leaveReconnect)}}}makeRTCConfiguration(j){var B;const q=Object.assign({},this.rtcConfig);if(!((B=this.signalOpts)===null||B===void 0)&&B.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),q.encodedInsertableStreams=!0),j.iceServers&&!q.iceServers){const V=[];j.iceServers.forEach(H=>{const $={urls:H.urls};H.username&&($.username=H.username),H.credential&&($.credential=H.credential),V.push($)}),q.iceServers=V}return j.clientConfiguration&&j.clientConfiguration.forceRelay===ClientConfigSetting.ENABLED&&(q.iceTransportPolicy="relay"),q.sdpSemantics="unified-plan",q.continualGatheringPolicy="gather_continually",q}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lossyDataChannel,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(j,B,q){return __awaiter$1(this,void 0,void 0,function*(){if(supportsTransceiver())return yield this.createTransceiverRTCRtpSender(j,B,q);if(supportsAddTrack())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(j.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")})}createSimulcastSender(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){if(supportsTransceiver())return this.createSimulcastTransceiverSender(j,B,q,V);if(supportsAddTrack())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(j.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")})}createTransceiverRTCRtpSender(j,B,q){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const V=[];j.mediaStream&&V.push(j.mediaStream),isVideoTrack(j)&&(j.codec=B.videoCodec);const H={direction:"sendonly",streams:V};return q&&(H.sendEncodings=q),(yield this.pcManager.addPublisherTransceiver(j.mediaStreamTrack,H)).sender})}createSimulcastTransceiverSender(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const H={direction:"sendonly"};V&&(H.sendEncodings=V);const $=yield this.pcManager.addPublisherTransceiver(B.mediaStreamTrack,H);if(q.videoCodec)return j.setSimulcastTrackSender(q.videoCodec,$.sender),$.sender})}createRTCRtpSender(j){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");return this.pcManager.addPublisherTrack(j)})}attemptReconnect(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q,V;if(!this._isClosed){if(this.attemptingReconnect){livekitLogger.warn("already attempting reconnect, returning early",this.logContext);return}(((B=this.clientConfiguration)===null||B===void 0?void 0:B.resumeConnection)===ClientConfigSetting.DISABLED||((V=(q=this.pcManager)===null||q===void 0?void 0:q.currentState)!==null&&V!==void 0?V:PCTransportState.NEW)===PCTransportState.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(j),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(H){this.reconnectAttempts+=1;let $=!0;H instanceof UnexpectedConnectionState?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:H})),$=!1):H instanceof SignalReconnectError||(this.fullReconnectOnNext=!0),$?this.handleDisconnect("reconnect",ReconnectReason.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(j){try{return this.reconnectPolicy.nextRetryDelayInMs(j)}catch(B){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:B}))}return null}restartConnection(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q,V;try{if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let H;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new SignalReconnectError;H=yield this.join(j??this.url,this.token,this.signalOpts)}catch($){throw $ instanceof ConnectionError&&$.reason===ConnectionErrorReason.NotAllowed?new UnexpectedConnectionState("could not reconnect, token might be expired"):new SignalReconnectError}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(EngineEvent.SignalRestarted,H),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");(B=this.regionUrlProvider)===null||B===void 0||B.resetAttempts(),this.emit(EngineEvent.Restarted)}catch(H){const $=yield(q=this.regionUrlProvider)===null||q===void 0?void 0:q.getNextBestRegionUrl();if($){yield this.restartConnection($);return}else throw(V=this.regionUrlProvider)===null||V===void 0||V.resetAttempts(),H}})}resumeConnection(j){return __awaiter$1(this,void 0,void 0,function*(){var B;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.pcManager)throw new UnexpectedConnectionState("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Resuming);let q;try{this.setupSignalClientCallbacks(),q=yield this.client.reconnect(this.url,this.token,this.participantSid,j)}catch(V){let H="";throw V instanceof Error&&(H=V.message,this.log.error(V.message,Object.assign(Object.assign({},this.logContext),{error:V}))),V instanceof ConnectionError&&V.reason===ConnectionErrorReason.NotAllowed?new UnexpectedConnectionState("could not reconnect, token might be expired"):V instanceof ConnectionError&&V.reason===ConnectionErrorReason.LeaveRequest?V:new SignalReconnectError(H)}if(this.emit(EngineEvent.SignalResumed),q){const V=this.makeRTCConfiguration(q);this.pcManager.updateConfiguration(V)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");this.client.setReconnected(),((B=this.reliableDC)===null||B===void 0?void 0:B.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(EngineEvent.Resumed)})}waitForPCInitialConnection(j,B){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(B,j)})}waitForPCReconnected(){return __awaiter$1(this,void 0,void 0,function*(){this.pcState=PCState.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield sleep$1(minReconnectWait),!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=PCState.Connected}catch(j){throw this.pcState=PCState.Disconnected,new ConnectionError("could not establish PC connection, ".concat(j.message),ConnectionErrorReason.InternalError)}})}publishRpcResponse(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){const H=new DataPacket({destinationIdentities:[j],kind:DataPacket_Kind.RELIABLE,value:{case:"rpcResponse",value:new RpcResponse({requestId:B,value:V?{case:"error",value:V.toProto()}:{case:"payload",value:q??""}})}});yield this.sendDataPacket(H,DataPacket_Kind.RELIABLE)})}publishRpcAck(j,B){return __awaiter$1(this,void 0,void 0,function*(){const q=new DataPacket({destinationIdentities:[j],kind:DataPacket_Kind.RELIABLE,value:{case:"rpcAck",value:new RpcAck({requestId:B})}});yield this.sendDataPacket(q,DataPacket_Kind.RELIABLE)})}sendDataPacket(j,B){return __awaiter$1(this,void 0,void 0,function*(){const q=j.toBinary();yield this.ensurePublisherConnected(B);const V=this.dataChannelForKind(B);V&&V.send(q),this.updateAndEmitDCBufferStatus(B)})}waitForBufferStatusLow(j){return new Promise((B,q)=>__awaiter$1(this,void 0,void 0,function*(){if(this.isBufferStatusLow(j))B();else{const V=()=>q("Engine closed");for(this.once(EngineEvent.Closing,V);!this.dcBufferStatus.get(j);)yield sleep$1(10);this.off(EngineEvent.Closing,V),B()}}))}ensureDataTransportConnected(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var H;if(!q.pcManager)throw new UnexpectedConnectionState("PC manager is closed");const $=V?q.pcManager.subscriber:q.pcManager.publisher,K=V?"Subscriber":"Publisher";if(!$)throw new ConnectionError("".concat(K," connection not set"),ConnectionErrorReason.InternalError);let X=!1;!V&&!q.dataChannelForKind(B,V)&&(q.createDataChannels(),X=!0),!X&&!V&&!q.pcManager.publisher.isICEConnected&&q.pcManager.publisher.getICEConnectionState()!=="checking"&&(X=!0),X&&q.negotiate();const Q=q.dataChannelForKind(B,V);if((Q==null?void 0:Q.readyState)==="open")return;const W=new Date().getTime()+q.peerConnectionTimeout;for(;new Date().getTime()<W;){if($.isICEConnected&&((H=q.dataChannelForKind(B,V))===null||H===void 0?void 0:H.readyState)==="open")return;yield sleep$1(50)}throw new ConnectionError("could not establish ".concat(K," connection, state: ").concat($.getICEConnectionState()),ConnectionErrorReason.InternalError)})()})}ensurePublisherConnected(j){return __awaiter$1(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(j,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==PCTransportState.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return __awaiter$1(this,void 0,void 0,function*(){return new Promise((j,B)=>__awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager){B(new NegotiationError("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const q=new AbortController,V=()=>{q.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),j()};this.isClosed&&B("cannot negotiate on closed engine"),this.on(EngineEvent.Closing,V),this.pcManager.publisher.once(PCEvents.RTPVideoPayloadTypes,H=>{const $=new Map;H.forEach(K=>{const X=K.codec.toLowerCase();isVideoCodec(X)&&$.set(K.payload,X)}),this.emit(EngineEvent.RTPVideoMapUpdate,$)});try{yield this.pcManager.negotiate(q),j()}catch(H){H instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ReconnectReason.RR_UNKNOWN),B(H)}finally{this.off(EngineEvent.Closing,V)}}))})}dataChannelForKind(j,B){if(B){if(j===DataPacket_Kind.LOSSY)return this.lossyDCSub;if(j===DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(j===DataPacket_Kind.LOSSY)return this.lossyDC;if(j===DataPacket_Kind.RELIABLE)return this.reliableDC}}sendSyncState(j,B){var q,V;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const H=this.pcManager.subscriber.getLocalDescription(),$=this.pcManager.subscriber.getRemoteDescription(),K=(V=(q=this.signalOpts)===null||q===void 0?void 0:q.autoSubscribe)!==null&&V!==void 0?V:!0,X=new Array,Q=new Array;j.forEach(W=>{W.isDesired!==K&&X.push(W.trackSid),W.isEnabled||Q.push(W.trackSid)}),this.client.sendSyncState(new SyncState({answer:H?toProtoSessionDescription({sdp:H.sdp,type:H.type}):void 0,offer:$?toProtoSessionDescription({sdp:$.sdp,type:$.type}):void 0,subscription:new UpdateSubscription({trackSids:X,subscribe:!K,participantTracks:[]}),publishTracks:getTrackPublicationInfo(B),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:Q}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const j=[],B=(q,V)=>{(q==null?void 0:q.id)!==void 0&&q.id!==null&&j.push(new DataChannelInfo({label:q.label,id:q.id,target:V}))};return B(this.dataChannelForKind(DataPacket_Kind.LOSSY),SignalTarget.PUBLISHER),B(this.dataChannelForKind(DataPacket_Kind.RELIABLE),SignalTarget.PUBLISHER),B(this.dataChannelForKind(DataPacket_Kind.LOSSY,!0),SignalTarget.SUBSCRIBER),B(this.dataChannelForKind(DataPacket_Kind.RELIABLE,!0),SignalTarget.SUBSCRIBER),j}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class SignalReconnectError extends Error{}function supportOptionalDatachannel(U){return U!==void 0&&U>13}function applyUserDataCompat(U,j){const B=U.participantIdentity?U.participantIdentity:j.participantIdentity;U.participantIdentity=B,j.participantIdentity=B;const q=U.destinationIdentities.length!==0?U.destinationIdentities:j.destinationIdentities;U.destinationIdentities=q,j.destinationIdentities=q}class RegionUrlProvider{constructor(j,B){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(j),this.token=B}updateToken(j){this.token=j}isCloud(){return isCloud(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(j){return __awaiter$1(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(j));const B=this.regionSettings.regions.filter(q=>!this.attemptedRegions.find(V=>V.url===q.url));if(B.length>0){const q=B[0];return this.attemptedRegions.push(q),livekitLogger.debug("next region: ".concat(q.region)),q.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(j){return __awaiter$1(this,void 0,void 0,function*(){const B=yield fetch("".concat(getCloudConfigUrl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:j});if(B.ok){const q=yield B.json();return this.lastUpdateAt=Date.now(),q}else throw new ConnectionError("Could not fetch region settings: ".concat(B.statusText),B.status===401?ConnectionErrorReason.NotAllowed:ConnectionErrorReason.InternalError,B.status)})}setServerReportedRegions(j){this.regionSettings=j,this.lastUpdateAt=Date.now()}}function getCloudConfigUrl(U){return"".concat(U.protocol.replace("ws","http"),"//").concat(U.host,"/settings")}class BaseStreamReader{get info(){return this._info}constructor(j,B,q){this.reader=B,this.totalByteSize=q,this._info=j,this.bytesReceived=0}}class ByteStreamReader extends BaseStreamReader{handleChunkReceived(j){var B;this.bytesReceived+=j.content.byteLength;const q=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(B=this.onProgress)===null||B===void 0||B.call(this,q)}[Symbol.asyncIterator](){const j=this.reader.getReader();return{next:()=>__awaiter$1(this,void 0,void 0,function*(){try{const{done:B,value:q}=yield j.read();return B?{done:!0,value:void 0}:(this.handleChunkReceived(q),{done:!1,value:q.content})}catch{return{done:!0,value:void 0}}}),return(){return __awaiter$1(this,void 0,void 0,function*(){return j.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return __awaiter$1(this,void 0,void 0,function*(){var j,B,q,V;let H=new Set;try{for(var $=!0,K=__asyncValues(this),X;X=yield K.next(),j=X.done,!j;$=!0){V=X.value,$=!1;const Q=V;H.add(Q)}}catch(Q){B={error:Q}}finally{try{!$&&!j&&(q=K.return)&&(yield q.call(K))}finally{if(B)throw B.error}}return Array.from(H)})}}class TextStreamReader extends BaseStreamReader{constructor(j,B,q){super(j,B,q),this.receivedChunks=new Map}handleChunkReceived(j){var B;const q=bigIntToNumber(j.chunkIndex),V=this.receivedChunks.get(q);if(V&&V.version>j.version)return;this.receivedChunks.set(q,j),this.bytesReceived+=j.content.byteLength;const H=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(B=this.onProgress)===null||B===void 0||B.call(this,H)}[Symbol.asyncIterator](){const j=this.reader.getReader(),B=new TextDecoder;return{next:()=>__awaiter$1(this,void 0,void 0,function*(){try{const{done:q,value:V}=yield j.read();return q?{done:!0,value:void 0}:(this.handleChunkReceived(V),{done:!1,value:B.decode(V.content)})}catch{return{done:!0,value:void 0}}}),return(){return __awaiter$1(this,void 0,void 0,function*(){return j.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return __awaiter$1(this,void 0,void 0,function*(){var j,B,q,V;let H="";try{for(var $=!0,K=__asyncValues(this),X;X=yield K.next(),j=X.done,!j;$=!0)V=X.value,$=!1,H+=V}catch(Q){B={error:Q}}finally{try{!$&&!j&&(q=K.return)&&(yield q.call(K))}finally{if(B)throw B.error}}return H})}}class BaseStreamWriter{constructor(j,B,q){this.writableStream=j,this.defaultWriter=j.getWriter(),this.onClose=q,this.info=B}write(j){return this.defaultWriter.write(j)}close(){return __awaiter$1(this,void 0,void 0,function*(){var j;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(j=this.onClose)===null||j===void 0||j.call(this)})}}class TextStreamWriter extends BaseStreamWriter{}class ByteStreamWriter extends BaseStreamWriter{}class RemoteTrack extends Track{constructor(j,B,q,V,H){super(j,q,H),this.sid=B,this.receiver=V}get isLocal(){return!1}setMuted(j){this.isMuted!==j&&(this.isMuted=j,this._mediaStreamTrack.enabled=!j,this.emit(j?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(j){this.mediaStream=j;const B=q=>{q.track===this._mediaStreamTrack&&(j.removeEventListener("removetrack",B),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this))};j.addEventListener("removetrack",B)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return __awaiter$1(this,void 0,void 0,function*(){var j;return!((j=this.receiver)===null||j===void 0)&&j.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(j){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=j:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency)),supportsSynchronizationSources()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const j=()=>{var B;this.timeSyncHandle=requestAnimationFrame(()=>j());const q=(B=this.receiver)===null||B===void 0?void 0:B.getSynchronizationSources()[0];if(q){const{timestamp:V,rtpTimestamp:H}=q;H&&this.rtpTimestamp!==H&&(this.emit(TrackEvent.TimeSyncUpdate,{timestamp:V,rtpTimestamp:H}),this.rtpTimestamp=H)}};j()}}class RemoteAudioTrack extends RemoteTrack{constructor(j,B,q,V,H,$){super(j,B,Track.Kind.Audio,q,$),this.monitorReceiver=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const K=yield this.getReceiverStats();K&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(K,this.prevStats)),this.prevStats=K}),this.audioContext=V,this.webAudioPluginNodes=[],H&&(this.sinkId=H.deviceId)}setVolume(j){var B;for(const q of this.attachedElements)this.audioContext?(B=this.gainNode)===null||B===void 0||B.gain.setTargetAtTime(j,0,.1):q.volume=j;isReactNative()&&this._mediaStreamTrack._setVolume(j),this.elementVolume=j}getVolume(){if(this.elementVolume)return this.elementVolume;if(isReactNative())return 1;let j=0;return this.attachedElements.forEach(B=>{B.volume>j&&(j=B.volume)}),j}setSinkId(j){return __awaiter$1(this,void 0,void 0,function*(){this.sinkId=j,yield Promise.all(this.attachedElements.map(B=>{if(supportsSetSinkId(B))return B.setSinkId(j)}))})}attach(j){const B=this.attachedElements.length===0;return j?super.attach(j):j=super.attach(),this.sinkId&&supportsSetSinkId(j)&&j.setSinkId(this.sinkId),this.audioContext&&B&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,j),j.volume=0,j.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),j}detach(j){let B;return j?(B=super.detach(j),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(B=super.detach(),this.disconnectWebAudio()),B}setAudioContext(j){this.audioContext=j,j&&this.attachedElements.length>0?this.connectWebAudio(j,this.attachedElements[0]):j||this.disconnectWebAudio()}setWebAudioPlugins(j){this.webAudioPluginNodes=j,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(j,B){this.disconnectWebAudio(),this.sourceNode=j.createMediaStreamSource(B.srcObject);let q=this.sourceNode;this.webAudioPluginNodes.forEach(V=>{q.connect(V),q=V}),this.gainNode=j.createGain(),q.connect(this.gainNode),this.gainNode.connect(j.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),j.state!=="running"&&j.resume().then(()=>{j.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(V=>{this.emit(TrackEvent.AudioPlaybackFailed,V)})}disconnectWebAudio(){var j,B;(j=this.gainNode)===null||j===void 0||j.disconnect(),(B=this.sourceNode)===null||B===void 0||B.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return __awaiter$1(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const j=yield this.receiver.getStats();let B;return j.forEach(q=>{q.type==="inbound-rtp"&&(B={type:"audio",streamId:q.id,timestamp:q.timestamp,jitter:q.jitter,bytesReceived:q.bytesReceived,concealedSamples:q.concealedSamples,concealmentEvents:q.concealmentEvents,silentConcealedSamples:q.silentConcealedSamples,silentConcealmentEvents:q.silentConcealmentEvents,totalAudioEnergy:q.totalAudioEnergy,totalSamplesDuration:q.totalSamplesDuration})}),B})}}const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(j,B,q,V,H){super(j,B,Track.Kind.Video,q,H),this.elementInfos=[],this.monitorReceiver=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const $=yield this.getReceiverStats();$&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate($,this.prevStats)),this.prevStats=$}),this.debouncedHandleResize=r$1(()=>{this.updateDimensions()},REACTION_DELAY),this.adaptiveStreamSettings=V}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(j){super.setMuted(j),this.attachedElements.forEach(B=>{j?detachTrack(this._mediaStreamTrack,B):attachToElement(this._mediaStreamTrack,B)})}attach(j){if(j?super.attach(j):j=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(B=>B.element===j)===void 0){const B=new HTMLElementInfo(j);this.observeElementInfo(B)}return j}observeElementInfo(j){this.adaptiveStreamSettings&&this.elementInfos.find(B=>B===j)===void 0?(j.handleResize=()=>{this.debouncedHandleResize()},j.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(j),j.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(j){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const B=this.elementInfos.filter(q=>q===j);for(const q of B)q.stopObserving();this.elementInfos=this.elementInfos.filter(q=>q!==j),this.updateVisibility(),this.debouncedHandleResize()}detach(j){let B=[];if(j)return this.stopObservingElement(j),super.detach(j);B=super.detach();for(const q of B)this.stopObservingElement(q);return B}getDecoderImplementation(){var j;return(j=this.prevStats)===null||j===void 0?void 0:j.decoderImplementation}getReceiverStats(){return __awaiter$1(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const j=yield this.receiver.getStats();let B,q="",V=new Map;return j.forEach(H=>{H.type==="inbound-rtp"?(q=H.codecId,B={type:"video",streamId:H.id,framesDecoded:H.framesDecoded,framesDropped:H.framesDropped,framesReceived:H.framesReceived,packetsReceived:H.packetsReceived,packetsLost:H.packetsLost,frameWidth:H.frameWidth,frameHeight:H.frameHeight,pliCount:H.pliCount,firCount:H.firCount,nackCount:H.nackCount,jitter:H.jitter,timestamp:H.timestamp,bytesReceived:H.bytesReceived,decoderImplementation:H.decoderImplementation}):H.type==="codec"&&V.set(H.id,H)}),B&&q!==""&&V.get(q)&&(B.mimeType=V.get(q).mimeType),B})}stopObservingElement(j){const B=this.elementInfos.filter(q=>q.element===j);for(const q of B)this.stopObservingElementInfo(q)}handleAppVisibilityChanged(){const j=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter$1(this,void 0,void 0,function*(){yield j.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var j,B;const q=this.elementInfos.reduce((K,X)=>Math.max(K,X.visibilityChangedAt||0),0),V=!((B=(j=this.adaptiveStreamSettings)===null||j===void 0?void 0:j.pauseVideoInBackground)!==null&&B!==void 0)||B?this.isInBackground:!1,H=this.elementInfos.some(K=>K.pictureInPicture),$=this.elementInfos.some(K=>K.visible)&&!V||H;if(this.lastVisible!==$){if(!$&&Date.now()-q<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=$,this.emit(TrackEvent.VisibilityChanged,$,this)}}updateDimensions(){var j,B;let q=0,V=0;const H=this.getPixelDensity();for(const $ of this.elementInfos){const K=$.width()*H,X=$.height()*H;K+X>q+V&&(q=K,V=X)}((j=this.lastDimensions)===null||j===void 0?void 0:j.width)===q&&((B=this.lastDimensions)===null||B===void 0?void 0:B.height)===V||(this.lastDimensions={width:q,height:V},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var j;const B=(j=this.adaptiveStreamSettings)===null||j===void 0?void 0:j.pixelDensity;return B==="screen"?getDevicePixelRatio():B||(getDevicePixelRatio()>2?2:1)}}class HTMLElementInfo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(j,B){this.onVisibilityChanged=q=>{var V;const{target:H,isIntersecting:$}=q;H===this.element&&(this.isIntersecting=$,this.isPiP=isElementInPiP(this.element),this.visibilityChangedAt=Date.now(),(V=this.handleVisibilityChanged)===null||V===void 0||V.call(this))},this.onEnterPiP=()=>{var q,V,H;(V=(q=window.documentPictureInPicture)===null||q===void 0?void 0:q.window)===null||V===void 0||V.addEventListener("pagehide",this.onLeavePiP),this.isPiP=isElementInPiP(this.element),(H=this.handleVisibilityChanged)===null||H===void 0||H.call(this)},this.onLeavePiP=()=>{var q;this.isPiP=isElementInPiP(this.element),(q=this.handleVisibilityChanged)===null||q===void 0||q.call(this)},this.element=j,this.isIntersecting=B??isElementInViewport(j),this.isPiP=isWeb()&&isElementInPiP(j),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var j,B,q;this.isIntersecting=isElementInViewport(this.element),this.isPiP=isElementInPiP(this.element),this.element.handleResize=()=>{var V;(V=this.handleResize)===null||V===void 0||V.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(j=window.documentPictureInPicture)===null||j===void 0||j.addEventListener("enter",this.onEnterPiP),(q=(B=window.documentPictureInPicture)===null||B===void 0?void 0:B.window)===null||q===void 0||q.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var j,B,q,V,H;(j=getIntersectionObserver())===null||j===void 0||j.unobserve(this.element),(B=getResizeObserver())===null||B===void 0||B.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(q=window.documentPictureInPicture)===null||q===void 0||q.removeEventListener("enter",this.onEnterPiP),(H=(V=window.documentPictureInPicture)===null||V===void 0?void 0:V.window)===null||H===void 0||H.removeEventListener("pagehide",this.onLeavePiP)}}function isElementInPiP(U){var j,B;return document.pictureInPictureElement===U?!0:!((j=window.documentPictureInPicture)===null||j===void 0)&&j.window?isElementInViewport(U,(B=window.documentPictureInPicture)===null||B===void 0?void 0:B.window):!1}function isElementInViewport(U,j){const B=j||window;let q=U.offsetTop,V=U.offsetLeft;const H=U.offsetWidth,$=U.offsetHeight,{hidden:K}=U,{display:X}=getComputedStyle(U);for(;U.offsetParent;)U=U.offsetParent,q+=U.offsetTop,V+=U.offsetLeft;return q<B.pageYOffset+B.innerHeight&&V<B.pageXOffset+B.innerWidth&&q+$>B.pageYOffset&&V+H>B.pageXOffset&&!K&&X!=="none"}class TrackPublication extends eventsExports.EventEmitter{constructor(j,B,q,V){var H;super(),this.metadataMuted=!1,this.encryption=Encryption_Type.NONE,this.log=livekitLogger,this.handleMuted=()=>{this.emit(TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(TrackEvent.Unmuted)},this.log=getLogger((H=V==null?void 0:V.loggerName)!==null&&H!==void 0?H:LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=j,this.trackSid=B,this.trackName=q,this.source=Track.Source.Unknown}setTrack(j){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=j,j&&(j.on(TrackEvent.Muted,this.handleMuted),j.on(TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var j;return Object.assign(Object.assign({},(j=this.loggerContextCb)===null||j===void 0?void 0:j.call(this)),getLogContextFromTrack(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Encryption_Type.NONE}get audioTrack(){if(isAudioTrack(this.track))return this.track}get videoTrack(){if(isVideoTrack(this.track))return this.track}updateInfo(j){this.trackSid=j.sid,this.trackName=j.name,this.source=Track.sourceFromProto(j.source),this.mimeType=j.mimeType,this.kind===Track.Kind.Video&&j.width>0&&(this.dimensions={width:j.width,height:j.height},this.simulcasted=j.simulcast),this.encryption=j.encryption,this.trackInfo=j,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:j}))}}(function(U){(function(j){j.Desired="desired",j.Subscribed="subscribed",j.Unsubscribed="unsubscribed"})(U.SubscriptionStatus||(U.SubscriptionStatus={})),(function(j){j.Allowed="allowed",j.NotAllowed="not_allowed"})(U.PermissionStatus||(U.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{get isUpstreamPaused(){var j;return(j=this.track)===null||j===void 0?void 0:j.isUpstreamPaused}constructor(j,B,q,V){super(j,B.sid,B.name,V),this.track=void 0,this.handleTrackEnded=()=>{this.emit(TrackEvent.Ended)},this.updateInfo(B),this.setTrack(q)}setTrack(j){this.track&&this.track.off(TrackEvent.Ended,this.handleTrackEnded),super.setTrack(j),j&&j.on(TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return __awaiter$1(this,void 0,void 0,function*(){var j;return(j=this.track)===null||j===void 0?void 0:j.mute()})}unmute(){return __awaiter$1(this,void 0,void 0,function*(){var j;return(j=this.track)===null||j===void 0?void 0:j.unmute()})}pauseUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var j;yield(j=this.track)===null||j===void 0?void 0:j.pauseUpstream()})}resumeUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var j;yield(j=this.track)===null||j===void 0?void 0:j.resumeUpstream()})}getTrackFeatures(){var j;if(isAudioTrack(this.track)){const B=this.track.getSourceTrackSettings(),q=new Set;return B.autoGainControl&&q.add(AudioTrackFeature.TF_AUTO_GAIN_CONTROL),B.echoCancellation&&q.add(AudioTrackFeature.TF_ECHO_CANCELLATION),B.noiseSuppression&&q.add(AudioTrackFeature.TF_NOISE_SUPPRESSION),B.channelCount&&B.channelCount>1&&q.add(AudioTrackFeature.TF_STEREO),!((j=this.options)===null||j===void 0)&&j.dtx||q.add(AudioTrackFeature.TF_NO_DTX),this.track.enhancedNoiseCancellation&&q.add(AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION),Array.from(q.values())}else return[]}}function createLocalTracks(U,j){return __awaiter$1(this,void 0,void 0,function*(){U??(U={});let B=!1;const{audioProcessor:q,videoProcessor:V,optionsWithoutProcessor:H}=extractProcessorsFromOptions(U);let $=H.audio,K=H.video;if(q&&typeof H.audio=="object"&&(H.audio.processor=q),V&&typeof H.video=="object"&&(H.video.processor=V),U.audio&&typeof H.audio=="object"&&typeof H.audio.deviceId=="string"){const Z=H.audio.deviceId;H.audio.deviceId={exact:Z},B=!0,$=Object.assign(Object.assign({},H.audio),{deviceId:{ideal:Z}})}if(H.video&&typeof H.video=="object"&&typeof H.video.deviceId=="string"){const Z=H.video.deviceId;H.video.deviceId={exact:Z},B=!0,K=Object.assign(Object.assign({},H.video),{deviceId:{ideal:Z}})}(H.audio===!0||typeof H.audio=="object"&&!H.audio.deviceId)&&(H.audio={deviceId:"default"}),(H.video===!0||typeof H.video=="object"&&!H.video.deviceId)&&(H.video={deviceId:"default"});const X=mergeDefaultOptions(H,audioDefaults,videoDefaults),Q=constraintsForOptions(X),W=navigator.mediaDevices.getUserMedia(Q);H.audio&&(DeviceManager.userMediaPromiseMap.set("audioinput",W),W.catch(()=>DeviceManager.userMediaPromiseMap.delete("audioinput"))),H.video&&(DeviceManager.userMediaPromiseMap.set("videoinput",W),W.catch(()=>DeviceManager.userMediaPromiseMap.delete("videoinput")));try{const Z=yield W;return yield Promise.all(Z.getTracks().map(te=>__awaiter$1(this,void 0,void 0,function*(){const ie=te.kind==="audio";let ae=ie?X.audio:X.video;(typeof ae=="boolean"||!ae)&&(ae={});let oe;const de=ie?Q.audio:Q.video;typeof de!="boolean"&&(oe=de);const le=te.getSettings().deviceId;oe!=null&&oe.deviceId&&unwrapConstraint(oe.deviceId)!==le?oe.deviceId=le:oe||(oe={deviceId:le});const ue=mediaTrackToLocalTrack(te,oe,j);return ue.kind===Track.Kind.Video?ue.source=Track.Source.Camera:ue.kind===Track.Kind.Audio&&(ue.source=Track.Source.Microphone),ue.mediaStream=Z,isAudioTrack(ue)&&q?yield ue.setProcessor(q):isVideoTrack(ue)&&V&&(yield ue.setProcessor(V)),ue})))}catch(Z){if(!B)throw Z;return createLocalTracks(Object.assign(Object.assign({},U),{audio:$,video:K}),j)}})}function createLocalVideoTrack(U){return __awaiter$1(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:!1,video:!0}))[0]})}function createLocalAudioTrack(U){return __awaiter$1(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:U??!0,video:!1}))[0]})}var ConnectionQuality$2;(function(U){U.Excellent="excellent",U.Good="good",U.Poor="poor",U.Lost="lost",U.Unknown="unknown"})(ConnectionQuality$2||(ConnectionQuality$2={}));function qualityFromProto(U){switch(U){case ConnectionQuality$1.EXCELLENT:return ConnectionQuality$2.Excellent;case ConnectionQuality$1.GOOD:return ConnectionQuality$2.Good;case ConnectionQuality$1.POOR:return ConnectionQuality$2.Poor;case ConnectionQuality$1.LOST:return ConnectionQuality$2.Lost;default:return ConnectionQuality$2.Unknown}}class Participant extends eventsExports.EventEmitter{get logContext(){var j,B;return Object.assign({},(B=(j=this.loggerOptions)===null||j===void 0?void 0:j.loggerContextCb)===null||B===void 0?void 0:B.call(j))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(j=>j.isEncrypted)}get isAgent(){var j;return((j=this.permissions)===null||j===void 0?void 0:j.agent)||this.kind===ParticipantInfo_Kind.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(j,B,q,V,H,$){let K=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ParticipantInfo_Kind.STANDARD;var X;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ConnectionQuality$2.Unknown,this.log=livekitLogger,this.log=getLogger((X=$==null?void 0:$.loggerName)!==null&&X!==void 0?X:LoggerNames.Participant),this.loggerOptions=$,this.setMaxListeners(100),this.sid=j,this.identity=B,this.name=q,this.metadata=V,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=K,this._attributes=H??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(j){for(const[,B]of this.trackPublications)if(B.source===j)return B}getTrackPublicationByName(j){for(const[,B]of this.trackPublications)if(B.trackName===j)return B}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var j;const B=this.getTrackPublication(Track.Source.Camera);return!(!((j=B==null?void 0:B.isMuted)!==null&&j!==void 0)||j)}get isMicrophoneEnabled(){var j;const B=this.getTrackPublication(Track.Source.Microphone);return!(!((j=B==null?void 0:B.isMuted)!==null&&j!==void 0)||j)}get isScreenShareEnabled(){return!!this.getTrackPublication(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(j){return this.participantInfo&&this.participantInfo.sid===j.sid&&this.participantInfo.version>j.version?!1:(this.identity=j.identity,this.sid=j.sid,this._setName(j.name),this._setMetadata(j.metadata),this._setAttributes(j.attributes),j.permission&&this.setPermissions(j.permission),this.participantInfo=j,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:j})),!0)}_setMetadata(j){const B=this.metadata!==j,q=this.metadata;this.metadata=j,B&&this.emit(ParticipantEvent.ParticipantMetadataChanged,q)}_setName(j){const B=this.name!==j;this.name=j,B&&this.emit(ParticipantEvent.ParticipantNameChanged,j)}_setAttributes(j){const B=diffAttributes(this.attributes,j);this._attributes=j,Object.keys(B).length>0&&this.emit(ParticipantEvent.AttributesChanged,B)}setPermissions(j){var B,q,V,H,$,K;const X=this.permissions,Q=j.canPublish!==((B=this.permissions)===null||B===void 0?void 0:B.canPublish)||j.canSubscribe!==((q=this.permissions)===null||q===void 0?void 0:q.canSubscribe)||j.canPublishData!==((V=this.permissions)===null||V===void 0?void 0:V.canPublishData)||j.hidden!==((H=this.permissions)===null||H===void 0?void 0:H.hidden)||j.recorder!==(($=this.permissions)===null||$===void 0?void 0:$.recorder)||j.canPublishSources.length!==this.permissions.canPublishSources.length||j.canPublishSources.some((W,Z)=>{var te;return W!==((te=this.permissions)===null||te===void 0?void 0:te.canPublishSources[Z])})||j.canSubscribeMetrics!==((K=this.permissions)===null||K===void 0?void 0:K.canSubscribeMetrics);return this.permissions=j,Q&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,X),Q}setIsSpeaking(j){j!==this.isSpeaking&&(this.isSpeaking=j,j&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,j))}setConnectionQuality(j){const B=this._connectionQuality;this._connectionQuality=qualityFromProto(j),B!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(j){this.audioContext=j,this.audioTrackPublications.forEach(B=>isAudioTrack(B.track)&&B.track.setAudioContext(j))}addTrackPublication(j){j.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,j)}),j.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,j)});const B=j;switch(B.track&&(B.track.sid=j.trackSid),this.trackPublications.set(j.trackSid,j),j.kind){case Track.Kind.Audio:this.audioTrackPublications.set(j.trackSid,j);break;case Track.Kind.Video:this.videoTrackPublications.set(j.trackSid,j);break}}}function trackPermissionToProto(U){var j,B,q;if(!U.participantSid&&!U.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new TrackPermission({participantIdentity:(j=U.participantIdentity)!==null&&j!==void 0?j:"",participantSid:(B=U.participantSid)!==null&&B!==void 0?B:"",allTracks:(q=U.allowAll)!==null&&q!==void 0?q:!1,trackSids:U.allowedTrackSids||[]})}const STREAM_CHUNK_SIZE=15e3;class LocalParticipant extends Participant{constructor(j,B,q,V,H){super(j,B,void 0,void 0,void 0,{loggerName:V.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Encryption_Type.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Future)},this.handleReconnected=()=>{var $,K;(K=($=this.reconnectFuture)===null||$===void 0?void 0:$.resolve)===null||K===void 0||K.call($),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var $,K;this.reconnectFuture&&(this.reconnectFuture.promise.catch(X=>this.log.warn(X.message,this.logContext)),(K=($=this.reconnectFuture)===null||$===void 0?void 0:$.reject)===null||K===void 0||K.call($,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=$=>{const{requestId:K,reason:X,message:Q}=$,W=this.pendingSignalRequests.get(K);W&&(X!==RequestResponse_Reason.OK&&W.reject(new SignalRequestError(Q,X)),this.pendingSignalRequests.delete(K))},this.handleDataPacket=$=>{switch($.value.case){case"rpcResponse":let K=$.value.value,X=null,Q=null;K.value.case==="payload"?X=K.value.value:K.value.case==="error"&&(Q=RpcError.fromProto(K.value.value)),this.handleIncomingRpcResponse(K.requestId,X,Q);break;case"rpcAck":let W=$.value.value;this.handleIncomingRpcAck(W.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map($=>trackPermissionToProto($)))},this.onTrackUnmuted=$=>{this.onTrackMuted($,$.isUpstreamPaused)},this.onTrackMuted=($,K)=>{if(K===void 0&&(K=!0),!$.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($)));return}this.engine.updateMuteStatus($.sid,K)},this.onTrackUpstreamPaused=$=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),this.onTrackMuted($,!0)},this.onTrackUpstreamResumed=$=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),this.onTrackMuted($,$.isMuted)},this.onTrackFeatureUpdate=$=>{const K=this.audioTrackPublications.get($.sid);if(!K){this.log.warn("Could not update local audio track settings, missing publication for track ".concat($.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(K.trackSid,K.getTrackFeatures())},this.handleSubscribedQualityUpdate=$=>__awaiter$1(this,void 0,void 0,function*(){var K,X,Q,W,Z,te;if(!(!((Z=this.roomOptions)===null||Z===void 0)&&Z.dynacast))return;const ie=this.videoTrackPublications.get($.trackSid);if(!ie){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:$.trackSid}));return}if($.subscribedCodecs.length>0){if(!ie.videoTrack)return;const le=yield ie.videoTrack.setPublishingCodecs($.subscribedCodecs);try{for(var ae=!0,oe=__asyncValues(le),de;de=yield oe.next(),K=de.done,!K;ae=!0){W=de.value,ae=!1;const ue=W;isBackupCodec(ue)&&(this.log.debug("publish ".concat(ue," for ").concat(ie.videoTrack.sid),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(ie))),yield this.publishAdditionalCodecForTrack(ie.videoTrack,ue,ie.options))}}catch(ue){X={error:ue}}finally{try{!ae&&!K&&(Q=oe.return)&&(yield Q.call(oe))}finally{if(X)throw X.error}}}else $.subscribedQualities.length>0&&(yield(te=ie.videoTrack)===null||te===void 0?void 0:te.setPublishingLayers($.subscribedQualities))}),this.handleLocalTrackUnpublished=$=>{const K=this.trackPublications.get($.trackSid);if(!K){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:$.trackSid}));return}this.unpublishTrack(K.track)},this.handleTrackEnded=$=>__awaiter$1(this,void 0,void 0,function*(){if($.source===Track.Source.ScreenShare||$.source===Track.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),this.unpublishTrack($);else if($.isUserProvided)yield $.mute();else if(isLocalAudioTrack($)||isLocalVideoTrack($))try{if(isWeb())try{const K=yield navigator==null?void 0:navigator.permissions.query({name:$.source===Track.Source.Camera?"camera":"microphone"});if(K&&K.state==="denied")throw this.log.warn("user has revoked access to ".concat($.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),K.onchange=()=>{K.state!=="denied"&&($.isMuted||$.restartTrack(),K.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}$.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),isLocalAudioTrack($)?yield $.restartTrack({deviceId:"default"}):yield $.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),yield $.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=q,this.roomOptions=V,this.setupEngine(q),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=H}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Encryption_Type.NONE}getTrackPublication(j){const B=super.getTrackPublication(j);if(B)return B}getTrackPublicationByName(j){const B=super.getTrackPublicationByName(j);if(B)return B}setupEngine(j){this.engine=j,this.engine.on(EngineEvent.RemoteMute,(B,q)=>{const V=this.trackPublications.get(B);!V||!V.track||(q?V.mute():V.unmute())}),this.engine.on(EngineEvent.Connected,this.handleReconnected).on(EngineEvent.SignalRestarted,this.handleReconnected).on(EngineEvent.SignalResumed,this.handleReconnected).on(EngineEvent.Restarting,this.handleReconnecting).on(EngineEvent.Resuming,this.handleReconnecting).on(EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(EngineEvent.Disconnected,this.handleDisconnected).on(EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse).on(EngineEvent.DataPacketReceived,this.handleDataPacket)}setMetadata(j){return __awaiter$1(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:j})})}setName(j){return __awaiter$1(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:j})})}setAttributes(j){return __awaiter$1(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:j})})}requestMetadataUpdate(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let{metadata:V,name:H,attributes:$}=B;return(function*(){return new Promise((K,X)=>__awaiter$1(q,void 0,void 0,function*(){var Q,W;try{let Z=!1;const te=yield this.engine.client.sendUpdateLocalMetadata((Q=V??this.metadata)!==null&&Q!==void 0?Q:"",(W=H??this.name)!==null&&W!==void 0?W:"",$),ie=performance.now();for(this.pendingSignalRequests.set(te,{resolve:K,reject:ae=>{X(ae),Z=!0},values:{name:H,metadata:V,attributes:$}});performance.now()-ie<5e3&&!Z;){if((!H||this.name===H)&&(!V||this.metadata===V)&&(!$||Object.entries($).every(ae=>{let[oe,de]=ae;return this.attributes[oe]===de||de===""&&!this.attributes[oe]}))){this.pendingSignalRequests.delete(te),K();return}yield sleep$1(50)}X(new SignalRequestError("Request to update local metadata timed out","TimeoutError"))}catch(Z){Z instanceof Error&&X(Z)}}))})()})}setCameraEnabled(j,B,q){return this.setTrackEnabled(Track.Source.Camera,j,B,q)}setMicrophoneEnabled(j,B,q){return this.setTrackEnabled(Track.Source.Microphone,j,B,q)}setScreenShareEnabled(j,B,q){return this.setTrackEnabled(Track.Source.ScreenShare,j,B,q)}setPermissions(j){const B=this.permissions,q=super.setPermissions(j);return q&&B&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,B),q}setE2EEEnabled(j){return __awaiter$1(this,void 0,void 0,function*(){this.encryptionType=j?Encryption_Type.GCM:Encryption_Type.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(j,B,q,V){return __awaiter$1(this,void 0,void 0,function*(){var H,$;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:j,enabled:B})),this.republishPromise&&(yield this.republishPromise);let K=this.getTrackPublication(j);if(B)if(K)yield K.unmute();else{let X;if(this.pendingPublishing.has(j)){const Q=yield this.waitForPendingPublicationOfSource(j);return Q||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:j})),yield Q==null?void 0:Q.unmute(),Q}this.pendingPublishing.add(j);try{switch(j){case Track.Source.Camera:X=yield this.createTracks({video:(H=q)!==null&&H!==void 0?H:!0});break;case Track.Source.Microphone:X=yield this.createTracks({audio:($=q)!==null&&$!==void 0?$:!0});break;case Track.Source.ScreenShare:X=yield this.createScreenTracks(Object.assign({},q));break;default:throw new TrackInvalidError(j)}}catch(Q){throw X==null||X.forEach(W=>{W.stop()}),Q instanceof Error&&this.emit(ParticipantEvent.MediaDevicesError,Q),this.pendingPublishing.delete(j),Q}try{const Q=[];for(const Z of X)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(Z))),Q.push(this.publishTrack(Z,V));[K]=yield Promise.all(Q)}catch(Q){throw X==null||X.forEach(W=>{W.stop()}),Q}finally{this.pendingPublishing.delete(j)}}else if(!(K!=null&&K.track)&&this.pendingPublishing.has(j)&&(K=yield this.waitForPendingPublicationOfSource(j),K||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:j}))),K&&K.track)if(j===Track.Source.ScreenShare){K=yield this.unpublishTrack(K.track);const X=this.getTrackPublication(Track.Source.ScreenShareAudio);X&&X.track&&this.unpublishTrack(X.track)}else yield K.mute();return K})}enableCameraAndMicrophone(){return __awaiter$1(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const j=yield this.createTracks({audio:!0,video:!0});yield Promise.all(j.map(B=>this.publishTrack(B)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}})}createTracks(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q;j??(j={});const V=mergeDefaultOptions(j,(B=this.roomOptions)===null||B===void 0?void 0:B.audioCaptureDefaults,(q=this.roomOptions)===null||q===void 0?void 0:q.videoCaptureDefaults);try{return(yield createLocalTracks(V,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(K=>(isAudioTrack(K)&&(this.microphoneError=void 0,K.setAudioContext(this.audioContext),K.source=Track.Source.Microphone,this.emit(ParticipantEvent.AudioStreamAcquired)),isVideoTrack(K)&&(this.cameraError=void 0,K.source=Track.Source.Camera),K))}catch(H){throw H instanceof Error&&(j.audio&&(this.microphoneError=H),j.video&&(this.cameraError=H)),H}})}createScreenTracks(j){return __awaiter$1(this,void 0,void 0,function*(){if(j===void 0&&(j={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");j.resolution===void 0&&!isSafari17()&&(j.resolution=ScreenSharePresets.h1080fps30.resolution);const B=screenCaptureToDisplayMediaStreamOptions(j),q=yield navigator.mediaDevices.getDisplayMedia(B),V=q.getVideoTracks();if(V.length===0)throw new TrackInvalidError("no video track found");const H=new LocalVideoTrack(V[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});H.source=Track.Source.ScreenShare,j.contentHint&&(H.mediaStreamTrack.contentHint=j.contentHint);const $=[H];if(q.getAudioTracks().length>0){this.emit(ParticipantEvent.AudioStreamAcquired);const K=new LocalAudioTrack(q.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});K.source=Track.Source.ScreenShareAudio,$.push(K)}return $})}publishTrack(j,B){return __awaiter$1(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(j,B)})}publishOrRepublishTrack(j,B){return __awaiter$1(this,arguments,void 0,function(q,V){var H=this;let $=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var K,X,Q,W;isLocalAudioTrack(q)&&q.setAudioContext(H.audioContext),yield(K=H.reconnectFuture)===null||K===void 0?void 0:K.promise,H.republishPromise&&!$&&(yield H.republishPromise),isLocalTrack(q)&&H.pendingPublishPromises.has(q)&&(yield H.pendingPublishPromises.get(q));let Z;if(q instanceof MediaStreamTrack)Z=q.getConstraints();else{Z=q.constraints;let le;switch(q.source){case Track.Source.Microphone:le="audioinput";break;case Track.Source.Camera:le="videoinput"}le&&H.activeDeviceMap.has(le)&&(Z=Object.assign(Object.assign({},Z),{deviceId:H.activeDeviceMap.get(le)}))}if(q instanceof MediaStreamTrack)switch(q.kind){case"audio":q=new LocalAudioTrack(q,Z,!0,H.audioContext,{loggerName:H.roomOptions.loggerName,loggerContextCb:()=>H.logContext});break;case"video":q=new LocalVideoTrack(q,Z,!0,{loggerName:H.roomOptions.loggerName,loggerContextCb:()=>H.logContext});break;default:throw new TrackInvalidError("unsupported MediaStreamTrack kind ".concat(q.kind))}else q.updateLoggerOptions({loggerName:H.roomOptions.loggerName,loggerContextCb:()=>H.logContext});let te;if(H.trackPublications.forEach(le=>{le.track&&le.track===q&&(te=le)}),te)return H.log.warn("track has already been published, skipping",Object.assign(Object.assign({},H.logContext),getLogContextFromTrack(te))),te;const ie="channelCount"in q.mediaStreamTrack.getSettings()&&q.mediaStreamTrack.getSettings().channelCount===2||q.mediaStreamTrack.getConstraints().channelCount===2,ae=(X=V==null?void 0:V.forceStereo)!==null&&X!==void 0?X:ie;ae&&(V||(V={}),V.dtx===void 0&&H.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},H.logContext),getLogContextFromTrack(q))),V.red===void 0&&H.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(Q=V.dtx)!==null&&Q!==void 0||(V.dtx=!1),(W=V.red)!==null&&W!==void 0||(V.red=!1));const oe=Object.assign(Object.assign({},H.roomOptions.publishDefaults),V);!isE2EESimulcastSupported()&&H.roomOptions.e2ee&&(H.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},H.logContext)),oe.simulcast=!1),oe.source&&(q.source=oe.source);const de=new Promise((le,ue)=>__awaiter$1(H,void 0,void 0,function*(){try{if(this.engine.client.currentState!==SignalConnectionState.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:getLogContextFromTrack(q)}));const he=()=>__awaiter$1(this,void 0,void 0,function*(){try{const me=yield this.publish(q,oe,ae);le(me)}catch(me){ue(me)}});setTimeout(()=>{this.engine.off(EngineEvent.SignalConnected,he),ue(new PublishTrackError("publishing rejected as engine not connected within timeout",408))},15e3),this.engine.once(EngineEvent.SignalConnected,he),this.engine.on(EngineEvent.Closing,()=>{this.engine.off(EngineEvent.SignalConnected,he),ue(new PublishTrackError("publishing rejected as engine closed",499))})}else try{const he=yield this.publish(q,oe,ae);le(he)}catch(he){ue(he)}}catch(he){ue(he)}}));H.pendingPublishPromises.set(q,de);try{return yield de}catch(le){throw le}finally{H.pendingPublishPromises.delete(q)}})()})}hasPermissionsToPublish(j){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j))),!1;const{canPublish:B,canPublishSources:q}=this.permissions;return B&&(q.length===0||q.map(V=>getTrackSourceFromProto(V)).includes(j.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j))),!1)}publish(j,B,q){return __awaiter$1(this,void 0,void 0,function*(){var V,H,$,K,X,Q,W,Z,te,ie;if(!this.hasPermissionsToPublish(j))throw new PublishTrackError("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(be=>isLocalTrack(j)&&be.source===j.source)&&j.source!==Track.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(j.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j))),B.stopMicTrackOnMute&&isAudioTrack(j)&&(j.stopOnMute=!0),j.source===Track.Source.ScreenShare&&isFireFox()&&(B.simulcast=!1),B.videoCodec==="av1"&&!supportsAV1()&&(B.videoCodec=void 0),B.videoCodec==="vp9"&&!supportsVP9()&&(B.videoCodec=void 0),B.videoCodec===void 0&&(B.videoCodec=defaultVideoCodec),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(be=>B.videoCodec===mimeTypeToVideoCodecString(be.mime))||(B.videoCodec=mimeTypeToVideoCodecString(this.enabledPublishVideoCodecs[0].mime)));const oe=B.videoCodec;j.on(TrackEvent.Muted,this.onTrackMuted),j.on(TrackEvent.Unmuted,this.onTrackUnmuted),j.on(TrackEvent.Ended,this.handleTrackEnded),j.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),j.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),j.on(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const de=new AddTrackRequest({cid:j.mediaStreamTrack.id,name:B.name,type:Track.kindToProto(j.kind),muted:j.isMuted,source:Track.sourceToProto(j.source),disableDtx:!(!((V=B.dtx)!==null&&V!==void 0)||V),encryption:this.encryptionType,stereo:q,disableRed:this.isE2EEEnabled||!(!((H=B.red)!==null&&H!==void 0)||H),stream:B==null?void 0:B.stream,backupCodecPolicy:B==null?void 0:B.backupCodecPolicy});let le;if(j.kind===Track.Kind.Video){let be={width:0,height:0};try{be=yield j.waitForDimensions()}catch{const Ee=(K=($=this.roomOptions.videoCaptureDefaults)===null||$===void 0?void 0:$.resolution)!==null&&K!==void 0?K:VideoPresets.h720.resolution;be={width:Ee.width,height:Ee.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j)),{dims:be}))}de.width=be.width,de.height=be.height,isLocalVideoTrack(j)&&(isSVCCodec(oe)&&(j.source===Track.Source.ScreenShare&&(B.scalabilityMode="L1T3","contentHint"in j.mediaStreamTrack&&(j.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j))))),B.scalabilityMode=(X=B.scalabilityMode)!==null&&X!==void 0?X:"L3T3_KEY"),de.simulcastCodecs=[new SimulcastCodec({codec:oe,cid:j.mediaStreamTrack.id})],B.backupCodec===!0&&(B.backupCodec={codec:defaultVideoCodec}),B.backupCodec&&oe!==B.backupCodec.codec&&de.encryption===Encryption_Type.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),de.simulcastCodecs.push(new SimulcastCodec({codec:B.backupCodec.codec,cid:""})))),le=computeVideoEncodings(j.source===Track.Source.ScreenShare,de.width,de.height,B),de.layers=videoLayersFromEncodings(de.width,de.height,le,isSVCCodec(B.videoCodec))}else j.kind===Track.Kind.Audio&&(le=[{maxBitrate:(Q=B.audioPreset)===null||Q===void 0?void 0:Q.maxBitrate,priority:(Z=(W=B.audioPreset)===null||W===void 0?void 0:W.priority)!==null&&Z!==void 0?Z:"high",networkPriority:(ie=(te=B.audioPreset)===null||te===void 0?void 0:te.priority)!==null&&ie!==void 0?ie:"high"}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const ue=()=>__awaiter$1(this,void 0,void 0,function*(){var be,ge,Ee;if(!this.engine.pcManager)throw new UnexpectedConnectionState("pcManager is not ready");if(j.sender=yield this.engine.createSender(j,B,le),isLocalVideoTrack(j)&&((be=B.degradationPreference)!==null&&be!==void 0||(B.degradationPreference=getDefaultDegradationPreference(j)),j.setDegradationPreference(B.degradationPreference)),le)if(isFireFox()&&j.kind===Track.Kind.Audio){let Fe;for(const Ue of this.engine.pcManager.publisher.getTransceivers())if(Ue.sender===j.sender){Fe=Ue;break}Fe&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:Fe,codec:"opus",maxbr:!((ge=le[0])===null||ge===void 0)&&ge.maxBitrate?le[0].maxBitrate/1e3:0})}else j.codec&&isSVCCodec(j.codec)&&(!((Ee=le[0])===null||Ee===void 0)&&Ee.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:de.cid,codec:j.codec,maxbr:le[0].maxBitrate/1e3});yield this.engine.negotiate()});let he;if(this.enabledPublishVideoCodecs.length>0)he=(yield Promise.all([this.engine.addTrack(de),ue()]))[0];else{he=yield this.engine.addTrack(de);let be;if(he.codecs.forEach(ge=>{be===void 0&&(be=ge.mimeType)}),be&&j.kind===Track.Kind.Video){const ge=mimeTypeToVideoCodecString(be);ge!==oe&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j)),{codec:ge})),B.videoCodec=ge,le=computeVideoEncodings(j.source===Track.Source.ScreenShare,de.width,de.height,B))}yield ue()}const me=new LocalTrackPublication(j.kind,he,j,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return me.options=B,j.sid=he.sid,this.log.debug("publishing ".concat(j.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:le,trackInfo:he})),isLocalVideoTrack(j)?j.startMonitor(this.engine.client):isLocalAudioTrack(j)&&j.startMonitor(),this.addTrackPublication(me),this.emit(ParticipantEvent.LocalTrackPublished,me),me})}get isLocal(){return!0}publishAdditionalCodecForTrack(j,B,q){return __awaiter$1(this,void 0,void 0,function*(){var V;if(this.encryptionType!==Encryption_Type.NONE)return;let H;if(this.trackPublications.forEach(ie=>{ie.track&&ie.track===j&&(H=ie)}),!H)throw new TrackInvalidError("track is not published");if(!isLocalVideoTrack(j))throw new TrackInvalidError("track is not a video track");const $=Object.assign(Object.assign({},(V=this.roomOptions)===null||V===void 0?void 0:V.publishDefaults),q),K=computeTrackBackupEncodings(j,B,$);if(!K){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j)));return}const X=j.addSimulcastTrack(B,K);if(!X)return;const Q=new AddTrackRequest({cid:X.mediaStreamTrack.id,type:Track.kindToProto(j.kind),muted:j.isMuted,source:Track.sourceToProto(j.source),sid:j.sid,simulcastCodecs:[{codec:$.videoCodec,cid:X.mediaStreamTrack.id}]});if(Q.layers=videoLayersFromEncodings(Q.width,Q.height,K),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const W=()=>__awaiter$1(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(j,X,$,K),yield this.engine.negotiate()}),te=(yield Promise.all([this.engine.addTrack(Q),W()]))[0];this.log.debug("published ".concat(B," for track ").concat(j.sid),Object.assign(Object.assign({},this.logContext),{encodings:K,trackInfo:te}))})}unpublishTrack(j,B){return __awaiter$1(this,void 0,void 0,function*(){var q,V;if(isLocalTrack(j)){const Q=this.pendingPublishPromises.get(j);Q&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j))),yield Q)}const H=this.getPublicationForTrack(j),$=H?getLogContextFromTrack(H):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),$)),!H||!H.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),$));return}j=H.track,j.off(TrackEvent.Muted,this.onTrackMuted),j.off(TrackEvent.Unmuted,this.onTrackUnmuted),j.off(TrackEvent.Ended,this.handleTrackEnded),j.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),j.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),j.off(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),B===void 0&&(B=(V=(q=this.roomOptions)===null||q===void 0?void 0:q.stopLocalTrackOnUnpublish)!==null&&V!==void 0?V:!0),B?j.stop():j.stopMonitor();let K=!1;const X=j.sender;if(j.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<PCTransportState.FAILED&&X)try{for(const Q of this.engine.pcManager.publisher.getTransceivers())Q.sender===X&&(Q.direction="inactive",K=!0);if(this.engine.removeTrack(X)&&(K=!0),isLocalVideoTrack(j)){for(const[,Q]of j.simulcastCodecs)Q.sender&&(this.engine.removeTrack(Q.sender)&&(K=!0),Q.sender=void 0);j.simulcastCodecs.clear()}}catch(Q){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),$),{error:Q}))}switch(this.trackPublications.delete(H.trackSid),H.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(H.trackSid);break;case Track.Kind.Video:this.videoTrackPublications.delete(H.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,H),H.setTrack(void 0),K&&(yield this.engine.negotiate()),H})}unpublishTracks(j){return __awaiter$1(this,void 0,void 0,function*(){return(yield Promise.all(j.map(q=>this.unpublishTrack(q)))).filter(q=>!!q)})}republishAllTracks(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){q.republishPromise&&(yield q.republishPromise),q.republishPromise=new Promise((H,$)=>__awaiter$1(q,void 0,void 0,function*(){try{const K=[];this.trackPublications.forEach(X=>{X.track&&(B&&(X.options=Object.assign(Object.assign({},X.options),B)),K.push(X))}),yield Promise.all(K.map(X=>__awaiter$1(this,void 0,void 0,function*(){const Q=X.track;yield this.unpublishTrack(Q,!1),V&&!Q.isMuted&&Q.source!==Track.Source.ScreenShare&&Q.source!==Track.Source.ScreenShareAudio&&(isLocalAudioTrack(Q)||isLocalVideoTrack(Q))&&!Q.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:X.trackSid})),yield Q.restartTrack()),yield this.publishOrRepublishTrack(Q,X.options,!0)}))),H()}catch(K){$(K)}finally{this.republishPromise=void 0}})),yield q.republishPromise})()})}publishData(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const H=V.reliable?DataPacket_Kind.RELIABLE:DataPacket_Kind.LOSSY,$=V.destinationIdentities,K=V.topic,X=new DataPacket({kind:H,value:{case:"user",value:new UserPacket({participantIdentity:q.identity,payload:B,destinationIdentities:$,topic:K})}});yield q.engine.sendDataPacket(X,H)})()})}publishDtmf(j,B){return __awaiter$1(this,void 0,void 0,function*(){const q=new DataPacket({kind:DataPacket_Kind.RELIABLE,value:{case:"sipDtmf",value:new SipDTMF({code:j,digit:B})}});yield this.engine.sendDataPacket(q,DataPacket_Kind.RELIABLE)})}sendChatMessage(j,B){return __awaiter$1(this,void 0,void 0,function*(){const q={id:crypto.randomUUID(),message:j,timestamp:Date.now(),attachedFiles:B==null?void 0:B.attachments},V=new DataPacket({value:{case:"chatMessage",value:new ChatMessage(Object.assign(Object.assign({},q),{timestamp:protoInt64.parse(q.timestamp)}))}});return yield this.engine.sendDataPacket(V,DataPacket_Kind.RELIABLE),this.emit(ParticipantEvent.ChatMessage,q),q})}editChatMessage(j,B){return __awaiter$1(this,void 0,void 0,function*(){const q=Object.assign(Object.assign({},B),{message:j,editTimestamp:Date.now()}),V=new DataPacket({value:{case:"chatMessage",value:new ChatMessage(Object.assign(Object.assign({},q),{timestamp:protoInt64.parse(q.timestamp),editTimestamp:protoInt64.parse(q.editTimestamp)}))}});return yield this.engine.sendDataPacket(V,DataPacket_Kind.RELIABLE),this.emit(ParticipantEvent.ChatMessage,q),q})}sendText(j,B){return __awaiter$1(this,void 0,void 0,function*(){var q;const V=crypto.randomUUID(),$=new TextEncoder().encode(j).byteLength,K=(q=B==null?void 0:B.attachments)===null||q===void 0?void 0:q.map(()=>crypto.randomUUID()),X=new Array(K?K.length+1:1).fill(0),Q=(Z,te)=>{var ie;X[te]=Z;const ae=X.reduce((oe,de)=>oe+de,0);(ie=B==null?void 0:B.onProgress)===null||ie===void 0||ie.call(B,ae)},W=yield this.streamText({streamId:V,totalSize:$,destinationIdentities:B==null?void 0:B.destinationIdentities,topic:B==null?void 0:B.topic,attachedStreamIds:K,attributes:B==null?void 0:B.attributes});return yield W.write(j),Q(1,0),yield W.close(),B!=null&&B.attachments&&K&&(yield Promise.all(B.attachments.map((Z,te)=>__awaiter$1(this,void 0,void 0,function*(){return this._sendFile(K[te],Z,{topic:B.topic,mimeType:Z.type,onProgress:ie=>{Q(ie,te+1)}})})))),W.info})}streamText(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q;const V=(B=j==null?void 0:j.streamId)!==null&&B!==void 0?B:crypto.randomUUID(),H={id:V,mimeType:"text/plain",timestamp:Date.now(),topic:(q=j==null?void 0:j.topic)!==null&&q!==void 0?q:"",size:j==null?void 0:j.totalSize,attributes:j==null?void 0:j.attributes},$=new DataStream_Header({streamId:V,mimeType:H.mimeType,topic:H.topic,timestamp:numberToBigInt(H.timestamp),totalLength:numberToBigInt(j==null?void 0:j.totalSize),attributes:H.attributes,contentHeader:{case:"textHeader",value:new DataStream_TextHeader({version:j==null?void 0:j.version,attachedStreamIds:j==null?void 0:j.attachedStreamIds,replyToStreamId:j==null?void 0:j.replyToStreamId,operationType:(j==null?void 0:j.type)==="update"?DataStream_OperationType.UPDATE:DataStream_OperationType.CREATE})}}),K=j==null?void 0:j.destinationIdentities,X=new DataPacket({destinationIdentities:K,value:{case:"streamHeader",value:$}});yield this.engine.sendDataPacket(X,DataPacket_Kind.RELIABLE);let Q=0;const W=this,Z=new WritableStream({write(ae){return __awaiter$1(this,void 0,void 0,function*(){for(const oe of splitUtf8(ae,STREAM_CHUNK_SIZE)){yield W.engine.waitForBufferStatusLow(DataPacket_Kind.RELIABLE);const de=new DataStream_Chunk({content:oe,streamId:V,chunkIndex:numberToBigInt(Q)}),le=new DataPacket({destinationIdentities:K,value:{case:"streamChunk",value:de}});yield W.engine.sendDataPacket(le,DataPacket_Kind.RELIABLE),Q+=1}})},close(){return __awaiter$1(this,void 0,void 0,function*(){const ae=new DataStream_Trailer({streamId:V}),oe=new DataPacket({destinationIdentities:K,value:{case:"streamTrailer",value:ae}});yield W.engine.sendDataPacket(oe,DataPacket_Kind.RELIABLE)})},abort(ae){console.log("Sink error:",ae)}});let te=()=>__awaiter$1(this,void 0,void 0,function*(){yield ie.close()});W.engine.once(EngineEvent.Closing,te);const ie=new TextStreamWriter(Z,H,()=>this.engine.off(EngineEvent.Closing,te));return ie})}sendFile(j,B){return __awaiter$1(this,void 0,void 0,function*(){const q=crypto.randomUUID();return yield this._sendFile(q,j,B),{id:q}})}_sendFile(j,B,q){return __awaiter$1(this,void 0,void 0,function*(){var V;const H=yield this.streamBytes({streamId:j,totalSize:B.size,name:B.name,mimeType:(V=q==null?void 0:q.mimeType)!==null&&V!==void 0?V:B.type,topic:q==null?void 0:q.topic,destinationIdentities:q==null?void 0:q.destinationIdentities}),$=B.stream().getReader();for(;;){const{done:K,value:X}=yield $.read();if(K)break;yield H.write(X)}return yield H.close(),H.info})}streamBytes(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q,V,H,$;const K=(B=j==null?void 0:j.streamId)!==null&&B!==void 0?B:crypto.randomUUID(),X=j==null?void 0:j.destinationIdentities,Q={id:K,mimeType:(q=j==null?void 0:j.mimeType)!==null&&q!==void 0?q:"application/octet-stream",topic:(V=j==null?void 0:j.topic)!==null&&V!==void 0?V:"",timestamp:Date.now(),attributes:j==null?void 0:j.attributes,size:j==null?void 0:j.totalSize,name:(H=j==null?void 0:j.name)!==null&&H!==void 0?H:"unknown"},W=new DataStream_Header({totalLength:numberToBigInt(($=Q.size)!==null&&$!==void 0?$:0),mimeType:Q.mimeType,streamId:K,topic:Q.topic,timestamp:numberToBigInt(Date.now()),contentHeader:{case:"byteHeader",value:new DataStream_ByteHeader({name:Q.name})}}),Z=new DataPacket({destinationIdentities:X,value:{case:"streamHeader",value:W}});yield this.engine.sendDataPacket(Z,DataPacket_Kind.RELIABLE);let te=0;const ie=new _$1,ae=this.engine,oe=this.log,de=new WritableStream({write(ue){return __awaiter$1(this,void 0,void 0,function*(){const he=yield ie.lock();let me=0;try{for(;me<ue.byteLength;){const be=ue.slice(me,me+STREAM_CHUNK_SIZE);yield ae.waitForBufferStatusLow(DataPacket_Kind.RELIABLE);const ge=new DataPacket({destinationIdentities:X,value:{case:"streamChunk",value:new DataStream_Chunk({content:be,streamId:K,chunkIndex:numberToBigInt(te)})}});yield ae.sendDataPacket(ge,DataPacket_Kind.RELIABLE),te+=1,me+=be.byteLength}}finally{he()}})},close(){return __awaiter$1(this,void 0,void 0,function*(){const ue=new DataStream_Trailer({streamId:K}),he=new DataPacket({destinationIdentities:X,value:{case:"streamTrailer",value:ue}});yield ae.sendDataPacket(he,DataPacket_Kind.RELIABLE)})},abort(ue){oe.error("Sink error:",ue)}});return new ByteStreamWriter(de,Q)})}performRpc(j){return __awaiter$1(this,arguments,void 0,function(B){var q=this;let{destinationIdentity:V,method:H,payload:$,responseTimeout:K=1e4}=B;return(function*(){return new Promise((Q,W)=>__awaiter$1(q,void 0,void 0,function*(){var Z,te,ie,ae;if(byteLength($)>MAX_PAYLOAD_BYTES){W(RpcError.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((te=(Z=this.engine.latestJoinResponse)===null||Z===void 0?void 0:Z.serverInfo)===null||te===void 0)&&te.version&&compareVersions((ae=(ie=this.engine.latestJoinResponse)===null||ie===void 0?void 0:ie.serverInfo)===null||ae===void 0?void 0:ae.version,"1.8.0")<0){W(RpcError.builtIn("UNSUPPORTED_SERVER"));return}const oe=crypto.randomUUID();yield this.publishRpcRequest(V,oe,H,$,K-2e3);const de=setTimeout(()=>{this.pendingAcks.delete(oe),W(RpcError.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(oe),clearTimeout(le)},2e3);this.pendingAcks.set(oe,{resolve:()=>{clearTimeout(de)},participantIdentity:V});const le=setTimeout(()=>{this.pendingResponses.delete(oe),W(RpcError.builtIn("RESPONSE_TIMEOUT"))},K);this.pendingResponses.set(oe,{resolve:(ue,he)=>{clearTimeout(le),this.pendingAcks.has(oe)&&(console.warn("RPC response received before ack",oe),this.pendingAcks.delete(oe),clearTimeout(de)),he?W(he):Q(ue??"")},participantIdentity:V})}))})()})}registerRpcMethod(j,B){this.rpcHandlers.has(j)&&this.log.warn("you're overriding the RPC handler for method ".concat(j,", in the future this will throw an error")),this.rpcHandlers.set(j,B)}unregisterRpcMethod(j){this.rpcHandlers.delete(j)}setTrackSubscriptionPermissions(j){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=B,this.allParticipantsAllowedToSubscribe=j,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(j){const B=this.pendingAcks.get(j);B?(B.resolve(),this.pendingAcks.delete(j)):console.error("Ack received for unexpected RPC request",j)}handleIncomingRpcResponse(j,B,q){const V=this.pendingResponses.get(j);V?(V.resolve(B,q),this.pendingResponses.delete(j)):console.error("Response received for unexpected RPC request",j)}publishRpcRequest(j,B,q,V,H){return __awaiter$1(this,void 0,void 0,function*(){const $=new DataPacket({destinationIdentities:[j],kind:DataPacket_Kind.RELIABLE,value:{case:"rpcRequest",value:new RpcRequest({id:B,method:q,payload:V,responseTimeoutMs:H,version:1})}});yield this.engine.sendDataPacket($,DataPacket_Kind.RELIABLE)})}handleParticipantDisconnected(j){for(const[B,{participantIdentity:q}]of this.pendingAcks)q===j&&this.pendingAcks.delete(B);for(const[B,{participantIdentity:q,resolve:V}]of this.pendingResponses)q===j&&(V(null,RpcError.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(B))}setEnabledPublishCodecs(j){this.enabledPublishVideoCodecs=j.filter(B=>B.mime.split("/")[0].toLowerCase()==="video")}updateInfo(j){return j.sid!==this.sid||!super.updateInfo(j)?!1:(j.tracks.forEach(B=>{var q,V;const H=this.trackPublications.get(B.sid);if(H){const $=H.isMuted||((V=(q=H.track)===null||q===void 0?void 0:q.isUpstreamPaused)!==null&&V!==void 0?V:!1);$!==B.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(H)),{mutedOnServer:$})),this.engine.client.sendMuteTrack(B.sid,$))}}),!0)}getPublicationForTrack(j){let B;return this.trackPublications.forEach(q=>{const V=q.track;V&&(j instanceof MediaStreamTrack?(isLocalAudioTrack(V)||isLocalVideoTrack(V))&&V.mediaStreamTrack===j&&(B=q):j===V&&(B=q))}),B}waitForPendingPublicationOfSource(j){return __awaiter$1(this,void 0,void 0,function*(){const q=Date.now();for(;Date.now()<q+1e4;){const V=Array.from(this.pendingPublishPromises.entries()).find(H=>{let[$]=H;return $.source===j});if(V)return V[1];yield sleep$1(20)}})}}class RemoteTrackPublication extends TrackPublication{constructor(j,B,q,V){super(j,B.sid,B.name,V),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=VideoQuality.HIGH,this.handleEnded=H=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,H)},this.handleVisibilityChange=H=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(H),this.logContext),this.disabled=!H,this.emitTrackUpdate()},this.handleVideoDimensionsChange=H=>{this.log.debug("adaptivestream video dimensions ".concat(H.width,"x").concat(H.height),this.logContext),this.videoDimensions=H,this.emitTrackUpdate()},this.subscribed=q,this.updateInfo(B)}setSubscribed(j){const B=this.subscriptionStatus,q=this.permissionStatus;this.subscribed=j,j&&(this.allowed=!0);const V=new UpdateSubscription({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ParticipantTracks({participantSid:"",trackSids:[this.trackSid]})]});this.emit(TrackEvent.UpdateSubscription,V),this.emitSubscriptionUpdateIfChanged(B),this.emitPermissionUpdateIfChanged(q)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(j){!this.isManualOperationAllowed()||this.disabled===!j||(this.disabled=!j,this.emitTrackUpdate())}setVideoQuality(j){!this.isManualOperationAllowed()||this.currentVideoQuality===j||(this.currentVideoQuality=j,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(j){var B,q;this.isManualOperationAllowed()&&(((B=this.videoDimensions)===null||B===void 0?void 0:B.width)===j.width&&((q=this.videoDimensions)===null||q===void 0?void 0:q.height)===j.height||(isRemoteVideoTrack(this.track)&&(this.videoDimensions=j),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(j){this.isManualOperationAllowed()&&isRemoteVideoTrack(this.track)&&this.fps!==j&&(this.fps=j,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(j){const B=this.subscriptionStatus,q=this.permissionStatus,V=this.track;V!==j&&(V&&(V.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),V.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),V.off(TrackEvent.Ended,this.handleEnded),V.detach(),V.stopMonitor(),this.emit(TrackEvent.Unsubscribed,V)),super.setTrack(j),j&&(j.sid=this.trackSid,j.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),j.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),j.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,j)),this.emitPermissionUpdateIfChanged(q),this.emitSubscriptionUpdateIfChanged(B))}setAllowed(j){const B=this.subscriptionStatus,q=this.permissionStatus;this.allowed=j,this.emitPermissionUpdateIfChanged(q),this.emitSubscriptionUpdateIfChanged(B)}setSubscriptionError(j){this.emit(TrackEvent.SubscriptionFailed,j)}updateInfo(j){super.updateInfo(j);const B=this.metadataMuted;this.metadataMuted=j.muted,this.track?this.track.setMuted(j.muted):B!==j.muted&&this.emit(j.muted?TrackEvent.Muted:TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(j){const B=this.subscriptionStatus;j!==B&&this.emit(TrackEvent.SubscriptionStatusChanged,B,j)}emitPermissionUpdateIfChanged(j){this.permissionStatus!==j&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,j)}isManualOperationAllowed(){return this.kind===Track.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return isRemoteVideoTrack(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const j=new UpdateTrackSettings({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(j.width=Math.ceil(this.videoDimensions.width),j.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?j.quality=this.currentVideoQuality:j.quality=VideoQuality.HIGH,this.emit(TrackEvent.UpdateSettings,j)}}class RemoteParticipant extends Participant{static fromParticipantInfo(j,B,q){return new RemoteParticipant(j,B.sid,B.identity,B.name,B.metadata,B.attributes,q,B.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(j,B,q,V,H,$,K){let X=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ParticipantInfo_Kind.STANDARD;super(B,q||"",V,H,$,K,X),this.signalClient=j,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(j){super.addTrackPublication(j),j.on(TrackEvent.UpdateSettings,B=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(j))),this.signalClient.sendUpdateTrackSettings(B)}),j.on(TrackEvent.UpdateSubscription,B=>{B.participantTracks.forEach(q=>{q.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(B)}),j.on(TrackEvent.SubscriptionPermissionChanged,B=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,j,B)}),j.on(TrackEvent.SubscriptionStatusChanged,B=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,j,B)}),j.on(TrackEvent.Subscribed,B=>{this.emit(ParticipantEvent.TrackSubscribed,B,j)}),j.on(TrackEvent.Unsubscribed,B=>{this.emit(ParticipantEvent.TrackUnsubscribed,B,j)}),j.on(TrackEvent.SubscriptionFailed,B=>{this.emit(ParticipantEvent.TrackSubscriptionFailed,j.trackSid,B)})}getTrackPublication(j){const B=super.getTrackPublication(j);if(B)return B}getTrackPublicationByName(j){const B=super.getTrackPublicationByName(j);if(B)return B}setVolume(j){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Track.Source.Microphone;this.volumeMap.set(B,j);const q=this.getTrackPublication(B);q&&q.track&&q.track.setVolume(j)}getVolume(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Track.Source.Microphone;const B=this.getTrackPublication(j);return B&&B.track?B.track.getVolume():this.volumeMap.get(j)}addSubscribedMediaTrack(j,B,q,V,H,$){let K=this.getTrackPublicationBySid(B);if(K||B.startsWith("TR")||this.trackPublications.forEach(W=>{!K&&j.kind===W.kind.toString()&&(K=W)}),!K){if($===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:B})),this.emit(ParticipantEvent.TrackSubscriptionFailed,B);return}$===void 0&&($=20),setTimeout(()=>{this.addSubscribedMediaTrack(j,B,q,V,H,$-1)},150);return}if(j.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(K))),this.emit(ParticipantEvent.TrackSubscriptionFailed,B);return}const X=j.kind==="video";let Q;return X?Q=new RemoteVideoTrack(j,B,V,H):Q=new RemoteAudioTrack(j,B,V,this.audioContext,this.audioOutput),Q.source=K.source,Q.isMuted=K.isMuted,Q.setMediaStream(q),Q.start(),K.setTrack(Q),this.volumeMap.has(K.source)&&isRemoteTrack(Q)&&isAudioTrack(Q)&&Q.setVolume(this.volumeMap.get(K.source)),K}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(j){return this.trackPublications.get(j)}updateInfo(j){if(!super.updateInfo(j))return!1;const B=new Map,q=new Map;return j.tracks.forEach(V=>{var H,$;let K=this.getTrackPublicationBySid(V.sid);if(K)K.updateInfo(V);else{const X=Track.kindFromProto(V.type);if(!X)return;K=new RemoteTrackPublication(X,V,(H=this.signalClient.connectOptions)===null||H===void 0?void 0:H.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:($=this.loggerOptions)===null||$===void 0?void 0:$.loggerName}),K.updateInfo(V),q.set(V.sid,K);const Q=Array.from(this.trackPublications.values()).find(W=>W.source===(K==null?void 0:K.source));Q&&K.source!==Track.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(K.source),Object.assign(Object.assign({},this.logContext),{oldTrack:getLogContextFromTrack(Q),newTrack:getLogContextFromTrack(K)})),this.addTrackPublication(K)}B.set(V.sid,K)}),this.trackPublications.forEach(V=>{B.has(V.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(V))),this.unpublishTrack(V.trackSid,!0))}),q.forEach(V=>{this.emit(ParticipantEvent.TrackPublished,V)}),!0}unpublishTrack(j,B){const q=this.trackPublications.get(j);if(!q)return;const{track:V}=q;switch(V&&(V.stop(),q.setTrack(void 0)),this.trackPublications.delete(j),q.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(j);break;case Track.Kind.Video:this.videoTrackPublications.delete(j);break}B&&this.emit(ParticipantEvent.TrackUnpublished,q)}setAudioOutput(j){return __awaiter$1(this,void 0,void 0,function*(){this.audioOutput=j;const B=[];this.audioTrackPublications.forEach(q=>{var V;isAudioTrack(q.track)&&isRemoteTrack(q.track)&&B.push(q.track.setSinkId((V=j.deviceId)!==null&&V!==void 0?V:"default"))}),yield Promise.all(B)})}emit(j){for(var B=arguments.length,q=new Array(B>1?B-1:0),V=1;V<B;V++)q[V-1]=arguments[V];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:j,args:q})),super.emit(j,...q)}}var ConnectionState;(function(U){U.Disconnected="disconnected",U.Connecting="connecting",U.Connected="connected",U.Reconnecting="reconnecting",U.SignalReconnecting="signalReconnecting"})(ConnectionState||(ConnectionState={}));const connectionReconcileFrequency=4*1e3;class Room extends eventsExports.EventEmitter{constructor(j){var B,q,V,H;if(super(),B=this,this.state=ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=livekitLogger,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=($,K,X)=>__awaiter$1(this,void 0,void 0,function*(){var Q;if(!isBrowserSupported())throw isReactNative()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const W=yield this.disconnectLock.lock();if(this.state===ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),W(),Promise.resolve();if(this.connectFuture)return W(),this.connectFuture.promise;this.setAndEmitConnectionState(ConnectionState.Connecting),((Q=this.regionUrlProvider)===null||Q===void 0?void 0:Q.getServerUrl().toString())!==$&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),isCloud(new URL($))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new RegionUrlProvider($,K):this.regionUrlProvider.updateToken(K),this.regionUrlProvider.fetchRegionSettings().then(ie=>{var ae;(ae=this.regionUrlProvider)===null||ae===void 0||ae.setServerReportedRegions(ie)}).catch(ie=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:ie}))}));const Z=(ie,ae,oe)=>__awaiter$1(this,void 0,void 0,function*(){var de,le;this.abortController&&this.abortController.abort();const ue=new AbortController;this.abortController=ue,W==null||W();try{yield this.attemptConnection(oe??$,K,X,ue),this.abortController=void 0,ie()}catch(he){if(this.regionUrlProvider&&he instanceof ConnectionError&&he.reason!==ConnectionErrorReason.Cancelled&&he.reason!==ConnectionErrorReason.NotAllowed){let me=null;try{me=yield this.regionUrlProvider.getNextBestRegionUrl((de=this.abortController)===null||de===void 0?void 0:de.signal)}catch(be){if(be instanceof ConnectionError&&(be.status===401||be.reason===ConnectionErrorReason.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),ae(be);return}}me&&!(!((le=this.abortController)===null||le===void 0)&&le.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(he.message,". Retrying with another region: ").concat(me),this.logContext),this.recreateEngine(),yield Z(ie,ae,me)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,getDisconnectReasonFromConnectionError(he)),ae(he))}else{let me=DisconnectReason.UNKNOWN_REASON;he instanceof ConnectionError&&(me=getDisconnectReasonFromConnectionError(he)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,me),ae(he)}}}),te=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Future((ie,ae)=>{Z(ie,ae,te)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=($,K,X,Q,W,Z)=>__awaiter$1(this,void 0,void 0,function*(){var te,ie,ae;const oe=yield X.join($,K,{autoSubscribe:Q.autoSubscribe,adaptiveStream:typeof W.adaptiveStream=="object"?!0:W.adaptiveStream,maxRetries:Q.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:Q.websocketTimeout},Z.signal);let de=oe.serverInfo;if(de||(de={version:oe.serverVersion,region:oe.serverRegion}),this.serverInfo=de,this.log.debug("connected to Livekit Server ".concat(Object.entries(de).map(le=>{let[ue,he]=le;return"".concat(ue,": ").concat(he)}).join(", ")),{room:(te=oe.room)===null||te===void 0?void 0:te.name,roomSid:(ie=oe.room)===null||ie===void 0?void 0:ie.sid,identity:(ae=oe.participant)===null||ae===void 0?void 0:ae.identity}),!de.version)throw new UnsupportedServer("unknown server version");return de.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),W.dynacast=!1),oe}),this.applyJoinResponse=$=>{const K=$.participant;if(this.localParticipant.sid=K.sid,this.localParticipant.identity=K.identity,this.localParticipant.setEnabledPublishCodecs($.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer($.sifTrailer)}catch(X){this.log.error(X instanceof Error?X.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:X}))}this.handleParticipantUpdates([K,...$.otherParticipants]),$.room&&this.handleRoomUpdate($.room)},this.attemptConnection=($,K,X,Q)=>__awaiter$1(this,void 0,void 0,function*(){var W,Z;this.state===ConnectionState.Reconnecting||this.isResuming||!((W=this.engine)===null||W===void 0)&&W.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((Z=this.regionUrlProvider)===null||Z===void 0)&&Z.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},roomConnectOptionDefaults),X),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const te=yield this.connectSignal($,K,this.engine,this.connOptions,this.options,Q);this.applyJoinResponse(te),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected)}catch(te){yield this.engine.close(),this.recreateEngine();const ie=new ConnectionError("could not establish signal connection",ConnectionErrorReason.ServerUnreachable);throw te instanceof Error&&(ie.message="".concat(ie.message,": ").concat(te.message)),te instanceof ConnectionError&&(ie.reason=te.reason,ie.status=te.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:te})),ie}if(Q.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ConnectionError("Connection attempt aborted",ConnectionErrorReason.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,Q)}catch(te){throw yield this.engine.close(),this.recreateEngine(),te}isWeb()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),isWeb()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var $=arguments.length,K=new Array($),X=0;X<$;X++)K[X]=arguments[X];return __awaiter$1(B,[...K],void 0,function(){var Q=this;let W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var Z,te,ie,ae;const oe=yield Q.disconnectLock.lock();try{if(Q.state===ConnectionState.Disconnected){Q.log.debug("already disconnected",Q.logContext);return}Q.log.info("disconnect from room",Object.assign({},Q.logContext)),(Q.state===ConnectionState.Connecting||Q.state===ConnectionState.Reconnecting||Q.isResuming)&&(Q.log.warn("abort connection attempt",Q.logContext),(Z=Q.abortController)===null||Z===void 0||Z.abort(),(ie=(te=Q.connectFuture)===null||te===void 0?void 0:te.reject)===null||ie===void 0||ie.call(te,new ConnectionError("Client initiated disconnect",ConnectionErrorReason.Cancelled)),Q.connectFuture=void 0),!((ae=Q.engine)===null||ae===void 0)&&ae.client.isDisconnected||(yield Q.engine.client.sendLeave()),Q.engine&&(yield Q.engine.close()),Q.handleDisconnect(W,DisconnectReason.CLIENT_INITIATED),Q.engine=void 0}finally{oe()}})()})},this.onPageLeave=()=>__awaiter$1(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>__awaiter$1(this,void 0,void 0,function*(){const $=[],K=getBrowser();if(K&&K.os==="iOS"){const X="livekit-dummy-audio-el";let Q=document.getElementById(X);if(!Q){Q=document.createElement("audio"),Q.id=X,Q.autoplay=!0,Q.hidden=!0;const W=getEmptyAudioStreamTrack();W.enabled=!0;const Z=new MediaStream([W]);Q.srcObject=Z,document.addEventListener("visibilitychange",()=>{Q&&(Q.srcObject=document.hidden?null:Z,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(Q),this.once(RoomEvent.Disconnected,()=>{Q==null||Q.remove(),Q=null})}$.push(Q)}this.remoteParticipants.forEach(X=>{X.audioTrackPublications.forEach(Q=>{Q.track&&Q.track.attachedElements.forEach(W=>{$.push(W)})})});try{yield Promise.all([this.acquireAudioContext(),...$.map(X=>(X.muted=!1,X.play()))]),this.handleAudioPlaybackStarted()}catch(X){throw this.handleAudioPlaybackFailed(X),X}}),this.startVideo=()=>__awaiter$1(this,void 0,void 0,function*(){const $=[];for(const K of this.remoteParticipants.values())K.videoTrackPublications.forEach(X=>{var Q;(Q=X.track)===null||Q===void 0||Q.attachedElements.forEach(W=>{$.includes(W)||$.push(W)})});yield Promise.all($.map(K=>K.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(K=>{K.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const $ of this.remoteParticipants.values())this.handleParticipantDisconnected($.identity,$);this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)},this.handleSignalRestarted=$=>__awaiter$1(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat($.serverRegion),Object.assign(Object.assign({},this.logContext),{region:$.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse($);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(K){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:K}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:$.serverRegion}))}catch{return}this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=$=>{$.forEach(K=>{var X;if(K.identity===this.localParticipant.identity){this.localParticipant.updateInfo(K);return}K.identity===""&&(K.identity=(X=this.sidToIdentity.get(K.sid))!==null&&X!==void 0?X:"");let Q=this.remoteParticipants.get(K.identity);K.state===ParticipantInfo_State.DISCONNECTED?this.handleParticipantDisconnected(K.identity,Q):Q=this.getOrCreateParticipant(K.identity,K)})},this.handleActiveSpeakersUpdate=$=>{const K=[],X={};$.forEach(Q=>{if(X[Q.sid]=!0,Q.sid===this.localParticipant.sid)this.localParticipant.audioLevel=Q.level,this.localParticipant.setIsSpeaking(!0),K.push(this.localParticipant);else{const W=this.getRemoteParticipantBySid(Q.sid);W&&(W.audioLevel=Q.level,W.setIsSpeaking(!0),K.push(W))}}),X[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(Q=>{X[Q.sid]||(Q.audioLevel=0,Q.setIsSpeaking(!1))}),this.activeSpeakers=K,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,K)},this.handleSpeakersChanged=$=>{const K=new Map;this.activeSpeakers.forEach(Q=>{const W=this.remoteParticipants.get(Q.identity);W&&W.sid!==Q.sid||K.set(Q.sid,Q)}),$.forEach(Q=>{let W=this.getRemoteParticipantBySid(Q.sid);Q.sid===this.localParticipant.sid&&(W=this.localParticipant),W&&(W.audioLevel=Q.level,W.setIsSpeaking(Q.active),Q.active?K.set(Q.sid,W):K.delete(Q.sid))});const X=Array.from(K.values());X.sort((Q,W)=>W.audioLevel-Q.audioLevel),this.activeSpeakers=X,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,X)},this.handleStreamStateUpdate=$=>{$.streamStates.forEach(K=>{const X=this.getRemoteParticipantBySid(K.participantSid);if(!X)return;const Q=X.getTrackPublicationBySid(K.trackSid);if(!Q||!Q.track)return;const W=Track.streamStateFromProto(K.state);W!==Q.track.streamState&&(Q.track.streamState=W,X.emit(ParticipantEvent.TrackStreamStateChanged,Q,Q.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,Q,Q.track.streamState,X))})},this.handleSubscriptionPermissionUpdate=$=>{const K=this.getRemoteParticipantBySid($.participantSid);if(!K)return;const X=K.getTrackPublicationBySid($.trackSid);X&&X.setAllowed($.allowed)},this.handleSubscriptionError=$=>{const K=Array.from(this.remoteParticipants.values()).find(Q=>Q.trackPublications.has($.trackSid));if(!K)return;const X=K.getTrackPublicationBySid($.trackSid);X&&X.setSubscriptionError($.err)},this.handleDataPacket=$=>{const K=this.remoteParticipants.get($.participantIdentity);if($.value.case==="user")this.handleUserPacket(K,$.value.value,$.kind);else if($.value.case==="transcription")this.handleTranscription(K,$.value.value);else if($.value.case==="sipDtmf")this.handleSipDtmf(K,$.value.value);else if($.value.case==="chatMessage")this.handleChatMessage(K,$.value.value);else if($.value.case==="metrics")this.handleMetrics($.value.value,K);else if($.value.case==="streamHeader")this.handleStreamHeader($.value.value,$.participantIdentity);else if($.value.case==="streamChunk")this.handleStreamChunk($.value.value);else if($.value.case==="streamTrailer")this.handleStreamTrailer($.value.value);else if($.value.case==="rpcRequest"){const X=$.value.value;this.handleIncomingRpcRequest($.participantIdentity,X.id,X.method,X.payload,X.responseTimeoutMs,X.version)}},this.handleUserPacket=($,K,X)=>{this.emit(RoomEvent.DataReceived,K.payload,$,X,K.topic),$==null||$.emit(ParticipantEvent.DataReceived,K.payload,X)},this.handleSipDtmf=($,K)=>{this.emit(RoomEvent.SipDTMFReceived,K,$),$==null||$.emit(ParticipantEvent.SipDTMFReceived,K)},this.bufferedSegments=new Map,this.handleTranscription=($,K)=>{const X=K.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(K.transcribedParticipantIdentity),Q=X==null?void 0:X.trackPublications.get(K.trackId),W=extractTranscriptionSegments(K,this.transcriptionReceivedTimes);Q==null||Q.emit(TrackEvent.TranscriptionReceived,W),X==null||X.emit(ParticipantEvent.TranscriptionReceived,W,Q),this.emit(RoomEvent.TranscriptionReceived,W,X,Q)},this.handleChatMessage=($,K)=>{const X=extractChatMessage(K);this.emit(RoomEvent.ChatMessage,X,$)},this.handleMetrics=($,K)=>{this.emit(RoomEvent.MetricsReceived,$,K)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=$=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:$})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>__awaiter$1(this,void 0,void 0,function*(){var $,K;const X=DeviceManager.getInstance().previousDevices,Q=yield DeviceManager.getInstance().getDevices(void 0,!1),W=getBrowser();if((W==null?void 0:W.name)==="Chrome"&&W.os!=="iOS")for(let te of Q){const ie=X.find(ae=>ae.deviceId===te.deviceId);ie&&ie.label!==""&&ie.kind===te.kind&&ie.label!==te.label&&this.getActiveDevice(te.kind)==="default"&&this.emit(RoomEvent.ActiveDeviceChanged,te.kind,te.deviceId)}const Z=["audiooutput","audioinput","videoinput"];for(let te of Z){const ie=Q.filter(oe=>oe.kind===te),ae=this.getActiveDevice(te);if(ae===(($=X.filter(oe=>oe.kind===te)[0])===null||$===void 0?void 0:$.deviceId)&&ie.length>0&&((K=ie[0])===null||K===void 0?void 0:K.deviceId)!==ae){yield this.switchActiveDevice(te,ie[0].deviceId);continue}te==="audioinput"&&!isSafari()||te==="videoinput"||ie.length>0&&!ie.find(oe=>oe.deviceId===this.getActiveDevice(te))&&(yield this.switchActiveDevice(te,ie[0].deviceId))}this.emit(RoomEvent.MediaDevicesChanged)}),this.handleRoomUpdate=$=>{const K=this.roomInfo;this.roomInfo=$,K&&K.metadata!==$.metadata&&this.emitWhenConnected(RoomEvent.RoomMetadataChanged,$.metadata),(K==null?void 0:K.activeRecording)!==$.activeRecording&&this.emitWhenConnected(RoomEvent.RecordingStatusChanged,$.activeRecording)},this.handleConnectionQualityUpdate=$=>{$.updates.forEach(K=>{if(K.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(K.quality);return}const X=this.getRemoteParticipantBySid(K.participantSid);X&&X.setConnectionQuality(K.quality)})},this.onLocalParticipantMetadataChanged=$=>{this.emit(RoomEvent.ParticipantMetadataChanged,$,this.localParticipant)},this.onLocalParticipantNameChanged=$=>{this.emit(RoomEvent.ParticipantNameChanged,$,this.localParticipant)},this.onLocalAttributesChanged=$=>{this.emit(RoomEvent.ParticipantAttributesChanged,$,this.localParticipant)},this.onLocalTrackMuted=$=>{this.emit(RoomEvent.TrackMuted,$,this.localParticipant)},this.onLocalTrackUnmuted=$=>{this.emit(RoomEvent.TrackUnmuted,$,this.localParticipant)},this.onTrackProcessorUpdate=$=>{var K;(K=$==null?void 0:$.onPublish)===null||K===void 0||K.call($,this)},this.onLocalTrackPublished=$=>__awaiter$1(this,void 0,void 0,function*(){var K,X,Q,W,Z,te;(K=$.track)===null||K===void 0||K.on(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),(X=$.track)===null||X===void 0||X.on(TrackEvent.Restarted,this.onLocalTrackRestarted),(Z=(W=(Q=$.track)===null||Q===void 0?void 0:Q.getProcessor())===null||W===void 0?void 0:W.onPublish)===null||Z===void 0||Z.call(W,this),this.emit(RoomEvent.LocalTrackPublished,$,this.localParticipant),isLocalAudioTrack($.track)&&(yield $.track.checkForSilence())&&this.emit(RoomEvent.LocalAudioSilenceDetected,$);const ie=yield(te=$.track)===null||te===void 0?void 0:te.getDeviceId(!1),ae=sourceToKind($.source);ae&&ie&&ie!==this.localParticipant.activeDeviceMap.get(ae)&&(this.localParticipant.activeDeviceMap.set(ae,ie),this.emit(RoomEvent.ActiveDeviceChanged,ae,ie))}),this.onLocalTrackUnpublished=$=>{var K,X;(K=$.track)===null||K===void 0||K.off(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),(X=$.track)===null||X===void 0||X.off(TrackEvent.Restarted,this.onLocalTrackRestarted),this.emit(RoomEvent.LocalTrackUnpublished,$,this.localParticipant)},this.onLocalTrackRestarted=$=>__awaiter$1(this,void 0,void 0,function*(){const K=yield $.getDeviceId(!1),X=sourceToKind($.source);X&&K&&K!==this.localParticipant.activeDeviceMap.get(X)&&(this.log.debug("local track restarted, setting ".concat(X," ").concat(K," active"),this.logContext),this.localParticipant.activeDeviceMap.set(X,K),this.emit(RoomEvent.ActiveDeviceChanged,X,K))}),this.onLocalConnectionQualityChanged=$=>{this.emit(RoomEvent.ConnectionQualityChanged,$,this.localParticipant)},this.onMediaDevicesError=$=>{this.emit(RoomEvent.MediaDevicesError,$)},this.onLocalParticipantPermissionsChanged=$=>{this.emit(RoomEvent.ParticipantPermissionsChanged,$,this.localParticipant)},this.onLocalChatMessageSent=$=>{this.emit(RoomEvent.ChatMessage,$,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},roomOptionDefaults),j),this.log=getLogger((q=this.options.loggerName)!==null&&q!==void 0?q:LoggerNames.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},audioDefaults),j==null?void 0:j.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},videoDefaults),j==null?void 0:j.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},publishDefaults),j==null?void 0:j.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new _$1,this.localParticipant=new LocalParticipant("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",unwrapConstraint(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",unwrapConstraint(this.options.audioCaptureDefaults.deviceId)),!((V=this.options.audioOutput)===null||V===void 0)&&V.deviceId&&this.switchActiveDevice("audiooutput",unwrapConstraint(this.options.audioOutput.deviceId)).catch($=>this.log.warn("Could not set audio output: ".concat($.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),isWeb()){const $=new AbortController;(H=navigator.mediaDevices)===null||H===void 0||H.addEventListener("devicechange",this.handleDeviceChange,{signal:$.signal}),Room.cleanupRegistry&&Room.cleanupRegistry.register(this,()=>{$.abort()})}}registerTextStreamHandler(j,B){if(this.textStreamHandlers.has(j))throw new TypeError('A text stream handler for topic "'.concat(j,'" has already been set.'));this.textStreamHandlers.set(j,B)}unregisterTextStreamHandler(j){this.textStreamHandlers.delete(j)}registerByteStreamHandler(j,B){if(this.byteStreamHandlers.has(j))throw new TypeError('A byte stream handler for topic "'.concat(j,'" has already been set.'));this.byteStreamHandlers.set(j,B)}unregisterByteStreamHandler(j){this.byteStreamHandlers.delete(j)}registerRpcMethod(j,B){if(this.rpcHandlers.has(j))throw Error("RPC handler already registered for method ".concat(j,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(j,B)}unregisterRpcMethod(j){this.rpcHandlers.delete(j)}handleIncomingRpcRequest(j,B,q,V,H,$){return __awaiter$1(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(j,B),$!==1){yield this.engine.publishRpcResponse(j,B,null,RpcError.builtIn("UNSUPPORTED_VERSION"));return}const K=this.rpcHandlers.get(q);if(!K){yield this.engine.publishRpcResponse(j,B,null,RpcError.builtIn("UNSUPPORTED_METHOD"));return}let X=null,Q=null;try{const W=yield K({requestId:B,callerIdentity:j,payload:V,responseTimeout:H});byteLength(W)>MAX_PAYLOAD_BYTES?(X=RpcError.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(q))):Q=W}catch(W){W instanceof RpcError?X=W:(console.warn("Uncaught error returned by RPC handler for ".concat(q,". Returning APPLICATION_ERROR instead."),W),X=RpcError.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(j,B,Q,X)})}setE2EEEnabled(j){return __awaiter$1(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(j)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(j,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var j;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new E2EEManager(this.options.e2ee),this.e2eeManager.on(EncryptionEvent.ParticipantEncryptionStatusChanged,(B,q)=>{isLocalParticipant(q)&&(this.isE2EEEnabled=B),this.emit(RoomEvent.ParticipantEncryptionStatusChanged,B,q)}),this.e2eeManager.on(EncryptionEvent.EncryptionError,B=>this.emit(RoomEvent.EncryptionError,B)),(j=this.e2eeManager)===null||j===void 0||j.setup(this))}get logContext(){var j;return{room:this.name,roomID:(j=this.roomInfo)===null||j===void 0?void 0:j.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var j,B;return(B=(j=this.roomInfo)===null||j===void 0?void 0:j.activeRecording)!==null&&B!==void 0?B:!1}getSid(){return __awaiter$1(this,void 0,void 0,function*(){return this.state===ConnectionState.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((j,B)=>{const q=V=>{V.sid!==""&&(this.engine.off(EngineEvent.RoomUpdate,q),j(V.sid))};this.engine.on(EngineEvent.RoomUpdate,q),this.once(RoomEvent.Disconnected,()=>{this.engine.off(EngineEvent.RoomUpdate,q),B("Room disconnected before room server id was available")})})})}get name(){var j,B;return(B=(j=this.roomInfo)===null||j===void 0?void 0:j.name)!==null&&B!==void 0?B:""}get metadata(){var j;return(j=this.roomInfo)===null||j===void 0?void 0:j.metadata}get numParticipants(){var j,B;return(B=(j=this.roomInfo)===null||j===void 0?void 0:j.numParticipants)!==null&&B!==void 0?B:0}get numPublishers(){var j,B;return(B=(j=this.roomInfo)===null||j===void 0?void 0:j.numPublishers)!==null&&B!==void 0?B:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new RTCEngine(this.options),this.engine.on(EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(EngineEvent.RoomUpdate,this.handleRoomUpdate).on(EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(EngineEvent.SubscriptionError,this.handleSubscriptionError).on(EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(EngineEvent.MediaTrackAdded,(j,B,q)=>{this.onTrackAdded(j,B,q)}).on(EngineEvent.Disconnected,j=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,j)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ConnectionState.SignalReconnecting)&&this.emit(RoomEvent.SignalReconnecting)}).on(EngineEvent.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ConnectionState.Connected)&&this.emit(RoomEvent.Reconnected)}).on(EngineEvent.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ConnectionState.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.SignalRestarted,this.handleSignalRestarted).on(EngineEvent.Offline,()=>{this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)}).on(EngineEvent.DCBufferStatusChanged,(j,B)=>{this.emit(RoomEvent.DCBufferStatusChanged,j,B)}).on(EngineEvent.LocalTrackSubscribed,j=>{const B=this.localParticipant.getTrackPublications().find(q=>{let{trackSid:V}=q;return V===j});if(!B){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ParticipantEvent.LocalTrackSubscribed,B),this.emitWhenConnected(RoomEvent.LocalTrackSubscribed,B,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(j){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return DeviceManager.getInstance().getDevices(j,B)}prepareConnection(j,B){return __awaiter$1(this,void 0,void 0,function*(){if(this.state===ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(j),this.logContext);try{if(isCloud(new URL(j))&&B){this.regionUrlProvider=new RegionUrlProvider(j,B);const q=yield this.regionUrlProvider.getNextBestRegionUrl();q&&this.state===ConnectionState.Disconnected&&(this.regionUrl=q,yield fetch(toHttpUrl(q),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(q),this.logContext))}else yield fetch(toHttpUrl(j),{method:"HEAD"})}catch(q){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:q}))}}})}getParticipantByIdentity(j){return this.localParticipant.identity===j?this.localParticipant:this.remoteParticipants.get(j)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(j,B){return __awaiter$1(this,void 0,void 0,function*(){let q=()=>{},V;switch(j){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":V=new SimulateScenario({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":V=new SimulateScenario({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":V=new SimulateScenario({scenario:{case:"serverLeave",value:!0}});break;case"migration":V=new SimulateScenario({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":q=()=>__awaiter$1(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),V=new SimulateScenario({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":q=()=>__awaiter$1(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),V=new SimulateScenario({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":V=new SimulateScenario({scenario:{case:"switchCandidateProtocol",value:j==="force-tls"?2:1}}),q=()=>__awaiter$1(this,void 0,void 0,function*(){const H=this.engine.client.onLeave;H&&H(new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.RECONNECT}))});break;case"subscriber-bandwidth":if(B===void 0||typeof B!="number")throw new Error("subscriber-bandwidth requires a number as argument");V=new SimulateScenario({scenario:{case:"subscriberBandwidth",value:numberToBigInt(B)}});break;case"leave-full-reconnect":V=new SimulateScenario({scenario:{case:"leaveRequestFullReconnect",value:!0}})}V&&(yield this.engine.client.sendSimulateScenario(V),yield q())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(j){return this.localParticipant.activeDeviceMap.get(j)}switchActiveDevice(j,B){return __awaiter$1(this,arguments,void 0,function(q,V){var H=this;let $=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var K,X,Q,W,Z,te,ie,ae;let oe=!0,de=!1;const le=$?{exact:V}:V;if(q==="audioinput"){de=H.localParticipant.audioTrackPublications.size===0;const ue=(K=H.getActiveDevice(q))!==null&&K!==void 0?K:H.options.audioCaptureDefaults.deviceId;H.options.audioCaptureDefaults.deviceId=le;const he=Array.from(H.localParticipant.audioTrackPublications.values()).filter(me=>me.source===Track.Source.Microphone);try{oe=(yield Promise.all(he.map(me=>{var be;return(be=me.audioTrack)===null||be===void 0?void 0:be.setDeviceId(le)}))).every(me=>me===!0)}catch(me){throw H.options.audioCaptureDefaults.deviceId=ue,me}}else if(q==="videoinput"){de=H.localParticipant.videoTrackPublications.size===0;const ue=(X=H.getActiveDevice(q))!==null&&X!==void 0?X:H.options.videoCaptureDefaults.deviceId;H.options.videoCaptureDefaults.deviceId=le;const he=Array.from(H.localParticipant.videoTrackPublications.values()).filter(me=>me.source===Track.Source.Camera);try{oe=(yield Promise.all(he.map(me=>{var be;return(be=me.videoTrack)===null||be===void 0?void 0:be.setDeviceId(le)}))).every(me=>me===!0)}catch(me){throw H.options.videoCaptureDefaults.deviceId=ue,me}}else if(q==="audiooutput"){if(!supportsSetSinkId()&&!H.options.webAudioMix||H.options.webAudioMix&&H.audioContext&&!("setSinkId"in H.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");H.options.webAudioMix&&(V=(Q=yield DeviceManager.getInstance().normalizeDeviceId("audiooutput",V))!==null&&Q!==void 0?Q:""),(W=(ae=H.options).audioOutput)!==null&&W!==void 0||(ae.audioOutput={});const ue=(Z=H.getActiveDevice(q))!==null&&Z!==void 0?Z:H.options.audioOutput.deviceId;H.options.audioOutput.deviceId=V;try{H.options.webAudioMix&&((te=H.audioContext)===null||te===void 0||te.setSinkId(V)),yield Promise.all(Array.from(H.remoteParticipants.values()).map(he=>he.setAudioOutput({deviceId:V})))}catch(he){throw H.options.audioOutput.deviceId=ue,he}}return(de||q==="audiooutput")&&(H.localParticipant.activeDeviceMap.set(q,q==="audiooutput"&&((ie=H.options.audioOutput)===null||ie===void 0?void 0:ie.deviceId)||V),H.emit(RoomEvent.ActiveDeviceChanged,q,V)),oe})()})}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.AudioStreamAcquired,this.startAudio).on(ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var j;(j=this.engine)===null||j===void 0||j.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(j,B,q){if(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting){const W=()=>{this.onTrackAdded(j,B,q),Z()},Z=()=>{this.off(RoomEvent.Reconnected,W),this.off(RoomEvent.Connected,W),this.off(RoomEvent.Disconnected,Z)};this.once(RoomEvent.Reconnected,W),this.once(RoomEvent.Connected,W),this.once(RoomEvent.Disconnected,Z);return}if(this.state===ConnectionState.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(j.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const V=unpackStreamId(B.id),H=V[0];let $=V[1],K=j.id;if($&&$.startsWith("TR")&&(K=$),H===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const X=Array.from(this.remoteParticipants.values()).find(W=>W.sid===H);if(!X){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(H),this.logContext);return}let Q;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?Q=this.options.adaptiveStream:Q={}),X.addSubscribedMediaTrack(j,K,B,q,Q)}handleDisconnect(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,B=arguments.length>1?arguments[1]:void 0;var q;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(V=>{V.trackPublications.forEach(H=>{V.unpublishTrack(H.trackSid)})}),this.localParticipant.trackPublications.forEach(V=>{var H,$,K;V.track&&this.localParticipant.unpublishTrack(V.track,j),j?((H=V.track)===null||H===void 0||H.detach(),($=V.track)===null||$===void 0||$.stop()):(K=V.track)===null||K===void 0||K.stopMonitor()}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.AudioStreamAcquired,this.startAudio).off(ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(q=navigator.mediaDevices)===null||q===void 0||q.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ConnectionState.Disconnected),this.emit(RoomEvent.Disconnected,B)}}}handleParticipantDisconnected(j,B){var q;this.remoteParticipants.delete(j),B&&(B.trackPublications.forEach(V=>{B.unpublishTrack(V.trackSid,!0)}),this.emit(RoomEvent.ParticipantDisconnected,B),(q=this.localParticipant)===null||q===void 0||q.handleParticipantDisconnected(B.identity))}handleStreamHeader(j,B){return __awaiter$1(this,void 0,void 0,function*(){var q;if(j.contentHeader.case==="byteHeader"){const V=this.byteStreamHandlers.get(j.topic);if(!V){this.log.debug("ignoring incoming byte stream due to no handler for topic",j.topic);return}let H;const $={id:j.streamId,name:(q=j.contentHeader.value.name)!==null&&q!==void 0?q:"unknown",mimeType:j.mimeType,size:j.totalLength?Number(j.totalLength):void 0,topic:j.topic,timestamp:bigIntToNumber(j.timestamp),attributes:j.attributes},K=new ReadableStream({start:X=>{H=X,this.byteStreamControllers.set(j.streamId,{info:$,controller:H,startTime:Date.now()})}});V(new ByteStreamReader($,K,bigIntToNumber(j.totalLength)),{identity:B})}else if(j.contentHeader.case==="textHeader"){const V=this.textStreamHandlers.get(j.topic);if(!V){this.log.debug("ignoring incoming text stream due to no handler for topic",j.topic);return}let H;const $={id:j.streamId,mimeType:j.mimeType,size:j.totalLength?Number(j.totalLength):void 0,topic:j.topic,timestamp:Number(j.timestamp),attributes:j.attributes},K=new ReadableStream({start:X=>{H=X,this.textStreamControllers.set(j.streamId,{info:$,controller:H,startTime:Date.now()})}});V(new TextStreamReader($,K,bigIntToNumber(j.totalLength)),{identity:B})}})}handleStreamChunk(j){const B=this.byteStreamControllers.get(j.streamId);B&&j.content.length>0&&B.controller.enqueue(j);const q=this.textStreamControllers.get(j.streamId);q&&j.content.length>0&&q.controller.enqueue(j)}handleStreamTrailer(j){const B=this.textStreamControllers.get(j.streamId);B&&(B.info.attributes=Object.assign(Object.assign({},B.info.attributes),j.attributes),B.controller.close(),this.textStreamControllers.delete(j.streamId));const q=this.byteStreamControllers.get(j.streamId);q&&(q.info.attributes=Object.assign(Object.assign({},q.info.attributes),j.attributes),q.controller.close(),this.byteStreamControllers.delete(j.streamId))}acquireAudioContext(){return __awaiter$1(this,void 0,void 0,function*(){var j,B;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(j=getNewAudioContext())!==null&&j!==void 0?j:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(V=>V.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),sleep$1(200)])}catch(V){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:V}))}const q=((B=this.audioContext)===null||B===void 0?void 0:B.state)==="running";q!==this.canPlaybackAudio&&(this.audioEnabled=q,this.emit(RoomEvent.AudioPlaybackStatusChanged,q))})}createParticipant(j,B){var q;let V;return B?V=RemoteParticipant.fromParticipantInfo(this.engine.client,B,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):V=new RemoteParticipant(this.engine.client,"",j,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&V.setAudioContext(this.audioContext),!((q=this.options.audioOutput)===null||q===void 0)&&q.deviceId&&V.setAudioOutput(this.options.audioOutput).catch(H=>this.log.warn("Could not set audio output: ".concat(H.message),this.logContext)),V}getOrCreateParticipant(j,B){if(this.remoteParticipants.has(j)){const V=this.remoteParticipants.get(j);return B&&V.updateInfo(B)&&this.sidToIdentity.set(B.sid,B.identity),V}const q=this.createParticipant(j,B);return this.remoteParticipants.set(j,q),this.sidToIdentity.set(B.sid,B.identity),this.emitWhenConnected(RoomEvent.ParticipantConnected,q),q.on(ParticipantEvent.TrackPublished,V=>{this.emitWhenConnected(RoomEvent.TrackPublished,V,q)}).on(ParticipantEvent.TrackSubscribed,(V,H)=>{V.kind===Track.Kind.Audio?(V.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),V.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):V.kind===Track.Kind.Video&&(V.on(TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),V.on(TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(RoomEvent.TrackSubscribed,V,H,q)}).on(ParticipantEvent.TrackUnpublished,V=>{this.emit(RoomEvent.TrackUnpublished,V,q)}).on(ParticipantEvent.TrackUnsubscribed,(V,H)=>{this.emit(RoomEvent.TrackUnsubscribed,V,H,q)}).on(ParticipantEvent.TrackMuted,V=>{this.emitWhenConnected(RoomEvent.TrackMuted,V,q)}).on(ParticipantEvent.TrackUnmuted,V=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,V,q)}).on(ParticipantEvent.ParticipantMetadataChanged,V=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,V,q)}).on(ParticipantEvent.ParticipantNameChanged,V=>{this.emitWhenConnected(RoomEvent.ParticipantNameChanged,V,q)}).on(ParticipantEvent.AttributesChanged,V=>{this.emitWhenConnected(RoomEvent.ParticipantAttributesChanged,V,q)}).on(ParticipantEvent.ConnectionQualityChanged,V=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,V,q)}).on(ParticipantEvent.ParticipantPermissionsChanged,V=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,V,q)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(V,H)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,V,H,q)}).on(ParticipantEvent.TrackSubscriptionFailed,(V,H)=>{this.emit(RoomEvent.TrackSubscriptionFailed,V,q,H)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(V,H)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,V,H,q)}),B&&q.updateInfo(B),q}sendSyncState(){const j=Array.from(this.remoteParticipants.values()).reduce((q,V)=>(q.push(...V.getTrackPublications()),q),[]),B=this.localParticipant.getTrackPublications();this.engine.sendSyncState(j,B)}updateSubscriptions(){for(const j of this.remoteParticipants.values())for(const B of j.videoTrackPublications.values())B.isSubscribed&&isRemotePub(B)&&B.emitTrackUpdate()}getRemoteParticipantBySid(j){const B=this.sidToIdentity.get(j);if(B)return this.remoteParticipants.get(B)}registerConnectionReconcile(){this.clearConnectionReconcile();let j=0;this.connectionReconcileInterval=CriticalTimers.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(j++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:j,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),j>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,DisconnectReason.STATE_MISMATCH))):j=0},connectionReconcileFrequency)}clearConnectionReconcile(){this.connectionReconcileInterval&&CriticalTimers.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(j){return j===this.state?!1:(this.state=j,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(j=>{let[B,q]=j;this.emit(B,...q)}),this.bufferedEvents=[]}emitWhenConnected(j){for(var B=arguments.length,q=new Array(B>1?B-1:0),V=1;V<B;V++)q[V-1]=arguments[V];if(this.state===ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([j,q]);else if(this.state===ConnectionState.Connected)return this.emit(j,...q);return!1}simulateParticipants(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q;const V=Object.assign({audio:!0,video:!0,useRealTracks:!1},j.publish),H=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},j.participants);if(this.handleDisconnect(),this.roomInfo=new Room$1({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:protoInt64.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ParticipantInfo({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState(ConnectionState.Connected),V.video){const $=new LocalTrackPublication(Track.Kind.Video,new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO,name:"video-dummy"}),new LocalVideoTrack(V.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack(160*((B=H.aspectRatios[0])!==null&&B!==void 0?B:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication($),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,$)}if(V.audio){const $=new LocalTrackPublication(Track.Kind.Audio,new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO}),new LocalAudioTrack(V.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication($),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,$)}for(let $=0;$<H.count-1;$+=1){let K=new ParticipantInfo({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat($),state:ParticipantInfo_State.ACTIVE,tracks:[],joinedAt:protoInt64.parse(Date.now())});const X=this.getOrCreateParticipant(K.identity,K);if(H.video){const Q=createDummyVideoStreamTrack(160*((q=H.aspectRatios[$%H.aspectRatios.length])!==null&&q!==void 0?q:1),160,!1,!0),W=new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});X.addSubscribedMediaTrack(Q,W.sid,new MediaStream([Q]),new RTCRtpReceiver),K.tracks=[...K.tracks,W]}if(H.audio){const Q=getEmptyAudioStreamTrack(),W=new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});X.addSubscribedMediaTrack(Q,W.sid,new MediaStream([Q]),new RTCRtpReceiver),K.tracks=[...K.tracks,W]}X.updateInfo(K)}})}emit(j){for(var B=arguments.length,q=new Array(B>1?B-1:0),V=1;V<B;V++)q[V-1]=arguments[V];if(j!==RoomEvent.ActiveSpeakersChanged&&j!==RoomEvent.TranscriptionReceived){const H=mapArgs(q).filter($=>$!==void 0);this.log.debug("room event ".concat(j),Object.assign(Object.assign({},this.logContext),{event:j,args:H}))}return super.emit(j,...q)}}Room.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(U=>{U()});function mapArgs(U){return U.map(j=>{if(j)return Array.isArray(j)?mapArgs(j):typeof j=="object"?"logContext"in j?j.logContext:void 0:j})}var CheckStatus;(function(U){U[U.IDLE=0]="IDLE",U[U.RUNNING=1]="RUNNING",U[U.SKIPPED=2]="SKIPPED",U[U.SUCCESS=3]="SUCCESS",U[U.FAILED=4]="FAILED"})(CheckStatus||(CheckStatus={}));class Checker extends eventsExports.EventEmitter{constructor(j,B){let q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=CheckStatus.IDLE,this.logs=[],this.options={},this.url=j,this.token=B,this.name=this.constructor.name,this.room=new Room(q.roomOptions),this.connectOptions=q.connectOptions,this.options=q}run(j){return __awaiter$1(this,void 0,void 0,function*(){if(this.status!==CheckStatus.IDLE)throw Error("check is running already");this.setStatus(CheckStatus.RUNNING);try{yield this.perform()}catch(B){B instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(B.message):this.appendError(B.message))}return yield this.disconnect(),yield new Promise(B=>setTimeout(B,500)),this.status!==CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?CheckStatus.SUCCESS:CheckStatus.FAILED),j&&j(),this.getInfo()})}isSuccess(){return!this.logs.some(j=>j.level==="error")}connect(j){return __awaiter$1(this,void 0,void 0,function*(){return this.room.state===ConnectionState.Connected?this.room:(j||(j=this.url),yield this.room.connect(j,this.token,this.connectOptions),this.room)})}disconnect(){return __awaiter$1(this,void 0,void 0,function*(){this.room&&this.room.state!==ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise(j=>setTimeout(j,500)))})}skip(){this.setStatus(CheckStatus.SKIPPED)}switchProtocol(j){return __awaiter$1(this,void 0,void 0,function*(){let B=!1,q=!1;if(this.room.on(RoomEvent.Reconnecting,()=>{B=!0}),this.room.once(RoomEvent.Reconnected,()=>{q=!0}),this.room.simulateScenario("force-".concat(j)),yield new Promise(H=>setTimeout(H,1e3)),!B)return;const V=Date.now()+1e4;for(;Date.now()<V;){if(q)return;yield sleep$1(100)}throw new Error("Could not reconnect using ".concat(j," protocol after 10 seconds"))})}appendMessage(j){this.logs.push({level:"info",message:j}),this.emit("update",this.getInfo())}appendWarning(j){this.logs.push({level:"warning",message:j}),this.emit("update",this.getInfo())}appendError(j){this.logs.push({level:"error",message:j}),this.emit("update",this.getInfo())}setStatus(j){this.status=j,this.emit("update",this.getInfo())}get engine(){var j;return(j=this.room)===null||j===void 0?void 0:j.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class CloudRegionCheck extends Checker{get description(){return"Cloud regions"}perform(){return __awaiter$1(this,void 0,void 0,function*(){const j=new RegionUrlProvider(this.url,this.token);if(!j.isCloud()){this.skip();return}const B=[],q=new Set;for(let H=0;H<3;H++){const $=yield j.getNextBestRegionUrl();if(!$)break;if(q.has($))continue;q.add($);const K=yield this.checkCloudRegion($);this.appendMessage("".concat(K.region," RTT: ").concat(K.rtt,"ms, duration: ").concat(K.duration,"ms")),B.push(K)}B.sort((H,$)=>(H.duration-$.duration)*.5+(H.rtt-$.rtt)*.5);const V=B[0];this.bestStats=V,this.appendMessage("best Cloud region: ".concat(V.region))})}getInfo(){const j=super.getInfo();return j.data=this.bestStats,j}checkCloudRegion(j){return __awaiter$1(this,void 0,void 0,function*(){var B,q;yield this.connect(j),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const V=(B=this.room.serverInfo)===null||B===void 0?void 0:B.region;if(!V)throw new Error("Region not found");const H=yield this.room.localParticipant.streamText({topic:"test"}),$=1e3,X=1e6/$,Q="A".repeat($),W=Date.now();for(let ae=0;ae<X;ae++)yield H.write(Q);yield H.close();const Z=Date.now(),te=yield(q=this.room.engine.pcManager)===null||q===void 0?void 0:q.publisher.getStats(),ie={region:V,rtt:1e4,duration:Z-W};return te==null||te.forEach(ae=>{ae.type==="candidate-pair"&&ae.nominated&&(ie.rtt=ae.currentRoundTripTime*1e3)}),yield this.disconnect(),ie})}}const TEST_DURATION=1e4;class ConnectionProtocolCheck extends Checker{get description(){return"Connection via UDP vs TCP"}perform(){return __awaiter$1(this,void 0,void 0,function*(){const j=yield this.checkConnectionProtocol("udp"),B=yield this.checkConnectionProtocol("tcp");this.bestStats=j,j.qualityLimitationDurations.bandwidth-B.qualityLimitationDurations.bandwidth>.5||(j.packetsLost-B.packetsLost)/j.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=B):this.appendMessage("best connection quality via udp");const q=this.bestStats;this.appendMessage("upstream bitrate: ".concat((q.bitrateTotal/q.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((q.rttTotal/q.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((q.jitterTotal/q.count*1e3).toFixed(2)," ms")),q.packetsLost>0&&this.appendWarning("packets lost: ".concat((q.packetsLost/q.packetsSent*100).toFixed(2),"%")),q.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((q.qualityLimitationDurations.bandwidth/(TEST_DURATION/1e3)*100).toFixed(2),"%")),q.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((q.qualityLimitationDurations.cpu/(TEST_DURATION/1e3)*100).toFixed(2),"%"))})}getInfo(){const j=super.getInfo();return j.data=this.bestStats,j}checkConnectionProtocol(j){return __awaiter$1(this,void 0,void 0,function*(){yield this.connect(),j==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const B=document.createElement("canvas");B.width=1280,B.height=720;const q=B.getContext("2d");if(!q)throw new Error("Could not get canvas context");let V=0;const H=()=>{V=(V+1)%360,q.fillStyle="hsl(".concat(V,", 100%, 50%)"),q.fillRect(0,0,B.width,B.height),requestAnimationFrame(H)};H();const K=B.captureStream(30).getVideoTracks()[0],Q=(yield this.room.localParticipant.publishTrack(K,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,W={protocol:j,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},Z=setInterval(()=>__awaiter$1(this,void 0,void 0,function*(){const te=yield Q.getRTCStatsReport();te==null||te.forEach(ie=>{ie.type==="outbound-rtp"?(W.packetsSent=ie.packetsSent,W.qualityLimitationDurations=ie.qualityLimitationDurations,W.bitrateTotal+=ie.targetBitrate,W.count++):ie.type==="remote-inbound-rtp"&&(W.packetsLost=ie.packetsLost,W.rttTotal+=ie.roundTripTime,W.jitterTotal+=ie.jitter)})}),1e3);return yield new Promise(te=>setTimeout(te,TEST_DURATION)),clearInterval(Z),K.stop(),B.remove(),yield this.disconnect(),W})}}class PublishAudioCheck extends Checker{get description(){return"Can publish audio"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.connect(),q=yield createLocalAudioTrack();if(yield detectSilence(q,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),B.localParticipant.publishTrack(q),yield new Promise(K=>setTimeout(K,3e3));const H=yield(j=q.sender)===null||j===void 0?void 0:j.getStats();if(!H)throw new Error("Could not get RTCStats");let $=0;if(H.forEach(K=>{K.type==="outbound-rtp"&&(K.kind==="audio"||!K.kind&&K.mediaType==="audio")&&($=K.packetsSent)}),$===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat($," audio packets"))})}}class PublishVideoCheck extends Checker{get description(){return"Can publish video"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.connect(),q=yield createLocalVideoTrack();yield this.checkForVideo(q.mediaStreamTrack),B.localParticipant.publishTrack(q),yield new Promise($=>setTimeout($,5e3));const V=yield(j=q.sender)===null||j===void 0?void 0:j.getStats();if(!V)throw new Error("Could not get RTCStats");let H=0;if(V.forEach($=>{$.type==="outbound-rtp"&&($.kind==="video"||!$.kind&&$.mediaType==="video")&&(H+=$.packetsSent)}),H===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(H," video packets"))})}checkForVideo(j){return __awaiter$1(this,void 0,void 0,function*(){const B=new MediaStream;B.addTrack(j.clone());const q=document.createElement("video");q.srcObject=B,q.muted=!0,yield new Promise(V=>{q.onplay=()=>{setTimeout(()=>{var H,$,K,X;const Q=document.createElement("canvas"),W=j.getSettings(),Z=($=(H=W.width)!==null&&H!==void 0?H:q.videoWidth)!==null&&$!==void 0?$:1280,te=(X=(K=W.height)!==null&&K!==void 0?K:q.videoHeight)!==null&&X!==void 0?X:720;Q.width=Z,Q.height=te;const ie=Q.getContext("2d");ie.drawImage(q,0,0);const oe=ie.getImageData(0,0,Q.width,Q.height).data;let de=!0;for(let le=0;le<oe.length;le+=4)if(oe[le]!==0||oe[le+1]!==0||oe[le+2]!==0){de=!1;break}de?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),V()},1e3)},q.play()}),q.remove()})}}class ReconnectCheck extends Checker{get description(){return"Resuming connection after interruption"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.connect();let q=!1,V=!1,H;const $=new Promise(Q=>{setTimeout(Q,5e3),H=Q}),K=()=>{q=!0};B.on(RoomEvent.SignalReconnecting,K).on(RoomEvent.Reconnecting,K).on(RoomEvent.Reconnected,()=>{V=!0,H(!0)}),(j=B.engine.client.ws)===null||j===void 0||j.close();const X=B.engine.client.onClose;if(X&&X(""),yield $,q){if(!V||B.state!==ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class TURNCheck extends Checker{get description(){return"Can connect via TURN"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var j,B;const q=new SignalClient,V=yield q.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let H=!1,$=!1,K=!1;for(let X of V.iceServers)for(let Q of X.urls)Q.startsWith("turn:")?($=!0,K=!0):Q.startsWith("turns:")&&($=!0,K=!0,H=!0),Q.startsWith("stun:")&&(K=!0);K?$&&!H&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield q.close(),!((B=(j=this.connectOptions)===null||j===void 0?void 0:j.rtcConfig)===null||B===void 0)&&B.iceServers||$?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(X=>setTimeout(X,0)))})}}class WebRTCCheck extends Checker{get description(){return"Establishing WebRTC connection"}perform(){return __awaiter$1(this,void 0,void 0,function*(){let j=!1,B=!1;this.room.on(RoomEvent.SignalConnected,()=>{const q=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(V,H)=>{if(V.candidate){const $=new RTCIceCandidate(V);let K="".concat($.protocol," ").concat($.address,":").concat($.port," ").concat($.type);$.address&&(isIPPrivate($.address)?K+=" (private)":$.protocol==="tcp"&&$.tcpType==="passive"?(j=!0,K+=" (passive)"):$.protocol==="udp"&&(B=!0)),this.appendMessage(K)}q&&q(V,H)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=V=>{V instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(V.errorCode," ").concat(V.errorText," ").concat(V.url))})});try{yield this.connect(),livekitLogger.info("now the room is connected")}catch(q){throw this.appendWarning("ports need to be open on firewall in order to connect."),q}j||this.appendWarning("Server is not configured for ICE/TCP"),B||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function isIPPrivate(U){const j=U.split(".");if(j.length===4){if(j[0]==="10")return!0;if(j[0]==="192"&&j[1]==="168")return!0;if(j[0]==="172"){const B=parseInt(j[1],10);if(B>=16&&B<=31)return!0}}return!1}class WebSocketCheck extends Checker{get description(){return"Connecting to signal connection via WebSocket"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var j,B,q;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let V=new SignalClient;const H=yield V.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(H.serverVersion,".")),((j=H.serverInfo)===null||j===void 0?void 0:j.edition)===ServerInfo_Edition.Cloud&&(!((B=H.serverInfo)===null||B===void 0)&&B.region)&&this.appendMessage("LiveKit Cloud: ".concat((q=H.serverInfo)===null||q===void 0?void 0:q.region)),yield V.close()})}}class ConnectionCheck extends eventsExports.EventEmitter{constructor(j,B){let q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=j,this.token=B,this.options=q}getNextCheckId(){const j=this.checkResults.size;return this.checkResults.set(j,{logs:[],status:CheckStatus.IDLE,name:"",description:""}),j}updateCheck(j,B){this.checkResults.set(j,B),this.emit("checkUpdate",j,B)}isSuccess(){return Array.from(this.checkResults.values()).every(j=>j.status!==CheckStatus.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(j){return __awaiter$1(this,void 0,void 0,function*(){const B=this.getNextCheckId(),q=new j(this.url,this.token,this.options),V=$=>{this.updateCheck(B,$)};q.on("update",V);const H=yield q.run();return q.off("update",V),H})}checkWebsocket(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(WebSocketCheck)})}checkWebRTC(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(WebRTCCheck)})}checkTURN(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(TURNCheck)})}checkReconnect(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(ReconnectCheck)})}checkPublishAudio(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishAudioCheck)})}checkPublishVideo(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishVideoCheck)})}checkConnectionProtocol(){return __awaiter$1(this,void 0,void 0,function*(){const j=yield this.createAndRunCheck(ConnectionProtocolCheck);if(j.data&&"protocol"in j.data){const B=j.data;this.options.protocol=B.protocol}return j})}checkCloudRegion(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(CloudRegionCheck)})}}var src={exports:{}},indexLight={exports:{}},indexMinimal={},minimal={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=U;function U(j,B){for(var q=new Array(arguments.length-1),V=0,H=2,$=!0;H<arguments.length;)q[V++]=arguments[H++];return new Promise(function(X,Q){q[V]=function(Z){if($)if($=!1,Z)Q(Z);else{for(var te=new Array(arguments.length-1),ie=0;ie<te.length;)te[ie++]=arguments[ie];X.apply(null,te)}};try{j.apply(B||null,q)}catch(W){$&&($=!1,Q(W))}})}return aspromise}var base64={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,(function(U){var j=U;j.length=function(K){var X=K.length;if(!X)return 0;for(var Q=0;--X%4>1&&K.charAt(X)==="=";)++Q;return Math.ceil(K.length*3)/4-Q};for(var B=new Array(64),q=new Array(123),V=0;V<64;)q[B[V]=V<26?V+65:V<52?V+71:V<62?V-4:V-59|43]=V++;j.encode=function(K,X,Q){for(var W=null,Z=[],te=0,ie=0,ae;X<Q;){var oe=K[X++];switch(ie){case 0:Z[te++]=B[oe>>2],ae=(oe&3)<<4,ie=1;break;case 1:Z[te++]=B[ae|oe>>4],ae=(oe&15)<<2,ie=2;break;case 2:Z[te++]=B[ae|oe>>6],Z[te++]=B[oe&63],ie=0;break}te>8191&&((W||(W=[])).push(String.fromCharCode.apply(String,Z)),te=0)}return ie&&(Z[te++]=B[ae],Z[te++]=61,ie===1&&(Z[te++]=61)),W?(te&&W.push(String.fromCharCode.apply(String,Z.slice(0,te))),W.join("")):String.fromCharCode.apply(String,Z.slice(0,te))};var H="invalid encoding";j.decode=function(K,X,Q){for(var W=Q,Z=0,te,ie=0;ie<K.length;){var ae=K.charCodeAt(ie++);if(ae===61&&Z>1)break;if((ae=q[ae])===void 0)throw Error(H);switch(Z){case 0:te=ae,Z=1;break;case 1:X[Q++]=te<<2|(ae&48)>>4,te=ae,Z=2;break;case 2:X[Q++]=(te&15)<<4|(ae&60)>>2,te=ae,Z=3;break;case 3:X[Q++]=(te&3)<<6|ae,Z=0;break}}if(Z===1)throw Error(H);return Q-W},j.test=function(K){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(K)}})(base64)),base64}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=U;function U(){this._listeners={}}return U.prototype.on=function(B,q,V){return(this._listeners[B]||(this._listeners[B]=[])).push({fn:q,ctx:V||this}),this},U.prototype.off=function(B,q){if(B===void 0)this._listeners={};else if(q===void 0)this._listeners[B]=[];else for(var V=this._listeners[B],H=0;H<V.length;)V[H].fn===q?V.splice(H,1):++H;return this},U.prototype.emit=function(B){var q=this._listeners[B];if(q){for(var V=[],H=1;H<arguments.length;)V.push(arguments[H++]);for(H=0;H<q.length;)q[H].fn.apply(q[H++].ctx,V)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=U(U);function U(H){return typeof Float32Array<"u"?(function(){var $=new Float32Array([-0]),K=new Uint8Array($.buffer),X=K[3]===128;function Q(ie,ae,oe){$[0]=ie,ae[oe]=K[0],ae[oe+1]=K[1],ae[oe+2]=K[2],ae[oe+3]=K[3]}function W(ie,ae,oe){$[0]=ie,ae[oe]=K[3],ae[oe+1]=K[2],ae[oe+2]=K[1],ae[oe+3]=K[0]}H.writeFloatLE=X?Q:W,H.writeFloatBE=X?W:Q;function Z(ie,ae){return K[0]=ie[ae],K[1]=ie[ae+1],K[2]=ie[ae+2],K[3]=ie[ae+3],$[0]}function te(ie,ae){return K[3]=ie[ae],K[2]=ie[ae+1],K[1]=ie[ae+2],K[0]=ie[ae+3],$[0]}H.readFloatLE=X?Z:te,H.readFloatBE=X?te:Z})():(function(){function $(X,Q,W,Z){var te=Q<0?1:0;if(te&&(Q=-Q),Q===0)X(1/Q>0?0:2147483648,W,Z);else if(isNaN(Q))X(2143289344,W,Z);else if(Q>34028234663852886e22)X((te<<31|2139095040)>>>0,W,Z);else if(Q<11754943508222875e-54)X((te<<31|Math.round(Q/1401298464324817e-60))>>>0,W,Z);else{var ie=Math.floor(Math.log(Q)/Math.LN2),ae=Math.round(Q*Math.pow(2,-ie)*8388608)&8388607;X((te<<31|ie+127<<23|ae)>>>0,W,Z)}}H.writeFloatLE=$.bind(null,j),H.writeFloatBE=$.bind(null,B);function K(X,Q,W){var Z=X(Q,W),te=(Z>>31)*2+1,ie=Z>>>23&255,ae=Z&8388607;return ie===255?ae?NaN:te*(1/0):ie===0?te*1401298464324817e-60*ae:te*Math.pow(2,ie-150)*(ae+8388608)}H.readFloatLE=K.bind(null,q),H.readFloatBE=K.bind(null,V)})(),typeof Float64Array<"u"?(function(){var $=new Float64Array([-0]),K=new Uint8Array($.buffer),X=K[7]===128;function Q(ie,ae,oe){$[0]=ie,ae[oe]=K[0],ae[oe+1]=K[1],ae[oe+2]=K[2],ae[oe+3]=K[3],ae[oe+4]=K[4],ae[oe+5]=K[5],ae[oe+6]=K[6],ae[oe+7]=K[7]}function W(ie,ae,oe){$[0]=ie,ae[oe]=K[7],ae[oe+1]=K[6],ae[oe+2]=K[5],ae[oe+3]=K[4],ae[oe+4]=K[3],ae[oe+5]=K[2],ae[oe+6]=K[1],ae[oe+7]=K[0]}H.writeDoubleLE=X?Q:W,H.writeDoubleBE=X?W:Q;function Z(ie,ae){return K[0]=ie[ae],K[1]=ie[ae+1],K[2]=ie[ae+2],K[3]=ie[ae+3],K[4]=ie[ae+4],K[5]=ie[ae+5],K[6]=ie[ae+6],K[7]=ie[ae+7],$[0]}function te(ie,ae){return K[7]=ie[ae],K[6]=ie[ae+1],K[5]=ie[ae+2],K[4]=ie[ae+3],K[3]=ie[ae+4],K[2]=ie[ae+5],K[1]=ie[ae+6],K[0]=ie[ae+7],$[0]}H.readDoubleLE=X?Z:te,H.readDoubleBE=X?te:Z})():(function(){function $(X,Q,W,Z,te,ie){var ae=Z<0?1:0;if(ae&&(Z=-Z),Z===0)X(0,te,ie+Q),X(1/Z>0?0:2147483648,te,ie+W);else if(isNaN(Z))X(0,te,ie+Q),X(2146959360,te,ie+W);else if(Z>17976931348623157e292)X(0,te,ie+Q),X((ae<<31|2146435072)>>>0,te,ie+W);else{var oe;if(Z<22250738585072014e-324)oe=Z/5e-324,X(oe>>>0,te,ie+Q),X((ae<<31|oe/4294967296)>>>0,te,ie+W);else{var de=Math.floor(Math.log(Z)/Math.LN2);de===1024&&(de=1023),oe=Z*Math.pow(2,-de),X(oe*4503599627370496>>>0,te,ie+Q),X((ae<<31|de+1023<<20|oe*1048576&1048575)>>>0,te,ie+W)}}}H.writeDoubleLE=$.bind(null,j,0,4),H.writeDoubleBE=$.bind(null,B,4,0);function K(X,Q,W,Z,te){var ie=X(Z,te+Q),ae=X(Z,te+W),oe=(ae>>31)*2+1,de=ae>>>20&2047,le=4294967296*(ae&1048575)+ie;return de===2047?le?NaN:oe*(1/0):de===0?oe*5e-324*le:oe*Math.pow(2,de-1075)*(le+4503599627370496)}H.readDoubleLE=K.bind(null,q,0,4),H.readDoubleBE=K.bind(null,V,4,0)})(),H}function j(H,$,K){$[K]=H&255,$[K+1]=H>>>8&255,$[K+2]=H>>>16&255,$[K+3]=H>>>24}function B(H,$,K){$[K]=H>>>24,$[K+1]=H>>>16&255,$[K+2]=H>>>8&255,$[K+3]=H&255}function q(H,$){return(H[$]|H[$+1]<<8|H[$+2]<<16|H[$+3]<<24)>>>0}function V(H,$){return(H[$]<<24|H[$+1]<<16|H[$+2]<<8|H[$+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(U){}return null}return inquire_1}var utf8={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,(function(U){var j=U;j.length=function(q){for(var V=0,H=0,$=0;$<q.length;++$)H=q.charCodeAt($),H<128?V+=1:H<2048?V+=2:(H&64512)===55296&&(q.charCodeAt($+1)&64512)===56320?(++$,V+=4):V+=3;return V},j.read=function(q,V,H){var $=H-V;if($<1)return"";for(var K=null,X=[],Q=0,W;V<H;)W=q[V++],W<128?X[Q++]=W:W>191&&W<224?X[Q++]=(W&31)<<6|q[V++]&63:W>239&&W<365?(W=((W&7)<<18|(q[V++]&63)<<12|(q[V++]&63)<<6|q[V++]&63)-65536,X[Q++]=55296+(W>>10),X[Q++]=56320+(W&1023)):X[Q++]=(W&15)<<12|(q[V++]&63)<<6|q[V++]&63,Q>8191&&((K||(K=[])).push(String.fromCharCode.apply(String,X)),Q=0);return K?(Q&&K.push(String.fromCharCode.apply(String,X.slice(0,Q))),K.join("")):String.fromCharCode.apply(String,X.slice(0,Q))},j.write=function(q,V,H){for(var $=H,K,X,Q=0;Q<q.length;++Q)K=q.charCodeAt(Q),K<128?V[H++]=K:K<2048?(V[H++]=K>>6|192,V[H++]=K&63|128):(K&64512)===55296&&((X=q.charCodeAt(Q+1))&64512)===56320?(K=65536+((K&1023)<<10)+(X&1023),++Q,V[H++]=K>>18|240,V[H++]=K>>12&63|128,V[H++]=K>>6&63|128,V[H++]=K&63|128):(V[H++]=K>>12|224,V[H++]=K>>6&63|128,V[H++]=K&63|128);return H-$}})(utf8)),utf8}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=U;function U(j,B,q){var V=q||8192,H=V>>>1,$=null,K=V;return function(Q){if(Q<1||Q>H)return j(Q);K+Q>V&&($=j(V),K=0);var W=B.call($,K,K+=Q);return K&7&&(K=(K|7)+1),W}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=j;var U=requireMinimal();function j(H,$){this.lo=H>>>0,this.hi=$>>>0}var B=j.zero=new j(0,0);B.toNumber=function(){return 0},B.zzEncode=B.zzDecode=function(){return this},B.length=function(){return 1};var q=j.zeroHash="\0\0\0\0\0\0\0\0";j.fromNumber=function($){if($===0)return B;var K=$<0;K&&($=-$);var X=$>>>0,Q=($-X)/4294967296>>>0;return K&&(Q=~Q>>>0,X=~X>>>0,++X>4294967295&&(X=0,++Q>4294967295&&(Q=0))),new j(X,Q)},j.from=function($){if(typeof $=="number")return j.fromNumber($);if(U.isString($))if(U.Long)$=U.Long.fromString($);else return j.fromNumber(parseInt($,10));return $.low||$.high?new j($.low>>>0,$.high>>>0):B},j.prototype.toNumber=function($){if(!$&&this.hi>>>31){var K=~this.lo+1>>>0,X=~this.hi>>>0;return K||(X=X+1>>>0),-(K+X*4294967296)}return this.lo+this.hi*4294967296},j.prototype.toLong=function($){return U.Long?new U.Long(this.lo|0,this.hi|0,!!$):{low:this.lo|0,high:this.hi|0,unsigned:!!$}};var V=String.prototype.charCodeAt;return j.fromHash=function($){return $===q?B:new j((V.call($,0)|V.call($,1)<<8|V.call($,2)<<16|V.call($,3)<<24)>>>0,(V.call($,4)|V.call($,5)<<8|V.call($,6)<<16|V.call($,7)<<24)>>>0)},j.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},j.prototype.zzEncode=function(){var $=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^$)>>>0,this.lo=(this.lo<<1^$)>>>0,this},j.prototype.zzDecode=function(){var $=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^$)>>>0,this.hi=(this.hi>>>1^$)>>>0,this},j.prototype.length=function(){var $=this.lo,K=(this.lo>>>28|this.hi<<4)>>>0,X=this.hi>>>24;return X===0?K===0?$<16384?$<128?1:2:$<2097152?3:4:K<16384?K<128?5:6:K<2097152?7:8:X<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,(function(U){var j=U;j.asPromise=requireAspromise(),j.base64=requireBase64(),j.EventEmitter=requireEventemitter(),j.float=requireFloat(),j.inquire=requireInquire(),j.utf8=requireUtf8(),j.pool=requirePool(),j.LongBits=requireLongbits(),j.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),j.global=j.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||minimal,j.emptyArray=Object.freeze?Object.freeze([]):[],j.emptyObject=Object.freeze?Object.freeze({}):{},j.isInteger=Number.isInteger||function(H){return typeof H=="number"&&isFinite(H)&&Math.floor(H)===H},j.isString=function(H){return typeof H=="string"||H instanceof String},j.isObject=function(H){return H&&typeof H=="object"},j.isset=j.isSet=function(H,$){var K=H[$];return K!=null&&H.hasOwnProperty($)?typeof K!="object"||(Array.isArray(K)?K.length:Object.keys(K).length)>0:!1},j.Buffer=(function(){try{var V=j.inquire("buffer").Buffer;return V.prototype.utf8Write?V:null}catch{return null}})(),j._Buffer_from=null,j._Buffer_allocUnsafe=null,j.newBuffer=function(H){return typeof H=="number"?j.Buffer?j._Buffer_allocUnsafe(H):new j.Array(H):j.Buffer?j._Buffer_from(H):typeof Uint8Array>"u"?H:new Uint8Array(H)},j.Array=typeof Uint8Array<"u"?Uint8Array:Array,j.Long=j.global.dcodeIO&&j.global.dcodeIO.Long||j.global.Long||j.inquire("long"),j.key2Re=/^true|false|0|1$/,j.key32Re=/^-?(?:0|[1-9][0-9]*)$/,j.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,j.longToHash=function(H){return H?j.LongBits.from(H).toHash():j.LongBits.zeroHash},j.longFromHash=function(H,$){var K=j.LongBits.fromHash(H);return j.Long?j.Long.fromBits(K.lo,K.hi,$):K.toNumber(!!$)};function B(V,H,$){for(var K=Object.keys(H),X=0;X<K.length;++X)(V[K[X]]===void 0||!$)&&(V[K[X]]=H[K[X]]);return V}j.merge=B,j.lcFirst=function(H){return H.charAt(0).toLowerCase()+H.substring(1)};function q(V){function H($,K){if(!(this instanceof H))return new H($,K);Object.defineProperty(this,"message",{get:function(){return $}}),Error.captureStackTrace?Error.captureStackTrace(this,H):Object.defineProperty(this,"stack",{value:new Error().stack||""}),K&&B(this,K)}return H.prototype=Object.create(Error.prototype,{constructor:{value:H,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return V},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),H}j.newError=q,j.ProtocolError=q("ProtocolError"),j.oneOfGetter=function(H){for(var $={},K=0;K<H.length;++K)$[H[K]]=1;return function(){for(var X=Object.keys(this),Q=X.length-1;Q>-1;--Q)if($[X[Q]]===1&&this[X[Q]]!==void 0&&this[X[Q]]!==null)return X[Q]}},j.oneOfSetter=function(H){return function($){for(var K=0;K<H.length;++K)H[K]!==$&&delete this[H[K]]}},j.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},j._configure=function(){var V=j.Buffer;if(!V){j._Buffer_from=j._Buffer_allocUnsafe=null;return}j._Buffer_from=V.from!==Uint8Array.from&&V.from||function($,K){return new V($,K)},j._Buffer_allocUnsafe=V.allocUnsafe||function($){return new V($)}}})(minimal)),minimal}var writer,hasRequiredWriter;function requireWriter(){if(hasRequiredWriter)return writer;hasRequiredWriter=1,writer=X;var U=requireMinimal(),j,B=U.LongBits,q=U.base64,V=U.utf8;function H(de,le,ue){this.fn=de,this.len=le,this.next=void 0,this.val=ue}function $(){}function K(de){this.head=de.head,this.tail=de.tail,this.len=de.len,this.next=de.states}function X(){this.len=0,this.head=new H($,0,0),this.tail=this.head,this.states=null}var Q=function(){return U.Buffer?function(){return(X.create=function(){return new j})()}:function(){return new X}};X.create=Q(),X.alloc=function(le){return new U.Array(le)},U.Array!==Array&&(X.alloc=U.pool(X.alloc,U.Array.prototype.subarray)),X.prototype._push=function(le,ue,he){return this.tail=this.tail.next=new H(le,ue,he),this.len+=ue,this};function W(de,le,ue){le[ue]=de&255}function Z(de,le,ue){for(;de>127;)le[ue++]=de&127|128,de>>>=7;le[ue]=de}function te(de,le){this.len=de,this.next=void 0,this.val=le}te.prototype=Object.create(H.prototype),te.prototype.fn=Z,X.prototype.uint32=function(le){return this.len+=(this.tail=this.tail.next=new te((le=le>>>0)<128?1:le<16384?2:le<2097152?3:le<268435456?4:5,le)).len,this},X.prototype.int32=function(le){return le<0?this._push(ie,10,B.fromNumber(le)):this.uint32(le)},X.prototype.sint32=function(le){return this.uint32((le<<1^le>>31)>>>0)};function ie(de,le,ue){for(;de.hi;)le[ue++]=de.lo&127|128,de.lo=(de.lo>>>7|de.hi<<25)>>>0,de.hi>>>=7;for(;de.lo>127;)le[ue++]=de.lo&127|128,de.lo=de.lo>>>7;le[ue++]=de.lo}X.prototype.uint64=function(le){var ue=B.from(le);return this._push(ie,ue.length(),ue)},X.prototype.int64=X.prototype.uint64,X.prototype.sint64=function(le){var ue=B.from(le).zzEncode();return this._push(ie,ue.length(),ue)},X.prototype.bool=function(le){return this._push(W,1,le?1:0)};function ae(de,le,ue){le[ue]=de&255,le[ue+1]=de>>>8&255,le[ue+2]=de>>>16&255,le[ue+3]=de>>>24}X.prototype.fixed32=function(le){return this._push(ae,4,le>>>0)},X.prototype.sfixed32=X.prototype.fixed32,X.prototype.fixed64=function(le){var ue=B.from(le);return this._push(ae,4,ue.lo)._push(ae,4,ue.hi)},X.prototype.sfixed64=X.prototype.fixed64,X.prototype.float=function(le){return this._push(U.float.writeFloatLE,4,le)},X.prototype.double=function(le){return this._push(U.float.writeDoubleLE,8,le)};var oe=U.Array.prototype.set?function(le,ue,he){ue.set(le,he)}:function(le,ue,he){for(var me=0;me<le.length;++me)ue[he+me]=le[me]};return X.prototype.bytes=function(le){var ue=le.length>>>0;if(!ue)return this._push(W,1,0);if(U.isString(le)){var he=X.alloc(ue=q.length(le));q.decode(le,he,0),le=he}return this.uint32(ue)._push(oe,ue,le)},X.prototype.string=function(le){var ue=V.length(le);return ue?this.uint32(ue)._push(V.write,ue,le):this._push(W,1,0)},X.prototype.fork=function(){return this.states=new K(this),this.head=this.tail=new H($,0,0),this.len=0,this},X.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new H($,0,0),this.len=0),this},X.prototype.ldelim=function(){var le=this.head,ue=this.tail,he=this.len;return this.reset().uint32(he),he&&(this.tail.next=le.next,this.tail=ue,this.len+=he),this},X.prototype.finish=function(){for(var le=this.head.next,ue=this.constructor.alloc(this.len),he=0;le;)le.fn(le.val,ue,he),he+=le.len,le=le.next;return ue},X._configure=function(de){j=de,X.create=Q(),j._configure()},writer}var writer_buffer,hasRequiredWriter_buffer;function requireWriter_buffer(){if(hasRequiredWriter_buffer)return writer_buffer;hasRequiredWriter_buffer=1,writer_buffer=B;var U=requireWriter();(B.prototype=Object.create(U.prototype)).constructor=B;var j=requireMinimal();function B(){U.call(this)}B._configure=function(){B.alloc=j._Buffer_allocUnsafe,B.writeBytesBuffer=j.Buffer&&j.Buffer.prototype instanceof Uint8Array&&j.Buffer.prototype.set.name==="set"?function(H,$,K){$.set(H,K)}:function(H,$,K){if(H.copy)H.copy($,K,0,H.length);else for(var X=0;X<H.length;)$[K++]=H[X++]}},B.prototype.bytes=function(H){j.isString(H)&&(H=j._Buffer_from(H,"base64"));var $=H.length>>>0;return this.uint32($),$&&this._push(B.writeBytesBuffer,$,H),this};function q(V,H,$){V.length<40?j.utf8.write(V,H,$):H.utf8Write?H.utf8Write(V,$):H.write(V,$)}return B.prototype.string=function(H){var $=j.Buffer.byteLength(H);return this.uint32($),$&&this._push(q,$,H),this},B._configure(),writer_buffer}var reader,hasRequiredReader;function requireReader(){if(hasRequiredReader)return reader;hasRequiredReader=1,reader=H;var U=requireMinimal(),j,B=U.LongBits,q=U.utf8;function V(Z,te){return RangeError("index out of range: "+Z.pos+" + "+(te||1)+" > "+Z.len)}function H(Z){this.buf=Z,this.pos=0,this.len=Z.length}var $=typeof Uint8Array<"u"?function(te){if(te instanceof Uint8Array||Array.isArray(te))return new H(te);throw Error("illegal buffer")}:function(te){if(Array.isArray(te))return new H(te);throw Error("illegal buffer")},K=function(){return U.Buffer?function(ie){return(H.create=function(oe){return U.Buffer.isBuffer(oe)?new j(oe):$(oe)})(ie)}:$};H.create=K(),H.prototype._slice=U.Array.prototype.subarray||U.Array.prototype.slice,H.prototype.uint32=(function(){var te=4294967295;return function(){if(te=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(te=(te|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(te=(te|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(te=(te|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(te=(te|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return te;if((this.pos+=5)>this.len)throw this.pos=this.len,V(this,10);return te}})(),H.prototype.int32=function(){return this.uint32()|0},H.prototype.sint32=function(){var te=this.uint32();return te>>>1^-(te&1)|0};function X(){var Z=new B(0,0),te=0;if(this.len-this.pos>4){for(;te<4;++te)if(Z.lo=(Z.lo|(this.buf[this.pos]&127)<<te*7)>>>0,this.buf[this.pos++]<128)return Z;if(Z.lo=(Z.lo|(this.buf[this.pos]&127)<<28)>>>0,Z.hi=(Z.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return Z;te=0}else{for(;te<3;++te){if(this.pos>=this.len)throw V(this);if(Z.lo=(Z.lo|(this.buf[this.pos]&127)<<te*7)>>>0,this.buf[this.pos++]<128)return Z}return Z.lo=(Z.lo|(this.buf[this.pos++]&127)<<te*7)>>>0,Z}if(this.len-this.pos>4){for(;te<5;++te)if(Z.hi=(Z.hi|(this.buf[this.pos]&127)<<te*7+3)>>>0,this.buf[this.pos++]<128)return Z}else for(;te<5;++te){if(this.pos>=this.len)throw V(this);if(Z.hi=(Z.hi|(this.buf[this.pos]&127)<<te*7+3)>>>0,this.buf[this.pos++]<128)return Z}throw Error("invalid varint encoding")}H.prototype.bool=function(){return this.uint32()!==0};function Q(Z,te){return(Z[te-4]|Z[te-3]<<8|Z[te-2]<<16|Z[te-1]<<24)>>>0}H.prototype.fixed32=function(){if(this.pos+4>this.len)throw V(this,4);return Q(this.buf,this.pos+=4)},H.prototype.sfixed32=function(){if(this.pos+4>this.len)throw V(this,4);return Q(this.buf,this.pos+=4)|0};function W(){if(this.pos+8>this.len)throw V(this,8);return new B(Q(this.buf,this.pos+=4),Q(this.buf,this.pos+=4))}return H.prototype.float=function(){if(this.pos+4>this.len)throw V(this,4);var te=U.float.readFloatLE(this.buf,this.pos);return this.pos+=4,te},H.prototype.double=function(){if(this.pos+8>this.len)throw V(this,4);var te=U.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,te},H.prototype.bytes=function(){var te=this.uint32(),ie=this.pos,ae=this.pos+te;if(ae>this.len)throw V(this,te);if(this.pos+=te,Array.isArray(this.buf))return this.buf.slice(ie,ae);if(ie===ae){var oe=U.Buffer;return oe?oe.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,ie,ae)},H.prototype.string=function(){var te=this.bytes();return q.read(te,0,te.length)},H.prototype.skip=function(te){if(typeof te=="number"){if(this.pos+te>this.len)throw V(this,te);this.pos+=te}else do if(this.pos>=this.len)throw V(this);while(this.buf[this.pos++]&128);return this},H.prototype.skipType=function(Z){switch(Z){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(Z=this.uint32()&7)!==4;)this.skipType(Z);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+Z+" at offset "+this.pos)}return this},H._configure=function(Z){j=Z,H.create=K(),j._configure();var te=U.Long?"toLong":"toNumber";U.merge(H.prototype,{int64:function(){return X.call(this)[te](!1)},uint64:function(){return X.call(this)[te](!0)},sint64:function(){return X.call(this).zzDecode()[te](!1)},fixed64:function(){return W.call(this)[te](!0)},sfixed64:function(){return W.call(this)[te](!1)}})},reader}var reader_buffer,hasRequiredReader_buffer;function requireReader_buffer(){if(hasRequiredReader_buffer)return reader_buffer;hasRequiredReader_buffer=1,reader_buffer=B;var U=requireReader();(B.prototype=Object.create(U.prototype)).constructor=B;var j=requireMinimal();function B(q){U.call(this,q)}return B._configure=function(){j.Buffer&&(B.prototype._slice=j.Buffer.prototype.slice)},B.prototype.string=function(){var V=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+V,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+V,this.len))},B._configure(),reader_buffer}var rpc={},service$1,hasRequiredService$1;function requireService$1(){if(hasRequiredService$1)return service$1;hasRequiredService$1=1,service$1=j;var U=requireMinimal();(j.prototype=Object.create(U.EventEmitter.prototype)).constructor=j;function j(B,q,V){if(typeof B!="function")throw TypeError("rpcImpl must be a function");U.EventEmitter.call(this),this.rpcImpl=B,this.requestDelimited=!!q,this.responseDelimited=!!V}return j.prototype.rpcCall=function B(q,V,H,$,K){if(!$)throw TypeError("request must be specified");var X=this;if(!K)return U.asPromise(B,X,q,V,H,$);if(!X.rpcImpl){setTimeout(function(){K(Error("already ended"))},0);return}try{return X.rpcImpl(q,V[X.requestDelimited?"encodeDelimited":"encode"]($).finish(),function(W,Z){if(W)return X.emit("error",W,q),K(W);if(Z===null){X.end(!0);return}if(!(Z instanceof H))try{Z=H[X.responseDelimited?"decodeDelimited":"decode"](Z)}catch(te){return X.emit("error",te,q),K(te)}return X.emit("data",Z,q),K(null,Z)})}catch(Q){X.emit("error",Q,q),setTimeout(function(){K(Q)},0);return}},j.prototype.end=function(q){return this.rpcImpl&&(q||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},service$1}var hasRequiredRpc;function requireRpc(){return hasRequiredRpc||(hasRequiredRpc=1,(function(U){var j=U;j.Service=requireService$1()})(rpc)),rpc}var roots,hasRequiredRoots;function requireRoots(){return hasRequiredRoots||(hasRequiredRoots=1,roots={}),roots}var hasRequiredIndexMinimal;function requireIndexMinimal(){return hasRequiredIndexMinimal||(hasRequiredIndexMinimal=1,(function(U){var j=U;j.build="minimal",j.Writer=requireWriter(),j.BufferWriter=requireWriter_buffer(),j.Reader=requireReader(),j.BufferReader=requireReader_buffer(),j.util=requireMinimal(),j.rpc=requireRpc(),j.roots=requireRoots(),j.configure=B;function B(){j.util._configure(),j.Writer._configure(j.BufferWriter),j.Reader._configure(j.BufferReader)}B()})(indexMinimal)),indexMinimal}var types={},util={exports:{}},codegen_1,hasRequiredCodegen;function requireCodegen(){if(hasRequiredCodegen)return codegen_1;hasRequiredCodegen=1,codegen_1=U;function U(j,B){typeof j=="string"&&(B=j,j=void 0);var q=[];function V($){if(typeof $!="string"){var K=H();if(U.verbose&&console.log("codegen: "+K),K="return "+K,$){for(var X=Object.keys($),Q=new Array(X.length+1),W=new Array(X.length),Z=0;Z<X.length;)Q[Z]=X[Z],W[Z]=$[X[Z++]];return Q[Z]=K,Function.apply(null,Q).apply(null,W)}return Function(K)()}for(var te=new Array(arguments.length-1),ie=0;ie<te.length;)te[ie]=arguments[++ie];if(ie=0,$=$.replace(/%([%dfijs])/g,function(oe,de){var le=te[ie++];switch(de){case"d":case"f":return String(Number(le));case"i":return String(Math.floor(le));case"j":return JSON.stringify(le);case"s":return String(le)}return"%"}),ie!==te.length)throw Error("parameter count mismatch");return q.push($),V}function H($){return"function "+($||B||"")+"("+(j&&j.join(",")||"")+`){
  `+q.join(`
  `)+`
}`}return V.toString=H,V}return U.verbose=!1,codegen_1}var fetch_1,hasRequiredFetch;function requireFetch(){if(hasRequiredFetch)return fetch_1;hasRequiredFetch=1,fetch_1=q;var U=requireAspromise(),j=requireInquire(),B=j("fs");function q(V,H,$){return typeof H=="function"?($=H,H={}):H||(H={}),$?!H.xhr&&B&&B.readFile?B.readFile(V,function(X,Q){return X&&typeof XMLHttpRequest<"u"?q.xhr(V,H,$):X?$(X):$(null,H.binary?Q:Q.toString("utf8"))}):q.xhr(V,H,$):U(q,this,V,H)}return q.xhr=function(H,$,K){var X=new XMLHttpRequest;X.onreadystatechange=function(){if(X.readyState===4){if(X.status!==0&&X.status!==200)return K(Error("status "+X.status));if($.binary){var W=X.response;if(!W){W=[];for(var Z=0;Z<X.responseText.length;++Z)W.push(X.responseText.charCodeAt(Z)&255)}return K(null,typeof Uint8Array<"u"?new Uint8Array(W):W)}return K(null,X.responseText)}},$.binary&&("overrideMimeType"in X&&X.overrideMimeType("text/plain; charset=x-user-defined"),X.responseType="arraybuffer"),X.open("GET",H),X.send()},fetch_1}var path={},hasRequiredPath;function requirePath(){return hasRequiredPath||(hasRequiredPath=1,(function(U){var j=U,B=j.isAbsolute=function(H){return/^(?:\/|\w+:)/.test(H)},q=j.normalize=function(H){H=H.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var $=H.split("/"),K=B(H),X="";K&&(X=$.shift()+"/");for(var Q=0;Q<$.length;)$[Q]===".."?Q>0&&$[Q-1]!==".."?$.splice(--Q,2):K?$.splice(Q,1):++Q:$[Q]==="."?$.splice(Q,1):++Q;return X+$.join("/")};j.resolve=function(H,$,K){return K||($=q($)),B($)?$:(K||(H=q(H)),(H=H.replace(/(?:\/|^)[^/]+$/,"")).length?q(H+"/"+$):$)}})(path)),path}var namespace,hasRequiredNamespace;function requireNamespace(){if(hasRequiredNamespace)return namespace;hasRequiredNamespace=1,namespace=X;var U=requireObject();((X.prototype=Object.create(U.prototype)).constructor=X).className="Namespace";var j=requireField(),B=requireUtil(),q=requireOneof(),V,H,$;X.fromJSON=function(Z,te){return new X(Z,te.options).addJSON(te.nested)};function K(W,Z){if(W&&W.length){for(var te={},ie=0;ie<W.length;++ie)te[W[ie].name]=W[ie].toJSON(Z);return te}}X.arrayToJSON=K,X.isReservedId=function(Z,te){if(Z){for(var ie=0;ie<Z.length;++ie)if(typeof Z[ie]!="string"&&Z[ie][0]<=te&&Z[ie][1]>te)return!0}return!1},X.isReservedName=function(Z,te){if(Z){for(var ie=0;ie<Z.length;++ie)if(Z[ie]===te)return!0}return!1};function X(W,Z){U.call(this,W,Z),this.nested=void 0,this._nestedArray=null}function Q(W){return W._nestedArray=null,W}return Object.defineProperty(X.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=B.toArray(this.nested))}}),X.prototype.toJSON=function(Z){return B.toObject(["options",this.options,"nested",K(this.nestedArray,Z)])},X.prototype.addJSON=function(Z){var te=this;if(Z)for(var ie=Object.keys(Z),ae=0,oe;ae<ie.length;++ae)oe=Z[ie[ae]],te.add((oe.fields!==void 0?V.fromJSON:oe.values!==void 0?$.fromJSON:oe.methods!==void 0?H.fromJSON:oe.id!==void 0?j.fromJSON:X.fromJSON)(ie[ae],oe));return this},X.prototype.get=function(Z){return this.nested&&this.nested[Z]||null},X.prototype.getEnum=function(Z){if(this.nested&&this.nested[Z]instanceof $)return this.nested[Z].values;throw Error("no such enum: "+Z)},X.prototype.add=function(Z){if(!(Z instanceof j&&Z.extend!==void 0||Z instanceof V||Z instanceof q||Z instanceof $||Z instanceof H||Z instanceof X))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var te=this.get(Z.name);if(te)if(te instanceof X&&Z instanceof X&&!(te instanceof V||te instanceof H)){for(var ie=te.nestedArray,ae=0;ae<ie.length;++ae)Z.add(ie[ae]);this.remove(te),this.nested||(this.nested={}),Z.setOptions(te.options,!0)}else throw Error("duplicate name '"+Z.name+"' in "+this)}return this.nested[Z.name]=Z,this instanceof V||this instanceof H||this instanceof $||this instanceof j||Z._edition||(Z._edition=Z._defaultEdition),Z.onAdd(this),Q(this)},X.prototype.remove=function(Z){if(!(Z instanceof U))throw TypeError("object must be a ReflectionObject");if(Z.parent!==this)throw Error(Z+" is not a member of "+this);return delete this.nested[Z.name],Object.keys(this.nested).length||(this.nested=void 0),Z.onRemove(this),Q(this)},X.prototype.define=function(Z,te){if(B.isString(Z))Z=Z.split(".");else if(!Array.isArray(Z))throw TypeError("illegal path");if(Z&&Z.length&&Z[0]==="")throw Error("path must be relative");for(var ie=this;Z.length>0;){var ae=Z.shift();if(ie.nested&&ie.nested[ae]){if(ie=ie.nested[ae],!(ie instanceof X))throw Error("path conflicts with non-namespace objects")}else ie.add(ie=new X(ae))}return te&&ie.addJSON(te),ie},X.prototype.resolveAll=function(){var Z=this.nestedArray,te=0;for(this.resolve();te<Z.length;)Z[te]instanceof X?Z[te++].resolveAll():Z[te++].resolve();return this},X.prototype._resolveFeaturesRecursive=function(Z){return Z=this._edition||Z,U.prototype._resolveFeaturesRecursive.call(this,Z),this.nestedArray.forEach(te=>{te._resolveFeaturesRecursive(Z)}),this},X.prototype.lookup=function(Z,te,ie){if(typeof te=="boolean"?(ie=te,te=void 0):te&&!Array.isArray(te)&&(te=[te]),B.isString(Z)&&Z.length){if(Z===".")return this.root;Z=Z.split(".")}else if(!Z.length)return this;if(Z[0]==="")return this.root.lookup(Z.slice(1),te);var ae=this.get(Z[0]);if(ae){if(Z.length===1){if(!te||te.indexOf(ae.constructor)>-1)return ae}else if(ae instanceof X&&(ae=ae.lookup(Z.slice(1),te,!0)))return ae}else for(var oe=0;oe<this.nestedArray.length;++oe)if(this._nestedArray[oe]instanceof X&&(ae=this._nestedArray[oe].lookup(Z,te,!0)))return ae;return this.parent===null||ie?null:this.parent.lookup(Z,te)},X.prototype.lookupType=function(Z){var te=this.lookup(Z,[V]);if(!te)throw Error("no such type: "+Z);return te},X.prototype.lookupEnum=function(Z){var te=this.lookup(Z,[$]);if(!te)throw Error("no such Enum '"+Z+"' in "+this);return te},X.prototype.lookupTypeOrEnum=function(Z){var te=this.lookup(Z,[V,$]);if(!te)throw Error("no such Type or Enum '"+Z+"' in "+this);return te},X.prototype.lookupService=function(Z){var te=this.lookup(Z,[H]);if(!te)throw Error("no such Service '"+Z+"' in "+this);return te},X._configure=function(W,Z,te){V=W,H=Z,$=te},namespace}var mapfield,hasRequiredMapfield;function requireMapfield(){if(hasRequiredMapfield)return mapfield;hasRequiredMapfield=1,mapfield=q;var U=requireField();((q.prototype=Object.create(U.prototype)).constructor=q).className="MapField";var j=requireTypes(),B=requireUtil();function q(V,H,$,K,X,Q){if(U.call(this,V,H,K,void 0,void 0,X,Q),!B.isString($))throw TypeError("keyType must be a string");this.keyType=$,this.resolvedKeyType=null,this.map=!0}return q.fromJSON=function(H,$){return new q(H,$.id,$.keyType,$.type,$.options,$.comment)},q.prototype.toJSON=function(H){var $=H?!!H.keepComments:!1;return B.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",$?this.comment:void 0])},q.prototype.resolve=function(){if(this.resolved)return this;if(j.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return U.prototype.resolve.call(this)},q.d=function(H,$,K){return typeof K=="function"?K=B.decorateType(K).name:K&&typeof K=="object"&&(K=B.decorateEnum(K).name),function(Q,W){B.decorateType(Q.constructor).add(new q(W,H,$,K))}},mapfield}var method,hasRequiredMethod;function requireMethod(){if(hasRequiredMethod)return method;hasRequiredMethod=1,method=B;var U=requireObject();((B.prototype=Object.create(U.prototype)).constructor=B).className="Method";var j=requireUtil();function B(q,V,H,$,K,X,Q,W,Z){if(j.isObject(K)?(Q=K,K=X=void 0):j.isObject(X)&&(Q=X,X=void 0),!(V===void 0||j.isString(V)))throw TypeError("type must be a string");if(!j.isString(H))throw TypeError("requestType must be a string");if(!j.isString($))throw TypeError("responseType must be a string");U.call(this,q,Q),this.type=V||"rpc",this.requestType=H,this.requestStream=K?!0:void 0,this.responseType=$,this.responseStream=X?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=W,this.parsedOptions=Z}return B.fromJSON=function(V,H){return new B(V,H.type,H.requestType,H.responseType,H.requestStream,H.responseStream,H.options,H.comment,H.parsedOptions)},B.prototype.toJSON=function(V){var H=V?!!V.keepComments:!1;return j.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",H?this.comment:void 0,"parsedOptions",this.parsedOptions])},B.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),U.prototype.resolve.call(this))},method}var service,hasRequiredService;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=V;var U=requireNamespace();((V.prototype=Object.create(U.prototype)).constructor=V).className="Service";var j=requireMethod(),B=requireUtil(),q=requireRpc();function V($,K){U.call(this,$,K),this.methods={},this._methodsArray=null}V.fromJSON=function(K,X){var Q=new V(K,X.options);if(X.methods)for(var W=Object.keys(X.methods),Z=0;Z<W.length;++Z)Q.add(j.fromJSON(W[Z],X.methods[W[Z]]));return X.nested&&Q.addJSON(X.nested),X.edition&&(Q._edition=X.edition),Q.comment=X.comment,Q._defaultEdition="proto3",Q},V.prototype.toJSON=function(K){var X=U.prototype.toJSON.call(this,K),Q=K?!!K.keepComments:!1;return B.toObject(["edition",this._editionToJSON(),"options",X&&X.options||void 0,"methods",U.arrayToJSON(this.methodsArray,K)||{},"nested",X&&X.nested||void 0,"comment",Q?this.comment:void 0])},Object.defineProperty(V.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=B.toArray(this.methods))}});function H($){return $._methodsArray=null,$}return V.prototype.get=function(K){return this.methods[K]||U.prototype.get.call(this,K)},V.prototype.resolveAll=function(){U.prototype.resolve.call(this);for(var K=this.methodsArray,X=0;X<K.length;++X)K[X].resolve();return this},V.prototype._resolveFeaturesRecursive=function(K){return K=this._edition||K,U.prototype._resolveFeaturesRecursive.call(this,K),this.methodsArray.forEach(X=>{X._resolveFeaturesRecursive(K)}),this},V.prototype.add=function(K){if(this.get(K.name))throw Error("duplicate name '"+K.name+"' in "+this);return K instanceof j?(this.methods[K.name]=K,K.parent=this,H(this)):U.prototype.add.call(this,K)},V.prototype.remove=function(K){if(K instanceof j){if(this.methods[K.name]!==K)throw Error(K+" is not a member of "+this);return delete this.methods[K.name],K.parent=null,H(this)}return U.prototype.remove.call(this,K)},V.prototype.create=function(K,X,Q){for(var W=new q.Service(K,X,Q),Z=0,te;Z<this.methodsArray.length;++Z){var ie=B.lcFirst((te=this._methodsArray[Z]).resolve().name).replace(/[^$\w_]/g,"");W[ie]=B.codegen(["r","c"],B.isReserved(ie)?ie+"_":ie)("return this.rpcCall(m,q,s,r,c)")({m:te,q:te.resolvedRequestType.ctor,s:te.resolvedResponseType.ctor})}return W},service}var message,hasRequiredMessage;function requireMessage(){if(hasRequiredMessage)return message;hasRequiredMessage=1,message=j;var U=requireMinimal();function j(B){if(B)for(var q=Object.keys(B),V=0;V<q.length;++V)this[q[V]]=B[q[V]]}return j.create=function(q){return this.$type.create(q)},j.encode=function(q,V){return this.$type.encode(q,V)},j.encodeDelimited=function(q,V){return this.$type.encodeDelimited(q,V)},j.decode=function(q){return this.$type.decode(q)},j.decodeDelimited=function(q){return this.$type.decodeDelimited(q)},j.verify=function(q){return this.$type.verify(q)},j.fromObject=function(q){return this.$type.fromObject(q)},j.toObject=function(q,V){return this.$type.toObject(q,V)},j.prototype.toJSON=function(){return this.$type.toObject(this,U.toJSONOptions)},message}var decoder_1,hasRequiredDecoder;function requireDecoder(){if(hasRequiredDecoder)return decoder_1;hasRequiredDecoder=1,decoder_1=V;var U=require_enum(),j=requireTypes(),B=requireUtil();function q(H){return"missing required '"+H.name+"'"}function V(H){for(var $=B.codegen(["r","l","e"],H.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(H.fieldsArray.filter(function(te){return te.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),K=0;K<H.fieldsArray.length;++K){var X=H._fieldsArray[K].resolve(),Q=X.resolvedType instanceof U?"int32":X.type,W="m"+B.safeProp(X.name);$("case %i: {",X.id),X.map?($("if(%s===util.emptyObject)",W)("%s={}",W)("var c2 = r.uint32()+r.pos"),j.defaults[X.keyType]!==void 0?$("k=%j",j.defaults[X.keyType]):$("k=null"),j.defaults[Q]!==void 0?$("value=%j",j.defaults[Q]):$("value=null"),$("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",X.keyType)("case 2:"),j.basic[Q]===void 0?$("value=types[%i].decode(r,r.uint32())",K):$("value=r.%s()",Q),$("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),j.long[X.keyType]!==void 0?$('%s[typeof k==="object"?util.longToHash(k):k]=value',W):$("%s[k]=value",W)):X.repeated?($("if(!(%s&&%s.length))",W,W)("%s=[]",W),j.packed[Q]!==void 0&&$("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",W,Q)("}else"),j.basic[Q]===void 0?$(X.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",W,K):$("%s.push(r.%s())",W,Q)):j.basic[Q]===void 0?$(X.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",W,K):$("%s=r.%s()",W,Q),$("break")("}")}for($("default:")("r.skipType(t&7)")("break")("}")("}"),K=0;K<H._fieldsArray.length;++K){var Z=H._fieldsArray[K];Z.required&&$("if(!m.hasOwnProperty(%j))",Z.name)("throw util.ProtocolError(%j,{instance:m})",q(Z))}return $("return m")}return decoder_1}var verifier_1,hasRequiredVerifier;function requireVerifier(){if(hasRequiredVerifier)return verifier_1;hasRequiredVerifier=1,verifier_1=H;var U=require_enum(),j=requireUtil();function B($,K){return $.name+": "+K+($.repeated&&K!=="array"?"[]":$.map&&K!=="object"?"{k:"+$.keyType+"}":"")+" expected"}function q($,K,X,Q){if(K.resolvedType)if(K.resolvedType instanceof U){$("switch(%s){",Q)("default:")("return%j",B(K,"enum value"));for(var W=Object.keys(K.resolvedType.values),Z=0;Z<W.length;++Z)$("case %i:",K.resolvedType.values[W[Z]]);$("break")("}")}else $("{")("var e=types[%i].verify(%s);",X,Q)("if(e)")("return%j+e",K.name+".")("}");else switch(K.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":$("if(!util.isInteger(%s))",Q)("return%j",B(K,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":$("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",Q,Q,Q,Q)("return%j",B(K,"integer|Long"));break;case"float":case"double":$('if(typeof %s!=="number")',Q)("return%j",B(K,"number"));break;case"bool":$('if(typeof %s!=="boolean")',Q)("return%j",B(K,"boolean"));break;case"string":$("if(!util.isString(%s))",Q)("return%j",B(K,"string"));break;case"bytes":$('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',Q,Q,Q)("return%j",B(K,"buffer"));break}return $}function V($,K,X){switch(K.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":$("if(!util.key32Re.test(%s))",X)("return%j",B(K,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":$("if(!util.key64Re.test(%s))",X)("return%j",B(K,"integer|Long key"));break;case"bool":$("if(!util.key2Re.test(%s))",X)("return%j",B(K,"boolean key"));break}return $}function H($){var K=j.codegen(["m"],$.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),X=$.oneofsArray,Q={};X.length&&K("var p={}");for(var W=0;W<$.fieldsArray.length;++W){var Z=$._fieldsArray[W].resolve(),te="m"+j.safeProp(Z.name);if(Z.optional&&K("if(%s!=null&&m.hasOwnProperty(%j)){",te,Z.name),Z.map)K("if(!util.isObject(%s))",te)("return%j",B(Z,"object"))("var k=Object.keys(%s)",te)("for(var i=0;i<k.length;++i){"),V(K,Z,"k[i]"),q(K,Z,W,te+"[k[i]]")("}");else if(Z.repeated)K("if(!Array.isArray(%s))",te)("return%j",B(Z,"array"))("for(var i=0;i<%s.length;++i){",te),q(K,Z,W,te+"[i]")("}");else{if(Z.partOf){var ie=j.safeProp(Z.partOf.name);Q[Z.partOf.name]===1&&K("if(p%s===1)",ie)("return%j",Z.partOf.name+": multiple values"),Q[Z.partOf.name]=1,K("p%s=1",ie)}q(K,Z,W,te)}Z.optional&&K("}")}return K("return null")}return verifier_1}var converter={},hasRequiredConverter;function requireConverter(){return hasRequiredConverter||(hasRequiredConverter=1,(function(U){var j=U,B=require_enum(),q=requireUtil();function V($,K,X,Q){var W=!1;if(K.resolvedType)if(K.resolvedType instanceof B){$("switch(d%s){",Q);for(var Z=K.resolvedType.values,te=Object.keys(Z),ie=0;ie<te.length;++ie)Z[te[ie]]===K.typeDefault&&!W&&($("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',Q,Q,Q),K.repeated||$("break"),W=!0),$("case%j:",te[ie])("case %i:",Z[te[ie]])("m%s=%j",Q,Z[te[ie]])("break");$("}")}else $('if(typeof d%s!=="object")',Q)("throw TypeError(%j)",K.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",Q,X,Q);else{var ae=!1;switch(K.type){case"double":case"float":$("m%s=Number(d%s)",Q,Q);break;case"uint32":case"fixed32":$("m%s=d%s>>>0",Q,Q);break;case"int32":case"sint32":case"sfixed32":$("m%s=d%s|0",Q,Q);break;case"uint64":ae=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":$("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",Q,Q,ae)('else if(typeof d%s==="string")',Q)("m%s=parseInt(d%s,10)",Q,Q)('else if(typeof d%s==="number")',Q)("m%s=d%s",Q,Q)('else if(typeof d%s==="object")',Q)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",Q,Q,Q,ae?"true":"");break;case"bytes":$('if(typeof d%s==="string")',Q)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",Q,Q,Q)("else if(d%s.length >= 0)",Q)("m%s=d%s",Q,Q);break;case"string":$("m%s=String(d%s)",Q,Q);break;case"bool":$("m%s=Boolean(d%s)",Q,Q);break}}return $}j.fromObject=function(K){var X=K.fieldsArray,Q=q.codegen(["d"],K.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!X.length)return Q("return new this.ctor");Q("var m=new this.ctor");for(var W=0;W<X.length;++W){var Z=X[W].resolve(),te=q.safeProp(Z.name);Z.map?(Q("if(d%s){",te)('if(typeof d%s!=="object")',te)("throw TypeError(%j)",Z.fullName+": object expected")("m%s={}",te)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",te),V(Q,Z,W,te+"[ks[i]]")("}")("}")):Z.repeated?(Q("if(d%s){",te)("if(!Array.isArray(d%s))",te)("throw TypeError(%j)",Z.fullName+": array expected")("m%s=[]",te)("for(var i=0;i<d%s.length;++i){",te),V(Q,Z,W,te+"[i]")("}")("}")):(Z.resolvedType instanceof B||Q("if(d%s!=null){",te),V(Q,Z,W,te),Z.resolvedType instanceof B||Q("}"))}return Q("return m")};function H($,K,X,Q){if(K.resolvedType)K.resolvedType instanceof B?$("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",Q,X,Q,Q,X,Q,Q):$("d%s=types[%i].toObject(m%s,o)",Q,X,Q);else{var W=!1;switch(K.type){case"double":case"float":$("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",Q,Q,Q,Q);break;case"uint64":W=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":$('if(typeof m%s==="number")',Q)("d%s=o.longs===String?String(m%s):m%s",Q,Q,Q)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",Q,Q,Q,Q,W?"true":"",Q);break;case"bytes":$("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",Q,Q,Q,Q,Q);break;default:$("d%s=m%s",Q,Q);break}}return $}j.toObject=function(K){var X=K.fieldsArray.slice().sort(q.compareFieldsById);if(!X.length)return q.codegen()("return {}");for(var Q=q.codegen(["m","o"],K.name+"$toObject")("if(!o)")("o={}")("var d={}"),W=[],Z=[],te=[],ie=0;ie<X.length;++ie)X[ie].partOf||(X[ie].resolve().repeated?W:X[ie].map?Z:te).push(X[ie]);if(W.length){for(Q("if(o.arrays||o.defaults){"),ie=0;ie<W.length;++ie)Q("d%s=[]",q.safeProp(W[ie].name));Q("}")}if(Z.length){for(Q("if(o.objects||o.defaults){"),ie=0;ie<Z.length;++ie)Q("d%s={}",q.safeProp(Z[ie].name));Q("}")}if(te.length){for(Q("if(o.defaults){"),ie=0;ie<te.length;++ie){var ae=te[ie],oe=q.safeProp(ae.name);if(ae.resolvedType instanceof B)Q("d%s=o.enums===String?%j:%j",oe,ae.resolvedType.valuesById[ae.typeDefault],ae.typeDefault);else if(ae.long)Q("if(util.Long){")("var n=new util.Long(%i,%i,%j)",ae.typeDefault.low,ae.typeDefault.high,ae.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",oe)("}else")("d%s=o.longs===String?%j:%i",oe,ae.typeDefault.toString(),ae.typeDefault.toNumber());else if(ae.bytes){var de="["+Array.prototype.slice.call(ae.typeDefault).join(",")+"]";Q("if(o.bytes===String)d%s=%j",oe,String.fromCharCode.apply(String,ae.typeDefault))("else{")("d%s=%s",oe,de)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",oe,oe)("}")}else Q("d%s=%j",oe,ae.typeDefault)}Q("}")}var le=!1;for(ie=0;ie<X.length;++ie){var ae=X[ie],ue=K._fieldsArray.indexOf(ae),oe=q.safeProp(ae.name);ae.map?(le||(le=!0,Q("var ks2")),Q("if(m%s&&(ks2=Object.keys(m%s)).length){",oe,oe)("d%s={}",oe)("for(var j=0;j<ks2.length;++j){"),H(Q,ae,ue,oe+"[ks2[j]]")("}")):ae.repeated?(Q("if(m%s&&m%s.length){",oe,oe)("d%s=[]",oe)("for(var j=0;j<m%s.length;++j){",oe),H(Q,ae,ue,oe+"[j]")("}")):(Q("if(m%s!=null&&m.hasOwnProperty(%j)){",oe,ae.name),H(Q,ae,ue,oe),ae.partOf&&Q("if(o.oneofs)")("d%s=%j",q.safeProp(ae.partOf.name),ae.name)),Q("}")}return Q("return d")}})(converter)),converter}var wrappers={},hasRequiredWrappers;function requireWrappers(){return hasRequiredWrappers||(hasRequiredWrappers=1,(function(U){var j=U,B=requireMessage();j[".google.protobuf.Any"]={fromObject:function(q){if(q&&q["@type"]){var V=q["@type"].substring(q["@type"].lastIndexOf("/")+1),H=this.lookup(V);if(H){var $=q["@type"].charAt(0)==="."?q["@type"].slice(1):q["@type"];return $.indexOf("/")===-1&&($="/"+$),this.create({type_url:$,value:H.encode(H.fromObject(q)).finish()})}}return this.fromObject(q)},toObject:function(q,V){var H="type.googleapis.com/",$="",K="";if(V&&V.json&&q.type_url&&q.value){K=q.type_url.substring(q.type_url.lastIndexOf("/")+1),$=q.type_url.substring(0,q.type_url.lastIndexOf("/")+1);var X=this.lookup(K);X&&(q=X.decode(q.value))}if(!(q instanceof this.ctor)&&q instanceof B){var Q=q.$type.toObject(q,V),W=q.$type.fullName[0]==="."?q.$type.fullName.slice(1):q.$type.fullName;return $===""&&($=H),K=$+W,Q["@type"]=K,Q}return this.toObject(q,V)}}})(wrappers)),wrappers}var type,hasRequiredType;function requireType(){if(hasRequiredType)return type;hasRequiredType=1,type=oe;var U=requireNamespace();((oe.prototype=Object.create(U.prototype)).constructor=oe).className="Type";var j=require_enum(),B=requireOneof(),q=requireField(),V=requireMapfield(),H=requireService(),$=requireMessage(),K=requireReader(),X=requireWriter(),Q=requireUtil(),W=requireEncoder(),Z=requireDecoder(),te=requireVerifier(),ie=requireConverter(),ae=requireWrappers();function oe(le,ue){U.call(this,le,ue),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(oe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var le=Object.keys(this.fields),ue=0;ue<le.length;++ue){var he=this.fields[le[ue]],me=he.id;if(this._fieldsById[me])throw Error("duplicate id "+me+" in "+this);this._fieldsById[me]=he}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Q.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Q.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=oe.generateConstructor(this)())},set:function(le){var ue=le.prototype;ue instanceof $||((le.prototype=new $).constructor=le,Q.merge(le.prototype,ue)),le.$type=le.prototype.$type=this,Q.merge(le,$,!0),this._ctor=le;for(var he=0;he<this.fieldsArray.length;++he)this._fieldsArray[he].resolve();var me={};for(he=0;he<this.oneofsArray.length;++he)me[this._oneofsArray[he].resolve().name]={get:Q.oneOfGetter(this._oneofsArray[he].oneof),set:Q.oneOfSetter(this._oneofsArray[he].oneof)};he&&Object.defineProperties(le.prototype,me)}}}),oe.generateConstructor=function(ue){for(var he=Q.codegen(["p"],ue.name),me=0,be;me<ue.fieldsArray.length;++me)(be=ue._fieldsArray[me]).map?he("this%s={}",Q.safeProp(be.name)):be.repeated&&he("this%s=[]",Q.safeProp(be.name));return he("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function de(le){return le._fieldsById=le._fieldsArray=le._oneofsArray=null,delete le.encode,delete le.decode,delete le.verify,le}return oe.fromJSON=function(ue,he){var me=new oe(ue,he.options);me.extensions=he.extensions,me.reserved=he.reserved;for(var be=Object.keys(he.fields),ge=0;ge<be.length;++ge)me.add((typeof he.fields[be[ge]].keyType<"u"?V.fromJSON:q.fromJSON)(be[ge],he.fields[be[ge]]));if(he.oneofs)for(be=Object.keys(he.oneofs),ge=0;ge<be.length;++ge)me.add(B.fromJSON(be[ge],he.oneofs[be[ge]]));if(he.nested)for(be=Object.keys(he.nested),ge=0;ge<be.length;++ge){var Ee=he.nested[be[ge]];me.add((Ee.id!==void 0?q.fromJSON:Ee.fields!==void 0?oe.fromJSON:Ee.values!==void 0?j.fromJSON:Ee.methods!==void 0?H.fromJSON:U.fromJSON)(be[ge],Ee))}return he.extensions&&he.extensions.length&&(me.extensions=he.extensions),he.reserved&&he.reserved.length&&(me.reserved=he.reserved),he.group&&(me.group=!0),he.comment&&(me.comment=he.comment),he.edition&&(me._edition=he.edition),me._defaultEdition="proto3",me},oe.prototype.toJSON=function(ue){var he=U.prototype.toJSON.call(this,ue),me=ue?!!ue.keepComments:!1;return Q.toObject(["edition",this._editionToJSON(),"options",he&&he.options||void 0,"oneofs",U.arrayToJSON(this.oneofsArray,ue),"fields",U.arrayToJSON(this.fieldsArray.filter(function(be){return!be.declaringField}),ue)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",he&&he.nested||void 0,"comment",me?this.comment:void 0])},oe.prototype.resolveAll=function(){U.prototype.resolveAll.call(this);var ue=this.oneofsArray;for(me=0;me<ue.length;)ue[me++].resolve();for(var he=this.fieldsArray,me=0;me<he.length;)he[me++].resolve();return this},oe.prototype._resolveFeaturesRecursive=function(ue){return ue=this._edition||ue,U.prototype._resolveFeaturesRecursive.call(this,ue),this.oneofsArray.forEach(he=>{he._resolveFeatures(ue)}),this.fieldsArray.forEach(he=>{he._resolveFeatures(ue)}),this},oe.prototype.get=function(ue){return this.fields[ue]||this.oneofs&&this.oneofs[ue]||this.nested&&this.nested[ue]||null},oe.prototype.add=function(ue){if(this.get(ue.name))throw Error("duplicate name '"+ue.name+"' in "+this);if(ue instanceof q&&ue.extend===void 0){if(this._fieldsById?this._fieldsById[ue.id]:this.fieldsById[ue.id])throw Error("duplicate id "+ue.id+" in "+this);if(this.isReservedId(ue.id))throw Error("id "+ue.id+" is reserved in "+this);if(this.isReservedName(ue.name))throw Error("name '"+ue.name+"' is reserved in "+this);return ue.parent&&ue.parent.remove(ue),this.fields[ue.name]=ue,ue.message=this,ue.onAdd(this),de(this)}return ue instanceof B?(this.oneofs||(this.oneofs={}),this.oneofs[ue.name]=ue,ue.onAdd(this),de(this)):U.prototype.add.call(this,ue)},oe.prototype.remove=function(ue){if(ue instanceof q&&ue.extend===void 0){if(!this.fields||this.fields[ue.name]!==ue)throw Error(ue+" is not a member of "+this);return delete this.fields[ue.name],ue.parent=null,ue.onRemove(this),de(this)}if(ue instanceof B){if(!this.oneofs||this.oneofs[ue.name]!==ue)throw Error(ue+" is not a member of "+this);return delete this.oneofs[ue.name],ue.parent=null,ue.onRemove(this),de(this)}return U.prototype.remove.call(this,ue)},oe.prototype.isReservedId=function(ue){return U.isReservedId(this.reserved,ue)},oe.prototype.isReservedName=function(ue){return U.isReservedName(this.reserved,ue)},oe.prototype.create=function(ue){return new this.ctor(ue)},oe.prototype.setup=function(){for(var ue=this.fullName,he=[],me=0;me<this.fieldsArray.length;++me)he.push(this._fieldsArray[me].resolve().resolvedType);this.encode=W(this)({Writer:X,types:he,util:Q}),this.decode=Z(this)({Reader:K,types:he,util:Q}),this.verify=te(this)({types:he,util:Q}),this.fromObject=ie.fromObject(this)({types:he,util:Q}),this.toObject=ie.toObject(this)({types:he,util:Q});var be=ae[ue];if(be){var ge=Object.create(this);ge.fromObject=this.fromObject,this.fromObject=be.fromObject.bind(ge),ge.toObject=this.toObject,this.toObject=be.toObject.bind(ge)}return this},oe.prototype.encode=function(ue,he){return this.setup().encode(ue,he)},oe.prototype.encodeDelimited=function(ue,he){return this.encode(ue,he&&he.len?he.fork():he).ldelim()},oe.prototype.decode=function(ue,he){return this.setup().decode(ue,he)},oe.prototype.decodeDelimited=function(ue){return ue instanceof K||(ue=K.create(ue)),this.decode(ue,ue.uint32())},oe.prototype.verify=function(ue){return this.setup().verify(ue)},oe.prototype.fromObject=function(ue){return this.setup().fromObject(ue)},oe.prototype.toObject=function(ue,he){return this.setup().toObject(ue,he)},oe.d=function(ue){return function(me){Q.decorateType(me,ue)}},type}var root$1,hasRequiredRoot;function requireRoot(){if(hasRequiredRoot)return root$1;hasRequiredRoot=1,root$1=X;var U=requireNamespace();((X.prototype=Object.create(U.prototype)).constructor=X).className="Root";var j=requireField(),B=require_enum(),q=requireOneof(),V=requireUtil(),H,$,K;function X(te){U.call(this,"",te),this.deferred=[],this.files=[],this._edition="proto2"}X.fromJSON=function(ie,ae){return ae||(ae=new X),ie.options&&ae.setOptions(ie.options),ae.addJSON(ie.nested).resolveAll()},X.prototype.resolvePath=V.path.resolve,X.prototype.fetch=V.fetch;function Q(){}X.prototype.load=function te(ie,ae,oe){typeof ae=="function"&&(oe=ae,ae=void 0);var de=this;if(!oe)return V.asPromise(te,de,ie,ae);var le=oe===Q;function ue(Ue,ze){if(oe){if(le)throw Ue;var xe=oe;oe=null,ze&&ze.resolveAll(),xe(Ue,ze)}}function he(Ue){var ze=Ue.lastIndexOf("google/protobuf/");if(ze>-1){var xe=Ue.substring(ze);if(xe in K)return xe}return null}function me(Ue,ze){try{if(V.isString(ze)&&ze.charAt(0)==="{"&&(ze=JSON.parse(ze)),!V.isString(ze))de.setOptions(ze.options).addJSON(ze.nested);else{$.filename=Ue;var xe=$(ze,de,ae),Ie,Ge=0;if(xe.imports)for(;Ge<xe.imports.length;++Ge)(Ie=he(xe.imports[Ge])||de.resolvePath(Ue,xe.imports[Ge]))&&be(Ie);if(xe.weakImports)for(Ge=0;Ge<xe.weakImports.length;++Ge)(Ie=he(xe.weakImports[Ge])||de.resolvePath(Ue,xe.weakImports[Ge]))&&be(Ie,!0)}}catch(De){ue(De)}!le&&!ge&&ue(null,de)}function be(Ue,ze){if(Ue=he(Ue)||Ue,!(de.files.indexOf(Ue)>-1)){if(de.files.push(Ue),Ue in K){le?me(Ue,K[Ue]):(++ge,setTimeout(function(){--ge,me(Ue,K[Ue])}));return}if(le){var xe;try{xe=V.fs.readFileSync(Ue).toString("utf8")}catch(Ie){ze||ue(Ie);return}me(Ue,xe)}else++ge,de.fetch(Ue,function(Ie,Ge){if(--ge,!!oe){if(Ie){ze?ge||ue(null,de):ue(Ie);return}me(Ue,Ge)}})}}var ge=0;V.isString(ie)&&(ie=[ie]);for(var Ee=0,Fe;Ee<ie.length;++Ee)(Fe=de.resolvePath("",ie[Ee]))&&be(Fe);return de.resolveAll(),le||ge||ue(null,de),de},X.prototype.loadSync=function(ie,ae){if(!V.isNode)throw Error("not supported");return this.load(ie,ae,Q)},X.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(ie){return"'extend "+ie.extend+"' in "+ie.parent.fullName}).join(", "));return U.prototype.resolveAll.call(this)};var W=/^[A-Z]/;function Z(te,ie){var ae=ie.parent.lookup(ie.extend);if(ae){var oe=new j(ie.fullName,ie.id,ie.type,ie.rule,void 0,ie.options);return ae.get(oe.name)||(oe.declaringField=ie,ie.extensionField=oe,ae.add(oe)),!0}return!1}return X.prototype._handleAdd=function(ie){if(ie instanceof j)ie.extend!==void 0&&!ie.extensionField&&(Z(this,ie)||this.deferred.push(ie));else if(ie instanceof B)W.test(ie.name)&&(ie.parent[ie.name]=ie.values);else if(!(ie instanceof q)){if(ie instanceof H)for(var ae=0;ae<this.deferred.length;)Z(this,this.deferred[ae])?this.deferred.splice(ae,1):++ae;for(var oe=0;oe<ie.nestedArray.length;++oe)this._handleAdd(ie._nestedArray[oe]);W.test(ie.name)&&(ie.parent[ie.name]=ie)}},X.prototype._handleRemove=function(ie){if(ie instanceof j){if(ie.extend!==void 0)if(ie.extensionField)ie.extensionField.parent.remove(ie.extensionField),ie.extensionField=null;else{var ae=this.deferred.indexOf(ie);ae>-1&&this.deferred.splice(ae,1)}}else if(ie instanceof B)W.test(ie.name)&&delete ie.parent[ie.name];else if(ie instanceof U){for(var oe=0;oe<ie.nestedArray.length;++oe)this._handleRemove(ie._nestedArray[oe]);W.test(ie.name)&&delete ie.parent[ie.name]}},X._configure=function(te,ie,ae){H=te,$=ie,K=ae},root$1}var hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util.exports;hasRequiredUtil=1;var U=util.exports=requireMinimal(),j=requireRoots(),B,q;U.codegen=requireCodegen(),U.fetch=requireFetch(),U.path=requirePath(),U.fs=U.inquire("fs"),U.toArray=function(Q){if(Q){for(var W=Object.keys(Q),Z=new Array(W.length),te=0;te<W.length;)Z[te]=Q[W[te++]];return Z}return[]},U.toObject=function(Q){for(var W={},Z=0;Z<Q.length;){var te=Q[Z++],ie=Q[Z++];ie!==void 0&&(W[te]=ie)}return W};var V=/\\/g,H=/"/g;U.isReserved=function(Q){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(Q)},U.safeProp=function(Q){return!/^[$\w_]+$/.test(Q)||U.isReserved(Q)?'["'+Q.replace(V,"\\\\").replace(H,'\\"')+'"]':"."+Q},U.ucFirst=function(Q){return Q.charAt(0).toUpperCase()+Q.substring(1)};var $=/_([a-z])/g;U.camelCase=function(Q){return Q.substring(0,1)+Q.substring(1).replace($,function(W,Z){return Z.toUpperCase()})},U.compareFieldsById=function(Q,W){return Q.id-W.id},U.decorateType=function(Q,W){if(Q.$type)return W&&Q.$type.name!==W&&(U.decorateRoot.remove(Q.$type),Q.$type.name=W,U.decorateRoot.add(Q.$type)),Q.$type;B||(B=requireType());var Z=new B(W||Q.name);return U.decorateRoot.add(Z),Z.ctor=Q,Object.defineProperty(Q,"$type",{value:Z,enumerable:!1}),Object.defineProperty(Q.prototype,"$type",{value:Z,enumerable:!1}),Z};var K=0;return U.decorateEnum=function(Q){if(Q.$type)return Q.$type;q||(q=require_enum());var W=new q("Enum"+K++,Q);return U.decorateRoot.add(W),Object.defineProperty(Q,"$type",{value:W,enumerable:!1}),W},U.setProperty=function(Q,W,Z,te){function ie(ae,oe,de){var le=oe.shift();if(le==="__proto__"||le==="prototype")return ae;if(oe.length>0)ae[le]=ie(ae[le]||{},oe,de);else{var ue=ae[le];if(ue&&te)return ae;ue&&(de=[].concat(ue).concat(de)),ae[le]=de}return ae}if(typeof Q!="object")throw TypeError("dst must be an object");if(!W)throw TypeError("path must be specified");return W=W.split("."),ie(Q,W,Z)},Object.defineProperty(U,"decorateRoot",{get:function(){return j.decorated||(j.decorated=new(requireRoot()))}}),util.exports}var hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,(function(U){var j=U,B=requireUtil(),q=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function V(H,$){var K=0,X={};for($|=0;K<H.length;)X[q[K+$]]=H[K++];return X}j.basic=V([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),j.defaults=V([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",B.emptyArray,null]),j.long=V([0,0,0,1,1],7),j.mapKey=V([0,0,0,5,5,0,0,0,1,1,0,2],2),j.packed=V([1,5,0,0,0,5,5,0,0,0,1,1,0])})(types)),types}var field,hasRequiredField;function requireField(){if(hasRequiredField)return field;hasRequiredField=1,field=$;var U=requireObject();(($.prototype=Object.create(U.prototype)).constructor=$).className="Field";var j=require_enum(),B=requireTypes(),q=requireUtil(),V,H=/^required|optional|repeated$/;$.fromJSON=function(X,Q){var W=new $(X,Q.id,Q.type,Q.rule,Q.extend,Q.options,Q.comment);return Q.edition&&(W._edition=Q.edition),W._defaultEdition="proto3",W};function $(K,X,Q,W,Z,te,ie){if(q.isObject(W)?(ie=Z,te=W,W=Z=void 0):q.isObject(Z)&&(ie=te,te=Z,Z=void 0),U.call(this,K,te),!q.isInteger(X)||X<0)throw TypeError("id must be a non-negative integer");if(!q.isString(Q))throw TypeError("type must be a string");if(W!==void 0&&!H.test(W=W.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(Z!==void 0&&!q.isString(Z))throw TypeError("extend must be a string");W==="proto3_optional"&&(W="optional"),this.rule=W&&W!=="optional"?W:void 0,this.type=Q,this.id=X,this.extend=Z||void 0,this.repeated=W==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=q.Long?B.long[Q]!==void 0:!1,this.bytes=Q==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=ie}return Object.defineProperty($.prototype,"required",{get:function(){return this._features.field_presence==="LEGACY_REQUIRED"}}),Object.defineProperty($.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty($.prototype,"delimited",{get:function(){return this.resolvedType instanceof V&&this._features.message_encoding==="DELIMITED"}}),Object.defineProperty($.prototype,"packed",{get:function(){return this._features.repeated_field_encoding==="PACKED"}}),Object.defineProperty($.prototype,"hasPresence",{get:function(){return this.repeated||this.map?!1:this.partOf||this.declaringField||this.extensionField||this._features.field_presence!=="IMPLICIT"}}),$.prototype.setOption=function(X,Q,W){return U.prototype.setOption.call(this,X,Q,W)},$.prototype.toJSON=function(X){var Q=X?!!X.keepComments:!1;return q.toObject(["edition",this._editionToJSON(),"rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",Q?this.comment:void 0])},$.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=B.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof V?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof j&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof j)&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=q.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var X;q.base64.test(this.typeDefault)?q.base64.decode(this.typeDefault,X=q.newBuffer(q.base64.length(this.typeDefault)),0):q.utf8.write(this.typeDefault,X=q.newBuffer(q.utf8.length(this.typeDefault)),0),this.typeDefault=X}return this.map?this.defaultValue=q.emptyObject:this.repeated?this.defaultValue=q.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof V&&(this.parent.ctor.prototype[this.name]=this.defaultValue),U.prototype.resolve.call(this)},$.prototype._inferLegacyProtoFeatures=function(X){if(X!=="proto2"&&X!=="proto3")return{};var Q={};return this.resolve(),this.rule==="required"&&(Q.field_presence="LEGACY_REQUIRED"),this.resolvedType instanceof V&&this.resolvedType.group&&(Q.message_encoding="DELIMITED"),this.getOption("packed")===!0?Q.repeated_field_encoding="PACKED":this.getOption("packed")===!1&&(Q.repeated_field_encoding="EXPANDED"),Q},$.prototype._resolveFeatures=function(X){return U.prototype._resolveFeatures.call(this,this._edition||X)},$.d=function(X,Q,W,Z){return typeof Q=="function"?Q=q.decorateType(Q).name:Q&&typeof Q=="object"&&(Q=q.decorateEnum(Q).name),function(ie,ae){q.decorateType(ie.constructor).add(new $(ae,X,Q,W,{default:Z}))}},$._configure=function(X){V=X},field}var oneof,hasRequiredOneof;function requireOneof(){if(hasRequiredOneof)return oneof;hasRequiredOneof=1,oneof=q;var U=requireObject();((q.prototype=Object.create(U.prototype)).constructor=q).className="OneOf";var j=requireField(),B=requireUtil();function q(H,$,K,X){if(Array.isArray($)||(K=$,$=void 0),U.call(this,H,K),!($===void 0||Array.isArray($)))throw TypeError("fieldNames must be an Array");this.oneof=$||[],this.fieldsArray=[],this.comment=X}q.fromJSON=function($,K){return new q($,K.oneof,K.options,K.comment)},q.prototype.toJSON=function($){var K=$?!!$.keepComments:!1;return B.toObject(["options",this.options,"oneof",this.oneof,"comment",K?this.comment:void 0])};function V(H){if(H.parent)for(var $=0;$<H.fieldsArray.length;++$)H.fieldsArray[$].parent||H.parent.add(H.fieldsArray[$])}return q.prototype.add=function($){if(!($ instanceof j))throw TypeError("field must be a Field");return $.parent&&$.parent!==this.parent&&$.parent.remove($),this.oneof.push($.name),this.fieldsArray.push($),$.partOf=this,V(this),this},q.prototype.remove=function($){if(!($ instanceof j))throw TypeError("field must be a Field");var K=this.fieldsArray.indexOf($);if(K<0)throw Error($+" is not a member of "+this);return this.fieldsArray.splice(K,1),K=this.oneof.indexOf($.name),K>-1&&this.oneof.splice(K,1),$.partOf=null,this},q.prototype.onAdd=function($){U.prototype.onAdd.call(this,$);for(var K=this,X=0;X<this.oneof.length;++X){var Q=$.get(this.oneof[X]);Q&&!Q.partOf&&(Q.partOf=K,K.fieldsArray.push(Q))}V(this)},q.prototype.onRemove=function($){for(var K=0,X;K<this.fieldsArray.length;++K)(X=this.fieldsArray[K]).parent&&X.parent.remove(X);U.prototype.onRemove.call(this,$)},Object.defineProperty(q.prototype,"isProto3Optional",{get:function(){if(this.fieldsArray==null||this.fieldsArray.length!==1)return!1;var H=this.fieldsArray[0];return H.options!=null&&H.options.proto3_optional===!0}}),q.d=function(){for(var $=new Array(arguments.length),K=0;K<arguments.length;)$[K]=arguments[K++];return function(Q,W){B.decorateType(Q.constructor).add(new q(W,$)),Object.defineProperty(Q,W,{get:B.oneOfGetter($),set:B.oneOfSetter($)})}},oneof}var object,hasRequiredObject;function requireObject(){if(hasRequiredObject)return object;hasRequiredObject=1,object=$,$.className="ReflectionObject";const U=requireOneof();var j=requireUtil(),B,q={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},V={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},H={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function $(K,X){if(!j.isString(K))throw TypeError("name must be a string");if(X&&!j.isObject(X))throw TypeError("options must be an object");this.options=X,this.parsedOptions=null,this.name=K,this._edition=null,this._defaultEdition="proto2",this._features={},this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}return Object.defineProperties($.prototype,{root:{get:function(){for(var K=this;K.parent!==null;)K=K.parent;return K}},fullName:{get:function(){for(var K=[this.name],X=this.parent;X;)K.unshift(X.name),X=X.parent;return K.join(".")}}}),$.prototype.toJSON=function(){throw Error()},$.prototype.onAdd=function(X){this.parent&&this.parent!==X&&this.parent.remove(this),this.parent=X,this.resolved=!1;var Q=X.root;Q instanceof B&&Q._handleAdd(this)},$.prototype.onRemove=function(X){var Q=X.root;Q instanceof B&&Q._handleRemove(this),this.parent=null,this.resolved=!1},$.prototype.resolve=function(){return this.resolved?this:(this instanceof B&&(this._resolveFeaturesRecursive(this._edition),this.resolved=!0),this)},$.prototype._resolveFeaturesRecursive=function(X){return this._resolveFeatures(this._edition||X)},$.prototype._resolveFeatures=function(X){var Q={};if(!X)throw new Error("Unknown edition for "+this.fullName);var W=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(X));if(this._edition){if(X==="proto2")Q=Object.assign({},V);else if(X==="proto3")Q=Object.assign({},H);else if(X==="2023")Q=Object.assign({},q);else throw new Error("Unknown edition: "+X);this._features=Object.assign(Q,W||{});return}if(this.partOf instanceof U){var Z=Object.assign({},this.partOf._features);this._features=Object.assign(Z,W||{})}else if(!this.declaringField)if(this.parent){var te=Object.assign({},this.parent._features);this._features=Object.assign(te,W||{})}else throw new Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features)},$.prototype._inferLegacyProtoFeatures=function(){return{}},$.prototype.getOption=function(X){if(this.options)return this.options[X]},$.prototype.setOption=function(X,Q,W){return this.options||(this.options={}),/^features\./.test(X)?j.setProperty(this.options,X,Q,W):(!W||this.options[X]===void 0)&&(this.getOption(X)!==Q&&(this.resolved=!1),this.options[X]=Q),this},$.prototype.setParsedOption=function(X,Q,W){this.parsedOptions||(this.parsedOptions=[]);var Z=this.parsedOptions;if(W){var te=Z.find(function(oe){return Object.prototype.hasOwnProperty.call(oe,X)});if(te){var ie=te[X];j.setProperty(ie,W,Q)}else te={},te[X]=j.setProperty({},W,Q),Z.push(te)}else{var ae={};ae[X]=Q,Z.push(ae)}return this},$.prototype.setOptions=function(X,Q){if(X)for(var W=Object.keys(X),Z=0;Z<W.length;++Z)this.setOption(W[Z],X[W[Z]],Q);return this},$.prototype.toString=function(){var X=this.constructor.className,Q=this.fullName;return Q.length?X+" "+Q:X},$.prototype._editionToJSON=function(){if(!(!this._edition||this._edition==="proto3"))return this._edition},$._configure=function(K){B=K},object}var _enum,hasRequired_enum;function require_enum(){if(hasRequired_enum)return _enum;hasRequired_enum=1,_enum=q;var U=requireObject();((q.prototype=Object.create(U.prototype)).constructor=q).className="Enum";var j=requireNamespace(),B=requireUtil();function q(V,H,$,K,X,Q){if(U.call(this,V,$),H&&typeof H!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=K,this.comments=X||{},this.valuesOptions=Q,this._valuesFeatures={},this.reserved=void 0,H)for(var W=Object.keys(H),Z=0;Z<W.length;++Z)typeof H[W[Z]]=="number"&&(this.valuesById[this.values[W[Z]]=H[W[Z]]]=W[Z])}return q.prototype._resolveFeatures=function(H){return H=this._edition||H,U.prototype._resolveFeatures.call(this,H),Object.keys(this.values).forEach($=>{var K=Object.assign({},this._features);this._valuesFeatures[$]=Object.assign(K,this.valuesOptions&&this.valuesOptions[$]&&this.valuesOptions[$].features)}),this},q.fromJSON=function(H,$){var K=new q(H,$.values,$.options,$.comment,$.comments);return K.reserved=$.reserved,$.edition&&(K._edition=$.edition),K._defaultEdition="proto3",K},q.prototype.toJSON=function(H){var $=H?!!H.keepComments:!1;return B.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",$?this.comment:void 0,"comments",$?this.comments:void 0])},q.prototype.add=function(H,$,K,X){if(!B.isString(H))throw TypeError("name must be a string");if(!B.isInteger($))throw TypeError("id must be an integer");if(this.values[H]!==void 0)throw Error("duplicate name '"+H+"' in "+this);if(this.isReservedId($))throw Error("id "+$+" is reserved in "+this);if(this.isReservedName(H))throw Error("name '"+H+"' is reserved in "+this);if(this.valuesById[$]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+$+" in "+this);this.values[H]=$}else this.valuesById[this.values[H]=$]=H;return X&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[H]=X||null),this.comments[H]=K||null,this},q.prototype.remove=function(H){if(!B.isString(H))throw TypeError("name must be a string");var $=this.values[H];if($==null)throw Error("name '"+H+"' does not exist in "+this);return delete this.valuesById[$],delete this.values[H],delete this.comments[H],this.valuesOptions&&delete this.valuesOptions[H],this},q.prototype.isReservedId=function(H){return j.isReservedId(this.reserved,H)},q.prototype.isReservedName=function(H){return j.isReservedName(this.reserved,H)},_enum}var encoder_1,hasRequiredEncoder;function requireEncoder(){if(hasRequiredEncoder)return encoder_1;hasRequiredEncoder=1,encoder_1=V;var U=require_enum(),j=requireTypes(),B=requireUtil();function q(H,$,K,X){return $.delimited?H("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",K,X,($.id<<3|3)>>>0,($.id<<3|4)>>>0):H("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",K,X,($.id<<3|2)>>>0)}function V(H){for(var $=B.codegen(["m","w"],H.name+"$encode")("if(!w)")("w=Writer.create()"),K,X,Q=H.fieldsArray.slice().sort(B.compareFieldsById),K=0;K<Q.length;++K){var W=Q[K].resolve(),Z=H._fieldsArray.indexOf(W),te=W.resolvedType instanceof U?"int32":W.type,ie=j.basic[te];X="m"+B.safeProp(W.name),W.map?($("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",X,W.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",X)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(W.id<<3|2)>>>0,8|j.mapKey[W.keyType],W.keyType),ie===void 0?$("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",Z,X):$(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|ie,te,X),$("}")("}")):W.repeated?($("if(%s!=null&&%s.length){",X,X),W.packed&&j.packed[te]!==void 0?$("w.uint32(%i).fork()",(W.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",X)("w.%s(%s[i])",te,X)("w.ldelim()"):($("for(var i=0;i<%s.length;++i)",X),ie===void 0?q($,W,Z,X+"[i]"):$("w.uint32(%i).%s(%s[i])",(W.id<<3|ie)>>>0,te,X)),$("}")):(W.optional&&$("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",X,W.name),ie===void 0?q($,W,Z,X):$("w.uint32(%i).%s(%s)",(W.id<<3|ie)>>>0,te,X))}return $("return w")}return encoder_1}var hasRequiredIndexLight;function requireIndexLight(){if(hasRequiredIndexLight)return indexLight.exports;hasRequiredIndexLight=1;var U=indexLight.exports=requireIndexMinimal();U.build="light";function j(q,V,H){return typeof V=="function"?(H=V,V=new U.Root):V||(V=new U.Root),V.load(q,H)}U.load=j;function B(q,V){return V||(V=new U.Root),V.loadSync(q)}return U.loadSync=B,U.encoder=requireEncoder(),U.decoder=requireDecoder(),U.verifier=requireVerifier(),U.converter=requireConverter(),U.ReflectionObject=requireObject(),U.Namespace=requireNamespace(),U.Root=requireRoot(),U.Enum=require_enum(),U.Type=requireType(),U.Field=requireField(),U.OneOf=requireOneof(),U.MapField=requireMapfield(),U.Service=requireService(),U.Method=requireMethod(),U.Message=requireMessage(),U.wrappers=requireWrappers(),U.types=requireTypes(),U.util=requireUtil(),U.ReflectionObject._configure(U.Root),U.Namespace._configure(U.Type,U.Service,U.Enum),U.Root._configure(U.Type),U.Field._configure(U.Type),indexLight.exports}var tokenize_1,hasRequiredTokenize;function requireTokenize(){if(hasRequiredTokenize)return tokenize_1;hasRequiredTokenize=1,tokenize_1=W;var U=/[\s{}=;:[\],'"()<>]/g,j=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,B=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,q=/^ *[*/]+ */,V=/^\s*\*?\/*/,H=/\n/g,$=/\s/,K=/\\(.?)/g,X={0:"\0",r:"\r",n:`
`,t:"	"};function Q(Z){return Z.replace(K,function(te,ie){switch(ie){case"\\":case"":return ie;default:return X[ie]||""}})}W.unescape=Q;function W(Z,te){Z=Z.toString();var ie=0,ae=Z.length,oe=1,de=0,le={},ue=[],he=null;function me(Ve){return Error("illegal "+Ve+" (line "+oe+")")}function be(){var Ve=he==="'"?B:j;Ve.lastIndex=ie-1;var Se=Ve.exec(Z);if(!Se)throw me("string");return ie=Ve.lastIndex,xe(he),he=null,Q(Se[1])}function ge(Ve){return Z.charAt(Ve)}function Ee(Ve,Se,we){var $e={type:Z.charAt(Ve++),lineEmpty:!1,leading:we},Ye;te?Ye=2:Ye=3;var pe=Ve-Ye,ve;do if(--pe<0||(ve=Z.charAt(pe))===`
`){$e.lineEmpty=!0;break}while(ve===" "||ve==="	");for(var Oe=Z.substring(Ve,Se).split(H),fe=0;fe<Oe.length;++fe)Oe[fe]=Oe[fe].replace(te?V:q,"").trim();$e.text=Oe.join(`
`).trim(),le[oe]=$e,de=oe}function Fe(Ve){var Se=Ue(Ve),we=Z.substring(Ve,Se),$e=/^\s*\/\//.test(we);return $e}function Ue(Ve){for(var Se=Ve;Se<ae&&ge(Se)!==`
`;)Se++;return Se}function ze(){if(ue.length>0)return ue.shift();if(he)return be();var Ve,Se,we,$e,Ye,pe=ie===0;do{if(ie===ae)return null;for(Ve=!1;$.test(we=ge(ie));)if(we===`
`&&(pe=!0,++oe),++ie===ae)return null;if(ge(ie)==="/"){if(++ie===ae)throw me("comment");if(ge(ie)==="/")if(te){if($e=ie,Ye=!1,Fe(ie-1)){Ye=!0;do if(ie=Ue(ie),ie===ae||(ie++,!pe))break;while(Fe(ie))}else ie=Math.min(ae,Ue(ie)+1);Ye&&(Ee($e,ie,pe),pe=!0),oe++,Ve=!0}else{for(Ye=ge($e=ie+1)==="/";ge(++ie)!==`
`;)if(ie===ae)return null;++ie,Ye&&(Ee($e,ie-1,pe),pe=!0),++oe,Ve=!0}else if((we=ge(ie))==="*"){$e=ie+1,Ye=te||ge($e)==="*";do{if(we===`
`&&++oe,++ie===ae)throw me("comment");Se=we,we=ge(ie)}while(Se!=="*"||we!=="/");++ie,Ye&&(Ee($e,ie-2,pe),pe=!0),Ve=!0}else return"/"}}while(Ve);var ve=ie;U.lastIndex=0;var Oe=U.test(ge(ve++));if(!Oe)for(;ve<ae&&!U.test(ge(ve));)++ve;var fe=Z.substring(ie,ie=ve);return(fe==='"'||fe==="'")&&(he=fe),fe}function xe(Ve){ue.push(Ve)}function Ie(){if(!ue.length){var Ve=ze();if(Ve===null)return null;xe(Ve)}return ue[0]}function Ge(Ve,Se){var we=Ie(),$e=we===Ve;if($e)return ze(),!0;if(!Se)throw me("token '"+we+"', '"+Ve+"' expected");return!1}function De(Ve){var Se=null,we;return Ve===void 0?(we=le[oe-1],delete le[oe-1],we&&(te||we.type==="*"||we.lineEmpty)&&(Se=we.leading?we.text:null)):(de<Ve&&Ie(),we=le[Ve],delete le[Ve],we&&!we.lineEmpty&&(te||we.type==="/")&&(Se=we.leading?null:we.text)),Se}return Object.defineProperty({next:ze,peek:Ie,push:xe,skip:Ge,cmnt:De},"line",{get:function(){return oe}})}return tokenize_1}var parse_1,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse_1;hasRequiredParse=1,parse_1=be,be.filename=null,be.defaults={keepCase:!1};var U=requireTokenize(),j=requireRoot(),B=requireType(),q=requireField(),V=requireMapfield(),H=requireOneof(),$=require_enum(),K=requireService(),X=requireMethod(),Q=requireObject(),W=requireTypes(),Z=requireUtil(),te=/^[1-9][0-9]*$/,ie=/^-?[1-9][0-9]*$/,ae=/^0[x][0-9a-fA-F]+$/,oe=/^-?0[x][0-9a-fA-F]+$/,de=/^0[0-7]+$/,le=/^-?0[0-7]+$/,ue=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,he=/^[a-zA-Z_][a-zA-Z_0-9]*$/,me=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function be(ge,Ee,Fe){Ee instanceof j||(Fe=Ee,Ee=new j),Fe||(Fe=be.defaults);var Ue=Fe.preferTrailingComment||!1,ze=U(ge,Fe.alternateCommentMode||!1),xe=ze.next,Ie=ze.push,Ge=ze.peek,De=ze.skip,Ve=ze.cmnt,Se=!0,we,$e,Ye,pe="proto2",ve=Ee,Oe=[],fe={},Qe=Fe.keepCase?function(Pe){return Pe}:Z.camelCase;function tt(){Oe.forEach(Pe=>{Pe._edition=pe,Object.keys(fe).forEach(Le=>{Pe.getOption(Le)===void 0&&Pe.setOption(Le,fe[Le],!0)})})}function He(Pe,Le,Ne){var Xe=be.filename;return Ne||(be.filename=null),Error("illegal "+(Le||"token")+" '"+Pe+"' ("+(Xe?Xe+", ":"")+"line "+ze.line+")")}function at(){var Pe=[],Le;do{if((Le=xe())!=='"'&&Le!=="'")throw He(Le);Pe.push(xe()),De(Le),Le=Ge()}while(Le==='"'||Le==="'");return Pe.join("")}function xt(Pe){var Le=xe();switch(Le){case"'":case'"':return Ie(Le),at();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return on(Le,!0)}catch{if(me.test(Le))return Le;throw He(Le,"value")}}function gt(Pe,Le){var Ne,Xe;do if(Le&&((Ne=Ge())==='"'||Ne==="'")){var Je=at();if(Pe.push(Je),pe>=2023)throw He(Je,"id")}else try{Pe.push([Xe=tn(xe()),De("to",!0)?tn(xe()):Xe])}catch(kt){if(Le&&me.test(Ne)&&pe>=2023)Pe.push(Ne);else throw kt}while(De(",",!0));var ot={options:void 0};ot.setOption=function(kt,It){this.options===void 0&&(this.options={}),this.options[kt]=It},nn(ot,function(It){if(It==="option")rn(ot,It),De(";");else throw He(It)},function(){st(ot)})}function on(Pe,Le){var Ne=1;switch(Pe.charAt(0)==="-"&&(Ne=-1,Pe=Pe.substring(1)),Pe){case"inf":case"INF":case"Inf":return Ne*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(te.test(Pe))return Ne*parseInt(Pe,10);if(ae.test(Pe))return Ne*parseInt(Pe,16);if(de.test(Pe))return Ne*parseInt(Pe,8);if(ue.test(Pe))return Ne*parseFloat(Pe);throw He(Pe,"number",Le)}function tn(Pe,Le){switch(Pe){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!Le&&Pe.charAt(0)==="-")throw He(Pe,"id");if(ie.test(Pe))return parseInt(Pe,10);if(oe.test(Pe))return parseInt(Pe,16);if(le.test(Pe))return parseInt(Pe,8);throw He(Pe,"id")}function ji(){if(we!==void 0)throw He("package");if(we=xe(),!me.test(we))throw He(we,"name");ve=ve.define(we),De(";")}function ar(){var Pe=Ge(),Le;switch(Pe){case"weak":Le=Ye||(Ye=[]),xe();break;case"public":xe();default:Le=$e||($e=[]);break}Pe=at(),De(";"),Le.push(Pe)}function Nn(){if(De("="),pe=at(),pe<2023)throw He(pe,"syntax");De(";")}function ui(){if(De("="),pe=at(),!["2023"].includes(pe))throw He(pe,"edition");De(";")}function Un(Pe,Le){switch(Le){case"option":return rn(Pe,Le),De(";"),!0;case"message":return Ui(Pe,Le),!0;case"enum":return sr(Pe,Le),!0;case"service":return vt(Pe,Le),!0;case"extend":return Mn(Pe,Le),!0}return!1}function nn(Pe,Le,Ne){var Xe=ze.line;if(Pe&&(typeof Pe.comment!="string"&&(Pe.comment=Ve()),Pe.filename=be.filename),De("{",!0)){for(var Je;(Je=xe())!=="}";)Le(Je);De(";",!0)}else Ne&&Ne(),De(";"),Pe&&(typeof Pe.comment!="string"||Ue)&&(Pe.comment=Ve(Xe)||Pe.comment)}function Ui(Pe,Le){if(!he.test(Le=xe()))throw He(Le,"type name");var Ne=new B(Le);nn(Ne,function(Je){if(!Un(Ne,Je))switch(Je){case"map":Bi(Ne);break;case"required":if(pe!=="proto2")throw He(Je);case"repeated":$t(Ne,Je);break;case"optional":if(pe==="proto3")$t(Ne,"proto3_optional");else{if(pe!=="proto2")throw He(Je);$t(Ne,"optional")}break;case"oneof":Qr(Ne,Je);break;case"extensions":gt(Ne.extensions||(Ne.extensions=[]));break;case"reserved":gt(Ne.reserved||(Ne.reserved=[]),!0);break;default:if(pe==="proto2"||!me.test(Je))throw He(Je);Ie(Je),$t(Ne,"optional");break}}),Pe.add(Ne),Pe===ve&&Oe.push(Ne)}function $t(Pe,Le,Ne){var Xe=xe();if(Xe==="group"){di(Pe,Le);return}for(;Xe.endsWith(".")||Ge().startsWith(".");)Xe+=xe();if(!me.test(Xe))throw He(Xe,"type");var Je=xe();if(!he.test(Je))throw He(Je,"name");Je=Qe(Je),De("=");var ot=new q(Je,tn(xe()),Xe,Le,Ne);if(nn(ot,function(zt){if(zt==="option")rn(ot,zt),De(";");else throw He(zt)},function(){st(ot)}),Le==="proto3_optional"){var kt=new H("_"+Je);ot.setOption("proto3_optional",!0),kt.add(ot),Pe.add(kt)}else Pe.add(ot);Pe===ve&&Oe.push(ot)}function di(Pe,Le){if(pe>=2023)throw He("group");var Ne=xe();if(!he.test(Ne))throw He(Ne,"name");var Xe=Z.lcFirst(Ne);Ne===Xe&&(Ne=Z.ucFirst(Ne)),De("=");var Je=tn(xe()),ot=new B(Ne);ot.group=!0;var kt=new q(Xe,Je,Ne,Le);kt.filename=be.filename,nn(ot,function(zt){switch(zt){case"option":rn(ot,zt),De(";");break;case"required":case"repeated":$t(ot,zt);break;case"optional":pe==="proto3"?$t(ot,"proto3_optional"):$t(ot,"optional");break;case"message":Ui(ot,zt);break;case"enum":sr(ot,zt);break;default:throw He(zt)}}),Pe.add(ot).add(kt)}function Bi(Pe){De("<");var Le=xe();if(W.mapKey[Le]===void 0)throw He(Le,"type");De(",");var Ne=xe();if(!me.test(Ne))throw He(Ne,"type");De(">");var Xe=xe();if(!he.test(Xe))throw He(Xe,"name");De("=");var Je=new V(Qe(Xe),tn(xe()),Le,Ne);nn(Je,function(kt){if(kt==="option")rn(Je,kt),De(";");else throw He(kt)},function(){st(Je)}),Pe.add(Je)}function Qr(Pe,Le){if(!he.test(Le=xe()))throw He(Le,"name");var Ne=new H(Qe(Le));nn(Ne,function(Je){Je==="option"?(rn(Ne,Je),De(";")):(Ie(Je),$t(Ne,"optional"))}),Pe.add(Ne)}function sr(Pe,Le){if(!he.test(Le=xe()))throw He(Le,"name");var Ne=new $(Le);nn(Ne,function(Je){switch(Je){case"option":rn(Ne,Je),De(";");break;case"reserved":gt(Ne.reserved||(Ne.reserved=[]),!0),Ne.reserved===void 0&&(Ne.reserved=[]);break;default:Yt(Ne,Je)}}),Pe.add(Ne),Pe===ve&&Oe.push(Ne)}function Yt(Pe,Le){if(!he.test(Le))throw He(Le,"name");De("=");var Ne=tn(xe(),!0),Xe={options:void 0};Xe.getOption=function(Je){return this.options[Je]},Xe.setOption=function(Je,ot){Q.prototype.setOption.call(Xe,Je,ot)},Xe.setParsedOption=function(){},nn(Xe,function(ot){if(ot==="option")rn(Xe,ot),De(";");else throw He(ot)},function(){st(Xe)}),Pe.add(Le,Ne,Xe.comment,Xe.parsedOptions||Xe.options)}function rn(Pe,Le){var Ne,Xe,Je=!0;for(Le==="option"&&(Le=xe());Le!=="=";){if(Le==="("){var ot=xe();De(")"),Le="("+ot+")"}if(Je){if(Je=!1,Le.includes(".")&&!Le.includes("(")){var kt=Le.split(".");Ne=kt[0]+".",Le=kt[1];continue}Ne=Le}else Xe=Xe?Xe+=Le:Le;Le=xe()}var It=Xe?Ne.concat(Xe):Ne,zt=je(Pe,It);Xe=Xe&&Xe[0]==="."?Xe.slice(1):Xe,Ne=Ne&&Ne[Ne.length-1]==="."?Ne.slice(0,-1):Ne,it(Pe,Ne,zt,Xe)}function je(Pe,Le){if(De("{",!0)){for(var Ne={};!De("}",!0);){if(!he.test(mt=xe()))throw He(mt,"name");if(mt===null)throw He(mt,"end of input");var Xe,Je=mt;if(De(":",!0),Ge()==="{")Xe=je(Pe,Le+"."+mt);else if(Ge()==="["){Xe=[];var ot;if(De("[",!0)){do ot=xt(),Xe.push(ot);while(De(",",!0));De("]"),typeof ot<"u"&&Ke(Pe,Le+"."+mt,ot)}}else Xe=xt(),Ke(Pe,Le+"."+mt,Xe);var kt=Ne[Je];kt&&(Xe=[].concat(kt).concat(Xe)),Ne[Je]=Xe,De(",",!0),De(";",!0)}return Ne}var It=xt();return Ke(Pe,Le,It),It}function Ke(Pe,Le,Ne){if(ve===Pe&&/^features\./.test(Le)){fe[Le]=Ne;return}Pe.setOption&&Pe.setOption(Le,Ne)}function it(Pe,Le,Ne,Xe){Pe.setParsedOption&&Pe.setParsedOption(Le,Ne,Xe)}function st(Pe){if(De("[",!0)){do rn(Pe,"option");while(De(",",!0));De("]")}return Pe}function vt(Pe,Le){if(!he.test(Le=xe()))throw He(Le,"service name");var Ne=new K(Le);nn(Ne,function(Je){if(!Un(Ne,Je))if(Je==="rpc")an(Ne,Je);else throw He(Je)}),Pe.add(Ne),Pe===ve&&Oe.push(Ne)}function an(Pe,Le){var Ne=Ve(),Xe=Le;if(!he.test(Le=xe()))throw He(Le,"name");var Je=Le,ot,kt,It,zt;if(De("("),De("stream",!0)&&(kt=!0),!me.test(Le=xe())||(ot=Le,De(")"),De("returns"),De("("),De("stream",!0)&&(zt=!0),!me.test(Le=xe())))throw He(Le);It=Le,De(")");var Tn=new X(Je,Xe,ot,It,kt,zt);Tn.comment=Ne,nn(Tn,function(Hn){if(Hn==="option")rn(Tn,Hn),De(";");else throw He(Hn)}),Pe.add(Tn)}function Mn(Pe,Le){if(!me.test(Le=xe()))throw He(Le,"reference");var Ne=Le;nn(null,function(Je){switch(Je){case"required":case"repeated":$t(Pe,Je,Ne);break;case"optional":pe==="proto3"?$t(Pe,"proto3_optional",Ne):$t(Pe,"optional",Ne);break;default:if(pe==="proto2"||!me.test(Je))throw He(Je);Ie(Je),$t(Pe,"optional",Ne);break}})}for(var mt;(mt=xe())!==null;)switch(mt){case"package":if(!Se)throw He(mt);ji();break;case"import":if(!Se)throw He(mt);ar();break;case"syntax":if(!Se)throw He(mt);Nn();break;case"edition":if(!Se)throw He(mt);ui();break;case"option":rn(ve,mt),De(";",!0);break;default:if(Un(ve,mt)){Se=!1;continue}throw He(mt)}return tt(),be.filename=null,{package:we,imports:$e,weakImports:Ye,root:Ee}}return parse_1}var common_1,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common_1;hasRequiredCommon=1,common_1=j;var U=/\/|\./;function j(q,V){U.test(q)||(q="google/protobuf/"+q+".proto",V={nested:{google:{nested:{protobuf:{nested:V}}}}}),j[q]=V}j("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var B;return j("duration",{Duration:B={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),j("timestamp",{Timestamp:B}),j("empty",{Empty:{fields:{}}}),j("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),j("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),j("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),j.get=function(V){return j[V]||null},common_1}var hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src.exports;hasRequiredSrc=1;var U=src.exports=requireIndexLight();return U.build="full",U.tokenize=requireTokenize(),U.parse=requireParse(),U.common=requireCommon(),U.Root._configure(U.Type,U.parse,U.common),src.exports}var protobufjs,hasRequiredProtobufjs;function requireProtobufjs(){return hasRequiredProtobufjs||(hasRequiredProtobufjs=1,protobufjs=requireSrc()),protobufjs}var protobufjsExports=requireProtobufjs();const protobuf=getDefaultExportFromCjs$1(protobufjsExports);var extendStatics=function(U,j){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,q){B.__proto__=q}||function(B,q){for(var V in q)Object.prototype.hasOwnProperty.call(q,V)&&(B[V]=q[V])},extendStatics(U,j)};function __extends(U,j){if(typeof j!="function"&&j!==null)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");extendStatics(U,j);function B(){this.constructor=U}U.prototype=j===null?Object.create(j):(B.prototype=j.prototype,new B)}var __assign=function(){return __assign=Object.assign||function(j){for(var B,q=1,V=arguments.length;q<V;q++){B=arguments[q];for(var H in B)Object.prototype.hasOwnProperty.call(B,H)&&(j[H]=B[H])}return j},__assign.apply(this,arguments)};function __awaiter(U,j,B,q){function V(H){return H instanceof B?H:new B(function($){$(H)})}return new(B||(B=Promise))(function(H,$){function K(W){try{Q(q.next(W))}catch(Z){$(Z)}}function X(W){try{Q(q.throw(W))}catch(Z){$(Z)}}function Q(W){W.done?H(W.value):V(W.value).then(K,X)}Q((q=q.apply(U,j||[])).next())})}function __generator(U,j){var B={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},q,V,H,$=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return $.next=K(0),$.throw=K(1),$.return=K(2),typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function K(Q){return function(W){return X([Q,W])}}function X(Q){if(q)throw new TypeError("Generator is already executing.");for(;$&&($=0,Q[0]&&(B=0)),B;)try{if(q=1,V&&(H=Q[0]&2?V.return:Q[0]?V.throw||((H=V.return)&&H.call(V),0):V.next)&&!(H=H.call(V,Q[1])).done)return H;switch(V=0,H&&(Q=[Q[0]&2,H.value]),Q[0]){case 0:case 1:H=Q;break;case 4:return B.label++,{value:Q[1],done:!1};case 5:B.label++,V=Q[1],Q=[0];continue;case 7:Q=B.ops.pop(),B.trys.pop();continue;default:if(H=B.trys,!(H=H.length>0&&H[H.length-1])&&(Q[0]===6||Q[0]===2)){B=0;continue}if(Q[0]===3&&(!H||Q[1]>H[0]&&Q[1]<H[3])){B.label=Q[1];break}if(Q[0]===6&&B.label<H[1]){B.label=H[1],H=Q;break}if(H&&B.label<H[2]){B.label=H[2],B.ops.push(Q);break}H[2]&&B.ops.pop(),B.trys.pop();continue}Q=j.call(U,B)}catch(W){Q=[6,W],V=0}finally{q=H=0}if(Q[0]&5)throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}}}typeof SuppressedError=="function"&&SuppressedError;var options={syntax:"proto3"},nested={pipecat:{nested:{TextFrame:{fields:{id:{type:"uint64",id:1},name:{type:"string",id:2},text:{type:"string",id:3}}},AudioRawFrame:{fields:{id:{type:"uint64",id:1},name:{type:"string",id:2},audio:{type:"bytes",id:3},sampleRate:{type:"uint32",id:4},numChannels:{type:"uint32",id:5}}},TranscriptionFrame:{fields:{id:{type:"uint64",id:1},name:{type:"string",id:2},text:{type:"string",id:3},userId:{type:"string",id:4},timestamp:{type:"string",id:5}}},Frame:{oneofs:{frame:{oneof:["text","audio","transcription"]}},fields:{text:{type:"TextFrame",id:1},audio:{type:"AudioRawFrame",id:2},transcription:{type:"TranscriptionFrame",id:3}}}}}},jsonDescriptor={options,nested},ConnectionQuality;(function(U){U.UNKNOWN="UNKNOWN",U.GOOD="GOOD",U.BAD="BAD"})(ConnectionQuality||(ConnectionQuality={}));var AbstractConnectionQualityIndicator=(function(){function U(j){this._connectionQuality=ConnectionQuality.UNKNOWN,this.onConnectionQualityChanged=j}return Object.defineProperty(U.prototype,"connectionQuality",{get:function(){return this._connectionQuality},enumerable:!1,configurable:!0}),U.prototype.handleStatsChanged=function(){var j=this.calculateConnectionQuality();j!==this._connectionQuality&&(this._connectionQuality=j,this.onConnectionQualityChanged(j))},U.prototype.start=function(j){this.stop(!0),this._start(j)},U.prototype.stop=function(j){j===void 0&&(j=!1),this._stop(),this._connectionQuality=ConnectionQuality.UNKNOWN,j||this.onConnectionQualityChanged(ConnectionQuality.UNKNOWN)},U})();function QualityIndicatorMixer(){for(var U=[],j=0;j<arguments.length;j++)U[j]=arguments[j];var B=(function(q){__extends(V,q);function V(H){var $=q.call(this,H)||this;return $.childTrackers=U.map(function(K){var X=K.getParams,Q=K.TrackerClass;return{tracker:new Q(function(){return $.handleStatsChanged()}),getParams:X}}),$}return V.prototype.calculateConnectionQuality=function(){var H=this.childTrackers.map(function($){var K=$.tracker;return K.connectionQuality});return H.some(function($){return $===ConnectionQuality.BAD})?ConnectionQuality.BAD:H.every(function($){return $===ConnectionQuality.UNKNOWN})?ConnectionQuality.UNKNOWN:ConnectionQuality.GOOD},V.prototype._start=function(H){this.childTrackers.forEach(function($){var K=$.tracker,X=$.getParams;return K.start(X(H))})},V.prototype._stop=function(){this.childTrackers.forEach(function(H){var $=H.tracker;return $.stop(!0)})},V})(AbstractConnectionQualityIndicator);return B}var LiveKitConnectionQualityIndicator=(function(U){__extends(j,U);function j(){var B=U!==null&&U.apply(this,arguments)||this;return B.room=null,B.liveKitConnectionQuality=ConnectionQuality$2.Unknown,B.liveKitConnectionState=null,B.handleConnectionQualityChanged=function(q){B.liveKitConnectionQuality=q,B.handleStatsChanged()},B.handleConnectionStateChanged=function(q){B.liveKitConnectionState=q,B.handleStatsChanged()},B}return j.prototype._start=function(B){this.room=B,this.room.localParticipant.on(ParticipantEvent.ConnectionQualityChanged,this.handleConnectionQualityChanged),this.room.on(RoomEvent.ConnectionStateChanged,this.handleConnectionStateChanged)},j.prototype._stop=function(){this.room&&(this.room.localParticipant.off(RoomEvent.ConnectionQualityChanged,this.handleConnectionQualityChanged),this.room.off(RoomEvent.ConnectionStateChanged,this.handleConnectionStateChanged))},j.prototype.calculateConnectionQuality=function(){return[ConnectionQuality$2.Lost,ConnectionQuality$2.Poor].includes(this.liveKitConnectionQuality)||this.liveKitConnectionState&&[ConnectionState.Disconnected,ConnectionState.Reconnecting,ConnectionState.SignalReconnecting].includes(this.liveKitConnectionState)?ConnectionQuality.BAD:ConnectionQuality.GOOD},j})(AbstractConnectionQualityIndicator),t,e,s,n;function r(){}function o(){o.init.call(this)}function i(U){return U._maxListeners===void 0?o.defaultMaxListeners:U._maxListeners}function a(U,j,B){if(j)U.call(B);else for(var q=U.length,V=m(U,q),H=0;H<q;++H)V[H].call(B)}function c(U,j,B,q){if(j)U.call(B,q);else for(var V=U.length,H=m(U,V),$=0;$<V;++$)H[$].call(B,q)}function d(U,j,B,q,V){if(j)U.call(B,q,V);else for(var H=U.length,$=m(U,H),K=0;K<H;++K)$[K].call(B,q,V)}function u(U,j,B,q,V,H){if(j)U.call(B,q,V,H);else for(var $=U.length,K=m(U,$),X=0;X<$;++X)K[X].call(B,q,V,H)}function h(U,j,B,q){if(j)U.apply(B,q);else for(var V=U.length,H=m(U,V),$=0;$<V;++$)H[$].apply(B,q)}function l(U,j,B,q){var V,H,$,K;if(typeof B!="function")throw new TypeError('"listener" argument must be a function');if((H=U._events)?(H.newListener&&(U.emit("newListener",j,B.listener?B.listener:B),H=U._events),$=H[j]):(H=U._events=new r,U._eventsCount=0),$){if(typeof $=="function"?$=H[j]=q?[B,$]:[$,B]:q?$.unshift(B):$.push(B),!$.warned&&(V=i(U))&&V>0&&$.length>V){$.warned=!0;var X=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+j+" listeners added. Use emitter.setMaxListeners() to increase limit");X.name="MaxListenersExceededWarning",X.emitter=U,X.type=j,X.count=$.length,K=X,typeof console.warn=="function"?console.warn(K):console.log(K)}}else $=H[j]=B,++U._eventsCount;return U}function p(U,j,B){var q=!1;function V(){U.removeListener(j,V),q||(q=!0,B.apply(U,arguments))}return V.listener=B,V}function f(U){var j=this._events;if(j){var B=j[U];if(typeof B=="function")return 1;if(B)return B.length}return 0}function m(U,j){for(var B=new Array(j);j--;)B[j]=U[j];return B}r.prototype=Object.create(null),o.EventEmitter=o,o.usingDomains=!1,o.prototype.domain=void 0,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.init=function(){this.domain=null,o.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(U){if(typeof U!="number"||U<0||isNaN(U))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=U,this},o.prototype.getMaxListeners=function(){return i(this)},o.prototype.emit=function(U){var j,B,q,V,H,$,K,X=U==="error";if($=this._events)X=X&&$.error==null;else if(!X)return!1;if(K=this.domain,X){if(j=arguments[1],!K){if(j instanceof Error)throw j;var Q=new Error('Uncaught, unspecified "error" event. ('+j+")");throw Q.context=j,Q}return j||(j=new Error('Uncaught, unspecified "error" event')),j.domainEmitter=this,j.domain=K,j.domainThrown=!1,K.emit("error",j),!1}if(!(B=$[U]))return!1;var W=typeof B=="function";switch(q=arguments.length){case 1:a(B,W,this);break;case 2:c(B,W,this,arguments[1]);break;case 3:d(B,W,this,arguments[1],arguments[2]);break;case 4:u(B,W,this,arguments[1],arguments[2],arguments[3]);break;default:for(V=new Array(q-1),H=1;H<q;H++)V[H-1]=arguments[H];h(B,W,this,V)}return!0},o.prototype.addListener=function(U,j){return l(this,U,j,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(U,j){return l(this,U,j,!0)},o.prototype.once=function(U,j){if(typeof j!="function")throw new TypeError('"listener" argument must be a function');return this.on(U,p(this,U,j)),this},o.prototype.prependOnceListener=function(U,j){if(typeof j!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(U,p(this,U,j)),this},o.prototype.removeListener=function(U,j){var B,q,V,H,$;if(typeof j!="function")throw new TypeError('"listener" argument must be a function');if(!(q=this._events))return this;if(!(B=q[U]))return this;if(B===j||B.listener&&B.listener===j)--this._eventsCount==0?this._events=new r:(delete q[U],q.removeListener&&this.emit("removeListener",U,B.listener||j));else if(typeof B!="function"){for(V=-1,H=B.length;H-- >0;)if(B[H]===j||B[H].listener&&B[H].listener===j){$=B[H].listener,V=H;break}if(V<0)return this;if(B.length===1){if(B[0]=void 0,--this._eventsCount==0)return this._events=new r,this;delete q[U]}else(function(K,X){for(var Q=X,W=Q+1,Z=K.length;W<Z;Q+=1,W+=1)K[Q]=K[W];K.pop()})(B,V);q.removeListener&&this.emit("removeListener",U,$||j)}return this},o.prototype.off=function(U,j){return this.removeListener(U,j)},o.prototype.removeAllListeners=function(U){var j,B;if(!(B=this._events))return this;if(!B.removeListener)return arguments.length===0?(this._events=new r,this._eventsCount=0):B[U]&&(--this._eventsCount==0?this._events=new r:delete B[U]),this;if(arguments.length===0){for(var q,V=Object.keys(B),H=0;H<V.length;++H)(q=V[H])!=="removeListener"&&this.removeAllListeners(q);return this.removeAllListeners("removeListener"),this._events=new r,this._eventsCount=0,this}if(typeof(j=B[U])=="function")this.removeListener(U,j);else if(j)do this.removeListener(U,j[j.length-1]);while(j[0]);return this},o.prototype.listeners=function(U){var j,B=this._events;return B&&(j=B[U])?typeof j=="function"?[j.listener||j]:(function(q){for(var V=new Array(q.length),H=0;H<V.length;++H)V[H]=q[H].listener||q[H];return V})(j):[]},o.listenerCount=function(U,j){return typeof U.listenerCount=="function"?U.listenerCount(j):f.call(U,j)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class g extends o{}(function(U){U.Issue="issue",U.NetworkScoresUpdated="network-scores-updated",U.StatsParsingFinished="stats-parsing-finished"})(t||(t={})),(function(U){U.Network="network",U.CPU="cpu",U.Server="server",U.Stream="stream"})(e||(e={})),(function(U){U.OutboundNetworkQuality="outbound-network-quality",U.InboundNetworkQuality="inbound-network-quality",U.OutboundNetworkMediaLatency="outbound-network-media-latency",U.InboundNetworkMediaLatency="inbound-network-media-latency",U.NetworkMediaSyncFailure="network-media-sync-failure",U.OutboundNetworkThroughput="outbound-network-throughput",U.InboundNetworkThroughput="inbound-network-throughput",U.EncoderCPUThrottling="encoder-cpu-throttling",U.DecoderCPUThrottling="decoder-cpu-throttling",U.ServerIssue="server-issue",U.UnknownVideoDecoderIssue="unknown-video-decoder",U.LowInboundMOS="low-inbound-mean-opinion-score",U.LowOutboundMOS="low-outbound-mean-opinion-score",U.FrozenVideoTrack="frozen-video-track",U.MissingVideoStreamData="missing-video-stream-data",U.MissingAudioStreamData="missing-audio-stream-data"})(s||(s={})),(function(U){U[U.BAD=2.1]="BAD",U[U.POOR=2.6]="POOR",U[U.FAIR=3.1]="FAIR",U[U.GOOD=3.8]="GOOD",U[U.EXCELLENT=4.3]="EXCELLENT"})(n||(n={}));const $r=class $r extends o{constructor(B){super();Bt(this,"isStopped",!1);Bt(this,"reportTimer");Bt(this,"getStatsInterval");Bt(this,"compositeStatsParser");this.compositeStatsParser=B.compositeStatsParser,this.getStatsInterval=B.getStatsInterval??1e4}get isRunning(){return!!this.reportTimer&&!this.isStopped}startReporting(){if(this.reportTimer)return;const B=()=>setTimeout((()=>{this.isStopped?this.reportTimer=void 0:this.parseReports().finally((()=>{this.reportTimer=B()}))}),this.getStatsInterval);this.isStopped=!1,this.reportTimer=B()}stopReporting(){this.isStopped=!0,this.reportTimer&&(clearTimeout(this.reportTimer),this.reportTimer=void 0)}async parseReports(){const B=Date.now(),q=await this.compositeStatsParser.parse(),V=Date.now()-B;this.emit($r.STATS_REPORTS_PARSED,{timeTaken:V,reportItems:q}),q.forEach((H=>{this.emit($r.STATS_REPORT_READY_EVENT,H)}))}};Bt($r,"STATS_REPORT_READY_EVENT","stats-report-ready"),Bt($r,"STATS_REPORTS_PARSED","stats-reports-parsed");let S=$r;const v=(()=>{const U=new Map;return j=>{const{taskId:B,delayMs:q,maxJitterMs:V,callback:H}=j,$=Math.ceil(Math.random()*(V||0)),K=U.get(B);K&&clearTimeout(K);const X=setTimeout((()=>{H(),U.delete(B)}),q+$);U.set(B,X)}})();var ir;class k{constructor(){Pt(this,ir,{})}calculate(j){const{connection:{id:B}}=j,{mos:q,stats:V}=this.calculateOutboundScore(j)||{},{mos:H,stats:$}=this.calculateInboundScore(j)||{};return rt(this,ir)[B]=j,v({taskId:B,delayMs:35e3,callback:()=>delete rt(this,ir)[B]}),{outbound:q,inbound:H,connectionId:B,statsSamples:{inboundStatsSample:$,outboundStatsSample:V}}}calculateOutboundScore(j){var ae,oe,de,le;const B=[...((ae=j.remote)==null?void 0:ae.audio.inbound)||[],...((oe=j.remote)==null?void 0:oe.video.inbound)||[]];if(!B.length)return;const q=rt(this,ir)[j.connection.id];if(!q)return;const V=[...((de=q.remote)==null?void 0:de.audio.inbound)||[],...((le=q.remote)==null?void 0:le.video.inbound)||[]],{packetsSent:H}=j.connection,$=q.connection.packetsSent,K=B.reduce(((ue,he)=>{const me=V.find((be=>be.ssrc===he.ssrc));return{sumJitter:ue.sumJitter+he.jitter,packetsLost:ue.packetsLost+he.packetsLost,lastPacketsLost:ue.lastPacketsLost+((me==null?void 0:me.packetsLost)||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),X=1e3*j.connection.currentRoundTripTime||0,{sumJitter:Q}=K,W=Q/B.length,Z=H-$,te=K.packetsLost-K.lastPacketsLost,ie=Z&&te?Math.round(100*te/(Z+te)):0;return{mos:this.calculateMOS({avgJitter:W,rtt:X,packetsLoss:ie}),stats:{avgJitter:W,rtt:X,packetsLoss:ie}}}calculateInboundScore(j){var ae,oe,de,le;const B=[...(ae=j.audio)==null?void 0:ae.inbound,...(oe=j.video)==null?void 0:oe.inbound];if(!B.length)return;const q=rt(this,ir)[j.connection.id];if(!q)return;const V=[...(de=q.video)==null?void 0:de.inbound,...(le=q.audio)==null?void 0:le.inbound],{packetsReceived:H}=j.connection,$=q.connection.packetsReceived,K=B.reduce(((ue,he)=>{const me=V.find((be=>be.ssrc===he.ssrc));return{sumJitter:ue.sumJitter+he.jitter,packetsLost:ue.packetsLost+he.packetsLost,lastPacketsLost:ue.lastPacketsLost+((me==null?void 0:me.packetsLost)||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),X=1e3*j.connection.currentRoundTripTime||0,{sumJitter:Q}=K,W=Q/B.length,Z=H-$,te=K.packetsLost-K.lastPacketsLost,ie=Z&&te?Math.round(100*te/(Z+te)):0;return{mos:this.calculateMOS({avgJitter:W,rtt:X,packetsLoss:ie}),stats:{avgJitter:W,rtt:X,packetsLoss:ie}}}calculateMOS({avgJitter:j,rtt:B,packetsLoss:q}){const V=B+2*j+10;let H=V<160?93.2-V/40:93.2-V/120-10;return H-=2.5*q,1+.035*H+7e-6*H*(H-60)*(100-H)}}ir=new WeakMap;var ci,za,qa;class y{constructor(j={}){Pt(this,ci,new Map);Pt(this,za);Pt(this,qa);Lt(this,za,j.statsCleanupTtlMs??35e3),Lt(this,qa,j.maxParsedStatsStorageSize??5)}detect(j,B){const q={...j,networkScores:{...B,statsSamples:(B==null?void 0:B.statsSamples)||{}}},V=this.performDetection(q);return this.setLastProcessedStats(j.connection.id,q),this.performPrevStatsCleanup({connectionId:j.connection.id}),V}performPrevStatsCleanup(j){const{connectionId:B,cleanupCallback:q}=j;rt(this,ci).has(B)&&v({taskId:B,delayMs:rt(this,za),callback:()=>{this.deleteLastProcessedStats(B),typeof q=="function"&&q()}})}setLastProcessedStats(j,B){if(!j||B.connection.id!==j)return;const q=rt(this,ci).get(j)??[];q.push(B),q.length>rt(this,qa)&&q.shift(),rt(this,ci).set(j,q)}getLastProcessedStats(j){const B=rt(this,ci).get(j);return B==null?void 0:B[B.length-1]}getAllLastProcessedStats(j){return rt(this,ci).get(j)??[]}deleteLastProcessedStats(j){rt(this,ci).delete(j)}}ci=new WeakMap,za=new WeakMap,qa=new WeakMap;var Fa;class w extends y{constructor(B={}){super(B);Pt(this,Fa);Lt(this,Fa,B.availableOutgoingBitrateThreshold??1e5)}performDetection(B){const q=[],{availableOutgoingBitrate:V}=B.connection;if(V===void 0)return q;const H=B.audio.outbound.reduce(((X,Q)=>X+Q.targetBitrate),0),$=B.video.outbound.reduce(((X,Q)=>X+Q.bitrate),0);if(!H&&!$)return q;const K={availableOutgoingBitrate:V,videoStreamsTotalBitrate:$,audioStreamsTotalTargetBitrate:H};return(H>V||$>0&&V<rt(this,Fa))&&q.push({statsSample:K,type:e.Network,reason:s.OutboundNetworkThroughput}),q}}Fa=new WeakMap;var Va,Ha,$a,Ga;class b extends y{constructor(B={}){super();Pt(this,Va);Pt(this,Ha);Pt(this,$a);Pt(this,Ga);Lt(this,Va,B.highPacketLossThresholdPct??5),Lt(this,Ha,B.highJitterThreshold??200),Lt(this,$a,B.highJitterBufferDelayThresholdMs??500),Lt(this,Ga,B.highRttThresholdMs??250)}performDetection(B){return this.processData(B)}processData(B){var ze,xe,Ie,Ge;const q=[],V=[...(ze=B.audio)==null?void 0:ze.inbound,...(xe=B.video)==null?void 0:xe.inbound];if(!V.length)return q;const H=this.getLastProcessedStats(B.connection.id);if(!H)return q;const $=[...(Ie=H.video)==null?void 0:Ie.inbound,...(Ge=H.audio)==null?void 0:Ge.inbound],{packetsReceived:K}=B.connection,X=H.connection.packetsReceived,Q=V.reduce(((De,Ve)=>{const Se=$.find((Oe=>Oe.ssrc===Ve.ssrc)),we=(Se==null?void 0:Se.jitterBufferDelay)||0,$e=(Se==null?void 0:Se.jitterBufferEmittedCount)||0,Ye=Ve.jitterBufferDelay-we,pe=Ve.jitterBufferEmittedCount-$e,ve=Ye&&pe?1e3*Ye/pe:0;return{sumJitter:De.sumJitter+Ve.jitter,sumJitterBufferDelayMs:De.sumJitterBufferDelayMs+ve,packetsLost:De.packetsLost+Ve.packetsLost,lastPacketsLost:De.lastPacketsLost+((Se==null?void 0:Se.packetsLost)||0)}}),{sumJitter:0,sumJitterBufferDelayMs:0,packetsLost:0,lastPacketsLost:0}),W=1e3*B.connection.currentRoundTripTime||0,{sumJitter:Z,sumJitterBufferDelayMs:te}=Q,ie=Z/V.length,ae=te/V.length,oe=K-X,de=Q.packetsLost-Q.lastPacketsLost,le=oe&&de?Math.round(100*de/(oe+de)):0,ue=le>rt(this,Va),he=ie>=rt(this,Ha),me=W>=rt(this,Ga),be=ae>rt(this,$a),ge=me&&!he&&!ue,Ee=ue&&he,Fe=he&&be,Ue={rtt:W,packetLossPct:le,avgJitter:ie,avgJitterBufferDelay:ae};return(he||ue)&&q.push({statsSample:Ue,type:e.Network,reason:s.InboundNetworkQuality,iceCandidate:B.connection.local.id}),ge&&q.push({statsSample:Ue,type:e.Server,reason:s.ServerIssue,iceCandidate:B.connection.remote.id}),Ee&&q.push({statsSample:Ue,type:e.Network,reason:s.InboundNetworkMediaLatency,iceCandidate:B.connection.local.id}),Fe&&q.push({statsSample:Ue,type:e.Network,reason:s.NetworkMediaSyncFailure,iceCandidate:B.connection.local.id}),q}}Va=new WeakMap,Ha=new WeakMap,$a=new WeakMap,Ga=new WeakMap;var Ka;class P extends y{constructor(B={}){super();Pt(this,Ka);Lt(this,Ka,B.correctedSamplesThresholdPct??5)}performDetection(B){return this.processData(B)}processData(B){var $;const q=B.audio.inbound,V=[],H=($=this.getLastProcessedStats(B.connection.id))==null?void 0:$.audio.inbound;return H&&q.forEach((K=>{const X=H.find((oe=>oe.ssrc===K.ssrc));if(!X)return;const Q=K.track.insertedSamplesForDeceleration+K.track.removedSamplesForAcceleration,W=X.track.insertedSamplesForDeceleration+X.track.removedSamplesForAcceleration;if(Q===W)return;const Z=K.track.totalSamplesReceived-X.track.totalSamplesReceived,te=Q-W,ie=Math.round(100*te/Z),ae={correctedSamplesPct:ie};ie>rt(this,Ka)&&V.push({statsSample:ae,type:e.Network,reason:s.NetworkMediaSyncFailure,ssrc:K.ssrc})})),V}}Ka=new WeakMap;var Qa,Ya;class T extends y{constructor(B={}){super();Pt(this,Qa);Pt(this,Ya);Lt(this,Qa,B.highPacketLossThresholdPct??5),Lt(this,Ya,B.highJitterThreshold??200)}performDetection(B){return this.processData(B)}processData(B){var me,be,ge,Ee;const q=[],V=[...((me=B.remote)==null?void 0:me.audio.inbound)||[],...((be=B.remote)==null?void 0:be.video.inbound)||[]];if(!V.length)return q;const H=this.getLastProcessedStats(B.connection.id);if(!H)return q;const $=[...((ge=H.remote)==null?void 0:ge.audio.inbound)||[],...((Ee=H.remote)==null?void 0:Ee.video.inbound)||[]],{packetsSent:K}=B.connection,X=H.connection.packetsSent,Q=V.reduce(((Fe,Ue)=>{const ze=$.find((xe=>xe.ssrc===Ue.ssrc));return{sumJitter:Fe.sumJitter+Ue.jitter,packetsLost:Fe.packetsLost+Ue.packetsLost,lastPacketsLost:Fe.lastPacketsLost+((ze==null?void 0:ze.packetsLost)||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),W=1e3*B.connection.currentRoundTripTime||0,{sumJitter:Z}=Q,te=Z/V.length,ie=K-X,ae=Q.packetsLost-Q.lastPacketsLost,oe=ie&&ae?Math.round(100*ae/(ie+ae)):0,de=oe>rt(this,Qa),le=te>=rt(this,Ya),ue=!de&&le||le||de,he={rtt:W,avgJitter:te,packetLossPct:oe};return de&&le&&q.push({statsSample:he,type:e.Network,reason:s.OutboundNetworkMediaLatency,iceCandidate:B.connection.local.id}),ue&&q.push({statsSample:he,type:e.Network,reason:s.OutboundNetworkQuality,iceCandidate:B.connection.local.id}),q}}Qa=new WeakMap,Ya=new WeakMap;class L extends y{performDetection(j){return this.processData(j)}processData(j){var H;const B=j.video.outbound.filter(($=>$.qualityLimitationReason!=="none")),q=[],V=(H=this.getLastProcessedStats(j.connection.id))==null?void 0:H.video.outbound;return V&&B.forEach(($=>{const K=V.find((Q=>Q.ssrc===$.ssrc));if(!K)return;const X={qualityLimitationReason:$.qualityLimitationReason};$.framesSent>K.framesSent||($.qualityLimitationReason==="cpu"&&q.push({statsSample:X,type:e.CPU,reason:s.EncoderCPUThrottling,ssrc:$.ssrc}),$.qualityLimitationReason==="bandwidth"&&q.push({statsSample:X,type:e.Network,reason:s.OutboundNetworkThroughput,ssrc:$.ssrc}))})),q}}var rr;class D extends y{constructor(){super(...arguments);Bt(this,"UNKNOWN_DECODER","unknown");Pt(this,rr,{})}performDetection(B){return this.processData(B)}performPrevStatsCleanup(B){const{connectionId:q,cleanupCallback:V}=B;super.performPrevStatsCleanup({...B,cleanupCallback:()=>{delete rt(this,rr)[q],typeof V=="function"&&V()}})}processData(B){var $;const q=[],{id:V}=B.connection,H=($=this.getLastProcessedStats(V))==null?void 0:$.video.inbound;return B.video.inbound.forEach((K=>{const{decoderImplementation:X,ssrc:Q}=K;if(H==null?void 0:H.find((Z=>Z.ssrc===Q)))if(X===this.UNKNOWN_DECODER){if(!this.hadLastDecoderWithIssue(V,Q)){this.setLastDecoderWithIssue(V,Q,this.UNKNOWN_DECODER);const Z={mimeType:K.mimeType,decoderImplementation:X};q.push({ssrc:Q,statsSample:Z,type:e.Stream,reason:s.UnknownVideoDecoderIssue,trackIdentifier:K.track.trackIdentifier})}}else this.setLastDecoderWithIssue(V,Q,void 0)})),q}setLastDecoderWithIssue(B,q,V){const H=rt(this,rr)[B]??{};V===void 0?delete H[q]:H[q]=V,rt(this,rr)[B]=H}hadLastDecoderWithIssue(B,q){const V=rt(this,rr)[B];return(V&&V[q])===this.UNKNOWN_DECODER}}rr=new WeakMap;const C=U=>U.reduce(((j,B)=>j+B),0)/U.length,R=(U,j,B=30)=>{var V,H,$,K,X;const q=[];for(let Q=1;Q<j.length-1;Q+=1){const W=(H=(V=j[Q])==null?void 0:V.video)==null?void 0:H.inbound.find((ae=>ae.ssrc===U));if(!W)continue;const Z=(X=(K=($=j[Q-1])==null?void 0:$.video)==null?void 0:K.inbound)==null?void 0:X.find((ae=>ae.ssrc===U));if(!W||!Z)continue;const te=W.timestamp-Z.timestamp,ie=W.framesDecoded-Z.framesDecoded;if(ie>0){const ae=te/ie;q.push(ae)}}return q.length<=1?!1:(Q=>{const W=((Z,te)=>te.reduce(((ie,ae)=>ie+(ae-Z)**2),0)/te.length)(C(Q),Q);return Math.sqrt(W)})(q)>B},M=(U,j)=>{for(let B=1;B<j.length;B+=1){const q=j[B].video.inbound.find((K=>K.ssrc===U));if(!q)continue;const V=j[B-1].video.inbound.find((K=>K.ssrc===U)),H=q.frameWidth!==(V==null?void 0:V.frameWidth),$=q.frameHeight!==(V==null?void 0:V.frameHeight);if(H||$)return!0}return!1};var Ja,Xa,Wa;class I extends y{constructor(B={}){super();Pt(this,Ja);Pt(this,Xa);Pt(this,Wa);Lt(this,Ja,B.avgFreezeDurationThresholdMs??1e3),Lt(this,Xa,B.frozenDurationThresholdPct??30),Lt(this,Wa,B.minMosQuality??n.BAD)}performDetection(B){const q=B.networkScores.inbound;return q!==void 0&&q<=rt(this,Wa)?[]:this.processData(B)}processData(B){const q=[],V=this.getAllLastProcessedStats(B.connection.id);if(V.length===0)return[];const H=B.video.inbound.map(($=>{const K=V[V.length-1].video.inbound.find((te=>te.ssrc===$.ssrc));if(!K||M($.ssrc,[V[V.length-1],B])||R($.ssrc,V))return;const X=$.freezeCount-(K.freezeCount??0),Q=1e3*($.totalFreezesDuration-(K.totalFreezesDuration??0)),W=X>0?Q/X:0,Z=Q/($.timestamp-K.timestamp)*100;return Z>rt(this,Xa)||W>rt(this,Ja)?{ssrc:$.ssrc,avgFreezeDurationMs:W,frozenDurationPct:Z}:void 0})).filter(($=>$!==void 0));return H.length>0&&(q.push({type:e.Stream,reason:s.FrozenVideoTrack,statsSample:{ssrcs:H.map(($=>$.ssrc))}}),this.deleteLastProcessedStats(B.connection.id)),q}}Ja=new WeakMap,Xa=new WeakMap,Wa=new WeakMap;var Za,es,ts;class E extends y{constructor(B={}){super(B);Pt(this,Za);Pt(this,es);Pt(this,ts);Lt(this,Za,B.volatilityThreshold??8),Lt(this,es,B.affectedStreamsPercentThreshold??30),Lt(this,ts,B.minMosQuality??n.BAD)}performDetection(B){return[...this.getAllLastProcessedStats(B.connection.id),B].find((q=>q.networkScores.inbound!==void 0&&q.networkScores.inbound<=rt(this,ts)))?[]:this.processData(B)}processData(B){const q=[],V=[...this.getAllLastProcessedStats(B.connection.id),B],H=B.video.inbound.map((K=>{if(V.length<5||M(K.ssrc,V))return;const X=[];for(let W=0;W<V.length-1;W+=1){const Z=V[W].video.inbound.find((te=>te.ssrc===K.ssrc));(Z==null?void 0:Z.framesPerSecond)!==void 0&&X.push(Z.framesPerSecond)}if(X.length<5||R(K.ssrc,V))return;const Q=(W=>{if(W.length===0)throw new Error("Cannot calculate volatility for empty array");const Z=C(W);return W.reduce(((te,ie)=>te+Math.abs(ie-Z)),0)/W.length*100/Z})(X);return Q>rt(this,Za)?{ssrc:K.ssrc,allFps:X,volatility:Q}:void 0})).filter((K=>!!K));if(H.length===0)return q;const $=H.length/(B.video.inbound.length/100);return $>rt(this,es)&&(q.push({type:e.CPU,reason:s.DecoderCPUThrottling,statsSample:{affectedStreamsPercent:$,throtthedStreams:H}}),this.deleteLastProcessedStats(B.connection.id)),q}}Za=new WeakMap,es=new WeakMap,ts=new WeakMap;const N=U=>U.iceConnectionState==="closed"||U.connectionState==="closed",_=(U,j,B)=>8*((q,V,H)=>{if(!V)return 0;const $=q[H],K=V[H];if($==null||K==null)return 0;const X=Math.floor(q.timestamp)-Math.floor(V.timestamp);return X===0?0:(Number($)-Number(K))/X*1e3})(U,j,B);class A{constructor(j){Bt(this,"connections",[]);Bt(this,"statsParser");this.statsParser=j.statsParser}listConnections(){return[...this.connections]}addPeerConnection(j){this.connections.push({id:j.id??String(Date.now()+Math.random().toString(32)),pc:j.pc})}removePeerConnection(j){const B=this.connections.findIndex((({pc:q})=>q===j.pc));B>=0&&this.removeConnectionsByIndexes([B])}async parse(){const j=[],B=this.connections.map((async(q,V)=>{if(!N(q.pc))return this.statsParser.parse(q);j.unshift(V)}));return j.length&&this.removeConnectionsByIndexes(j),(await Promise.all(B)).filter((q=>q!==void 0))}removeConnectionsByIndexes(j){j.forEach((B=>{this.connections.splice(B,1)}))}}class O{constructor(j){Bt(this,"prevStats",new Map);Bt(this,"allowedReportTypes",new Set(["candidate-pair","inbound-rtp","outbound-rtp","remote-outbound-rtp","remote-inbound-rtp","track","transport"]));Bt(this,"ignoreSSRCList");Bt(this,"logger");this.ignoreSSRCList=j.ignoreSSRCList??[],this.logger=j.logger}get previouslyParsedStatsConnectionsIds(){return[...this.prevStats.keys()]}async parse(j){if(!N(j.pc))return this.getConnectionStats(j);this.logger.debug("Skip stats parsing. Connection is closed.",{connection:j})}async getConnectionStats(j){const{pc:B,id:q}=j;try{const V=Date.now(),H=B.getReceivers().filter((Q=>{var W;return(W=Q.track)==null?void 0:W.enabled})),$=B.getSenders().filter((Q=>{var W;return(W=Q.track)==null?void 0:W.enabled})),K=await Promise.all(H.map((Q=>Q.getStats()))),X=await Promise.all($.map((Q=>Q.getStats())));return{id:q,stats:this.mapReportsStats([...K,...X],j),timeTaken:Date.now()-V}}catch(V){return void this.logger.error("Failed to get stats for PC",{id:q,pc:B,error:V})}}mapReportsStats(j,B){const q={audio:{inbound:[],outbound:[]},video:{inbound:[],outbound:[]},connection:{},remote:{video:{inbound:[],outbound:[]},audio:{inbound:[],outbound:[]}}};j.forEach(($=>{$.forEach((K=>{this.allowedReportTypes.has(K.type)&&this.updateMappedStatsWithReportItemData(K,q,$)}))}));const{id:V}=B,H=this.prevStats.get(V);return H&&this.propagateStatsWithRateValues(q,H.stats),this.prevStats.set(V,{stats:q,ts:Date.now()}),v({taskId:V,delayMs:35e3,callback:()=>this.prevStats.delete(V)}),q}updateMappedStatsWithReportItemData(j,B,q){const V=j.type;if(V==="candidate-pair"&&j.state==="succeeded"&&j.nominated)return void(B.connection=this.prepareConnectionStats(j,q));const H=this.getMediaType(j);if(!H)return;const $=j.ssrc;if(!$||!this.ignoreSSRCList.includes($))if(V!=="outbound-rtp")if(V!=="inbound-rtp")V!=="remote-outbound-rtp"?V==="remote-inbound-rtp"&&(this.mapConnectionStatsIfNecessary(B,j,q),B.remote[H].inbound.push({...j})):B.remote[H].outbound.push({...j});else{const K=q.get(j.trackId)||q.get(j.mediaSourceId)||{};this.mapConnectionStatsIfNecessary(B,j,q);const X={...j,track:{...K}};B[H].inbound.push(X)}else{const K=q.get(j.trackId)||q.get(j.mediaSourceId)||{},X={...j,track:{...K}};B[H].outbound.push(X)}}getMediaType(j){const B=j.mediaType||j.kind;if(!["audio","video"].includes(B)){const{id:q}=j;return q?String(q).includes("Video")?"video":String(q).includes("Audio")?"audio":void 0:void 0}return B}propagateStatsWithRateValues(j,B){j.audio.inbound.forEach((q=>{const V=B.audio.inbound.find((({id:H})=>H===q.id));q.bitrate=_(q,V,"bytesReceived"),q.packetRate=_(q,V,"packetsReceived")})),j.audio.outbound.forEach((q=>{const V=B.audio.outbound.find((({id:H})=>H===q.id));q.bitrate=_(q,V,"bytesSent"),q.packetRate=_(q,V,"packetsSent")})),j.video.inbound.forEach((q=>{const V=B.video.inbound.find((({id:H})=>H===q.id));q.bitrate=_(q,V,"bytesReceived"),q.packetRate=_(q,V,"packetsReceived")})),j.video.outbound.forEach((q=>{const V=B.video.outbound.find((({id:H})=>H===q.id));q.bitrate=_(q,V,"bytesSent"),q.packetRate=_(q,V,"packetsSent")}))}mapConnectionStatsIfNecessary(j,B,q){if(j.connection.id||!B.transportId)return;const V=q.get(B.transportId);if(V&&V.selectedCandidatePairId){const H=q.get(V.selectedCandidatePairId);j.connection=this.prepareConnectionStats(H,q)}}prepareConnectionStats(j,B){if(!j||!B)return{};const q={...j};if(q.remoteCandidateId){const V=B.get(q.remoteCandidateId);q.remote={...V}}if(q.localCandidateId){const V=B.get(q.localCandidateId);q.local={...V}}return q}}var Ii,Gr,Kr;const mo=class mo extends y{constructor(B={}){super();Pt(this,Ii,new Map);Pt(this,Gr);Pt(this,Kr);Lt(this,Gr,B.timeoutMs??15e3),Lt(this,Kr,B.steps??3)}performDetection(B){return this.processData(B)}processData(B){const q=[],V=[...this.getAllLastProcessedStats(B.connection.id),B];if(V.length<rt(this,Kr))return q;const H=V.slice(-rt(this,Kr)),$=H.map((X=>X.video.inbound)),K=H.map((X=>X.audio.inbound));return q.push(...this.detectMissingData(K,e.Stream,s.MissingAudioStreamData)),q.push(...this.detectMissingData($,e.Stream,s.MissingVideoStreamData)),new Set(rt(this,Ii).keys()).forEach((X=>{const Q=rt(this,Ii).get(X);Q&&Date.now()-Q>rt(this,Gr)&&this.removeMarkedIssue(X)})),q}detectMissingData(B,q,V){const H=[],$=B.pop(),K=mo.mapStatsByTrackId(B);return $.forEach((X=>{const Q=X.track.trackIdentifier,W=K.get(Q);if(!Array.isArray(W)||W.length===0||X.track.detached||X.track.ended)return;if(!mo.isAllBytesReceivedDidntChange(X.bytesReceived,W))return void this.removeMarkedIssue(Q);if(!this.markIssue(Q))return;const Z={bytesReceived:X.bytesReceived};H.push({type:q,reason:V,statsSample:Z,trackIdentifier:Q})})),H}static mapStatsByTrackId(B){const q=new Map;return B.forEach((V=>{V.forEach((H=>{const $=q.get(H.track.trackIdentifier)||[];$.push(H),q.set(H.track.trackIdentifier,$)}))})),q}static isAllBytesReceivedDidntChange(B,q){for(let V=0;V<q.length;V+=1)if(q[V].bytesReceived!==B)return!1;return!0}markIssue(B){const q=Date.now(),V=rt(this,Ii).get(B);return(!V||q-V>rt(this,Gr))&&(rt(this,Ii).set(B,q),!0)}removeMarkedIssue(B){rt(this,Ii).delete(B)}};Ii=new WeakMap,Gr=new WeakMap,Kr=new WeakMap;let J=mo;var Vn;class x{constructor(j){Bt(this,"eventEmitter");Pt(this,Vn,!1);Bt(this,"detectors",[]);Bt(this,"networkScoresCalculator");Bt(this,"statsReporter");Bt(this,"compositeStatsParser");Bt(this,"logger");Bt(this,"autoAddPeerConnections");this.logger=j.logger??{debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},this.eventEmitter=j.issueEmitter??new g,j.onIssues&&this.eventEmitter.on(t.Issue,j.onIssues),j.onNetworkScoresUpdated&&this.eventEmitter.on(t.NetworkScoresUpdated,j.onNetworkScoresUpdated),this.detectors=j.detectors??[new L,new b,new T,new P,new w,new D,new I,new E,new J],this.networkScoresCalculator=j.networkScoresCalculator??new k,this.compositeStatsParser=j.compositeStatsParser??new A({statsParser:new O({ignoreSSRCList:j.ignoreSSRCList,logger:this.logger})}),this.statsReporter=j.statsReporter??new S({compositeStatsParser:this.compositeStatsParser,getStatsInterval:j.getStatsInterval??5e3}),window.wid=this,this.autoAddPeerConnections=j.autoAddPeerConnections??!0,this.autoAddPeerConnections&&this.wrapRTCPeerConnection(),this.statsReporter.on(S.STATS_REPORT_READY_EVENT,(B=>{const q=this.calculateNetworkScores(B.stats);this.detectIssues({data:B.stats},q)})),this.statsReporter.on(S.STATS_REPORTS_PARSED,(B=>{const q={timeTaken:B.timeTaken,ts:Date.now()};j.onStats&&j.onStats(B.reportItems),this.eventEmitter.emit(t.StatsParsingFinished,q)}))}watchNewPeerConnections(){if(!this.autoAddPeerConnections)throw new Error("Auto add peer connections was disabled in the constructor.");rt(this,Vn)?this.logger.warn("WebRTCIssueDetector is already started. Skip processing"):(this.logger.info("Start watching peer connections"),Lt(this,Vn,!0),this.statsReporter.startReporting())}stopWatchingNewPeerConnections(){rt(this,Vn)?(this.logger.info("Stop watching peer connections"),Lt(this,Vn,!1),this.statsReporter.stopReporting()):this.logger.warn("WebRTCIssueDetector is already stopped. Skip processing")}handleNewPeerConnection(j,B){rt(this,Vn)||!this.autoAddPeerConnections?(rt(this,Vn)||this.autoAddPeerConnections!==!1||(this.logger.info("Starting stats reporting for new peer connection"),Lt(this,Vn,!0),this.statsReporter.startReporting()),this.logger.debug("Handling new peer connection",j),this.compositeStatsParser.addPeerConnection({pc:j,id:B})):this.logger.debug("Skip handling new peer connection. Detector is not running",j)}emitIssues(j){this.eventEmitter.emit(t.Issue,j)}detectIssues({data:j},B){const q=this.detectors.reduce(((V,H)=>[...V,...H.detect(j,B)]),[]);q.length>0&&this.emitIssues(q)}calculateNetworkScores(j){const B=this.networkScoresCalculator.calculate(j);return this.eventEmitter.emit(t.NetworkScoresUpdated,B),B}wrapRTCPeerConnection(){if(!window.RTCPeerConnection)return void this.logger.warn("No RTCPeerConnection found in browser window. Skipping");const j=window.RTCPeerConnection,B=V=>this.handleNewPeerConnection(V);function q(V){const H=new j(V);return B(H),H}q.prototype=j.prototype,window.RTCPeerConnection=q}}Vn=new WeakMap;var WebRTCConnectionQualityIndicator=(function(U){__extends(j,U);function j(){var B=U!==null&&U.apply(this,arguments)||this;return B.issueDetector=null,B.mosScores=null,B}return j.prototype._start=function(B){var q=this;this.issueDetector=new x({autoAddPeerConnections:!1,getStatsInterval:3e3,onNetworkScoresUpdated:function(V){q.mosScores=V,q.handleStatsChanged()}}),this.issueDetector.handleNewPeerConnection(B)},j.prototype._stop=function(){this.issueDetector&&(this.issueDetector.stopWatchingNewPeerConnections(),this.issueDetector=null),this.mosScores=null},j.prototype.calculateConnectionQuality=function(){return!this.mosScores||this.mosScores.inbound&&this.mosScores.outbound?ConnectionQuality.UNKNOWN:this.mosScores.inbound&&this.mosScores.inbound<3||this.mosScores.outbound&&this.mosScores.outbound<3?ConnectionQuality.BAD:ConnectionQuality.GOOD},j})(AbstractConnectionQualityIndicator),VoiceChatState;(function(U){U.INACTIVE="inactive",U.STARTING="starting",U.ACTIVE="started",U.STOPPING="stopping"})(VoiceChatState||(VoiceChatState={}));var AbstractVoiceChat=(function(){function U(){}return U})(),AbstractVoiceChatImplementation=(function(U){__extends(j,U);function j(){var B=U!==null&&U.apply(this,arguments)||this;return B._isMuted=!0,B.state=VoiceChatState.INACTIVE,B}return Object.defineProperty(j.prototype,"isMuted",{get:function(){return this._isMuted},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"isVoiceChatting",{get:function(){return this.state!==VoiceChatState.INACTIVE},enumerable:!1,configurable:!0}),j.prototype.startVoiceChat=function(B){return __awaiter(this,void 0,void 0,function(){var q;return __generator(this,function(V){switch(V.label){case 0:return this.state===VoiceChatState.INACTIVE?[3,2]:[4,this.stopVoiceChat()];case 1:V.sent(),V.label=2;case 2:return V.trys.push([2,4,,6]),this.state=VoiceChatState.STARTING,[4,this._startVoiceChat(B)];case 3:return V.sent(),this.state=VoiceChatState.ACTIVE,[3,6];case 4:return q=V.sent(),[4,this.stopVoiceChat()];case 5:throw V.sent(),q;case 6:return[2]}})})},j.prototype.stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(B){switch(B.label){case 0:return this.state===VoiceChatState.INACTIVE?[2]:(this.state=VoiceChatState.STOPPING,[4,this._stopVoiceChat()]);case 1:return B.sent(),this._isMuted=!0,this.state=VoiceChatState.INACTIVE,[2]}})})},j.prototype._mute=function(){},j.prototype._unmute=function(){},j.prototype.mute=function(){this.isVoiceChatting&&(this._mute(),this._isMuted=!0)},j.prototype.unmute=function(){this.isVoiceChatting&&(this._unmute(),this._isMuted=!1)},j})(AbstractVoiceChat);function sleep(U){return new Promise(function(j){return setTimeout(j,U)})}function convertFloat32ToS16PCM(U){for(var j=new Int16Array(U.length),B=0;B<U.length;B++){var q=Math.max(-1,Math.min(1,U[B]));j[B]=q<0?q*32768:q*32767}return j}var LivekitVoiceChat=(function(U){__extends(j,U);function j(){var B=U!==null&&U.apply(this,arguments)||this;return B.room=null,B.track=null,B}return j.prototype._startVoiceChat=function(B){return __awaiter(this,void 0,void 0,function(){var q,V;return __generator(this,function(H){switch(H.label){case 0:return this.room=B.room,q=this,[4,createLocalAudioTrack({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0})];case 1:return q.track=H.sent(),[4,this.room.localParticipant.publishTrack(this.track)];case 2:return H.sent(),!((V=B.config)===null||V===void 0)&&V.defaultMuted?this.mute():this.unmute(),[4,sleep(4e3)];case 3:return H.sent(),[2]}})})},j.prototype._stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){var B;return __generator(this,function(q){return!((B=this.room)===null||B===void 0)&&B.localParticipant&&this.room.localParticipant.getTrackPublications().forEach(function(V){V.track&&V.track.kind===Track.Kind.Audio&&V.track.stop()}),this.track&&(this.track.stop(),this.track=null),[2]})})},j.prototype._mute=function(){this.track&&!this.track.isMuted&&this.track.mute()},j.prototype._unmute=function(){this.track&&this.track.isMuted&&this.track.unmute()},j})(AbstractVoiceChatImplementation),WebSocketVoiceChat=(function(U){__extends(j,U);function j(){var B=U!==null&&U.apply(this,arguments)||this;return B.audioContext=null,B.webSocket=null,B.scriptProcessor=null,B.mediaStreamAudioSource=null,B.mediaDevicesStream=null,B.audioRawFrame=null,B}return j.prototype._startVoiceChat=function(B){return __awaiter(this,void 0,void 0,function(){var q,V=this,H,$,K,X;return __generator(this,function(Q){switch(Q.label){case 0:if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Cannot start voice chat without media devices");return this.webSocket=B.webSocket,this.audioRawFrame=B.audioRawFrame,this.audioContext=new window.AudioContext({latencyHint:"interactive",sampleRate:16e3}),!((H=B.config)===null||H===void 0)&&H.defaultMuted||this.unmute(),[4,navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0}})];case 1:return q=Q.sent(),this.mediaDevicesStream=q,this.mediaStreamAudioSource=($=this.audioContext)===null||$===void 0?void 0:$.createMediaStreamSource(q),this.scriptProcessor=(K=this.audioContext)===null||K===void 0?void 0:K.createScriptProcessor(512,1,1),this.mediaStreamAudioSource.connect(this.scriptProcessor),this.scriptProcessor.connect((X=this.audioContext)===null||X===void 0?void 0:X.destination),this.scriptProcessor.onaudioprocess=function(W){var Z;if(!(!V.webSocket||!V.audioRawFrame)){var te;V.isMuted?te=new Float32Array(512):te=W.inputBuffer.getChannelData(0);var ie=convertFloat32ToS16PCM(te),ae=new Uint8Array(ie.buffer),oe=V.audioRawFrame.create({audio:{audio:Array.from(ae),sampleRate:16e3,numChannels:1}}),de=new Uint8Array(V.audioRawFrame.encode(oe).finish());(Z=V.webSocket)===null||Z===void 0||Z.send(de)}},[4,sleep(2e3)];case 2:return Q.sent(),[2]}})})},j.prototype._stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){var B,q;return __generator(this,function(V){return this.audioContext&&(this.audioContext=null),this.scriptProcessor&&(this.scriptProcessor.disconnect(),this.scriptProcessor=null),this.mediaStreamAudioSource&&(this.mediaStreamAudioSource.disconnect(),this.mediaStreamAudioSource=null),this.mediaDevicesStream&&((q=(B=this.mediaDevicesStream)===null||B===void 0?void 0:B.getTracks())===null||q===void 0||q.forEach(function(H){return H.stop()}),this.mediaDevicesStream=null),[2]})})},j})(AbstractVoiceChatImplementation),VoiceChatTransport;(function(U){U.LIVEKIT="livekit",U.WEBSOCKET="websocket"})(VoiceChatTransport||(VoiceChatTransport={}));var VoiceChatFactory=(function(U){__extends(j,U);function j(B){var q=B.voiceChatInstance,V=B.initialConfig,H=U.call(this)||this;return H.initialConfig=V,H.voiceChat=q,H}return Object.defineProperty(j.prototype,"isMuted",{get:function(){return this.voiceChat.isMuted},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"isVoiceChatting",{get:function(){return this.voiceChat.isVoiceChatting},enumerable:!1,configurable:!0}),j.prototype.startVoiceChat=function(B){return __awaiter(this,arguments,void 0,function(q){var V=q.config;return __generator(this,function(H){switch(H.label){case 0:return[4,this.voiceChat.startVoiceChat(__assign(__assign({},this.initialConfig),{config:V}))];case 1:return H.sent(),[2]}})})},j.prototype.stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(B){switch(B.label){case 0:return[4,this.voiceChat.stopVoiceChat()];case 1:return B.sent(),[2]}})})},j.prototype.mute=function(){this.voiceChat.mute()},j.prototype.unmute=function(){this.voiceChat.unmute()},j.createLiveKitVoiceChat=function(B){return new this({voiceChatInstance:new LivekitVoiceChat,initialConfig:B})},j.createWebSocketVoiceChat=function(B){return new this({voiceChatInstance:new WebSocketVoiceChat,initialConfig:B})},j})(AbstractVoiceChat),AvatarQuality;(function(U){U.Low="low",U.Medium="medium",U.High="high"})(AvatarQuality||(AvatarQuality={}));var VoiceEmotion;(function(U){U.EXCITED="excited",U.SERIOUS="serious",U.FRIENDLY="friendly",U.SOOTHING="soothing",U.BROADCASTER="broadcaster"})(VoiceEmotion||(VoiceEmotion={}));var ElevenLabsModel;(function(U){U.eleven_flash_v2_5="eleven_flash_v2_5",U.eleven_multilingual_v2="eleven_multilingual_v2"})(ElevenLabsModel||(ElevenLabsModel={}));var STTProvider;(function(U){U.DEEPGRAM="deepgram",U.GLADIA="gladia"})(STTProvider||(STTProvider={}));var TaskType;(function(U){U.TALK="talk",U.REPEAT="repeat"})(TaskType||(TaskType={}));var TaskMode;(function(U){U.SYNC="sync",U.ASYNC="async"})(TaskMode||(TaskMode={}));var StreamingEvents;(function(U){U.AVATAR_START_TALKING="avatar_start_talking",U.AVATAR_STOP_TALKING="avatar_stop_talking",U.AVATAR_TALKING_MESSAGE="avatar_talking_message",U.AVATAR_END_MESSAGE="avatar_end_message",U.USER_TALKING_MESSAGE="user_talking_message",U.USER_END_MESSAGE="user_end_message",U.USER_START="user_start",U.USER_STOP="user_stop",U.USER_SILENCE="user_silence",U.STREAM_READY="stream_ready",U.STREAM_DISCONNECTED="stream_disconnected",U.CONNECTION_QUALITY_CHANGED="connection_quality_changed"})(StreamingEvents||(StreamingEvents={}));var APIError=(function(U){__extends(j,U);function j(B,q,V){var H=U.call(this,B)||this;return H.name="APIError",H.status=q,H.responseText=V,H}return j})(Error),ConnectionQualityIndicatorClass=QualityIndicatorMixer({TrackerClass:LiveKitConnectionQualityIndicator,getParams:function(U){return U}},{TrackerClass:WebRTCConnectionQualityIndicator,getParams:function(U){var j;return((j=U.engine.pcManager)===null||j===void 0?void 0:j.subscriber)._pc}}),StreamingAvatar=(function(){function U(j){var B=j.token,q=j.basePath,V=q===void 0?"https://api.heygen.com":q,H=this;this.room=null,this.mediaStream=null,this.eventTarget=new EventTarget,this.webSocket=null,this.sessionId=null,this.voiceChat=null,this.isLiveKitTransport=!1,this.enablePushToTalk=!1,this.token=B,this.basePath=V,this.connectionQualityIndicator=new ConnectionQualityIndicatorClass(function($){return H.emit(StreamingEvents.CONNECTION_QUALITY_CHANGED,$)})}return Object.defineProperty(U.prototype,"connectionQuality",{get:function(){return this.connectionQualityIndicator.connectionQuality},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"isInputAudioMuted",{get:function(){var j,B;return(B=(j=this.voiceChat)===null||j===void 0?void 0:j.isMuted)!==null&&B!==void 0?B:!0},enumerable:!1,configurable:!0}),U.prototype.muteInputAudio=function(){var j;(j=this.voiceChat)===null||j===void 0||j.mute()},U.prototype.unmuteInputAudio=function(){var j;(j=this.voiceChat)===null||j===void 0||j.unmute()},U.prototype.createStartAvatar=function(j){return __awaiter(this,void 0,void 0,function(){var B;return __generator(this,function(q){switch(q.label){case 0:return[4,this.newSession(j)];case 1:return B=q.sent(),[2,this.startAvatar(j,B)]}})})},U.prototype.startAvatar=function(j,B){return __awaiter(this,void 0,void 0,function(){var q,V,H=this,$;return __generator(this,function(K){switch(K.label){case 0:this.sessionId=B.session_id,this.isLiveKitTransport=j.voiceChatTransport===VoiceChatTransport.LIVEKIT,q=new Room({adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:VideoPresets.h720.resolution}}),this.room=q,this.mediaStream=null,this.enablePushToTalk=($=j.enablePushToTalk)!==null&&$!==void 0?$:!1,q.on(RoomEvent.DataReceived,function(X){var Q=null;try{var W=new TextDecoder().decode(X);Q=JSON.parse(W)}catch(Z){console.error(Z)}Q&&H.emit(Q.type,Q)}),V=new MediaStream,q.on(RoomEvent.TrackSubscribed,function(X){if(X.kind==="video"||X.kind==="audio"){V.addTrack(X.mediaStreamTrack);var Q=V.getVideoTracks().length>0,W=V.getAudioTracks().length>0;Q&&W&&!H.mediaStream&&(H.mediaStream=V,H.emit(StreamingEvents.STREAM_READY,H.mediaStream))}}),q.on(RoomEvent.TrackUnsubscribed,function(X){var Q=X.mediaStreamTrack;Q&&V.removeTrack(Q)}),q.on(RoomEvent.Disconnected,function(X){H.emit(StreamingEvents.STREAM_DISCONNECTED,X)}),K.label=1;case 1:return K.trys.push([1,3,,4]),[4,q.prepareConnection(B.url,B.access_token)];case 2:return K.sent(),[3,4];case 3:return K.sent(),[3,4];case 4:return[4,this.startSession()];case 5:return K.sent(),[4,q.connect(B.url,B.access_token)];case 6:return K.sent(),[4,this.connectWebSocket({useSilencePrompt:!!j.useSilencePrompt})];case 7:return K.sent(),this.initVoiceChat(j.voiceChatTransport||VoiceChatTransport.WEBSOCKET),this.connectionQualityIndicator.start(q),[2,B]}})})},U.prototype.startVoiceChat=function(){return __awaiter(this,arguments,void 0,function(j){var B,q=j===void 0?{}:j,V=q.isInputAudioMuted;return __generator(this,function(H){switch(H.label){case 0:return[4,(B=this.voiceChat)===null||B===void 0?void 0:B.startVoiceChat({config:{defaultMuted:V}})];case 1:return H.sent(),[2]}})})},U.prototype.closeVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){var j;return __generator(this,function(B){switch(B.label){case 0:return[4,(j=this.voiceChat)===null||j===void 0?void 0:j.stopVoiceChat()];case 1:return B.sent(),[2]}})})},U.prototype.newSession=function(j){return __awaiter(this,void 0,void 0,function(){var B,q,V,H,$;return __generator(this,function(K){return[2,this.request("/v1/streaming.new",{avatar_name:j.avatarName,quality:j.quality,knowledge_base_id:j.knowledgeId,knowledge_base:j.knowledgeBase,voice:{voice_id:(B=j.voice)===null||B===void 0?void 0:B.voiceId,rate:(q=j.voice)===null||q===void 0?void 0:q.rate,emotion:(V=j.voice)===null||V===void 0?void 0:V.emotion,elevenlabs_settings:__assign(__assign({},(H=j==null?void 0:j.voice)===null||H===void 0?void 0:H.elevenlabsSettings),{model_id:($=j.voice)===null||$===void 0?void 0:$.model})},language:j.language,version:"v2",video_encoding:"H264",source:"sdk",disable_idle_timeout:j.disableIdleTimeout,stt_settings:j.sttSettings,ia_is_livekit_transport:j.voiceChatTransport===VoiceChatTransport.LIVEKIT,silence_response:j.useSilencePrompt,activity_idle_timeout:j.activityIdleTimeout})]})})},U.prototype.startSession=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){return[2,this.request("/v1/streaming.start",{session_id:this.sessionId})]})})},U.prototype.speak=function(j){return __awaiter(this,void 0,void 0,function(){var B,q;return __generator(this,function(V){if(B=j.taskType||j.task_type||TaskType.TALK,q=j.taskMode||TaskMode.ASYNC,B===TaskType.TALK&&q===TaskMode.ASYNC){if(this.isLiveKitTransport&&this.room)return this.sendLivekitMessage(j.text),[2];if(!this.isLiveKitTransport&&this.webSocket&&this.audioRawFrame)return this.sendWebsocketMessage(j.text),[2]}return[2,this.request("/v1/streaming.task",{text:j.text,session_id:this.sessionId,task_mode:j.taskMode,task_type:j.taskType})]})})},U.prototype.startListening=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){return[2,this.request("/v1/streaming.start_listening",{session_id:this.sessionId})]})})},U.prototype.stopListening=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){return[2,this.request("/v1/streaming.stop_listening",{session_id:this.sessionId})]})})},U.prototype.interrupt=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){return[2,this.request("/v1/streaming.interrupt",{session_id:this.sessionId})]})})},U.prototype.stopAvatar=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){return this.closeVoiceChat(),this.connectionQualityIndicator.stop(),this.voiceChat=null,this.webSocket&&(this.webSocket.close(),this.webSocket=null),[2,this.request("/v1/streaming.stop",{session_id:this.sessionId})]})})},U.prototype.pushToTalkStart=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){if(!this.isLiveKitTransport)throw new Error("push to talk is only supported for LiveKit transport");if(!this.enablePushToTalk)throw new Error("push to talk is not enabled");if(!this.voiceChat.isVoiceChatting)throw new Error("voice chat is not active");if(!this.room)throw new Error("room is not initialized");return[2,this.sendLivekitMessage("push_to_talk:start")]})})},U.prototype.pushToTalkStop=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){if(!this.isLiveKitTransport)throw new Error("push to talk is only supported for LiveKit transport");if(!this.enablePushToTalk)throw new Error("push to talk is not enabled");if(this.voiceChat.isVoiceChatting||console.log("voice chat is not active"),!this.room)throw new Error("room is not initialized");return[2,this.sendLivekitMessage("push_to_talk:stop")]})})},U.prototype.keepAlive=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){return[2,this.request("/v1/streaming.keep_alive",{session_id:this.sessionId})]})})},U.prototype.on=function(j,B){return this.eventTarget.addEventListener(j,B),this},U.prototype.off=function(j,B){return this.eventTarget.removeEventListener(j,B),this},U.prototype.sendLivekitMessage=function(j){return __awaiter(this,void 0,void 0,function(){var B;return __generator(this,function(q){return this.room?(B=new TextEncoder().encode(JSON.stringify(j)),this.room.localParticipant.publishData(B,{reliable:!0}),[2]):[2]})})},U.prototype.sendWebsocketMessage=function(j){return __awaiter(this,void 0,void 0,function(){var B,q,V,H;return __generator(this,function($){return!this.webSocket||!this.audioRawFrame?[2]:(B=(V=this.audioRawFrame)===null||V===void 0?void 0:V.create({text:{text:j}}),q=new Uint8Array((H=this.audioRawFrame)===null||H===void 0?void 0:H.encode(B).finish()),this.webSocket.send(q),[2])})})},U.prototype.initVoiceChat=function(j){if(j===VoiceChatTransport.WEBSOCKET){if(this.loadAudioRawFrame(),!this.audioRawFrame||!this.webSocket)return;this.voiceChat=VoiceChatFactory.createWebSocketVoiceChat({webSocket:this.webSocket,audioRawFrame:this.audioRawFrame})}else{if(!this.room)return;this.voiceChat=VoiceChatFactory.createLiveKitVoiceChat({room:this.room})}},U.prototype.request=function(j,B,q){return __awaiter(this,void 0,void 0,function(){var V,H,$,K;return __generator(this,function(X){switch(X.label){case 0:return X.trys.push([0,5,,6]),[4,fetch(this.getRequestUrl(j),{method:"POST",headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json"},body:JSON.stringify(B)})];case 1:return V=X.sent(),V.ok?[3,3]:[4,V.text()];case 2:throw H=X.sent(),new APIError("API request failed with status ".concat(V.status),V.status,H);case 3:return[4,V.json()];case 4:return $=X.sent(),[2,$.data];case 5:throw K=X.sent(),K;case 6:return[2]}})})},U.prototype.emit=function(j,B){var q=new CustomEvent(j,{detail:B});this.eventTarget.dispatchEvent(q)},U.prototype.getRequestUrl=function(j){return"".concat(this.basePath).concat(j)},U.prototype.connectWebSocket=function(j){return __awaiter(this,void 0,void 0,function(){var B,q=this;return __generator(this,function(V){return B="wss://".concat(new URL(this.basePath).hostname,"/v1/ws/streaming.chat?session_id=").concat(this.sessionId,"&session_token=").concat(this.token).concat(this.isLiveKitTransport?"&arch_version=v2":"","&silence_response=").concat(j.useSilencePrompt,"&push_to_talk=").concat(this.enablePushToTalk),this.webSocket=new WebSocket(B),this.webSocket.addEventListener("message",function(H){var $=null;try{$=JSON.parse(H.data)}catch(K){console.error(K);return}$&&q.emit($.event_type,$)}),this.webSocket.addEventListener("close",function(H){q.webSocket=null}),[2,new Promise(function(H,$){var K,X;(K=q.webSocket)===null||K===void 0||K.addEventListener("error",function(Q){q.webSocket=null,$(Q)}),(X=q.webSocket)===null||X===void 0||X.addEventListener("open",function(){H(!0)})})]})})},U.prototype.loadAudioRawFrame=function(){return __awaiter(this,void 0,void 0,function(){var j;return __generator(this,function(B){return this.audioRawFrame||(j=protobuf.Root.fromJSON(jsonDescriptor),this.audioRawFrame=j==null?void 0:j.lookupType("pipecat.Frame")),[2]})})},U})();const AvatarVideo=reactExports.forwardRef(({isVisible:U,onAvatarReady:j},B)=>{const[q,V]=reactExports.useState("inactive"),[H,$]=reactExports.useState(null),[K,X]=reactExports.useState(ConnectionQuality.UNKNOWN),Q=reactExports.useRef(null),W=reactExports.useRef(null),Z=reactExports.useCallback(({detail:ue})=>{console.log("[Avatar] Stream ready, tracks:",ue.getTracks().length),B&&"current"in B&&B.current?(B.current.srcObject=ue,B.current.muted=!0,B.current.onloadedmetadata=()=>{var he;console.log("[Avatar] Video metadata loaded, attempting play"),(he=B.current)==null||he.play().then(()=>{console.log("[Avatar] Video playing"),B.current&&(B.current.muted=!1)}).catch(me=>console.error("[Avatar] Video play error:",me))}):console.error("[Avatar] Video ref not available"),V("connected"),$(null),j==null||j()},[B,j]),te=reactExports.useCallback(async()=>{if(Q.current){Q.current.off(StreamingEvents.STREAM_READY,Z),Q.current.off(StreamingEvents.STREAM_DISCONNECTED,te);try{await Q.current.stopAvatar()}catch{console.log("[Avatar] Cleanup completed")}Q.current=null,V("inactive"),W.current=null}},[Z]),ie=reactExports.useCallback(async()=>{if(q!=="inactive"){console.log("[Avatar] Session already active");return}try{V("connecting");const ue=await fetch(`${HEYGEN_API_URL}/api/heygen/token`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!ue.ok)throw new Error(`Failed to get token: ${ue.status}`);const he=await ue.json(),me=he.token,be=he.avatarId||"SilasHR_public";if(!me)throw new Error("No token received");Q.current=new StreamingAvatar({token:me}),Q.current.on(StreamingEvents.STREAM_READY,Z),Q.current.on(StreamingEvents.STREAM_DISCONNECTED,te),Q.current.on(StreamingEvents.CONNECTION_QUALITY_CHANGED,({detail:Ee})=>{X(Ee)});const ge=await Q.current.createStartAvatar({quality:AvatarQuality.High,avatarName:be,knowledgeId:void 0,voice:{rate:1,emotion:VoiceEmotion.FRIENDLY},language:"en",activityIdleTimeout:600,useSilencePrompt:!1});W.current=ge.session_id,console.log("[Avatar] Session started:",ge.session_id)}catch(ue){console.error("[Avatar] Failed to start:",ue),V("error"),$(ue instanceof Error?ue.message:"Failed to connect"),Q.current=null}},[q,Z,te]),ae=reactExports.useCallback(ue=>{Q.current&&q==="connected"&&(console.log("[Avatar] Speaking:",ue.substring(0,50)+"..."),Q.current.speak({text:ue,task_type:TaskType.REPEAT,taskMode:TaskMode.ASYNC}).catch(he=>{console.error("[Avatar] Speak failed:",he)}))},[q]);if(reactExports.useEffect(()=>(window.avatarSpeak=ae,()=>{delete window.avatarSpeak}),[ae]),reactExports.useEffect(()=>{if(q!=="connected")return;console.log("[Avatar] Starting keep-alive mechanism");const ue=setInterval(()=>{Q.current&&(console.log("[Avatar] Sending keep-alive ping"),Q.current.keepAlive().catch(he=>{console.error("[Avatar] Keep-alive failed:",he)}))},6e4);return()=>{console.log("[Avatar] Stopping keep-alive mechanism"),clearInterval(ue)}},[q]),reactExports.useEffect(()=>{U&&q==="inactive"?ie():!U&&q!=="inactive"&&te()},[U]),reactExports.useEffect(()=>()=>{Q.current&&te()},[]),!U)return null;const oe=q==="connected",de=q==="connecting",le=q==="error";return jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 w-full h-full bg-black",children:[jsxRuntimeExports.jsx("video",{ref:B,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),oe&&K!==ConnectionQuality.UNKNOWN&&jsxRuntimeExports.jsx("div",{className:"absolute top-4 right-4 z-10",children:jsxRuntimeExports.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${K===ConnectionQuality.GOOD?"bg-green-500/80 text-white":"bg-red-500/80 text-white"}`,children:K===ConnectionQuality.GOOD?" Good":" Poor"})}),!oe&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:jsxRuntimeExports.jsx("div",{className:"text-center text-white max-w-md px-6",children:de?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"mb-4",children:jsxRuntimeExports.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),jsxRuntimeExports.jsx("div",{className:"text-xl mb-2",children:"Connecting to Avatar..."})]}):le?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-xl mb-4 text-red-300",children:H||"Connection failed"}),jsxRuntimeExports.jsx("button",{onClick:ie,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors font-medium",children:"Retry Connection"})]}):jsxRuntimeExports.jsx("div",{className:"text-xl",children:"Initializing..."})})})]})});AvatarVideo.displayName="AvatarVideo";const ChatbotPage=React.memo(({isLoggedIn:U,isChatVisible:j,isAvatarVisible:B,messages:q,isLoading:V,sendMessage:H})=>{const[$,K]=React.useState(""),{isRecording:X,statusMessage:Q,handleMicClick:W}=useAudioRecorder({onTranscriptionComplete:async ie=>{K(ie)}}),Z=reactExports.useRef(null),te=React.useCallback(()=>{if(console.log("Avatar is ready!"),q.length>0&&q[0].role==="model"){const ie=q[0].parts[0].text;console.log("Speaking initial message:",ie),setTimeout(()=>{window.avatarSpeak?(console.log("Attempting to speak initial message now"),window.avatarSpeak(ie)):console.error("avatarSpeak not available")},300)}},[q]);return jsxRuntimeExports.jsxs("div",{className:"w-full h-full md:h-auto md:max-w-7xl md:max-h-[calc(100vh-12rem)] md:mx-auto md:aspect-[16/9] md:rounded-2xl md:shadow-2xl relative overflow-hidden md:border md:border-gray-200",style:{backgroundImage:"url(/abbotsford-red-hook.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[jsxRuntimeExports.jsx(AvatarVideo,{ref:Z,isVisible:B,onAvatarReady:te}),!B&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40 z-[5]"}),jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex flex-col z-10",children:[j&&jsxRuntimeExports.jsx(ChatMessageArea,{messages:q}),jsxRuntimeExports.jsx(ChatInput,{isLoading:V,isRecording:X,statusMessage:Q,onSendMessage:H,onMicClick:W,transcribedText:$,onTranscribedTextUsed:()=>K("")})]})]})});ChatbotPage.displayName="ChatbotPage";const HomeButton=({onClick:U,theme:j="dark"})=>{const B=j==="light"?"bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-500":"bg-white/20 text-white hover:bg-white/30 focus:ring-white/50";return jsxRuntimeExports.jsx("button",{onClick:U,className:`w-10 h-10 flex items-center justify-center rounded-full hover:scale-110 hover:shadow-lg transition-all duration-200 ease-in-out shadow-md focus:outline-none focus:ring-2 ${B}`,"aria-label":"Go to Homepage",children:jsxRuntimeExports.jsx(HomeIcon,{className:"w-6 h-6"})})},LoginButton=({isLoggedIn:U,isLoading:j,onClick:B})=>{const q=j?"Logging out...":U?"Logout":"Login";return jsxRuntimeExports.jsx("button",{onClick:B,disabled:j,className:"px-4 py-2 bg-blue-600 text-white rounded-full font-semibold hover:bg-blue-700 hover:scale-105 hover:shadow-lg transition-all duration-200 ease-in-out shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-400 disabled:cursor-wait disabled:scale-100","aria-label":U?"Logout":"Login",children:q})},AppHeader=({currentPage:U,isLoggedIn:j,isAuthLoading:B,onHomeClick:q,onLoginClick:V,isMobile:H,onMenuClick:$})=>{const K=U==="crm"?"light":"dark",X="text-black";return H?jsxRuntimeExports.jsxs("header",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-20",children:[jsxRuntimeExports.jsx("button",{onClick:$,className:`p-2 rounded-full hover:bg-black/10 ${X}`,children:jsxRuntimeExports.jsx(HamburgerIcon,{className:"w-6 h-6"})}),U==="crm"&&jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Chatbot CRM"})]}):jsxRuntimeExports.jsxs("header",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-30",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[U!=="home"&&jsxRuntimeExports.jsx(HomeButton,{onClick:q,theme:K}),U==="crm"&&jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Chatbot CRM"})]}),U!=="login"&&jsxRuntimeExports.jsx(LoginButton,{isLoggedIn:j,isLoading:B,onClick:V})]})},Sidebar=({isOpen:U,onClose:j,currentPage:B,isLoggedIn:q,isAuthLoading:V,onHomeClick:H,onLoginClick:$,isChatVisible:K,onToggleChat:X,onToggleAvatar:Q,isAvatarVisible:W})=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:`fixed inset-0 bg-black/50 z-40 transition-opacity duration-300 ${U?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:j}),jsxRuntimeExports.jsx("div",{className:`fixed top-0 left-0 h-full w-72 bg-slate-800 text-white shadow-xl z-50 transform transition-transform duration-300 ease-in-out ${U?"translate-x-0":"-translate-x-full"}`,children:jsxRuntimeExports.jsxs("div",{className:"p-6 flex flex-col h-full",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-8",children:"Menu"}),jsxRuntimeExports.jsxs("nav",{className:"flex flex-col space-y-4",children:[B!=="home"&&jsxRuntimeExports.jsx("button",{onClick:H,className:"text-left text-lg hover:bg-slate-700 p-2 rounded-md",children:"Home"}),B!=="login"&&jsxRuntimeExports.jsx("button",{onClick:$,className:"text-left text-lg hover:bg-slate-700 p-2 rounded-md",children:q?V?"Logging out...":"Logout":"Login"}),B==="chatbot"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("hr",{className:"border-slate-600 my-4"}),jsxRuntimeExports.jsx("button",{onClick:Q,className:"text-left text-lg hover:bg-slate-700 p-2 rounded-md",children:W?"Avatar Off":"Avatar On"}),jsxRuntimeExports.jsx("button",{onClick:X,className:"text-left text-lg hover:bg-slate-700 p-2 rounded-md",children:K?"Hide Chat":"Show Chat"})]})]})]})})]}),useMediaQuery=U=>{const[j,B]=reactExports.useState(()=>window.matchMedia(U).matches);return reactExports.useEffect(()=>{const q=window.matchMedia(U),V=H=>{B(H.matches)};return q.addEventListener("change",V),()=>{q.removeEventListener("change",V)}},[U]),j},useChat=U=>{const j=reactExports.useCallback(()=>{let K="Hey! I'm Logan from Abbotsford Road Coffee. I help folks opening new cafs, support existing caf owners, and answer any coffee questions you've got. What brings you by?";if(U){const X=getUser$1();K=`Hey ${(X==null?void 0:X.name)||"there"}! Welcome back. I'm here to help with any issues, discuss improvements, or answer questions about your caf operations. What can I do for you today?`}return[{role:"model",parts:[{text:K}]}]},[U]),[B,q]=reactExports.useState(j()),[V,H]=reactExports.useState(!1);reactExports.useEffect(()=>{initChat(),q(j())},[U,j]);const $=reactExports.useCallback(async K=>{if(!K.trim()||V)return;H(!0);const X={role:"user",parts:[{text:K}]};q(Q=>[...Q,X]);try{const Q=await sendMessage(K,U);let W="";q(Z=>[...Z,{role:"model",parts:[{text:""}]}]);for await(const Z of Q){const te=Z.text;W+=te,q(ie=>{const ae=[...ie],oe=ae[ae.length-1];return oe.parts[0].text=W,ae})}window.avatarSpeak&&W.trim()&&(console.log("Triggering avatar to speak:",W),window.avatarSpeak(W))}catch(Q){const W=handleApiError(Q);q(Z=>[...Z,{role:"model",parts:[{text:W}]}])}finally{H(!1)}},[V,U]);return{messages:B,isLoading:V,sendMessage:$}},App=()=>{const[U,j]=reactExports.useState("home"),[B,q]=reactExports.useState(()=>isAuthenticated()),[V,H]=reactExports.useState(!1),[$,K]=reactExports.useState("home"),[X,Q]=reactExports.useState(!0),[W,Z]=reactExports.useState(!1),[te,ie]=reactExports.useState(!1),[ae,oe]=reactExports.useState("outbound"),de=useMediaQuery("(max-width: 768px)"),{messages:le,isLoading:ue,sendMessage:he}=useChat(ae==="inbound"),me=async()=>{if(B){H(!0);try{await logout(),q(!1),j("home")}catch(Ie){console.error("Logout failed",Ie)}finally{H(!1)}}else K(U==="login"?"home":U),j("login")},be=()=>{q(!0),j($)},ge=()=>{if(B){const Ie=getUser$1();Ie&&Ie.role==="admin"?j("crm"):alert("Access Denied: Only administrators can access the CRM.")}else K("crm"),j("login")},Ee=()=>{Q(Ie=>!Ie)},Fe=()=>{Z(Ie=>{const Ge=!Ie;return Ge&&Q(!1),Ge})},Ue=()=>{j("home"),ie(!1)},ze=()=>{B?j("chatbot"):(K("chatbot"),j("login"))};React.useEffect(()=>{U==="chatbot"&&!B&&(K("chatbot"),j("login"))},[U,B]);const xe=()=>{switch(U){case"chatbot":return B?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ChatbotPage,{isLoggedIn:B,isChatVisible:X,isAvatarVisible:W,messages:le,isLoading:ue,sendMessage:he},`chatbot-${ae}`),jsxRuntimeExports.jsxs("div",{className:"fixed top-20 right-4 z-30 bg-white/10 backdrop-blur-lg rounded-lg p-3 border border-white/20",children:[jsxRuntimeExports.jsx("div",{className:"text-white text-sm font-medium mb-2",children:"Chat Mode:"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>oe("outbound"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${ae==="outbound"?"bg-blue-600 text-white":"bg-white/20 text-white/70 hover:bg-white/30"}`,children:"Lead Gen"}),jsxRuntimeExports.jsx("button",{onClick:()=>oe("inbound"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${ae==="inbound"?"bg-green-600 text-white":"bg-white/20 text-white/70 hover:bg-white/30"}`,children:"Support"})]})]})]}):(K("chatbot"),j("login"),jsxRuntimeExports.jsx(LoginPage,{onLoginSuccess:be}));case"crm":return jsxRuntimeExports.jsx(CrmPage,{});case"login":return jsxRuntimeExports.jsx(LoginPage,{onLoginSuccess:be});case"home":default:return jsxRuntimeExports.jsx(HomePage,{onNavigateToChatbot:ze,onNavigateToCrm:ge})}};return jsxRuntimeExports.jsxs(PageWrapper,{isFullScreen:U==="crm",bgClass:"bg-main-dark",children:[de&&jsxRuntimeExports.jsx(Sidebar,{isOpen:te,onClose:()=>ie(!1),currentPage:U,isLoggedIn:B,isAuthLoading:V,onHomeClick:Ue,onLoginClick:me,isChatVisible:X,onToggleChat:Ee,onToggleAvatar:Fe,isAvatarVisible:W}),jsxRuntimeExports.jsx(AppHeader,{currentPage:U,isLoggedIn:B,isAuthLoading:V,onHomeClick:Ue,onLoginClick:me,isMobile:de,onMenuClick:()=>ie(!0)}),xe(),!de&&U==="chatbot"&&jsxRuntimeExports.jsxs("div",{className:"chatbot-controls absolute left-1/2 -translate-x-1/2 flex items-center space-x-4 z-20",children:[jsxRuntimeExports.jsx("button",{onClick:Fe,className:"px-5 py-2 bg-white/20 backdrop-blur-sm text-white rounded-full font-semibold hover:bg-white/30 transition-colors duration-200 shadow-lg",children:W?"Avatar Off":"Avatar On"}),jsxRuntimeExports.jsx("button",{onClick:Ee,className:"px-5 py-2 bg-white/20 backdrop-blur-sm text-white rounded-full font-semibold hover:bg-white/30 transition-colors duration-200 shadow-lg",children:X?"Hide Chat":"Show Chat"})]})]})},rootElement=document.getElementById("root");if(!rootElement)throw new Error("Could not find root element to mount to");const root=ReactDOM.createRoot(rootElement);root.render(jsxRuntimeExports.jsx(App,{}));
